<!DOCTYPE html>
<html lang="fr">
<head>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KGHT97MD');</script>
<!-- End Google Tag Manager -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C2D5ENP3F1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-C2D5ENP3F1');
</script>

<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="TypixClin" />
<link rel="manifest" href="/site.webmanifest" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Planning de Révision EDN - Organisez et suivez vos révisions pour l'examen national">
<title>Tableur Révision EDN - TypixClin</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #3b82f6;
    --primary-dark: #1d4ed8;
    --primary-light: #60a5fa;
    --primary-gradient: linear-gradient(135deg, #3b82f6, #2563eb);
    --secondary: #475569;
    --accent: #8b5cf6;
    --background: #f5f8ff;
    --white: #ffffff;
    --black: #111827;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --success: #10b981;
    --success-light: #d1fae5;
	--success-dark: #059669;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    --danger: #ef4444;
    --danger-light: #fee2e2;
    --confidence-1: #991b1b;
    --confidence-2: #dc2626;
    --confidence-3: #f59e0b;
    --confidence-4: #22c55e;
    --confidence-5: #15803d;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-blue: 0 10px 25px -5px rgba(59, 130, 246, 0.5);
    --header-height: 70px;
    --container-max-width: 1400px;
    --border-radius-sm: 0.375rem;
    --border-radius-md: 0.5rem;
    --border-radius-lg: 1rem;
    --border-radius-xl: 1.5rem;
    --border-radius-full: 9999px;
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    --font-display: 'Outfit', sans-serif;
    --font-body: 'Space Grotesk', sans-serif;
    --z-elevated: 10;
    --z-sticky: 100;
    --z-dropdown: 200;
    --z-modal: 300;
	--z-toast: 400;
    --z-max: 9999;
}

[data-theme="dark"] {
    --primary: #60a5fa;
    --primary-dark: #3b82f6;
    --primary-light: #93c5fd;
    --primary-gradient: linear-gradient(135deg, #a855f7, #8b5cf6);
    --background: #0f172a;
    --white: #1e293b;
    --black: #f9fafb;
    --gray-900: #f9fafb;
    --gray-800: #f3f4f6;
    --gray-700: #e5e7eb;
    --gray-600: #d1d5db;
    --gray-500: #9ca3af;
    --gray-400: #6b7280;
    --gray-300: #4b5563;
    --gray-200: #374151;
    --gray-100: #1f2937;
    --gray-50: #111827;
    --success-light: rgba(16, 185, 129, 0.2);
    --warning-light: rgba(245, 158, 11, 0.2);
    --danger-light: rgba(239, 68, 68, 0.2);
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 16px; scroll-behavior: smooth; }
body { font-family: var(--font-body); background-color: var(--background); color: var(--gray-800); line-height: 1.6; overflow-x: hidden; min-height: 100vh; transition: background-color var(--transition-normal), color var(--transition-normal); }
h1, h2, h3, h4, h5, h6 { font-family: var(--font-display); font-weight: 700; line-height: 1.2; color: var(--gray-900); }
a { text-decoration: none; color: var(--primary); transition: color var(--transition-normal); }
button { cursor: pointer; font-family: var(--font-body); border: none; background: none; transition: all var(--transition-normal); }
.container { width: 100%; max-width: var(--container-max-width); margin: 0 auto; padding: 0 1.5rem; }

@media (max-width: 768px) {
    .container {
        padding: 0 0.75rem;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 0 0.5rem;
    }
    
    .section-card {
        border-radius: var(--border-radius-md);
    }
    
    .section-body {
        padding: 0.75rem;
    }
}




@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
@keyframes gradientFlow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

/* ===== LOADER ===== */
.loader-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--background);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: var(--z-max);
    transition: opacity var(--transition-slow), visibility var(--transition-slow);
}

.loader {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
}

.loader-logo {
    width: 120px;
    height: 120px;
    position: relative;
}

.loader-logo::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 4px solid var(--gray-200);
    border-top-color: var(--primary);
    animation: spin 1s linear infinite;
}

.loader-text {
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 800;
    color: var(--primary);
    letter-spacing: -0.05em;
    position: relative;
}

.loader-text::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--primary-gradient);
    background-size: 200% 200%;
    animation: gradientFlow 2s ease infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}


/* ===== HEADER ===== */
.header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: var(--header-height);
    z-index: var(--z-sticky);
    transition: transform var(--transition-normal), background-color var(--transition-normal), box-shadow var(--transition-normal);
    background-color: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

[data-theme="dark"] .header {
    background-color: rgba(30, 41, 59, 0.9);
}

.header.scrolled {
    box-shadow: var(--shadow-md);
}

.header-container {
    height: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-family: var(--font-display);
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--primary);
    letter-spacing: -0.05em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.logo-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background: var(--primary-gradient);
    border-radius: var(--border-radius-md);
    color: white;
    font-size: 1.5rem;
}

.logo:hover .logo-icon {
    animation: pulse 1s infinite;
}

.nav {
    display: flex;
    align-items: center;
}

.nav-items {
    display: flex;
    list-style: none;
    gap: 2rem;
}

.nav-link {
    font-weight: 500;
    color: var(--gray-700);
    transition: color var(--transition-normal), transform var(--transition-normal);
    position: relative;
}

.nav-link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary-gradient);
    transition: width var(--transition-normal);
}

.nav-link:hover {
    color: var(--primary);
    transform: translateY(-2px);
}

.nav-link:hover::after {
    width: 100%;
}

/* ========================================= */
/* INDICATEUR DE SAUVEGARDE DANS LE HEADER */
/* ========================================= */
.save-indicator-header {
    display: none; /* Caché par défaut */
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: transparent;
    border-radius: var(--border-radius-full);
    color: var(--gray-400);
    font-size: 1rem;
    margin-left: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
}

.save-indicator-header.visible {
    display: flex;
}

/* État : En attente de sauvegarde (icône rotation) */
.save-indicator-header.pending {
    color: var(--gray-400);
}

.save-indicator-header.pending i {
    animation: rotate 1.5s linear infinite;
}

/* État : Sauvegarde en cours (icône rotation rapide) */
.save-indicator-header.saving {
    color: var(--primary);
}

.save-indicator-header.saving i {
    animation: rotate 0.8s linear infinite;
}

/* État : Sauvegardé (icône check verte) */
.save-indicator-header.saved {
    color: var(--success);
}

.save-indicator-header.saved i {
    animation: none;
}

/* Animation de rotation pour les flèches circulaires */
@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Mode sombre */
[data-theme="dark"] .save-indicator-header.pending {
    color: var(--gray-500);
}

[data-theme="dark"] .save-indicator-header.saving {
    color: var(--primary-light);
}

[data-theme="dark"] .save-indicator-header.saved {
    color: var(--success);
}

/* Responsive */
@media (max-width: 768px) {
    .save-indicator-header {
        width: 28px;
        height: 28px;
        font-size: 0.9rem;
        margin-left: 1rem;
    }
}

.theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--gray-100);
    border-radius: var(--border-radius-full);
    color: var(--gray-600);
    font-size: 1.25rem;
    cursor: pointer;
    margin-left: 2rem;
    transition: all var(--transition-normal);
}

[data-theme="dark"] .theme-toggle {
    background: var(--gray-800);
    color: var(--gray-300);
}

.theme-toggle:hover {
    background: var(--primary-light);
    color: white;
    transform: rotate(15deg);
}

.mobile-menu-btn {
    display: none;
    font-size: 1.5rem;
    color: var(--gray-700);
    transition: color var(--transition-normal);
}

.mobile-menu-btn:hover {
    color: var(--primary);
}

@media (max-width: 992px) {
    .nav-items {
        display: none;
    }
    
    .mobile-menu-btn {
        display: block;
    }
    
    .theme-toggle {
        margin-left: 1.5rem;
        margin-right: 0.5rem;
    }
}

/* Mobile menu */
.mobile-menu {
    position: fixed;
    top: var(--header-height);
    left: 0;
    width: 100%;
    background-color: var(--white);
    padding: 2rem;
    z-index: calc(var(--z-sticky) - 1);
    box-shadow: var(--shadow-lg);
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
    transition: transform var(--transition-normal), opacity var(--transition-normal), visibility var(--transition-normal);
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.mobile-menu.active {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
}

.mobile-menu .nav-link {
    font-size: 1.25rem;
    display: block;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--gray-200);
}

.user-auth { display: flex; align-items: center; margin-left: 1rem; position: relative; }
.auth-btn { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: var(--gray-100); border-radius: var(--border-radius-full); color: var(--gray-600); font-size: 1.1rem; cursor: pointer; border: none; }
[data-theme="dark"] .auth-btn { background: var(--gray-800); color: var(--gray-300); }
.auth-btn:hover { background: var(--primary-light); color: white; }
.user-avatar { width: 40px; height: 40px; border-radius: var(--border-radius-full); background: var(--primary-gradient); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1rem; cursor: pointer; border: 2px solid transparent; text-transform: uppercase; }
.user-avatar:hover { border-color: var(--primary-light); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
.user-avatar img { width: 100%; height: 100%; border-radius: var(--border-radius-full); object-fit: cover; }
.profile-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background: var(--white); border-radius: var(--border-radius-lg); box-shadow: var(--shadow-xl); border: 1px solid var(--gray-200); min-width: 220px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all var(--transition-normal); z-index: var(--z-dropdown); overflow: hidden; }
.profile-dropdown.active { opacity: 1; visibility: visible; transform: translateY(0); }
.profile-header { padding: 1rem; border-bottom: 1px solid var(--gray-200); background: var(--gray-50); }
.profile-name { font-weight: 600; color: var(--gray-900); font-size: 0.95rem; margin-bottom: 0.2rem; }
.profile-email { font-size: 0.8rem; color: var(--gray-500); word-break: break-all; }
.profile-menu { padding: 0.5rem 0; }
.profile-menu-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: var(--gray-700); font-size: 0.9rem; cursor: pointer; border: none; background: none; width: 100%; text-align: left; }
.profile-menu-item:hover { background: var(--gray-100); color: var(--primary); }
.profile-menu-item.logout { color: #dc2626; }
.profile-menu-item.logout:hover { background: #fef2f2; }
.user-auth .auth-btn { display: flex; }
.user-auth .user-avatar { display: none; }
.user-auth .profile-dropdown { display: none; }
.user-auth.logged-in .auth-btn { display: none; }
.user-auth.logged-in .user-avatar { display: flex; }
.user-auth.logged-in .profile-dropdown { display: block; }

@media (max-width: 992px) {
    .nav-items { display: none; }
    .mobile-menu-btn { display: block; }
    .theme-toggle { margin-left: 1.5rem; }
}

.mobile-menu { position: fixed; top: var(--header-height); left: 0; width: 100%; background-color: var(--white); padding: 2rem; z-index: calc(var(--z-sticky) - 1); box-shadow: var(--shadow-lg); transform: translateY(-100%); opacity: 0; visibility: hidden; transition: all var(--transition-normal); display: flex; flex-direction: column; gap: 1.5rem; }
.mobile-menu.active { transform: translateY(0); opacity: 1; visibility: visible; }

.page-header { padding-top: calc(var(--header-height) + 2rem); padding-bottom: 1.5rem; background: linear-gradient(135deg, rgba(239, 246, 255, 0.8) 0%, rgba(219, 234, 254, 0.8) 100%); text-align: center; }
[data-theme="dark"] .page-header { background: linear-gradient(135deg, rgba(17, 24, 39, 0.8) 0%, rgba(31, 41, 55, 0.8) 100%); }
.page-title { font-size: 2.2rem; font-weight: 800; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem; animation: fadeInUp var(--transition-slow) forwards; }
.page-subtitle { font-size: 1rem; color: var(--gray-600); max-width: 600px; margin: 0 auto 1rem; }
.back-home-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.2rem; background: var(--primary-gradient); color: white; font-weight: 600; font-size: 0.9rem; border-radius: var(--border-radius-full); box-shadow: var(--shadow-md); transition: all var(--transition-normal); }
.back-home-btn:hover { transform: translateY(-3px); box-shadow: var(--shadow-blue); color: white; }

.login-required { padding: 2rem 1.5rem; text-align: center; }
.login-required-card { background: var(--white); border-radius: var(--border-radius-xl); box-shadow: var(--shadow-xl); padding: 2rem 1rem; max-width: 400px; margin: 0 auto; border: 1px solid var(--gray-200); }
.login-required-icon { width: 80px; height: 80px; background: linear-gradient(135deg, var(--gray-100), var(--gray-200)); border-radius: var(--border-radius-full); display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 2.5rem; color: var(--gray-400); }
.login-required-title { font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.75rem; }
.login-required-text { color: var(--gray-600); margin-bottom: 2rem; line-height: 1.7; }
.login-required-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 1rem 2rem; background: var(--primary-gradient); color: white; font-weight: 600; font-size: 1rem; border-radius: var(--border-radius-full); box-shadow: var(--shadow-blue); transition: all var(--transition-normal); }
.login-required-btn:hover { transform: translateY(-3px); color: white; }

.login-required-text { color: var(--gray-600); margin-bottom: 1.5rem; line-height: 1.6; font-size: 0.95rem; }
.login-required-scroll-hint { 
    margin-top: 1.5rem; 
    padding-top: 1.5rem; 
    border-top: 1px solid var(--gray-200); 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    gap: 0.5rem; 
    color: var(--gray-500); 
    font-size: 0.9rem;
    text-decoration: none;
    transition: color var(--transition-normal);
}
.login-required-scroll-hint:hover { color: var(--primary); }
.login-required-scroll-hint i { font-size: 1.2rem; color: var(--primary); animation: bounce 2s infinite; }
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(5px); }
}


.main-content { padding: 1.5rem; display: none; min-height: calc(100vh - var(--header-height) - 200px); }
.main-content.active { display: block; }

.app-nav { background: var(--white); border-radius: var(--border-radius-xl); box-shadow: var(--shadow-md); padding: 0.5rem; margin-bottom: 1.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap; border: 1px solid var(--gray-200); }
.app-nav-btn { flex: 1; min-width: 140px; padding: 0.875rem 1.25rem; background: transparent; border: none; border-radius: var(--border-radius-lg); font-weight: 600; font-size: 0.95rem; color: var(--gray-600); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
.app-nav-btn:hover { background: var(--gray-100); color: var(--primary); }
.app-nav-btn.active { background: var(--primary-gradient); color: white; box-shadow: var(--shadow-md); }

.app-page { display: none; animation: fadeInUp 0.3s ease; }
.app-page.active { display: block; }

.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.25rem; margin-bottom: 2rem; }
.stat-card { background: var(--white); border-radius: var(--border-radius-lg); padding: 1.5rem; box-shadow: var(--shadow-md); border: 1px solid var(--gray-200); position: relative; overflow: hidden; transition: all var(--transition-normal); }
.stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; }
.stat-card.blue::before { background: var(--primary); }
.stat-card.green::before { background: var(--success); }
.stat-card.orange::before { background: var(--warning); }
.stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); }
.stat-icon { width: 50px; height: 50px; border-radius: var(--border-radius-md); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 1rem; }
.stat-icon.blue { background: rgba(59, 130, 246, 0.1); color: var(--primary); }
.stat-icon.green { background: rgba(16, 185, 129, 0.1); color: var(--success); }
.stat-icon.orange { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
.stat-value { font-size: 2rem; font-weight: 800; color: var(--gray-900); margin-bottom: 0.25rem; }
.stat-label { font-size: 0.9rem; color: var(--gray-500); }
.stat-sublabel { font-size: 0.75rem; color: var(--gray-400); margin-top: 0.25rem; }
.stat-progress { margin-top: 1rem; }
.progress-bar { height: 6px; background: var(--gray-200); border-radius: var(--border-radius-full); overflow: hidden; }
.progress-fill { height: 100%; border-radius: var(--border-radius-full); transition: width 0.5s ease; }
.progress-fill.blue { background: var(--primary-gradient); }
.progress-fill.green { background: linear-gradient(135deg, #10b981, #059669); }
.progress-fill.orange { background: linear-gradient(135deg, #f59e0b, #d97706); }

.progress-fill.purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }

/* ===== STYLES STATISTIQUES AMÉLIORÉES ===== */
.stat-card.purple::before { background: var(--accent); }
.stat-icon.purple { background: rgba(139, 92, 246, 0.1); color: var(--accent); }

.stats-section-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--gray-700);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--gray-200);
}
.stats-section-title i { font-size: 1rem; }
.stats-section-title.general i { color: var(--primary); }
.stats-section-title.daily i { color: #f59e0b; }

.daily-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.daily-stat-card {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    padding: 1.25rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
    position: relative;
    overflow: hidden;
    transition: all var(--transition-normal);
}
.daily-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
}
.daily-stat-card.items-today::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
.daily-stat-card.delay-caught::before { background: linear-gradient(90deg, #10b981, #34d399); }
.daily-stat-card.time-today::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
.daily-stat-card.feeling-today::before { background: linear-gradient(90deg, #ec4899, #f472b6); }
.daily-stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); }

.daily-stat-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

.daily-stat-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--border-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}
.daily-stat-card.items-today .daily-stat-icon { background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(96, 165, 250, 0.15)); color: #3b82f6; }
.daily-stat-card.delay-caught .daily-stat-icon { background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(52, 211, 153, 0.15)); color: #10b981; }
.daily-stat-card.time-today .daily-stat-icon { background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(251, 191, 36, 0.15)); color: #f59e0b; }
.daily-stat-card.feeling-today .daily-stat-icon { background: linear-gradient(135deg, rgba(236, 72, 153, 0.15), rgba(244, 114, 182, 0.15)); color: #ec4899; }

.daily-stat-label { font-size: 0.8rem; color: var(--gray-500); font-weight: 500; }
.daily-stat-value {
    font-size: 1.75rem;
    font-weight: 800;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
}
.daily-stat-card.items-today .daily-stat-value { background: linear-gradient(135deg, #3b82f6, #60a5fa); -webkit-background-clip: text; background-clip: text; }
.daily-stat-card.delay-caught .daily-stat-value { background: linear-gradient(135deg, #10b981, #34d399); -webkit-background-clip: text; background-clip: text; }
.daily-stat-card.time-today .daily-stat-value { background: linear-gradient(135deg, #f59e0b, #fbbf24); -webkit-background-clip: text; background-clip: text; }
.daily-stat-card.feeling-today .daily-stat-value { background: linear-gradient(135deg, #ec4899, #f472b6); -webkit-background-clip: text; background-clip: text; }
.daily-stat-unit { font-size: 0.85rem; color: var(--gray-400); font-weight: 500; margin-left: 0.25rem; }

.feeling-indicator { display: flex; gap: 4px; margin-top: 0.5rem; }
.feeling-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--gray-300); transition: all var(--transition-fast); }
.feeling-dot.active { transform: scale(1.2); }
.feeling-dot.active.c1 { background: var(--confidence-1); }
.feeling-dot.active.c2 { background: var(--confidence-2); }
.feeling-dot.active.c3 { background: var(--confidence-3); }
.feeling-dot.active.c4 { background: var(--confidence-4); }
.feeling-dot.active.c5 { background: var(--confidence-5); }

@keyframes countUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

@media (max-width: 768px) {
    .daily-stats-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
    .daily-stat-card { padding: 1rem; }
    .daily-stat-value { font-size: 1.4rem; }
    .daily-stat-icon { width: 35px; height: 35px; font-size: 1rem; }
}
@media (max-width: 480px) {
    .daily-stats-grid { grid-template-columns: 1fr; }
}




.section-card { background: var(--white); border-radius: var(--border-radius-xl); box-shadow: var(--shadow-md); border: 1px solid var(--gray-200); overflow: hidden; margin-bottom: 1.5rem; }
.section-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; background: var(--gray-50); }
.section-title { font-size: 1.25rem; font-weight: 700; color: var(--gray-900); display: flex; align-items: center; gap: 0.75rem; }
.section-title i { color: var(--primary); }
.section-body { padding: 1.5rem; }

.specialties-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.25rem; }
.specialty-card { background: var(--white); border-radius: var(--border-radius-lg); border: 1px solid var(--gray-200); padding: 1.25rem; cursor: pointer; position: relative; overflow: hidden; transition: all var(--transition-normal); }
.specialty-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-2px); }
.specialty-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
.specialty-name { font-weight: 700; font-size: 1rem; color: var(--gray-900); flex: 1; display: flex; align-items: center; gap: 0.5rem; }
.specialty-icon { width: 32px; height: 32px; border-radius: var(--border-radius-sm); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: white; flex-shrink: 0; }
.specialty-badge { color: white; font-size: 0.75rem; font-weight: 700; padding: 0.25rem 0.6rem; border-radius: var(--border-radius-full); }
.specialty-stats { display: flex; gap: 1rem; flex-wrap: wrap; }
.specialty-stat { display: flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; color: var(--gray-600); }
.specialty-stat.completed { color: var(--success); }
.specialty-progress { margin-top: 1rem; }

.items-container { overflow-x: auto; }
.items-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
.items-table th { background: var(--gray-50); padding: 0.75rem; text-align: left; font-weight: 600; color: var(--gray-700); border-bottom: 2px solid var(--gray-200); white-space: nowrap; position: sticky; top: 0; cursor: pointer; user-select: none; }
.items-table th:hover { background: var(--gray-100); }
.items-table th .sort-icon { margin-left: 0.5rem; opacity: 0.5; font-size: 0.7rem; }
.items-table th.sorted .sort-icon { opacity: 1; color: var(--primary); }
.items-table td { padding: 0.75rem; border-bottom: 1px solid var(--gray-200); vertical-align: top; }
.items-table tr:hover { background: var(--gray-50); }
.items-table .item-num { font-weight: 700; color: var(--primary); min-width: 50px; }
.items-table .item-name { max-width: 200px; font-size: 0.8rem; }
.items-table .item-specialty { font-size: 0.75rem; color: var(--gray-500); white-space: nowrap; }

.tour-cell { min-width: 280px; }
.tour-badges { display: flex; gap: 2px; flex-wrap: nowrap; }
.tour-badge { width: 30px; height: 28px; border-radius: var(--border-radius-sm); display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 700; cursor: pointer; border: 2px solid var(--gray-300); background: var(--white); color: var(--gray-400); transition: all var(--transition-fast); }
.tour-badge:hover { border-color: var(--primary); color: var(--primary); transform: scale(1.05); }
.tour-badge.c1 { background: var(--confidence-1); border-color: var(--confidence-1); color: white; }
.tour-badge.c2 { background: var(--confidence-2); border-color: var(--confidence-2); color: white; }
.tour-badge.c3 { background: var(--confidence-3); border-color: var(--confidence-3); color: white; }
.tour-badge.c4 { background: var(--confidence-4); border-color: var(--confidence-4); color: white; }
.tour-badge.c5 { background: var(--confidence-5); border-color: var(--confidence-5); color: white; }
.tour-dates { display: flex; gap: 2px; margin-top: 2px; }
.tour-date { width: 30px; font-size: 0.6rem; color: var(--gray-500); text-align: center; overflow: hidden; font-family: var(--font-body); }

.resources-cell { min-width: 140px; padding: 0.5rem !important; }

/* Grille des ressources 2x2 */
.resources-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 4px;
    width: 100%;
}

/* Case de ressource */
.resource-box {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.3rem 0.4rem;
    border-radius: 6px;
    font-size: 0.65rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
    line-height: 1.2;
    min-height: 28px;
    border: 2px solid transparent;
}

.resource-box:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

/* Couleurs des ressources non validées */
.resource-box.qi-edni { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
.resource-box.dp-edni { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
.resource-box.qi-hypo { background: #dbeafe; color: #1e40af; border-color: #bfdbfe; }
.resource-box.dp-hypo { background: #dbeafe; color: #1e40af; border-color: #bfdbfe; }
.resource-box.qi-annales { background: #ffedd5; color: #c2410c; border-color: #fed7aa; }
.resource-box.dp-annales { background: #ffedd5; color: #c2410c; border-color: #fed7aa; }
.resource-box.qi-uness { background: #ede9fe; color: #5b21b6; border-color: #ddd6fe; }
.resource-box.dp-uness { background: #ede9fe; color: #5b21b6; border-color: #ddd6fe; }
.resource-box.fiche-perso { background: #fef3c7; color: #92400e; border-color: #fde68a; }

/* État validé (vert) */
.resource-box.validated {
    background: linear-gradient(135deg, #10b981, #34d399) !important;
    color: white !important;
    border-color: #059669 !important;
    box-shadow: 0 2px 6px rgba(16, 185, 129, 0.4);
}

/* Bouton configurer ressources */
.config-resources-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.65rem 1rem;
    background: var(--gray-100);
    border: 1px solid var(--gray-300);
    border-radius: var(--border-radius-md);
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    transition: all 0.2s ease;
}

.config-resources-btn:hover {
    background: var(--gray-200);
    border-color: var(--gray-400);
}

.config-resources-btn i {
    color: var(--primary);
}

/* Modal configuration ressources */
.resources-config-modal .modal-content {
    max-width: 420px;
    padding: 1.25rem;
}

.resources-config-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
}

.resources-config-subtitle {
    font-size: 0.8rem;
    color: var(--gray-500);
    margin-bottom: 0.75rem;
}

.resources-selected-count {
    text-align: center;
    padding: 0.4rem;
    background: var(--gray-100);
    border-radius: var(--border-radius-md);
    margin-bottom: 0.75rem;
    font-weight: 600;
    font-size: 0.8rem;
    color: var(--gray-700);
}

.resources-selected-count span {
    color: var(--primary);
}

/* Grille 3x3 pour les 9 ressources */
.resources-available-list {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.resource-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 0.3rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
    background: var(--white);
}

.resource-option:hover {
    border-color: var(--primary);
    background: rgba(59, 130, 246, 0.05);
}

.resource-option.selected {
    border-color: var(--primary);
    background: rgba(59, 130, 246, 0.1);
}

.resource-option.disabled {
    opacity: 0.4;
    cursor: not-allowed;
    pointer-events: none;
}

.resource-option-checkbox {
    width: 18px;
    height: 18px;
    border: 2px solid var(--gray-300);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6rem;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.resource-option.selected .resource-option-checkbox {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

.resource-option-preview {
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-size: 0.6rem;
    font-weight: 600;
}

.resource-option-name {
    font-weight: 500;
    font-size: 0.65rem;
    color: var(--gray-700);
    line-height: 1.2;
}

.resources-config-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
}

.resources-config-actions button {
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-md);
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.resources-cancel-btn {
    background: var(--gray-100);
    border: 1px solid var(--gray-300);
    color: var(--gray-700);
}

.resources-cancel-btn:hover {
    background: var(--gray-200);
}

.resources-save-btn {
    background: var(--primary-gradient);
    border: none;
    color: white;
}

.resources-save-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* Bouton ajouter ressources quand liste vide */
.resources-empty-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 60px;
    background: var(--gray-100);
    border: 2px dashed var(--gray-300);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    flex-direction: column;
    gap: 0.25rem;
}

.resources-empty-btn:hover {
    background: var(--gray-200);
    border-color: var(--primary);
}

.resources-empty-btn i {
    font-size: 1.25rem;
    color: var(--primary);
}

.resources-empty-btn span {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--gray-500);
}

/* Dark mode ressources */
[data-theme="dark"] .resource-box.qi-edni { background: rgba(254, 226, 226, 0.2); color: #fca5a5; border-color: rgba(254, 202, 202, 0.3); }
[data-theme="dark"] .resource-box.dp-edni { background: rgba(254, 226, 226, 0.2); color: #fca5a5; border-color: rgba(254, 202, 202, 0.3); }
[data-theme="dark"] .resource-box.qi-hypo { background: rgba(219, 234, 254, 0.2); color: #93c5fd; border-color: rgba(191, 219, 254, 0.3); }
[data-theme="dark"] .resource-box.dp-hypo { background: rgba(219, 234, 254, 0.2); color: #93c5fd; border-color: rgba(191, 219, 254, 0.3); }
[data-theme="dark"] .resource-box.qi-annales { background: rgba(255, 237, 213, 0.2); color: #fdba74; border-color: rgba(254, 215, 170, 0.3); }
[data-theme="dark"] .resource-box.dp-annales { background: rgba(255, 237, 213, 0.2); color: #fdba74; border-color: rgba(254, 215, 170, 0.3); }
[data-theme="dark"] .resource-box.qi-uness { background: rgba(237, 233, 254, 0.2); color: #c4b5fd; border-color: rgba(221, 214, 254, 0.3); }
[data-theme="dark"] .resource-box.dp-uness { background: rgba(237, 233, 254, 0.2); color: #c4b5fd; border-color: rgba(221, 214, 254, 0.3); }
[data-theme="dark"] .resource-box.fiche-perso { background: rgba(254, 243, 199, 0.2); color: #fcd34d; border-color: rgba(253, 230, 138, 0.3); }

[data-theme="dark"] .config-resources-btn { 
    background: #1e293b; 
    border: 1px solid #334155; 
    color: #94a3b8; 
}
[data-theme="dark"] .config-resources-btn:hover { 
    background: #60a5fa; 
    border-color: #60a5fa;
    color: #1e293b;
}
[data-theme="dark"] .config-resources-btn i { 
    color: #94a3b8; 
}
[data-theme="dark"] .config-resources-btn:hover i { 
    color: #1e293b; 
}

[data-theme="dark"] .resources-config-modal .modal-content {
    background: #1e293b !important;
    border: 1px solid #334155;
}
[data-theme="dark"] .resources-config-title {
    color: #f1f5f9;
}
[data-theme="dark"] .resources-config-subtitle {
    color: #94a3b8;
}
[data-theme="dark"] .resources-selected-count { 
    background: #334155; 
    color: #cbd5e1; 
}
[data-theme="dark"] .resource-option { 
    border-color: #475569; 
    background: #334155;
}
[data-theme="dark"] .resource-option:hover { 
    background: #475569; 
    border-color: #60a5fa;
}
[data-theme="dark"] .resource-option.selected { 
    background: rgba(59, 130, 246, 0.25); 
    border-color: #60a5fa;
}
[data-theme="dark"] .resource-option-checkbox {
    border-color: #64748b;
    background: #475569;
}
[data-theme="dark"] .resource-option.selected .resource-option-checkbox {
    background: #3b82f6;
    border-color: #3b82f6;
}
[data-theme="dark"] .resource-option-name { 
    color: #cbd5e1; 
}
[data-theme="dark"] .resources-cancel-btn {
    background: transparent;
    border: 1px solid #475569;
    color: #94a3b8;
}
[data-theme="dark"] .resources-cancel-btn:hover {
    background: #334155;
    color: #cbd5e1;
}
[data-theme="dark"] .resources-empty-btn { 
    background: #334155; 
    border-color: #475569; 
}
[data-theme="dark"] .resources-empty-btn:hover { 
    background: #475569; 
    border-color: #60a5fa; 
}
[data-theme="dark"] .resources-empty-btn span { 
    color: #94a3b8; 
}

/* Responsive ressources */
@media (max-width: 768px) {
    .config-resources-btn {
        width: 100%;
        justify-content: center;
    }
    
    .resources-config-modal .modal-content {
        max-width: 95%;
        padding: 1rem;
    }
    
    .resources-available-list {
        gap: 0.4rem;
    }
    
    .resource-option {
        padding: 0.4rem 0.2rem;
    }
    
    .resource-option-preview {
        font-size: 0.55rem;
        padding: 0.15rem 0.3rem;
    }
    
    .resource-option-name {
        font-size: 0.6rem;
    }
    
    .resource-option-checkbox {
        width: 16px;
        height: 16px;
    }
}
.days-cell { min-width: 80px; text-align: center; }
.days-badge { display: inline-block; padding: 0.35rem 0.75rem; border-radius: var(--border-radius-full); font-size: 0.85rem; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.days-badge.recent { background: var(--success); color: white; }
.days-badge.moderate { background: var(--warning); color: white; }
.days-badge.old { background: var(--danger); color: white; }
.days-badge.never { background: var(--gray-400); color: white; }

.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: var(--z-modal); backdrop-filter: blur(4px); }
.modal.active { display: flex; }
.modal-content { background: #ffffff; border-radius: var(--border-radius-xl); padding: 2rem; max-width: 400px; width: 90%; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); position: relative; }
.modal-close { position: absolute; top: 1rem; right: 1rem; width: 36px; height: 36px; border-radius: 50%; background: var(--gray-100); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: var(--gray-500); transition: all var(--transition-fast); }
.modal-close:hover { background: var(--danger-light); color: var(--danger); transform: rotate(90deg); }
.modal-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center; color: var(--gray-900); }

.modal-section { margin-bottom: 1.25rem; }
.modal-label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--gray-500); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; }
.modal-input { width: calc(100% - 4px) !important; padding: 0.75rem 1rem; border: 2px solid var(--gray-200); border-radius: var(--border-radius-md); font-size: 0.95rem; text-align: center; background: var(--gray-50); transition: all var(--transition-fast); box-sizing: border-box !important; max-width: 100% !important; display: block; margin: 0 auto; }
.modal-input:focus { outline: none; border-color: var(--primary); background: #ffffff; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }


input[type="date"].modal-input {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
}
@media (max-width: 480px) {
    .modal-content {
        padding: 1.5rem 1rem;
        width: 92%;
        max-width: 92%;
    }
    
    .modal-input {
        width: 100%;
        max-width: 100%;
        padding: 0.6rem 0.5rem;
        font-size: 0.9rem;
    }
}


.confidence-buttons { display: flex; gap: 0.5rem; justify-content: center; }
.confidence-btn { width: 50px; height: 50px; border-radius: var(--border-radius-md); border: 3px solid transparent; font-size: 1.2rem; font-weight: 700; color: white; cursor: pointer; transition: all var(--transition-fast); opacity: 0.7; }
.confidence-btn:hover { transform: scale(1.1); opacity: 1; }
.confidence-btn.selected { opacity: 1; transform: scale(1.15); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
.confidence-btn.c1 { background: var(--confidence-1); }
.confidence-btn.c2 { background: var(--confidence-2); }
.confidence-btn.c3 { background: var(--confidence-3); }
.confidence-btn.c4 { background: var(--confidence-4); }
.confidence-btn.c5 { background: var(--confidence-5); }

.confidence-error { 
    display: none; 
    color: var(--danger); 
    font-size: 0.8rem; 
    text-align: center; 
    margin-top: 0.5rem; 
    font-weight: 500; 
}

.confidence-error.visible { 
    display: block; 
    animation: fadeInDown 0.3s ease;
}

@keyframes fadeInDown { 
    0% { 
        opacity: 0; 
        transform: translateY(-10px); 
    } 
    100% { 
        opacity: 1; 
        transform: translateY(0); 
    } 
}

.duration-input-wrapper { display: flex; align-items: center; justify-content: center; gap: 0.5rem; background: var(--gray-50); padding: 0.75rem 1rem; border-radius: var(--border-radius-md); border: 2px solid var(--gray-200); width: calc(100% - 4px); max-width: 100%; box-sizing: border-box; margin: 0 auto; transition: all var(--transition-fast); }
.duration-input-wrapper:focus-within { border-color: var(--primary); background: #ffffff; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
@media (max-width: 480px) {
    .modal-content {
        padding: 1.5rem 1rem;
        width: 95%;
    }
    
    .duration-input-wrapper {
        width: 100%;
        padding: 0.5rem 0.75rem;
        box-sizing: border-box;
    }
    
    .duration-input {
        width: 45px;
        padding: 0.4rem;
        font-size: 1rem;
    }
    
    .confidence-btn {
        width: 42px;
        height: 42px;
        font-size: 1rem;
    }
    
    .support-buttons {
        gap: 0.4rem;
    }
    
    .support-btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.75rem;
    }
}

.duration-input { width: 50px; padding: 0.5rem; border: none; border-radius: var(--border-radius-sm); font-size: 1.1rem; text-align: center; background: #ffffff; font-weight: 600; }
.duration-input:focus { outline: none; box-shadow: 0 0 0 2px var(--primary); }
.duration-separator { font-size: 0.9rem; color: var(--gray-500); font-weight: 500; }

.support-buttons { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; }
.support-btn { padding: 0.5rem 0.75rem; font-size: 0.8rem; border-radius: var(--border-radius-md); border: 2px solid var(--gray-200); background: #ffffff; color: var(--gray-600); cursor: pointer; transition: all var(--transition-fast); display: flex; align-items: center; gap: 0.4rem; }
.support-btn i { font-size: 0.85rem; }
.support-btn:hover { border-color: var(--gray-300); background: var(--gray-50); }
.support-btn[data-support="qcm"] { --support-color: #3b82f6; }
.support-btn[data-support="college"] { --support-color: #8b5cf6; }
.support-btn[data-support="anki"] { --support-color: #ef4444; }
.support-btn[data-support="perso"] { --support-color: #f59e0b; }
.support-btn[data-support="codex"] { --support-color: #10b981; }
.support-btn[data-support="conf"] { --support-color: #ec4899; }
.support-btn:hover { border-color: var(--support-color); color: var(--support-color); }
.support-btn.selected { background: var(--support-color); border-color: var(--support-color); color: white; }

.modal-actions { display: flex; gap: 0.75rem; margin-top: 1.75rem; }
.btn-validate { flex: 1; padding: 0.85rem; background: var(--primary-gradient); color: white; border-radius: var(--border-radius-md); font-weight: 600; font-size: 0.95rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: var(--shadow-md); }
.btn-validate:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
.btn-reset { padding: 0.85rem 1.25rem; background: var(--gray-100); color: var(--gray-600); border-radius: var(--border-radius-md); font-weight: 500; display: flex; align-items: center; gap: 0.5rem; }
.btn-reset:hover { background: var(--danger-light); color: var(--danger); }

.tour-info { display: flex; flex-direction: column; align-items: center; gap: 2px; margin-top: 4px; }
.tour-duration { font-size: 0.6rem; color: var(--gray-500); font-family: var(--font-body); }
.tour-support { font-size: 0.6rem; padding: 1px 4px; border-radius: 3px; color: white; font-weight: 500; }
.tour-support.qcm { background: #3b82f6; }
.tour-support.college { background: #8b5cf6; }
.tour-support.anki { background: #ef4444; }
.tour-support.perso { background: #f59e0b; }
.tour-support.codex { background: #10b981; }
.tour-support.conf { background: #ec4899; }


.support-legend { display: flex; gap: 0.5rem; align-items: center; margin-left: auto; margin-right: 1rem; flex-wrap: wrap; }
.legend-item2 { font-size: 0.7rem; padding: 3px 8px; border-radius: 4px; color: white; display: flex; align-items: center; gap: 4px; }
.legend-item2 strong { font-weight: 700; }
.legend-item2.qcm { background: #3b82f6; }
.legend-item2.college { background: #8b5cf6; }
.legend-item2.anki { background: #ef4444; }
.legend-item2.perso { background: #f59e0b; }
.legend-item2.codex { background: #10b981; }
.legend-item2.conf { background: #ec4899; }

/* ===== PASTILLES SOUS-SPÉCIALITÉS ===== */
.item-badge {
    display: block;
    width: fit-content;
    font-size: 0.55rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 4px;
    margin-top: 4px;
    margin-left: 0;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
}

.item-badge.neurochir { background: #6366f1; }
.item-badge.nutrition { background: #84cc16; }
.item-badge.chir-dig { background: #f97316; }
.item-badge.cmf { background: #06b6d4; }
.item-badge.anapath { background: #991b1b; }
.item-badge.immuno { background: #0ea5e9; }
.item-badge.anesthesie { background: #ef4444; }
.item-badge.mpr { background: #14b8a6; }
.item-badge.chir-vasc { background: #ef4444; }
.item-badge.ortho { background: #14b8a6; }
.item-badge.genet { background: #0ea5e9; }
.item-badge.parasito { background: #16a34a; }



.filter-bar { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem; align-items: center; }
.search-box { flex: 1; min-width: 200px; position: relative; }
.search-box input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.75rem; border: 1px solid var(--gray-300); border-radius: var(--border-radius-lg); font-size: 0.95rem; background: var(--white); }
.search-box input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
.search-box i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray-400); }
.filter-select { padding: 0.75rem 1rem; border: 1px solid var(--gray-300); border-radius: var(--border-radius-lg); font-size: 0.95rem; background: var(--white); min-width: 160px; cursor: pointer; }
.filter-select:focus { outline: none; border-color: var(--primary); }

.saving-indicator { 
    /* ANCIEN INDICATEUR - CACHÉ (remplacé par save-indicator-header) */
    display: none !important;
}
.saving-indicator.visible { 
    opacity: 1; 
    transform: translateY(0); 
}
.saving-indicator i { 
    animation: spin 1s linear infinite; 
}
.saving-indicator.saved { 
    background: var(--success); 
}
.saving-indicator.saved i { 
    animation: none; 
}
/* Animation spinner */
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
    .saving-indicator {
        bottom: 1rem;
        right: 1rem;
        font-size: 0.8rem;
        padding: 0.5rem 1rem;
    }
}

/* ========================================= */
/* NOTIFICATION PERSONNALISÉE D'AVERTISSEMENT */
/* ========================================= */
.custom-warning-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
}

.custom-warning-modal.show {
    display: flex;
}

.custom-warning-content {
    background: var(--white);
    border-radius: var(--border-radius-xl);
    padding: 2.5rem;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.4s ease;
    text-align: center;
}

.custom-warning-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
    background: linear-gradient(135deg, #f59e0b, #ef4444);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: white;
    animation: pulse 2s infinite;
}

.custom-warning-title {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 1rem;
}

.custom-warning-message {
    font-size: 1.1rem;
    color: var(--gray-600);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.custom-warning-message strong {
    color: var(--danger);
    font-weight: 700;
}

.custom-warning-progress {
    width: 100%;
    height: 8px;
    background: var(--gray-200);
    border-radius: var(--border-radius-full);
    overflow: hidden;
    margin-bottom: 2rem;
}

.custom-warning-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #f59e0b, #ef4444);
    width: 0%;
    transition: width 0.3s ease;
    animation: progressGlow 1.5s infinite;
}

.custom-warning-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
}

.custom-warning-btn {
    flex: 1;
    min-width: 180px;
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius-lg);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-normal);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border: none;
}

.custom-warning-btn.btn-wait {
    background: var(--primary-gradient);
    color: white;
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
}

.custom-warning-btn.btn-wait:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
}

.custom-warning-btn.btn-force {
    background: var(--gray-200);
    color: var(--gray-700);
}

.custom-warning-btn.btn-force:hover {
    background: var(--gray-300);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { 
        opacity: 0;
        transform: translateY(50px); 
    }
    to { 
        opacity: 1;
        transform: translateY(0); 
    }
}

@keyframes progressGlow {
    0%, 100% { 
        box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
    }
    50% { 
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.8);
    }
}

/* Mode sombre */
[data-theme="dark"] .custom-warning-content {
    background: var(--gray-100);
}

[data-theme="dark"] .custom-warning-title {
    color: var(--gray-900);
}

[data-theme="dark"] .custom-warning-message {
    color: var(--gray-600);
}

/* Responsive */
@media (max-width: 768px) {
    .custom-warning-content {
        padding: 2rem 1.5rem;
        max-width: 95%;
    }
    
    .custom-warning-icon {
        width: 60px;
        height: 60px;
        font-size: 2rem;
    }
    
    .custom-warning-title {
        font-size: 1.5rem;
    }
    
    .custom-warning-message {
        font-size: 1rem;
    }
    
    .custom-warning-actions {
        flex-direction: column;
    }
    
    .custom-warning-btn {
        min-width: 100%;
    }
}

.quick-actions { display: flex; gap: 0.75rem; flex-wrap: wrap; }
.quick-action-btn { 
    padding: 0.625rem 1rem;
    background: var(--gray-200);
    border: 2px solid transparent;
    border-radius: var(--border-radius-md);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all var(--transition-normal);
}

.quick-action-btn:hover { 
    background: var(--gray-300);
    box-shadow: var(--shadow-md);
}
.empty-state { text-align: center; padding: 3rem 2rem; color: var(--gray-500); }
.empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }

.back-to-top { position: fixed; bottom: 2rem; right: 2rem; width: 50px; height: 50px; border-radius: var(--border-radius-full); background: var(--primary-gradient); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; cursor: pointer; opacity: 0; visibility: hidden; transform: translateY(20px); transition: all var(--transition-normal); box-shadow: var(--shadow-md); z-index: var(--z-elevated); }
.back-to-top.visible { opacity: 1; visibility: visible; transform: translateY(0); }

.tour-badge-wrapper { display: flex; flex-direction: column; align-items: center; }

/* ===== FOOTER ===== */
.footer {
    background-color: var(--gray-900);
    color: var(--gray-400);
    padding: 3rem 0 1.5rem;
}

.footer-container {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 3rem;
}

.footer-brand {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.footer-logo {
    font-family: var(--font-display);
    font-size: 1.75rem;
    font-weight: 800;
    color: white;
    letter-spacing: -0.05em;
}

.footer-description {
    color: var(--gray-500);
    font-size: 0.9rem;
    max-width: 350px;
}

.footer-social {
    display: flex;
    gap: 0.75rem;
}

.social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: var(--border-radius-full);
    background: var(--gray-800);
    color: var(--gray-400);
    font-size: 1.1rem;
    transition: all var(--transition-normal);
}

.social-link:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-3px);
}

.footer-nav {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.footer-nav-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.5rem;
}

.footer-nav-links {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.footer-nav-link {
    color: var(--gray-500);
    font-size: 0.9rem;
    transition: all var(--transition-normal);
}

.footer-nav-link:hover {
    color: var(--primary-light);
    transform: translateX(5px);
}

.footer-bottom {
    margin-top: 2.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--gray-800);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.footer-copyright {
    color: var(--gray-500);
    font-size: 0.85rem;
}


@media (max-width: 992px) {
    .footer-container {
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
}

@media (max-width: 768px) {
    .footer-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .footer-bottom {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .footer-legal {
        justify-content: center;
    }
}

/* Footer dark mode */
[data-theme="dark"] .footer {
    background-color: #0d1320;
}

[data-theme="dark"] .footer-logo {
    color: white;
}

[data-theme="dark"] .social-link {
    background: #1e293b;
    color: var(--gray-300);
}

[data-theme="dark"] .social-link:hover {
    background: var(--primary);
    color: white;
}

[data-theme="dark"] .footer-bottom {
    border-top: 1px solid #1e293b;
}

/* Back to top */
.back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 45px;
    height: 45px;
    border-radius: var(--border-radius-full);
    background: var(--primary-gradient);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: all var(--transition-normal);
    box-shadow: var(--shadow-md);
    z-index: var(--z-elevated);
}

.back-to-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.back-to-top:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-blue);
}

@media (max-width: 768px) {
    .footer {
        text-align: center;
    }

    .footer-description {
        margin-left: auto;
        margin-right: auto;
    }

    .footer-social {
        justify-content: center;
    }

    .footer-nav-links {
        align-items: center;
    }
}

@media (max-width: 992px) {
    .user-auth {
        margin-left: 0.5rem;
        margin-right: 0.75rem;
    }
}

@media (max-width: 480px) {
    .user-auth {
        margin-left: 0.5rem;
        margin-right: 0.5rem;
    }
    
    .auth-btn,
    .user-avatar {
        width: 36px;
        height: 36px;
        font-size: 0.9rem;
    }
    
    .profile-dropdown {
        position: fixed;
        top: var(--header-height);
        right: 1rem;
        left: 1rem;
        min-width: auto;
    }
}

#page-items .section-header {
    position: sticky;
    top: 70px;
    z-index: 50;
}

#page-dashboard .section-header {
    position: sticky;
    top: 70px;
    z-index: 40;
    background: var(--gray-50);
}

#page-dashboard .section-card {
    overflow: visible;
}

@media (max-width: 768px) {
    #page-dashboard .section-header {
        position: static;
    }
}

#page-items .items-container {
    overflow-x: visible;
}

#page-items .section-card {
    overflow: visible;
}


.tour-badge.locked {
    background: var(--gray-200);
    border-color: var(--gray-300);
    color: var(--gray-400);
    cursor: not-allowed;
    opacity: 0.6;
}

.tour-badge.locked:hover {
    transform: none;
    border-color: var(--gray-300);
    color: var(--gray-400);
}

/* ===== RESPONSIVE TABLEUR ===== */
@media (max-width: 1024px) {
    #page-items .section-header {
        flex-direction: column;
        align-items: flex-start;
        top: 70px;
    }
    
    #page-items .support-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    #page-items .items-table th {
        top: 180px;
    }
	
	
}

@media (max-width: 768px) {
    #page-items .section-header {
        position: relative;
        top: auto;
        padding: 1rem;
    }
    
#page-items .items-table th {
        position: static;
        top: auto;
    }
    
    #page-items .filter-bar {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    #page-items .filter-select {
        width: 100%;
    }
    
    #page-items .search-box {
        width: 100%;
    }
    
    #page-items .items-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    #page-items .section-card {
        overflow: visible;
    }
    
    #page-items .items-table {
        min-width: 800px;
    }
    
    #page-items .support-legend {
        display: none;
    }
    
    #page-items .section-title {
        font-size: 1rem;
    }
    
    .tour-badge-wrapper {
        min-width: 28px;
    }
    
    .tour-badge {
        width: 28px;
        height: 26px;
        font-size: 0.6rem;
    }
	
	    .section-body {
        padding: 0.75rem;
    }
}

@media (max-width: 480px) {
    #page-items .section-header {
        position: relative;
        top: auto;
        padding: 0.75rem;
    }
    
#page-items .items-table th {
        position: static;
        top: auto;
        padding: 0.5rem;
        font-size: 0.75rem;
    }
    
    #page-items .items-table td {
        padding: 0.5rem;
        font-size: 0.75rem;
    }
    
    #page-items .items-table .item-name {
        max-width: 120px;
        font-size: 0.7rem;
    }
    
    .tour-badge {
        width: 26px;
        height: 24px;
        font-size: 0.55rem;
    }
    
.tour-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1px;
    }
    
    .tour-duration {
        font-size: 0.5rem;
    }
    
    .tour-support {
        font-size: 0.5rem;
        padding: 0px 3px;
    }
	

    
    .app-nav-btn span {
        display: none;
    }
    
    .app-nav-btn i {
        font-size: 1.2rem;
    }
    
    .app-nav-btn {
        min-width: auto;
        padding: 0.75rem 1.5rem;
    }
	
		    /* Réduire les marges autour du tableau */
    .section-body {
        padding: 0.5rem;
    }
    
    .section-card {
        margin-bottom: 1rem;
        border-radius: var(--border-radius-md);
    }
    
    #page-items .section-header {
        padding: 0.5rem 0.75rem;
    }
    
    .items-container {
        margin: 0 -0.25rem;
    }
	
	
}

@media (max-width: 768px) {
    .main-content > .container {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }
    
    #page-items > .section-card {
        margin-left: -0.25rem;
        margin-right: -0.25rem;
        border-radius: var(--border-radius-md);
    }
}

@media (max-width: 480px) {
    .main-content > .container {
        padding-left: 0.25rem;
        padding-right: 0.25rem;
    }
    
    #page-items > .section-card {
        margin-left: 0;
        margin-right: 0;
        border-radius: var(--border-radius-sm);
        border-left: none;
        border-right: none;
    }
    
    #page-items .section-body {
        padding: 0.25rem;
    }
}


@media (max-width: 768px) {
    .main-content {
        padding: 1rem 0.5rem;
    }
}

@media (max-width: 480px) {
    .main-content {
        padding: 0.75rem 0.25rem;
    }
}


@media (max-width: 480px) {
    .main-content {
        padding: 0.75rem 0.25rem;
    }
}

/* ===== MODE PAYSAGE TÉLÉPHONE ===== */
@media screen and (max-height: 450px) {
    /* Désactiver les sticky */
    .header {
        position: absolute !important;
    }
    
    #page-items .section-header {
        position: relative !important;
        top: auto !important;
    }
    
    #page-items .items-table th {
        position: static !important;
        top: auto !important;
    }
    
    /* Corriger le débordement horizontal */
    html, body {
        overflow-x: hidden !important;
    }
    
    #page-items .items-container {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
    }
    
    /* Corriger le modal */
    .modal {
        align-items: flex-start !important;
        padding: 5px !important;
        overflow-y: auto !important;
    }
    
    .modal-content {
        padding: 0.5rem 0.75rem !important;
        width: 90% !important;
        max-width: 400px !important;
        max-height: none !important;
        overflow: visible !important;
        margin: 5px auto !important;
        box-sizing: border-box !important;
    }
    
    .modal-title {
        font-size: 0.9rem !important;
        margin-bottom: 0.4rem !important;
    }
    
    .modal-section {
        margin-bottom: 0.4rem !important;
    }
    
    .modal-label {
        margin-bottom: 0.2rem !important;
        font-size: 0.65rem !important;
    }
    
    .modal-input {
        padding: 0.4rem 0.5rem !important;
        font-size: 0.85rem !important;
    }
    
    .confidence-btn {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.75rem !important;
    }
    
    .confidence-buttons {
        gap: 0.25rem !important;
    }
    
    .duration-input-wrapper {
        padding: 0.25rem 0.4rem !important;
    }
    
    .duration-input {
        width: 35px !important;
        padding: 0.25rem !important;
        font-size: 0.8rem !important;
    }
    
    .support-buttons {
        gap: 0.2rem !important;
    }
    
    .support-btn {
        padding: 0.25rem 0.4rem !important;
        font-size: 0.65rem !important;
    }
    
    .modal-actions {
        margin-top: 0.5rem !important;
        gap: 0.5rem !important;
    }
    
    .btn-validate, .btn-reset {
        padding: 0.4rem !important;
        font-size: 0.8rem !important;
    }
    
    .modal-close {
        width: 24px !important;
        height: 24px !important;
        top: 0.4rem !important;
        right: 0.4rem !important;
        font-size: 0.9rem !important;
    }
}


/* ===== CUSTOM SELECT DROPDOWNS ===== */
.custom-select {
    position: relative;
    min-width: 180px;
}

.custom-select-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.5rem 0.75rem;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.custom-select-btn:hover {
    border-color: var(--primary-light);
}

.custom-select.open .custom-select-btn {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
}

.custom-select-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-size: 0.85rem;
}

.custom-select-text {
    flex: 1;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.custom-select-arrow {
    font-size: 0.7rem;
    color: var(--gray-400);
    transition: transform var(--transition-fast);
}

.custom-select.open .custom-select-arrow {
    transform: rotate(180deg);
}

.custom-select-menu {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    width: 100%;
    min-width: 220px;
    max-height: 300px;
    overflow-y: auto;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-lg);
    z-index: var(--z-dropdown);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-fast);
}

.custom-select.open .custom-select-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.custom-select-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.65rem 1rem;
    cursor: pointer;
    transition: all var(--transition-fast);
    color: var(--gray-700);
    font-size: 0.85rem;
}

.custom-select-option:hover {
    background: rgba(59, 130, 246, 0.08);
    color: var(--primary);
}

.custom-select-option.selected {
    background: var(--primary);
    color: white;
}

.custom-select-option.selected .option-icon {
    color: white;
}

.option-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    color: var(--gray-500);
}

.custom-select-option:hover .option-icon {
    color: var(--primary);
}

/* Scrollbar du menu */
.custom-select-menu::-webkit-scrollbar {
    width: 6px;
}

.custom-select-menu::-webkit-scrollbar-track {
    background: var(--gray-100);
    border-radius: 3px;
}

.custom-select-menu::-webkit-scrollbar-thumb {
    background: var(--gray-300);
    border-radius: 3px;
}

.custom-select-menu::-webkit-scrollbar-thumb:hover {
    background: var(--gray-400);
}

/* Responsive */
@media (max-width: 768px) {
    .custom-select {
        width: 100%;
        min-width: auto;
    }
    
    .custom-select-menu {
        min-width: 100%;
    }
}

/* ===== MULTI-SELECT SPÉCIALITÉS ===== */

/* Conteneur principal - largeur 280px pour 4 pastilles */
.specialty-multi-select {
    position: relative;
    width: 280px;
    min-width: 280px;
    max-width: 280px;
}

/* Bouton principal */
.specialty-multi-btn {
    display: flex;
    width: 100%;
    min-height: 38px;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.specialty-multi-btn:hover {
    border-color: var(--primary-light);
}

.specialty-multi-select.open .specialty-multi-btn {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
}

/* Icône */
.specialty-multi-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-size: 0.85rem;
    flex-shrink: 0;
}

/* Zone des pastilles - toujours sur une ligne */
.specialty-multi-content {
    display: flex;
    flex-wrap: nowrap;
    gap: 4px;
    flex: 1;
    overflow: hidden;
    align-items: center;
}

/* Placeholder */
.specialty-multi-placeholder {
    color: var(--gray-800);
    white-space: nowrap;
}

/* Pastilles */
.specialty-chip {
    padding: 2px 5px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    color: white;
    display: flex;
    align-items: center;
    gap: 3px;
    white-space: nowrap;
    flex-shrink: 0;
}

.specialty-chip span {
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Bouton supprimer pastille */
.specialty-chip-remove {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    cursor: pointer;
    font-size: 0.55rem;
    transition: background var(--transition-fast);
    flex-shrink: 0;
}

.specialty-chip-remove:hover {
    background: rgba(255,255,255,0.5);
}

/* Flèche */
.specialty-multi-arrow {
    font-size: 0.7rem;
    color: var(--gray-400);
    transition: transform var(--transition-fast);
    flex-shrink: 0;
}

.specialty-multi-select.open .specialty-multi-arrow {
    transform: rotate(180deg);
}

/* Menu déroulant */
.specialty-multi-menu {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    width: 100%;
    min-width: 280px;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-lg);
    z-index: var(--z-dropdown);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-fast);
}

.specialty-multi-select.open .specialty-multi-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* Header du menu */
.specialty-multi-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--gray-200);
    background: var(--gray-50);
    border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
}

/* Compteur */
.specialty-multi-counter {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--gray-600);
}

.specialty-counter-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;
    height: 24px;
    padding: 0 0.5rem;
    background: var(--primary);
    color: white;
    border-radius: var(--border-radius-full);
    font-size: 0.75rem;
    font-weight: 700;
}

.specialty-counter-badge.max-reached {
    background: var(--warning);
}

/* Bouton effacer */
.specialty-multi-clear {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.35rem 0.65rem;
    background: var(--gray-100);
    border: none;
    border-radius: var(--border-radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--gray-600);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.specialty-multi-clear:hover {
    background: var(--danger-light);
    color: var(--danger);
}

/* Recherche */
.specialty-multi-search {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--gray-100);
}

.specialty-multi-search input {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--gray-200);
    border-radius: var(--border-radius-sm);
    font-size: 0.85rem;
    outline: none;
    transition: border-color var(--transition-fast);
}

.specialty-multi-search input:focus {
    border-color: var(--primary);
}

.specialty-multi-search input::placeholder {
    color: var(--gray-400);
}

/* Liste des options */
.specialty-multi-list {
    max-height: 250px;
    overflow-y: auto;
    padding: 0.5rem 0;
}

/* Option */
.specialty-multi-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.6rem 1rem;
    cursor: pointer;
    transition: all var(--transition-fast);
    color: var(--gray-700);
    font-size: 0.85rem;
}

.specialty-multi-option:hover {
    background: rgba(59, 130, 246, 0.08);
}

.specialty-multi-option.selected {
    background: rgba(59, 130, 246, 0.12);
}

.specialty-multi-option.disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.specialty-multi-option.disabled:hover {
    background: transparent;
}

/* Checkbox */
.specialty-multi-checkbox {
    width: 18px;
    height: 18px;
    border: 2px solid var(--gray-300);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
    flex-shrink: 0;
}

.specialty-multi-option.selected .specialty-multi-checkbox {
    background: var(--primary);
    border-color: var(--primary);
}

.specialty-multi-checkbox i {
    font-size: 0.65rem;
    color: white;
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.specialty-multi-option.selected .specialty-multi-checkbox i {
    opacity: 1;
}

/* Icône option */
.specialty-multi-option-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    flex-shrink: 0;
}

/* Texte option */
.specialty-multi-option-text {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Option "Toutes les spécialités" */
.specialty-multi-all {
    border-bottom: 1px solid var(--gray-100);
    margin-bottom: 0.25rem;
    padding-bottom: 0.75rem;
}

.specialty-multi-all .specialty-multi-checkbox {
    border-radius: 50%;
}

/* Scrollbar */
.specialty-multi-list::-webkit-scrollbar {
    width: 6px;
}

.specialty-multi-list::-webkit-scrollbar-track {
    background: var(--gray-100);
}

.specialty-multi-list::-webkit-scrollbar-thumb {
    background: var(--gray-300);
    border-radius: 3px;
}


/* ===== MODE NUIT ===== */
[data-theme="dark"] .specialty-multi-btn {
    background: #1e293b;
    border-color: #475569;
    color: #e2e8f0;
}

[data-theme="dark"] .specialty-multi-btn:hover {
    border-color: #475569;
    background: #1e293b;
}

[data-theme="dark"] .specialty-multi-select.open .specialty-multi-btn {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
}

[data-theme="dark"] .specialty-multi-icon {
    color: #60a5fa;
}

[data-theme="dark"] .specialty-multi-placeholder {
    color: #e2e8f0;
}

[data-theme="dark"] .specialty-multi-arrow {
    color: #94a3b8;
}

[data-theme="dark"] .specialty-multi-menu {
    background: #1e293b;
    border-color: #475569;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
}

[data-theme="dark"] .specialty-multi-header {
    background: #334155;
    border-color: #475569;
}

[data-theme="dark"] .specialty-multi-counter {
    color: #cbd5e1;
}

[data-theme="dark"] .specialty-counter-badge {
    background: #3b82f6;
    color: white;
}

[data-theme="dark"] .specialty-counter-badge.max-reached {
    background: #f59e0b;
}

[data-theme="dark"] .specialty-multi-clear {
    background: #475569;
    color: #e2e8f0;
}

[data-theme="dark"] .specialty-multi-clear:hover {
    background: rgba(239, 68, 68, 0.2);
    color: #f87171;
}

[data-theme="dark"] .specialty-multi-search {
    border-color: #475569;
}

[data-theme="dark"] .specialty-multi-search input {
    background: #334155;
    border-color: #475569;
    color: #f1f5f9;
}

[data-theme="dark"] .specialty-multi-search input:focus {
    border-color: #3b82f6;
}

[data-theme="dark"] .specialty-multi-search input::placeholder {
    color: #64748b;
}

[data-theme="dark"] .specialty-multi-list {
    background: #1e293b;
}

[data-theme="dark"] .specialty-multi-option {
    color: #e2e8f0;
}

[data-theme="dark"] .specialty-multi-option:hover {
    background: rgba(96, 165, 250, 0.15);
}

[data-theme="dark"] .specialty-multi-option.selected {
    background: rgba(96, 165, 250, 0.2);
}

[data-theme="dark"] .specialty-multi-option.disabled {
    opacity: 0.4;
    color: #64748b;
}

[data-theme="dark"] .specialty-multi-checkbox {
    border-color: #64748b;
    background: #334155;
}

[data-theme="dark"] .specialty-multi-option.selected .specialty-multi-checkbox {
    background: #3b82f6;
    border-color: #3b82f6;
}

[data-theme="dark"] .specialty-multi-option-text {
    color: #e2e8f0;
}

[data-theme="dark"] .specialty-multi-all {
    border-color: #475569;
}

[data-theme="dark"] .specialty-multi-list::-webkit-scrollbar-track {
    background: #334155;
}

[data-theme="dark"] .specialty-multi-list::-webkit-scrollbar-thumb {
    background: #64748b;
}

[data-theme="dark"] .specialty-chip-remove {
    background: rgba(255, 255, 255, 0.25);
}

[data-theme="dark"] .specialty-chip-remove:hover {
    background: rgba(255, 255, 255, 0.4);
}

/* ===== MOBILE ===== */

@media (max-width: 768px) {
    .specialty-multi-select {
        width: 100%;
        min-width: 100%;
        max-width: 100%;
    }
    
    .specialty-multi-menu {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        min-width: 100%;
        border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        max-height: 70vh;
    }
    
    .specialty-multi-list {
        max-height: 45vh;
    }
    
    .specialty-chip {
        padding: 2px 4px;
        font-size: 9px;
    }
    
    .specialty-chip-remove {
        width: 10px;
        height: 10px;
        font-size: 0.5rem;
    }
}

/* Bouton fermer mobile */
.specialty-multi-header-buttons {
    display: flex;
    gap: 0.5rem;
}

.specialty-multi-close {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.35rem 0.65rem;
    background: #3b82f6;
    border: none;
    border-radius: var(--border-radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
    color: white;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.specialty-multi-close:hover {
    background: #2563eb;
}




/* ===== MODE SOMBRE - CORRECTIONS ===== */

/* Modal de validation des tours */
[data-theme="dark"] .modal-content {
    background: #1e293b;
    border: 1px solid #374151;
}

[data-theme="dark"] .modal-title {
    color: #f9fafb;
}

[data-theme="dark"] .modal-label {
    color: #9ca3af;
}

[data-theme="dark"] .modal-input {
    background: #0f172a;
    border-color: #374151;
    color: #f9fafb;
}

[data-theme="dark"] .modal-input:focus {
    background: #1e293b;
    border-color: var(--primary);
}

/* Inputs de durée */
[data-theme="dark"] .duration-input-wrapper {
    background: #0f172a;
    border-color: #374151;
}

[data-theme="dark"] .duration-input {
    background: #1e293b;
    color: #f9fafb;
}

[data-theme="dark"] .duration-input:focus {
    box-shadow: 0 0 0 2px var(--primary);
}

[data-theme="dark"] .duration-separator {
    color: #9ca3af;
}

/* Boutons de support */
[data-theme="dark"] .support-btn {
    background: #0f172a;
    border-color: #374151;
    color: #d1d5db;
}

[data-theme="dark"] .support-btn:hover {
    background: #1e293b;
    border-color: var(--support-color);
    color: var(--support-color);
}

[data-theme="dark"] .support-btn.selected {
    background: var(--support-color);
    border-color: var(--support-color);
    color: white;
}

/* Bouton fermer modal */
[data-theme="dark"] .modal-close {
    background: #374151;
    color: #9ca3af;
}

[data-theme="dark"] .modal-close:hover {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
}



/* Bouton Réinitialiser dans modal */
[data-theme="dark"] .btn-reset {
    background: #374151;
    color: #d1d5db;
}

[data-theme="dark"] .btn-reset:hover {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
}

/* ===== RECHERCHE ET FILTRES ===== */

/* Champ de recherche */
[data-theme="dark"] .search-box input {
    background: #1e293b;
    border-color: #374151;
    color: #f9fafb;
}

[data-theme="dark"] .search-box input::placeholder {
    color: #6b7280;
}

[data-theme="dark"] .search-box input:focus {
    border-color: var(--primary);
    background: #0f172a;
}

[data-theme="dark"] .search-box i {
    color: #6b7280;
}

/* Boutons d'action rapide (Réinitialiser les filtres, etc.) */
[data-theme="dark"] .quick-action-btn {
    background: var(--gray-200);
    border-color: transparent;
    color: var(--gray-700);
}
[data-theme="dark"] .quick-action-btn:hover {
    background: var(--gray-300);
    box-shadow: var(--shadow-md);
}

.quick-action-btn.success {
    background: var(--success);
    color: white;
    border-color: var(--success);
    pointer-events: none;
    cursor: not-allowed;
}

.quick-action-btn.success:hover {
    background: var(--success);
    color: white;
}

/* Custom select dropdowns */
[data-theme="dark"] .custom-select-btn {
    background: #1e293b;
    border-color: #374151;
    color: #f9fafb;
}

[data-theme="dark"] .custom-select-menu {
    background: #1e293b;
    border-color: #374151;
}

[data-theme="dark"] .custom-select-option {
    color: #d1d5db;
}

[data-theme="dark"] .custom-select-option:hover {
    background: rgba(59, 130, 246, 0.15);
    color: var(--primary-light);
}

[data-theme="dark"] .custom-select-option.selected {
    background: var(--primary);
    color: white;
}

/* Scrollbar du menu en mode sombre */
[data-theme="dark"] .custom-select-menu::-webkit-scrollbar-track {
    background: #1e293b;
}

[data-theme="dark"] .custom-select-menu::-webkit-scrollbar-thumb {
    background: #4b5563;
}

[data-theme="dark"] .custom-select-menu::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
}

/* ===== INDICATEUR DE SAUVEGARDE - MODE SOMBRE ===== */
[data-theme="dark"] .saving-indicator {
    background: #f9fafb;
    color: #111827;
}

[data-theme="dark"] .saving-indicator.saved {
    background: #10b981;
    color: white;
}



/* ===== STATISTIQUES HEBDOMADAIRES ===== */
.stats-section-title.weekly i { color: #8b5cf6; }

.weekly-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.25rem;
    margin-bottom: 2rem;
}

.weekly-chart-card {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    padding: 1.25rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
    position: relative;
    overflow: hidden;
    transition: all var(--transition-normal);
}

.weekly-chart-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
}

.weekly-chart-card.tours-weekly::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
.weekly-chart-card.time-weekly::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
.weekly-chart-card.feeling-weekly::before { background: linear-gradient(90deg, #ec4899, #f472b6); }

.weekly-chart-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.weekly-chart-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.weekly-chart-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--border-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

.weekly-chart-card.tours-weekly .weekly-chart-icon {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(96, 165, 250, 0.15));
    color: #3b82f6;
}

.weekly-chart-card.time-weekly .weekly-chart-icon {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(251, 191, 36, 0.15));
    color: #f59e0b;
}

.weekly-chart-card.feeling-weekly .weekly-chart-icon {
    background: linear-gradient(135deg, rgba(236, 72, 153, 0.15), rgba(244, 114, 182, 0.15));
    color: #ec4899;
}

.weekly-chart-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--gray-800);
}

.weekly-chart-container {
    height: 180px;
    position: relative;
    margin-bottom: 1rem;
}

.weekly-chart-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 0.75rem;
    border-top: 1px solid var(--gray-200);
}

.summary-label {
    font-size: 0.8rem;
    color: var(--gray-500);
    font-weight: 500;
}

.summary-value {
    font-size: 1.1rem;
    font-weight: 700;
}

.weekly-chart-card.tours-weekly .summary-value { color: #3b82f6; }
.weekly-chart-card.time-weekly .summary-value { color: #f59e0b; }
.weekly-chart-card.feeling-weekly .summary-value { color: #ec4899; }

/* Mode sombre */
[data-theme="dark"] .weekly-chart-card {
    background: var(--white);
    border-color: var(--gray-200);
}

[data-theme="dark"] .weekly-chart-title {
    color: var(--gray-800);
}

[data-theme="dark"] .weekly-chart-summary {
    border-top-color: var(--gray-200);
}

/* Responsive */
@media (max-width: 768px) {
    .weekly-stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .weekly-chart-container {
        height: 150px;
    }
}


/* ===== MESSAGE DE BIENVENUE ===== */
.welcome-message {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.25rem;
    display: none;
}

.welcome-message.visible {
    display: block;
}

.welcome-message .user-name {
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

/* =============================================
   NOUVEAU HEADER - MENUS DÉROULANTS
   ============================================= */

.nav-items {
    display: flex;
    list-style: none;
    gap: 1.5rem;
    margin: 0;
    padding: 0;
    align-items: center;
}

.nav-dropdown {
    position: relative;
}

.nav-dropdown-trigger {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    font-weight: 500;
    color: var(--gray-700);
    transition: color var(--transition-normal), transform var(--transition-normal);
    padding: 0.5rem 0;
    background: none;
    border: none;
    font-family: var(--font-body);
    font-size: 1rem;
    position: relative;
}

[data-theme="dark"] .nav-dropdown-trigger {
    color: white;
}

.nav-dropdown-trigger:hover {
    color: var(--primary);
}

.nav-dropdown-trigger::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary-gradient);
    transition: width 0.3s ease;
}

.nav-dropdown:hover .nav-dropdown-trigger::after {
    width: 100%;
}

.nav-dropdown-trigger i:first-child {
    font-size: 0.9rem;
}

.dropdown-chevron {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
}

.nav-dropdown:hover .dropdown-chevron {
    transform: rotate(180deg);
}

.nav-dropdown-content {
    position: absolute;
    top: 100%;
    left: -10px;
    background: var(--white);
    min-width: 240px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    padding: 8px 0;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.3s ease;
    border: 1px solid var(--gray-200);
}

[data-theme="dark"] .nav-dropdown-content {
    background: var(--gray-100);
    border-color: var(--gray-200);
}

.nav-dropdown:hover .nav-dropdown-content {
    opacity: 1;
    visibility: visible;
    transform: translateY(5px);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 18px;
    color: var(--gray-700);
    text-decoration: none;
    transition: all 0.2s ease;
    font-family: var(--font-body);
    font-size: 0.95rem;
}

[data-theme="dark"] .dropdown-item {
    color: white;
}

.dropdown-item:hover {
    background-color: var(--gray-100);
    color: var(--primary);
}

[data-theme="dark"] .dropdown-item:hover {
    background-color: var(--gray-200);
    color: var(--primary-light);
}

.dropdown-item.active {
    background-color: rgba(59, 130, 246, 0.1);
    color: var(--primary);
    font-weight: 600;
}

[data-theme="dark"] .dropdown-item.active {
    background-color: rgba(96, 165, 250, 0.15);
    color: var(--primary-light);
}

.dropdown-item i {
    font-size: 1rem;
    width: 20px;
    text-align: center;
}

/* =============================================
   MENU MOBILE
   ============================================= */

.mobile-menu {
    position: fixed;
    top: var(--header-height);
    left: 0;
    width: 100%;
    max-height: calc(100vh - var(--header-height));
    overflow-y: auto;
    background-color: var(--white);
    padding: 1rem;
    z-index: calc(var(--z-sticky) - 1);
    box-shadow: var(--shadow-lg);
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
    transition: transform var(--transition-normal), opacity var(--transition-normal), visibility var(--transition-normal);
}

[data-theme="dark"] .mobile-menu {
    background-color: var(--gray-50);
}

.mobile-menu.active {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
}

.mobile-menu-section {
    margin-bottom: 1.5rem;
}

.mobile-menu-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 700;
    font-size: 0.85rem;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.5rem 0;
    border-bottom: 2px solid var(--primary);
    margin-bottom: 0.75rem;
}

.mobile-menu-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0.85rem 1rem;
    color: var(--gray-700);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
    font-size: 0.95rem;
}

[data-theme="dark"] .mobile-menu-link {
    color: var(--gray-300);
}

.mobile-menu-link:hover {
    background-color: var(--gray-100);
    color: var(--primary);
}

.mobile-menu-link.active {
    background-color: rgba(59, 130, 246, 0.1);
    color: var(--primary);
    font-weight: 600;
}

.mobile-menu-link i {
    font-size: 1rem;
    width: 22px;
    text-align: center;
}

/* =============================================
   ICÔNES HEADER MOBILE
   ============================================= */

.header-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

@media (max-width: 992px) {
    .nav-items {
        display: none;
    }
    
    .header-actions {
        gap: 0.4rem;
    }
    
    .theme-toggle,
    .auth-btn,
    .user-avatar,
    .mobile-menu-btn {
        width: 38px;
        height: 38px;
        font-size: 1.1rem;
    }
    
    .theme-toggle {
        margin-left: 0;
    }
    
    .user-auth {
        margin-left: 0;
    }
    
    .mobile-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--gray-100);
        border-radius: var(--border-radius-full);
        color: var(--gray-600);
        transition: all var(--transition-normal);
    }
    
    [data-theme="dark"] .mobile-menu-btn {
        background: var(--gray-800);
        color: var(--gray-300);
    }
    
    .mobile-menu-btn:hover {
        background: var(--primary-light);
        color: white;
    }
}

@media (min-width: 993px) {
    .mobile-menu {
        display: none !important;
    }
}

@media (max-width: 480px) {
    .header-actions {
        gap: 0.3rem;
    }
    
    .theme-toggle,
    .auth-btn,
    .user-avatar,
    .mobile-menu-btn {
        width: 36px;
        height: 36px;
        font-size: 1rem;
    }
}


/* ===== SECTION PRÉSENTATION (NON CONNECTÉ) ===== */
.presentation-section {
    padding: 2rem 0;
}

.presentation-container {
    max-width: 900px;
    margin: 0 auto;
    background: var(--white);
    border-radius: var(--border-radius-xl);
    padding: 2.5rem;
    box-shadow: var(--shadow-lg);
}

[data-theme="dark"] .presentation-container {
    background: #1e293b;
    border: 1px solid #334155;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

/* Intro */
.presentation-intro {
    text-align: center;
    margin-bottom: 2.5rem;
}

.presentation-intro-icon {
    width: 90px;
    height: 90px;
    background: var(--primary-gradient);
    border-radius: var(--border-radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    box-shadow: var(--shadow-blue);
}

.presentation-intro-icon i {
    font-size: 2.8rem;
    color: white;
}

.presentation-intro-title {
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 1rem;
}

.presentation-intro-text {
    color: var(--gray-600);
    max-width: 650px;
    margin: 0 auto;
    line-height: 1.8;
    font-size: 1rem;
}

/* Separator */
.presentation-separator {
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--primary), transparent);
    margin: 2rem 0;
    border: none;
    border-radius: 2px;
}

/* Section title */
.presentation-section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.presentation-section-title i {
    font-size: 1rem;
}

/* Feature grid */
.presentation-feature-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.25rem;
    margin-bottom: 2rem;
}

@media (max-width: 650px) {
    .presentation-feature-grid {
        grid-template-columns: 1fr;
    }
}

.presentation-feature-card {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    transition: all var(--transition-normal);
    border: 1px solid var(--gray-200);
}

.presentation-feature-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary-light);
}

.presentation-feature-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--border-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
}

.presentation-feature-icon i {
    font-size: 1.3rem;
    color: white;
}

.presentation-feature-icon.stats { background: linear-gradient(135deg, #3b82f6, #2563eb); }
.presentation-feature-icon.tracking { background: linear-gradient(135deg, #f59e0b, #d97706); }
.presentation-feature-icon.specialties { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
.presentation-feature-icon.items { background: linear-gradient(135deg, #10b981, #059669); }
.presentation-feature-icon.save { background: linear-gradient(135deg, #ec4899, #db2777); }
.presentation-feature-icon.daily { background: linear-gradient(135deg, #06b6d4, #0891b2); }

.presentation-feature-title {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--gray-900);
}

.presentation-feature-description {
    font-size: 0.9rem;
    color: var(--gray-600);
    line-height: 1.6;
}

/* Info highlight */
.presentation-info-highlight {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    border-left: 4px solid var(--primary);
    padding: 1.25rem 1.5rem;
    border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
    margin: 1.5rem 0 2rem;
}

.presentation-info-highlight p {
    margin-bottom: 0.5rem;
    color: var(--gray-700);
    line-height: 1.7;
    font-size: 0.95rem;
}

.presentation-info-highlight p:last-child {
    margin-bottom: 0;
}

.presentation-info-highlight strong {
    color: var(--gray-900);
}

/* Benefits grid */
.presentation-benefits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.presentation-benefit-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--gray-50);
    border-radius: var(--border-radius-md);
    transition: all var(--transition-normal);
}

[data-theme="dark"] .presentation-benefit-item {
    background: var(--gray-100);
}

.presentation-benefit-item:hover {
    background: var(--gray-100);
    transform: translateX(5px);
}

[data-theme="dark"] .presentation-benefit-item:hover {
    background: var(--gray-200);
}

.presentation-benefit-icon {
    width: 36px;
    height: 36px;
    min-width: 36px;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
    border-radius: var(--border-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--success);
    font-size: 1rem;
}

.presentation-benefit-text {
    font-size: 0.9rem;
    color: var(--gray-700);
    line-height: 1.5;
    font-weight: 500;
}

/* Screenshots section */
.presentation-screenshots {
    margin: 2rem 0;
}

.presentation-screenshot-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

@media (max-width: 600px) {
    .presentation-screenshot-grid {
        grid-template-columns: 1fr;
    }
}

.presentation-screenshot-item {
    background: var(--gray-100);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    border: 1px solid var(--gray-200);
    transition: all var(--transition-normal);
}

.presentation-screenshot-item:hover {
    transform: scale(1.02);
    box-shadow: var(--shadow-lg);
}

.presentation-screenshot-item img {
    width: 100%;
    height: auto;
    display: block;
}

.presentation-screenshot-label {
    padding: 0.75rem 1rem;
    background: var(--white);
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--gray-700);
    text-align: center;
    border-top: 1px solid var(--gray-200);
}

[data-theme="dark"] .presentation-screenshot-label {
    background: var(--gray-50);
}

/* CTA section */
.presentation-cta {
    text-align: center;
    padding: 2rem;
    background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
    border-radius: var(--border-radius-xl);
    border: 2px dashed var(--gray-300);
    margin-top: 2rem;
}

[data-theme="dark"] .presentation-cta {
    background: linear-gradient(135deg, var(--gray-100), var(--gray-200));
    border-color: var(--gray-400);
}

.presentation-cta-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 2.5rem;
    background: var(--primary-gradient);
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    border-radius: var(--border-radius-full);
    box-shadow: var(--shadow-blue);
    transition: all var(--transition-normal);
}

.presentation-cta-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px -5px rgba(59, 130, 246, 0.5);
    color: white;
}

.presentation-cta-btn i {
    font-size: 1.1rem;
}

.presentation-cta-text {
    margin-top: 1rem;
    font-size: 0.9rem;
    color: var(--gray-500);
}

/* Tips list */
.presentation-tips-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

.presentation-tips-list li {
    padding: 0.85rem 0;
    padding-left: 1.75rem;
    position: relative;
    color: var(--gray-700);
    border-bottom: 1px solid var(--gray-200);
    font-size: 0.95rem;
    line-height: 1.5;
}

.presentation-tips-list li:last-child {
    border-bottom: none;
}

.presentation-tips-list li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: var(--success);
    font-weight: bold;
    font-size: 1rem;
}

/* Responsive */
@media (max-width: 768px) {
    .presentation-section {
        padding: 1.5rem 0;
    }
    
    .presentation-container {
        padding: 1.5rem;
        border-radius: var(--border-radius-lg);
        margin: 0 0.5rem;
    }
    
    .presentation-intro-icon {
        width: 70px;
        height: 70px;
    }
    
    .presentation-intro-icon i {
        font-size: 2rem;
    }
    
    .presentation-intro-title {
        font-size: 1.35rem;
    }
    
    .presentation-intro-text {
        font-size: 0.95rem;
    }
    
    .presentation-feature-card {
        padding: 1.25rem;
    }
    
    .presentation-benefits-grid {
        grid-template-columns: 1fr;
    }
}

/* Flèche scroll vers présentation */
.scroll-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
	    margin-top: 1rem;

    margin-bottom: 1rem;
    cursor: pointer;
    transition: all var(--transition-normal);
}

.scroll-indicator:hover {
    transform: translateY(5px);
}

.scroll-indicator-text {
    font-size: 0.9rem;
    color: var(--gray-500);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.scroll-indicator-arrow {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
    display: flex;
    align-items: center;
    justify-content: center;
    animation: bounceArrow 2s ease-in-out infinite;
}

.scroll-indicator-arrow i {
    font-size: 1.2rem;
    color: var(--primary);
}

@keyframes bounceArrow {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(8px);
    }
}

[data-theme="dark"] .scroll-indicator-arrow {
    background: linear-gradient(135deg, rgba(96, 165, 250, 0.15), rgba(167, 139, 250, 0.15));
}


/* ===== PREVIEW TABS & CAROUSEL ===== */
.preview-tabs {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.preview-tab {
    padding: 0.75rem 1.25rem;
    border-radius: var(--border-radius-full);
    background: var(--gray-100);
    color: var(--gray-600);
    font-weight: 500;
    font-size: 0.9rem;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all var(--transition-normal);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.preview-tab:hover {
    background: var(--gray-200);
    color: var(--gray-800);
}

.preview-tab.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-blue);
}

[data-theme="dark"] .preview-tab {
    background: var(--gray-700);
    color: var(--gray-300);
}

[data-theme="dark"] .preview-tab:hover {
    background: var(--gray-600);
    color: var(--gray-100);
}

[data-theme="dark"] .preview-tab.active {
    background: var(--primary);
    color: white;
}

.preview-carousel-container {
    position: relative;
}

.preview-carousel {
    display: none;
    position: relative;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.preview-carousel.active {
    display: flex;
    flex-direction: column;
}

/* Wrapper pour les slides avec hauteur fixe */
.carousel-slides-wrapper {
    position: relative;
    width: 100%;
    max-width: 700px;
    display: flex;
    align-items: center;
}

/* Slides */
.carousel-slides {
    position: relative;
    width: 100%;
    height: 450px; /* HAUTEUR FIXE pour uniformiser */
    overflow: hidden;
    border-radius: var(--border-radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--gray-100);
}

.carousel-slide {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    animation: fadeIn 0.4s ease;
}

.carousel-slide.active {
    display: flex;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.98); }
    to { opacity: 1; transform: scale(1); }
}

.carousel-slide img {
    max-width: 100%;
    max-height: 400px; /* Limite la hauteur des images */
    width: auto;
    height: auto;
    object-fit: contain; /* Garde les proportions */
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
}

[data-theme="dark"] .carousel-slides {
    background: #1a2332;
}

[data-theme="dark"] .carousel-slide img {
    border-color: #334155;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

.carousel-caption {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.95);
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-md);
    color: var(--gray-600);
    font-size: 0.9rem;
    text-align: center;
    font-style: italic;
    max-width: 90%;
    box-shadow: var(--shadow-sm);
}

[data-theme="dark"] .carousel-caption {
    background: rgba(30, 41, 59, 0.95);
    color: var(--gray-400);
}

/* Flèches - Position FIXE par rapport au wrapper */
.carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 45px;
    height: 45px;
    border-radius: var(--border-radius-full);
    background: var(--white);
    color: var(--gray-700);
    border: 1px solid var(--gray-200);
    box-shadow: var(--shadow-md);
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    transition: all var(--transition-normal);
}

.carousel-arrow:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    transform: translateY(-50%) scale(1.1);
}

.carousel-prev { left: -60px; }
.carousel-next { right: -60px; }

[data-theme="dark"] .carousel-arrow {
    background: #1e293b;
    color: var(--gray-300);
    border-color: #334155;
}

[data-theme="dark"] .carousel-arrow:hover {
    background: var(--primary);
    color: white;
}

/* Points indicateurs */
.carousel-dots {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1rem;
}

.carousel-dot {
    width: 10px;
    height: 10px;
    border-radius: var(--border-radius-full);
    background: var(--gray-300);
    border: none;
    cursor: pointer;
    transition: all var(--transition-normal);
}

.carousel-dot:hover {
    background: var(--gray-400);
}

.carousel-dot.active {
    background: var(--primary);
    width: 25px;
}

[data-theme="dark"] .carousel-dot {
    background: var(--gray-600);
}

[data-theme="dark"] .carousel-dot.active {
    background: var(--primary);
}

/* Responsive */
@media (max-width: 768px) {
    .preview-tabs {
        gap: 0.4rem;
    }
    
    .preview-tab {
        padding: 0.6rem 1rem;
        font-size: 0.8rem;
    }
    
    .preview-tab i {
        display: none;
    }
    
    .carousel-arrow {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
    }
    
    .carousel-prev { left: 5px; }
    .carousel-next { right: 5px; }
}


.reference-badge {
    display: block;
    width: fit-content;
    font-size: 0.55rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 4px;
    margin-top: 4px;
    margin-left: 0;
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: #78350f;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
    box-shadow: 0 1px 2px rgba(245, 158, 11, 0.3);
}

.reference-badge i {
    font-size: 0.5rem;
    margin-right: 3px;
}

/* Liens cliquables vers LiSA pour les items de référence */
.items-table .item-link {
    color: var(--primary);
    text-decoration: none;
    transition: all var(--transition-fast);
}
.items-table .item-link:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}
[data-theme="dark"] .items-table .item-link {
    color: var(--primary-light);
}
[data-theme="dark"] .items-table .item-link:hover {
    color: var(--primary);
}

/* Forcer les liens à être cliquables */
.items-table .item-name a.item-link {
    position: relative;
    z-index: 10;
    pointer-events: auto;
    cursor: pointer;
}

.items-table td.item-name {
    pointer-events: auto;
}


.specialty-extra-stats { 
    display: flex; 
    gap: 0.5rem; 
    flex-wrap: wrap; 
    padding-top: 0.75rem; 
    border-top: 1px dashed var(--gray-200); 
}
.specialty-extra-stat { 
    display: flex; 
    align-items: center; 
    gap: 0.4rem; 
    font-size: 0.78rem; 
    padding: 0.3rem 0.6rem; 
    border-radius: var(--border-radius-full); 
    font-weight: 500;
}
.specialty-extra-stat.time-stat { 
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(251, 191, 36, 0.1)); 
    color: #b45309; 
}
.specialty-extra-stat.feeling-stat { 
    color: white; 
    font-weight: 600;
}
.feeling-c1 { background: linear-gradient(135deg, #991b1b, #b91c1c); }
.feeling-c2 { background: linear-gradient(135deg, #dc2626, #ef4444); }
.feeling-c3 { background: linear-gradient(135deg, #d97706, #f59e0b); }
.feeling-c4 { background: linear-gradient(135deg, #16a34a, #22c55e); }
.feeling-c5 { background: linear-gradient(135deg, #15803d, #16a34a); }
.feeling-none { background: var(--gray-300); color: var(--gray-600); }


.stat-percent-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
}
.stat-percent-badge.orange-badge {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}





/* ===== PLANNING PAGE STYLES V4 ===== */

/* Container principal */
.planning-container {
    display: flex;
    gap: 1.5rem;
    width: 100%;
    align-items: flex-start;
    position: relative;
}

/* ===== SIDEBAR CHECKLIST - Z-INDEX CORRIGÉ ===== */
.planning-sidebar {
    width: 360px;
    flex-shrink: 0;
    position: sticky;
    top: 72px;  
    height: fit-content;
    max-height: calc(100vh - 90px);
    z-index: 10;
    align-self: flex-start;  /* Important pour le sticky */
}

.checklist-card {
    background: var(--white);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
    overflow: hidden;
}

.checklist-header {
    background: linear-gradient(135deg, #8b5cf6, #a78bfa);
    padding: 1.25rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.checklist-title {
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
}

.checklist-count {
    background: rgba(255,255,255,0.25);
    padding: 0.3rem 0.75rem;
    border-radius: var(--border-radius-full);
    font-size: 0.85rem;
    font-weight: 600;
    color: white;
}

.checklist-body { padding: 1.25rem; }

.checklist-input-wrapper {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
}

.checklist-input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    font-size: 0.95rem;
    transition: all var(--transition-normal);
    background: var(--gray-50);
}

.checklist-input:focus {
    outline: none;
    border-color: var(--accent);
    background: var(--white);
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

.checklist-add-btn {
    width: 44px;
    height: 44px;
    border-radius: var(--border-radius-md);
    background: linear-gradient(135deg, #8b5cf6, #a78bfa);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    transition: all var(--transition-normal);
}

@media (max-width: 1200px) {
    .planning-sidebar {
        position: static;  /* Plus de sticky quand la sidebar passe au-dessus */
        max-height: none;
    }
}


.checklist-add-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
}

.checklist-items {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    max-height: 450px;
    overflow-y: auto;
    padding-right: 0.5rem;
}

.checklist-items::-webkit-scrollbar { width: 5px; }
.checklist-items::-webkit-scrollbar-track { background: var(--gray-100); border-radius: 10px; }
.checklist-items::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 10px; }

.checklist-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.85rem 1rem;
    background: var(--gray-50);
    border-radius: var(--border-radius-md);
    transition: all var(--transition-normal);
    border: 1px solid transparent;
}

.checklist-item:hover {
    background: var(--white);
    border-color: var(--gray-200);
    box-shadow: var(--shadow-sm);
}

.checklist-item.completed {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
    border-color: rgba(16, 185, 129, 0.3);
}

.checklist-item.completed .checklist-item-text {
    text-decoration: line-through;
    color: var(--gray-400);
}

.checklist-checkbox {
    width: 22px;
    height: 22px;
    border: 2px solid var(--gray-300);
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-normal);
    flex-shrink: 0;
}

.checklist-checkbox:hover { border-color: var(--accent); background: rgba(139, 92, 246, 0.1); }
.checklist-checkbox.checked { background: linear-gradient(135deg, #10b981, #34d399); border-color: #10b981; color: white; font-size: 0.7rem; }

.checklist-item-text { flex: 1; font-size: 0.95rem; color: var(--gray-700); word-break: break-word; line-height: 1.4; }

.checklist-delete {
    opacity: 1; 
    background: var(--danger-light); 
    color: var(--danger); 
    padding: 0.4rem 0.5rem;
    border-radius: var(--border-radius-sm); 
    transition: all var(--transition-fast);
}

.checklist-delete:hover { 
    background: var(--danger); 
    color: white; 
}

.checklist-empty { text-align: center; padding: 2.5rem 1rem; color: var(--gray-400); }
.checklist-empty i { font-size: 2.5rem; margin-bottom: 0.75rem; display: block; opacity: 0.5; }

/* ===== ZONE PRINCIPALE ===== */
.planning-main { 
    flex: 1; 
    min-width: 0;
    position: relative;
    z-index: 1;
}

/* Header */
.planning-header-card {
    background: var(--white);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
    padding: 1.25rem 1.5rem;
    margin-bottom: 1.25rem;
}

.planning-header-row {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
}


.planning-date-selector {
    justify-self: end;
}



.planning-month-display { display: flex; align-items: center; gap: 1rem; }

.planning-month-title {
    font-size: 1.5rem; font-weight: 800; color: var(--gray-900);
    display: flex; align-items: center; gap: 0.5rem;
}
.planning-month-title i { color: var(--primary); }

.planning-year-badge {
    background: var(--primary-gradient); color: white;
    padding: 0.35rem 0.85rem; border-radius: var(--border-radius-full);
    font-size: 0.9rem; font-weight: 600;
}

.planning-nav-controls { display: flex; align-items: center; gap: 0.75rem; }

.planning-nav-btn {
    width: 42px; height: 42px; border-radius: var(--border-radius-md);
    background: var(--gray-100); color: var(--gray-600);
    display: flex; align-items: center; justify-content: center;
    font-size: 1rem; transition: all var(--transition-normal);
}
.planning-nav-btn:hover { background: var(--primary); color: white; transform: translateY(-2px); }

.planning-today-btn {
    padding: 0.6rem 1.25rem; border-radius: var(--border-radius-md);
    background: var(--primary-gradient); color: white;
    font-weight: 600; font-size: 0.9rem;
    display: flex; align-items: center; gap: 0.5rem;
    transition: all var(--transition-normal);
}
.planning-today-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-blue); }

.planning-date-selector { display: flex; align-items: center; gap: 0.5rem; }

.date-select {
    padding: 0.5rem 0.75rem; border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md); font-size: 0.9rem;
    font-weight: 500; color: var(--gray-700); background: var(--white);
    cursor: pointer; transition: all var(--transition-normal);
}
.date-select:focus { outline: none; border-color: var(--primary); }

/* Légende */
.planning-legend {
    display: flex; align-items: center; gap: 1rem; margin-top: 1rem;
    padding-top: 1rem; border-top: 1px solid var(--gray-200); flex-wrap: wrap;
}
.legend-title { font-size: 0.85rem; font-weight: 600; color: var(--gray-500); }
.legend-items { display: flex; gap: 0.75rem; flex-wrap: wrap; }
.legend-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.8rem; color: var(--gray-600); }
.legend-dot { width: 12px; height: 12px; border-radius: 4px; }
.legend-dot.stage { background: linear-gradient(135deg, #f97316, #fb923c); }
.legend-dot.revision { background: linear-gradient(135deg, #10b981, #34d399); }
.legend-dot.garde { background: linear-gradient(135deg, #ef4444, #f87171); }
.legend-dot.repos { background: linear-gradient(135deg, #8b5cf6, #a78bfa); }
.legend-dot.autre { background: linear-gradient(135deg, #ec4899, #f472b6); }

/* ===== CALENDRIER ===== */
.calendar-container {
    background: var(--white);
    border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0; 
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
}

.calendar-weekdays {
    display: grid; 
    grid-template-columns: repeat(7, minmax(120px, 1fr));
    background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
    border-bottom: 1px solid var(--gray-300);
    
    /* Sticky - AUGMENTER LE TOP */
    position: sticky;
    top: 70px;  
    z-index: 100;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    
	    border-top-left-radius: var(--border-radius-xl);
    border-top-right-radius: var(--border-radius-xl);

}

@media (max-width: 768px) {
    .calendar-weekdays {
        position: static;  /* Plus de sticky sur mobile */
        box-shadow: none;
    }
}


.weekday-header {
    padding: 0.85rem 0.5rem; text-align: center;
    font-weight: 700; font-size: 0.8rem;
    text-transform: uppercase; letter-spacing: 0.5px; color: var(--gray-600);
}
.weekday-header.weekend { color: var(--gray-400); }

.calendar-grid { 
    display: grid; 
    grid-template-columns: repeat(7, minmax(120px, 1fr));
}

/* ===== CASE DU JOUR - PLUS HAUTE + COULEUR FULL ===== */
.calendar-day {
    min-height: 160px; /* Plus haute */
    border-right: 1px solid var(--gray-400);
    border-bottom: 1px solid var(--gray-400);
    display: flex;
    flex-direction: column;
    position: relative;
    background: var(--white);
    transition: all var(--transition-normal);
}

.calendar-day:nth-child(7n) { border-right: none; }
.calendar-day.other-month { opacity: 0.4; }
.calendar-day.other-month:hover { opacity: 0.6; }

/* Weekend légèrement grisé */
.calendar-day.is-weekend { background: rgba(248, 250, 252, 0.5); }

/* Aujourd'hui */
.calendar-day.is-today {
    box-shadow: inset 0 0 0 2px var(--primary);
}

/* ===== COULEURS PASTEL FULL CASE PAR STATUT ===== */
.calendar-day.status-stage {
    background: linear-gradient(135deg, #fff7ed, #ffedd5) !important;
    border-left: 4px solid #f97316;
}

.calendar-day.status-revision {
    background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
    border-left: 4px solid #10b981;
}

.calendar-day.status-garde {
    background: linear-gradient(135deg, #fef2f2, #fee2e2) !important;
    border-left: 4px solid #ef4444;
}

.calendar-day.status-repos {
    background: linear-gradient(135deg, #faf5ff, #f3e8ff) !important;
    border-left: 4px solid #8b5cf6;
}

.calendar-day.status-autre {
    background: linear-gradient(135deg, #fdf2f8, #fce7f3) !important;
    border-left: 4px solid #ec4899;
}

/* Combinaison today + status */
.calendar-day.is-today.status-stage,
.calendar-day.is-today.status-revision,
.calendar-day.is-today.status-garde,
.calendar-day.is-today.status-repos,
.calendar-day.is-today.status-autre {
    box-shadow: inset 0 0 0 2px var(--primary);
}

/* En-tête du jour */
.day-header-zone {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 0.6rem;
    border-bottom: 1px solid rgba(0,0,0,0.12);
    cursor: pointer;
    transition: all var(--transition-normal);
    min-height: 36px;
    flex-shrink: 0;
}

.day-header-zone:hover { background: rgba(0,0,0,0.12); }

.day-num {
    font-weight: 700; font-size: 0.9rem; color: var(--gray-700);
    width: 26px; height: 26px; display: flex;
    align-items: center; justify-content: center; border-radius: 50%;
}

.calendar-day.is-today .day-num { background: var(--primary); color: white; }
.calendar-day.other-month .day-num { color: var(--gray-400); }

/* Badge statut */
.day-status-badge {
    font-size: 0.6rem; padding: 0.2rem 0.5rem; border-radius: 4px;
    font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px;
}

.day-status-badge.stage { background: #fed7aa; color: #9a3412; }
.day-status-badge.revision { background: #bbf7d0; color: #166534; }
.day-status-badge.garde { background: #fecaca; color: #991b1b; }
.day-status-badge.repos { background: #ddd6fe; color: #5b21b6; }
.day-status-badge.autre { background: #fbcfe8; color: #9d174d; }

/* Checkbox remplir semaine - Style discret */
.status-week-fill {
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid var(--gray-200);
}

.status-week-checkbox {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    cursor: pointer;
    font-size: 0.75rem;
    color: var(--gray-600);
    user-select: none;
    padding: 0.4rem;
    background: transparent;
    border-radius: var(--border-radius-sm);
    transition: all var(--transition-fast);
}


.status-week-checkbox input[type="checkbox"] {
    width: 14px;
    height: 14px;
    cursor: pointer;
    accent-color: var(--primary);
}

.status-week-checkbox span {
    font-weight: 500;
}

[data-theme="dark"] .status-week-fill {
    border-top-color: var(--gray-600);
}

[data-theme="dark"] .status-week-checkbox {
    color: var(--gray-400);
}




/* Zone notes - AUTO-EXPAND */
.day-notes-zone {
    flex: 1;
    padding: 0.4rem 0.6rem;
    overflow: hidden;
    min-height: 50px;
}

.day-notes-input {
    width: 100%;
    min-height: 45px;
    max-height: 150px;
    border: none;
    background: transparent;
    font-size: 0.72rem;
    line-height: 1.4;
    color: var(--gray-800);
    resize: none;
    outline: none;
    overflow-y: auto;
    font-weight: 800;
}

.day-notes-input::placeholder { 
    color: var(--gray-400); 
    font-style: italic; 
    opacity: 0.4;
}
.day-notes-input:focus { color: var(--gray-800); }

/* Scrollbar discrète pour les notes */
.day-notes-input::-webkit-scrollbar { width: 3px; }
.day-notes-input::-webkit-scrollbar-track { background: transparent; }
.day-notes-input::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 10px; }

/* Zone spécialités - MULTI */
.day-specialty-zone {
    padding: 0.4rem 0.6rem;
    border-top: 1px solid rgba(0,0,0,0.12);
    cursor: pointer;
    transition: all var(--transition-normal);
    min-height: 32px;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.25rem;
    flex-shrink: 0;
}

.day-specialty-zone:hover { background: rgba(0,0,0,0.03); }

.day-specialty-badge {
    font-size: 0.58rem;
    padding: 0.15rem 0.35rem;
    border-radius: 3px;
    font-weight: 600;
    white-space: nowrap;
}

.day-specialty-placeholder {
    font-size: 0.65rem;
    color: var(--gray-400);
    font-style: italic;
    opacity: 0.4;
}

/* ===== MINI POPUP - Z-INDEX ÉLEVÉ ===== */
.mini-popup {
    position: fixed; /* Fixed au lieu de absolute */
    z-index: 9999; /* Très élevé */
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0, 0, 0, 0.05);
    padding: 0.6rem;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-5px);
    transition: all 0.2s ease;
}

.mini-popup.active { opacity: 1; visibility: visible; transform: translateY(0); }

.mini-popup-status { width: 220px; }

.mini-popup-title {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--gray-500);
    padding: 0.25rem 0.5rem 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.4rem;
}

.status-mini-btn {
    padding: 0.55rem 0.3rem;
    border-radius: var(--border-radius-md);
    border: 2px solid transparent;
    cursor: pointer;
    transition: all var(--transition-fast);
    text-align: center;
    background: var(--gray-50);
}

.status-mini-btn:hover { transform: scale(1.05); }
.status-mini-btn.active { transform: scale(1.05); }

.status-mini-btn.none { border-color: var(--gray-300); }
.status-mini-btn.none.active { background: var(--gray-200); }

.status-mini-btn.stage { background: #ffedd5; border-color: #f97316; }
.status-mini-btn.stage.active { background: #fed7aa; }
.status-mini-btn.revision { background: #dcfce7; border-color: #10b981; }
.status-mini-btn.revision.active { background: #bbf7d0; }
.status-mini-btn.garde { background: #fee2e2; border-color: #ef4444; }
.status-mini-btn.garde.active { background: #fecaca; }
.status-mini-btn.repos { background: #f3e8ff; border-color: #8b5cf6; }
.status-mini-btn.repos.active { background: #ddd6fe; }
.status-mini-btn.autre { background: #fce7f3; border-color: #ec4899; }
.status-mini-btn.autre.active { background: #fbcfe8; }

.status-mini-icon { font-size: 1.1rem; margin-bottom: 0.2rem; }
.status-mini-label { font-size: 0.6rem; font-weight: 600; color: var(--gray-700); }

/* ===== MINI POPUP SPÉCIALITÉ - AMÉLIORÉ ===== */
.mini-popup-specialty {
    width: 320px;
    max-height: 420px;

}

/* Checkbox remplir semaine pour spécialités */
.specialty-week-fill {
    padding: 0.5rem 0.75rem 0.75rem;
    border-top: 1px solid var(--gray-200);
    background: var(--white);
}

.specialty-week-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    color: var(--gray-700);
    user-select: none;
}

.specialty-week-checkbox input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
    accent-color: var(--primary);
}

.specialty-week-checkbox:hover {
    color: var(--gray-900);
}

[data-theme="dark"] .specialty-week-fill {
    border-top-color: var(--gray-600);
}



.specialty-popup-header {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    padding: 0.75rem;
    border-bottom: 1px solid var(--gray-200);
    margin-bottom: 0.5rem;
}

.specialty-popup-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.mini-popup-title {
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--gray-700);
    padding: 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.specialty-popup-actions {
    display: flex;
    gap: 0.5rem;
}

.specialty-clear-btn {
    font-size: 0.75rem;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-md);
    background: var(--gray-100);
    color: var(--gray-700);
    cursor: pointer;
    transition: all var(--transition-fast);
    font-weight: 600;
    border: 1px solid var(--gray-300);
}

.specialty-clear-btn:hover { 
    background: #fee2e2; 
    color: #dc2626;
    border-color: #fecaca;
}

.specialty-confirm-btn {
    font-size: 0.75rem;
    padding: 0.5rem 1.25rem;
    border-radius: var(--border-radius-md);
    background: var(--primary);
    color: white;
    cursor: pointer;
    transition: all var(--transition-fast);
    font-weight: 600;
}

.specialty-confirm-btn:hover { 
    background: var(--primary-dark); 
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

/* Barre de recherche */
.specialty-search-wrapper {
    position: relative;
}

.specialty-search-input {
    width: 100%;
    padding: 0.6rem 0.75rem 0.6rem 2.2rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    font-size: 0.8rem;
    transition: all var(--transition-fast);
    background: var(--gray-50);
}

.specialty-search-input:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--white);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.specialty-search-input::placeholder {
    color: var(--gray-400);
}

.specialty-search-icon {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
    font-size: 0.8rem;
    pointer-events: none;
}

/* Grille scrollable */
.specialty-grid-scroll {
    max-height: 260px;
    overflow-y: auto;
    padding: 0.5rem;
}

.specialty-grid-scroll::-webkit-scrollbar { width: 5px; }
.specialty-grid-scroll::-webkit-scrollbar-track { background: var(--gray-100); border-radius: 10px; }
.specialty-grid-scroll::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 10px; }

.specialty-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.4rem;
}

.specialty-mini-btn {
    padding: 0.5rem 0.6rem;
    border-radius: var(--border-radius-md);
    border: 2px solid transparent;
    cursor: pointer;
    transition: all var(--transition-fast);
    text-align: center;
    font-size: 0.7rem;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    position: relative;
}

.specialty-mini-btn:hover { 
    transform: translateX(2px); 
    box-shadow: var(--shadow-sm);
}

.specialty-mini-btn.selected {
    border-color: var(--gray-800) !important;
    font-weight: 700;
    box-shadow: var(--shadow-md);
}

.specialty-mini-btn.selected::after {
    content: '✓';
    position: absolute;
    right: 6px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.65rem;
    font-weight: bold;
}

/* Cacher les éléments filtrés */
.specialty-mini-btn.hidden {
    display: none;
}

/* Message si aucun résultat */
.specialty-no-result {
    text-align: center;
    padding: 1.5rem;
    color: var(--gray-400);
    font-size: 0.8rem;
    grid-column: span 2;
}



/* ===== COULEURS SPÉCIALITÉS - ACCORDÉES AVEC SPECIALTY_CONFIG ===== */
.spe-hge, .day-specialty-badge.spe-hge, .specialty-mini-btn.spe-hge { 
    background: rgba(249, 115, 22, 0.15); color: #f97316; 
}
.spe-gyneco, .day-specialty-badge.spe-gyneco, .specialty-mini-btn.spe-gyneco { 
    background: rgba(236, 72, 153, 0.15); color: #ec4899; 
}
.spe-cardio, .day-specialty-badge.spe-cardio, .specialty-mini-btn.spe-cardio { 
    background: rgba(239, 68, 68, 0.15); color: #ef4444; 
}
.spe-pneumo, .day-specialty-badge.spe-pneumo, .specialty-mini-btn.spe-pneumo { 
    background: rgba(59, 130, 246, 0.15); color: #3b82f6; 
}
.spe-neuro, .day-specialty-badge.spe-neuro, .specialty-mini-btn.spe-neuro { 
    background: rgba(99, 102, 241, 0.15); color: #6366f1; 
}
.spe-psy, .day-specialty-badge.spe-psy, .specialty-mini-btn.spe-psy { 
    background: rgba(168, 85, 247, 0.15); color: #a855f7; 
}
.spe-pediatrie, .day-specialty-badge.spe-pediatrie, .specialty-mini-btn.spe-pediatrie { 
    background: rgba(244, 114, 182, 0.15); color: #f472b6; 
}
.spe-hemato, .day-specialty-badge.spe-hemato, .specialty-mini-btn.spe-hemato { 
    background: rgba(220, 38, 38, 0.15); color: #dc2626; 
}
.spe-orl, .day-specialty-badge.spe-orl, .specialty-mini-btn.spe-orl { 
    background: rgba(139, 92, 246, 0.15); color: #8b5cf6; 
}
.spe-endoc, .day-specialty-badge.spe-endoc, .specialty-mini-btn.spe-endoc { 
    background: rgba(234, 179, 8, 0.15); color: #eab308; 
}
.spe-osteo, .day-specialty-badge.spe-osteo, .specialty-mini-btn.spe-osteo { 
    background: rgba(20, 184, 166, 0.15); color: #14b8a6; 
}
.spe-onco, .day-specialty-badge.spe-onco, .specialty-mini-btn.spe-onco { 
    background: rgba(190, 18, 60, 0.15); color: #be123c; 
}
.spe-mir, .day-specialty-badge.spe-mir, .specialty-mini-btn.spe-mir { 
    background: rgba(239, 68, 68, 0.15); color: #ef4444; 
}
.spe-nephro, .day-specialty-badge.spe-nephro, .specialty-mini-btn.spe-nephro { 
    background: rgba(14, 165, 233, 0.15); color: #0ea5e9; 
}
.spe-infectio, .day-specialty-badge.spe-infectio, .specialty-mini-btn.spe-infectio { 
    background: rgba(34, 197, 94, 0.15); color: #22c55e; 
}
.spe-ophta, .day-specialty-badge.spe-ophta, .specialty-mini-btn.spe-ophta { 
    background: rgba(2, 132, 199, 0.15); color: #0284c7; 
}
.spe-therapeut, .day-specialty-badge.spe-therapeut, .specialty-mini-btn.spe-therapeut { 
    background: rgba(99, 102, 241, 0.15); color: #6366f1; 
}
.spe-legal, .day-specialty-badge.spe-legal, .specialty-mini-btn.spe-legal { 
    background: rgba(71, 85, 105, 0.15); color: #475569; 
}
.spe-geriatrie, .day-specialty-badge.spe-geriatrie, .specialty-mini-btn.spe-geriatrie { 
    background: rgba(120, 113, 108, 0.15); color: #78716c; 
}
.spe-dermato, .day-specialty-badge.spe-dermato, .specialty-mini-btn.spe-dermato { 
    background: rgba(245, 158, 11, 0.15); color: #f59e0b; 
}
.spe-mi, .day-specialty-badge.spe-mi, .specialty-mini-btn.spe-mi { 
    background: rgba(13, 148, 136, 0.15); color: #0d9488; 
}
.spe-uro, .day-specialty-badge.spe-uro, .specialty-mini-btn.spe-uro { 
    background: rgba(202, 138, 4, 0.15); color: #ca8a04; 
}
.spe-douleur, .day-specialty-badge.spe-douleur, .specialty-mini-btn.spe-douleur { 
    background: rgba(168, 85, 247, 0.15); color: #a855f7; 
}
.spe-sante-pub, .day-specialty-badge.spe-sante-pub, .specialty-mini-btn.spe-sante-pub { 
    background: rgba(5, 150, 105, 0.15); color: #059669; 
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1400px) {
    .calendar-weekdays,
    .calendar-grid {
        grid-template-columns: repeat(7, minmax(100px, 1fr));
    }
    .calendar-day { min-height: 140px; }
}

@media (max-width: 1200px) {
    .planning-container { flex-direction: column; }
    .planning-sidebar { width: 100%; position: static; max-height: none; }
    .checklist-items { max-height: 200px; }
    .calendar-day { min-height: 130px; }
}

@media (max-width: 900px) {
    .calendar-weekdays,
    .calendar-grid {
        grid-template-columns: repeat(7, minmax(80px, 1fr));
    }
    .calendar-day { min-height: 110px; }
    .day-notes-input { font-size: 0.65rem; min-height: 40px; }
    .day-specialty-zone { min-height: 26px; }
}

@media (max-width: 768px) {
    .planning-header-row { flex-direction: column; align-items: stretch; }
    .planning-month-display { justify-content: center; }
    .planning-nav-controls { justify-content: center; }
    .planning-date-selector { justify-content: center; }
    .calendar-day { min-height: 90px; }
    .day-num { font-size: 0.75rem; width: 22px; height: 22px; }
    .day-status-badge { font-size: 0.5rem; padding: 0.1rem 0.3rem; }
    .weekday-header { padding: 0.6rem 0.25rem; font-size: 0.6rem; }
    .mini-popup-specialty { width: 260px; }
}

@media (max-width: 600px) {
    .calendar-weekdays,
    .calendar-grid {
        grid-template-columns: repeat(7, minmax(50px, 1fr));
    }
    .calendar-day { min-height: 70px; }
    .day-specialty-zone { display: none; }
    .day-notes-zone { min-height: 30px; }
}

/* ===== DARK MODE ===== */
[data-theme="dark"] .calendar-container { background: var(--white); border-color: var(--gray-700); }
[data-theme="dark"] .calendar-day { background: var(--white); border-color: var(--gray-700); }
[data-theme="dark"] .calendar-weekdays { background: var(--gray-800); border-color: var(--gray-700); }
[data-theme="dark"] .mini-popup { background: var(--gray-800); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); }
[data-theme="dark"] .day-notes-input { color: var(--gray-300); }
[data-theme="dark"] .checklist-card { background: var(--white); border-color: var(--gray-700); }
[data-theme="dark"] .planning-header-card { background: var(--white); border-color: var(--gray-700); }

/* Dark mode - couleurs pastel ajustées */
[data-theme="dark"] .calendar-day.status-stage { background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.1)) !important; }
[data-theme="dark"] .calendar-day.status-revision { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1)) !important; }
[data-theme="dark"] .calendar-day.status-garde { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1)) !important; }
[data-theme="dark"] .calendar-day.status-repos { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1)) !important; }
[data-theme="dark"] .calendar-day.status-autre { background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(236, 72, 153, 0.1)) !important; }


/* ===== CUSTOM DROPDOWNS MOIS/ANNÉE ===== */
.planning-date-selector {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.custom-dropdown {
    position: relative;
    min-width: 140px;
}

.custom-dropdown.year-dropdown {
    min-width: 100px;
}

.custom-dropdown-btn {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
    padding: 0.65rem 1rem;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-lg);
    cursor: pointer;
    transition: all var(--transition-normal);
    width: 100%;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--gray-700);
}

.custom-dropdown-btn:hover {
    border-color: var(--primary);
    background: var(--gray-50);
}

.custom-dropdown-btn.active {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
}

.custom-dropdown-btn i {
    font-size: 0.7rem;
    color: var(--gray-400);
    transition: transform var(--transition-normal);
}

.custom-dropdown-btn.active i {
    transform: rotate(180deg);
}

.custom-dropdown-icon {
    color: var(--primary);
    font-size: 0.9rem;
}

.custom-dropdown-menu {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
    z-index: 1000;
    max-height: 280px;
    overflow-y: auto;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
}

.custom-dropdown-menu.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* Scrollbar */
.custom-dropdown-menu::-webkit-scrollbar { width: 5px; }
.custom-dropdown-menu::-webkit-scrollbar-track { background: var(--gray-100); border-radius: 10px; }
.custom-dropdown-menu::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 10px; }

/* Header du dropdown (optionnel) */
.custom-dropdown-header {
    padding: 0.75rem 1rem;
    background: var(--primary);
    color: white;
    font-weight: 600;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    position: sticky;
    top: 0;
    z-index: 1;
}

/* Options */
.custom-dropdown-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.7rem 1rem;
    cursor: pointer;
    transition: all var(--transition-fast);
    font-size: 0.85rem;
    color: var(--gray-700);
    border-left: 3px solid transparent;
}

.custom-dropdown-option:hover {
    background: var(--gray-50);
    border-left-color: var(--primary);
}

.custom-dropdown-option.selected {
    background: rgba(59, 130, 246, 0.1);
    color: var(--primary);
    font-weight: 600;
    border-left-color: var(--primary);
}

.custom-dropdown-option.selected::after {
    content: '✓';
    margin-left: auto;
    font-size: 0.75rem;
    font-weight: bold;
    color: var(--primary);
}

.custom-dropdown-option i {
    font-size: 0.8rem;
    width: 20px;
    text-align: center;
    color: var(--primary);
}

/* Dark mode */
[data-theme="dark"] .custom-dropdown-btn {
    background: var(--gray-800);
    border-color: var(--gray-600);
    color: var(--gray-200);
}

[data-theme="dark"] .custom-dropdown-menu {
    background: var(--gray-800);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .custom-dropdown-option {
    color: var(--gray-200);
}

[data-theme="dark"] .custom-dropdown-option:hover {
    background: var(--gray-700);
}


/* ===== PLANNING MOBILE - SCROLL HORIZONTAL FORCÉ ===== */
@media (max-width: 768px) {
    
    /* Permettre le scroll sur le wrapper uniquement */
    #page-planning {
        overflow-x: visible;
        overflow-y: visible;
    }
    
    .planning-container {
        overflow: visible;
    }
    
    .planning-main {
        overflow: visible;
        width: 100%;
    }
    
    /* Header reste fixe en largeur */
    .planning-header-card {
        width: 100%;
        overflow: visible;
    }
    
    .planning-header-row {
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
    }
    
    .planning-month-display {
        justify-content: center;
    }
    
    .planning-nav-controls {
        justify-content: center;
    }
    
    .planning-date-selector {
        justify-content: center;
    }
    
    /* Légende scrollable horizontalement */
    .planning-legend.specialty-legend {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 0.5rem;
    }
    
    .specialty-badges-legend {
        flex-wrap: nowrap;
        min-width: max-content;
    }
    
    /* ===== WRAPPER SCROLL - LA CLÉ ===== */
    .calendar-scroll-wrapper {
        width: 100%;
        overflow-x: scroll !important;
        overflow-y: visible !important;
        -webkit-overflow-scrolling: touch;
        position: relative;
        /* Masquer la scrollbar mais garder le scroll */
        scrollbar-width: thin;
        scrollbar-color: var(--gray-300) transparent;
    }
    
    .calendar-scroll-wrapper::-webkit-scrollbar {
        height: 6px;
    }
    
    .calendar-scroll-wrapper::-webkit-scrollbar-track {
        background: var(--gray-100);
        border-radius: 3px;
    }
    
    .calendar-scroll-wrapper::-webkit-scrollbar-thumb {
        background: var(--gray-300);
        border-radius: 3px;
    }
    
    /* Calendrier avec largeur FIXE pour forcer le scroll */
    .calendar-container {
        width: 650px !important;
        min-width: 650px !important;
        max-width: none !important;
        flex-shrink: 0;
    }
    
    .calendar-weekdays {
        position: static;
        box-shadow: none;
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        width: 100%;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        width: 100%;
    }
    
    .calendar-day {
        min-height: 100px;
        min-width: 0;
    }
    
    .weekday-header {
        padding: 0.6rem 0.25rem;
        font-size: 0.7rem;
    }
    
    .day-num {
        font-size: 0.75rem;
        width: 22px;
        height: 22px;
    }
    
    .day-status-badge {
        font-size: 0.5rem;
        padding: 0.1rem 0.3rem;
    }
    
    .day-notes-input {
        font-size: 0.65rem;
        min-height: 35px;
    }
    
    .day-specialty-zone {
        min-height: 24px;
    }
    
    .day-specialty-badge {
        font-size: 0.5rem;
        padding: 0.1rem 0.25rem;
    }
    
    /* Hint de scroll */
    .calendar-scroll-hint {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        margin-bottom: 0.75rem;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
        border-radius: var(--border-radius-md);
        color: var(--primary);
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .calendar-scroll-hint i {
        animation: scrollHint 1.5s ease-in-out infinite;
    }
}

@media (max-width: 480px) {
    .calendar-container {
        width: 580px !important;
        min-width: 580px !important;
    }
    
    .calendar-day {
        min-height: 85px;
    }
    
    .day-notes-input {
        font-size: 0.6rem;
        min-height: 28px;
    }
    
    .day-specialty-zone {
        min-height: 20px;
    }
    
    .planning-month-title {
        font-size: 1.2rem;
    }
    
    .planning-year-badge {
        font-size: 0.8rem;
        padding: 0.25rem 0.6rem;
    }
    
    .planning-nav-btn {
        width: 36px;
        height: 36px;
    }
    
    .planning-today-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
    }
}

/* Cacher le hint sur desktop */
@media (min-width: 769px) {
    .calendar-scroll-hint {
        display: none;
    }
}

@keyframes scrollHint {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(5px); }
}



@media (max-width: 768px) {
    
    /* ===== HEADER PLANNING RÉORGANISÉ ===== */
    .planning-header-row {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
    }
    
    /* Ligne 1 : Mois + Année (centré) */
    .planning-month-display {
        order: 1;
        justify-content: center;
        width: 100%;
    }
    
    /* Ligne 2 : Dropdowns Mois/Année */
    .planning-date-selector {
        order: 2;
        justify-content: center;
        width: 100%;
        max-width: 260px;
        gap: 0.5rem;
    }
    
    /* Ligne 3 : Navigation (flèches + Aujourd'hui) */
    .planning-nav-controls {
        order: 3;
        justify-content: center;
        width: 100%;
        max-width: 220px;
    }
    
    /* Dropdowns plus compacts */
    .custom-dropdown {
        flex: 1;
        max-width: 125px;
    }
    
    .custom-dropdown-btn {
        padding: 0.5rem 0.7rem;
        font-size: 0.8rem;
        gap: 0.4rem;
    }
    
    .custom-dropdown-icon {
        font-size: 0.8rem;
    }
    
    .custom-dropdown-btn i.fa-chevron-down {
        font-size: 0.6rem;
    }
    
    /* Boutons navigation compacts */
    .planning-nav-btn {
        width: 36px;
        height: 36px;
        font-size: 0.85rem;
    }
    
    .planning-today-btn {
        padding: 0.5rem 0.9rem;
        font-size: 0.8rem;
        white-space: nowrap;
    }
    
    /* ===== Z-INDEX POPUP SPÉCIALITÉS ===== */
    .mini-popup {
        z-index: 99999 !important;
    }
    
    .mini-popup-specialty {
        z-index: 99999 !important;
    }
    
    .mini-popup.active {
        z-index: 99999 !important;
    }
}

@media (max-width: 480px) {
    
    /* Encore plus compact */
    .planning-date-selector {
        max-width: 230px;
    }
    
    .custom-dropdown {
        max-width: 110px;
    }
    
    .custom-dropdown-btn {
        padding: 0.45rem 0.6rem;
        font-size: 0.75rem;
    }
    
    .custom-dropdown-icon {
        display: none; /* Cache l'icône calendrier */
    }
    
    .planning-nav-controls {
        max-width: 200px;
    }
    
    .planning-nav-btn {
        width: 34px;
        height: 34px;
    }
    
    .planning-today-btn {
        padding: 0.45rem 0.75rem;
        font-size: 0.75rem;
    }
    
    .planning-today-btn i {
        display: none; /* Cache l'icône pour gagner de la place */
    }
    
    .planning-month-title {
        font-size: 1.1rem;
    }
    
    .planning-year-badge {
        font-size: 0.75rem;
        padding: 0.2rem 0.5rem;
    }
}


/* ===== BOUTON ENVOYER VERS CHECKLIST ===== */
.send-to-checklist-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.35rem;
    padding: 0.35rem 0.6rem;
    margin-top: 0.35rem;
    font-size: 0.7rem;
    font-weight: 600;
    background: linear-gradient(135deg, #a855f7, #8b5cf6);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.send-to-checklist-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 3px 10px rgba(139, 92, 246, 0.4);
}

.send-to-checklist-btn i {
    font-size: 0.6rem;
}



/* Badge spécialité dans la checklist */
.checklist-specialty-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.1rem 0.3rem;
    border-radius: 4px;
    margin-left: 6px;
    font-size: 0.6rem;
    font-weight: 700;
    flex-shrink: 0;
}

/* Toast notification */
.toast-notification {
    position: fixed;
    bottom: 6rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: linear-gradient(135deg, #059669, #10b981);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    z-index: 9999;
    opacity: 0;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 500;
}

.toast-notification.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

.toast-notification.toast-warning {
    background: linear-gradient(135deg, #d97706, #f59e0b);
}

.toast-notification i {
    font-size: 1.1rem;
}

/* Légende spécialités */
.specialty-badges-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
}

.specialty-legend-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-size: 0.65rem;
    font-weight: 700;
    cursor: default;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    position: relative;
}

.specialty-legend-badge:hover {
    transform: scale(1.1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.specialty-legend-badge::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--gray-800);
    color: white;
    padding: 0.4rem 0.6rem;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 500;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.15s ease, visibility 0.15s ease;
    margin-bottom: 6px;
    z-index: 9999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.specialty-legend-badge:hover::after {
    opacity: 1;
    visibility: visible;
}

.planning-legend.specialty-legend {
    justify-content: center;
}

.specialty-badges-legend {
    justify-content: center;
}
	.specialty-badges-legend {
        display: grid;
        grid-template-columns: repeat(12, auto);
        justify-content: center;
    }

/* ===== FIX TOOLTIPS LÉGENDE SPÉCIALITÉS SUR MOBILE ===== */
@media (max-width: 768px) {

    .specialty-badges-legend {
        padding-top: 25px;  /* Espace pour le tooltip au-dessus */
    }
    
    .planning-legend.specialty-legend {
        margin-top: 0;
    }
	
	    .specialty-badges-legend {
        flex-wrap: wrap;
        min-width: auto;
    }
	    .specialty-badges-legend {
        display: grid;
        grid-template-columns: repeat(8, auto);
        justify-content: center;
        gap: 0.6rem;
    }
	
	    .specialty-legend-badge {
        padding: 0.4rem 0.55rem;
        font-size: 0.75rem;
    }
	    .planning-legend.specialty-legend {
        margin-top: 1rem;
    }
	
	
}


/* ===== DARK MODE - PLANNING COMPLET ===== */

/* Popup spécialités */
[data-theme="dark"] .mini-popup-specialty {
    background: #1e293b;
    border: 1px solid #334155;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

[data-theme="dark"] .specialty-popup-header {
    border-bottom-color: #334155;
}

[data-theme="dark"] .mini-popup-title {
    color: #e2e8f0;
}

[data-theme="dark"] .specialty-search-input {
    background: #0f172a;
    border-color: #334155;
    color: #e2e8f0;
}

[data-theme="dark"] .specialty-search-input::placeholder {
    color: #64748b;
}

[data-theme="dark"] .specialty-search-input:focus {
    border-color: var(--primary);
    background: #0f172a;
}

[data-theme="dark"] .specialty-mini-btn {
    border-color: #334155;
}

[data-theme="dark"] .specialty-mini-btn:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

[data-theme="dark"] .specialty-clear-btn {
    background: #334155;
    border-color: #475569;
    color: #cbd5e1;
}

[data-theme="dark"] .specialty-clear-btn:hover {
    background: rgba(239, 68, 68, 0.2);
    border-color: rgba(239, 68, 68, 0.4);
    color: #f87171;
}

[data-theme="dark"] .specialty-grid-scroll::-webkit-scrollbar-track {
    background: #1e293b;
}

[data-theme="dark"] .specialty-grid-scroll::-webkit-scrollbar-thumb {
    background: #475569;
}

/* Popup type de journée */
[data-theme="dark"] .mini-popup-status {
    background: #1e293b;
    border: 1px solid #334155;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

[data-theme="dark"] .status-mini-btn {
    background: #0f172a;
    border: 1px solid #334155;
}

[data-theme="dark"] .status-mini-btn:hover {
    background: #334155;
}

[data-theme="dark"] .status-mini-btn.active {
    border-color: var(--primary);
    background: #334155;
}

[data-theme="dark"] .status-mini-label {
    color: #cbd5e1;
}

/* Ligne des jours de la semaine */
[data-theme="dark"] .calendar-weekdays {
    background: linear-gradient(135deg, #1e293b, #0f172a);
    border-bottom-color: #334155;
}

[data-theme="dark"] .weekday-header {
    color: #cbd5e1;
}

[data-theme="dark"] .weekday-header.weekend {
    color: #64748b;
}

/* Dropdowns mois et année */
[data-theme="dark"] .custom-dropdown-btn {
    background: #1e293b;
    border-color: #334155;
    color: #e2e8f0;
}

[data-theme="dark"] .custom-dropdown-btn:hover {
    background: #334155;
    border-color: #475569;
}

[data-theme="dark"] .custom-dropdown-menu {
    background: #1e293b;
    border-color: #334155;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

[data-theme="dark"] .custom-dropdown-header {
    background: #0f172a;
    color: #cbd5e1;
    border-bottom-color: #334155;
}

[data-theme="dark"] .custom-dropdown-option {
    color: #cbd5e1;
}

[data-theme="dark"] .custom-dropdown-option:hover {
    background: #334155;
}

[data-theme="dark"] .custom-dropdown-option.selected {
    background: var(--primary);
    color: white;
}

/* Tooltip légende spécialités */
[data-theme="dark"] .specialty-legend-badge::after {
    background: #1e293b;
    color: #e2e8f0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

/* Légende matières */
[data-theme="dark"] .legend-title {
    color: #94a3b8;
}

[data-theme="dark"] .legend-item {
    color: #cbd5e1;
}

[data-theme="dark"] .planning-legend {
    border-top-color: #334155;
}

/* Boutons navigation */
[data-theme="dark"] .planning-nav-btn {
    background: #1e293b;
    border-color: #334155;
    color: #cbd5e1;
}

[data-theme="dark"] .planning-nav-btn:hover {
    background: #334155;
    color: #e2e8f0;
}

/* Scrollbars */
[data-theme="dark"] .calendar-wrapper::-webkit-scrollbar-track {
    background: #1e293b;
}

[data-theme="dark"] .calendar-wrapper::-webkit-scrollbar-thumb {
    background: #475569;
}

[data-theme="dark"] .calendar-wrapper::-webkit-scrollbar-thumb:hover {
    background: #64748b;
}

[data-theme="dark"] .specialty-badges-legend::-webkit-scrollbar-track {
    background: #1e293b;
}

[data-theme="dark"] .specialty-badges-legend::-webkit-scrollbar-thumb {
    background: #475569;
}

/* Checklist */
[data-theme="dark"] .checklist-input {
    background: #0f172a;
    border-color: #334155;
    color: #e2e8f0;
}

[data-theme="dark"] .checklist-input::placeholder {
    color: #64748b;
}

[data-theme="dark"] .checklist-input:focus {
    border-color: var(--primary);
    background: #0f172a;
}

[data-theme="dark"] .checklist-add-btn {
    background: var(--primary);
    color: white;
}

[data-theme="dark"] .checklist-item {
    border-bottom-color: #334155;
}

[data-theme="dark"] .checklist-item-text {
    color: #e2e8f0;
}

[data-theme="dark"] .checklist-item.completed .checklist-item-text {
    color: #64748b;
}

[data-theme="dark"] .checklist-checkbox {
    border-color: #475569;
    background: #0f172a;
}

[data-theme="dark"] .checklist-checkbox.checked {
    background: var(--primary);
    border-color: var(--primary);
}

[data-theme="dark"] .checklist-delete {
    color: #64748b;
}

[data-theme="dark"] .checklist-delete:hover {
    color: #f87171;
}

[data-theme="dark"] .checklist-empty {
    color: #64748b;
}

[data-theme="dark"] .checklist-empty i {
    color: #475569;
}

/* Cases du calendrier - bordures */
[data-theme="dark"] .calendar-day {
    border-color: #334155;
}

/* Header des cases */
[data-theme="dark"] .day-header-zone {
    border-bottom-color: #334155;
}

[data-theme="dark"] .day-header-zone:hover {
    background: rgba(255,255,255,0.05);
}

[data-theme="dark"] .day-num {
    color: #e2e8f0;
}

/* Notes */
[data-theme="dark"] .day-notes-input {
    color: #cbd5e1;
    background: transparent;
}

[data-theme="dark"] .day-notes-input::placeholder {
    color: #475569;
}

/* Titre mois */
[data-theme="dark"] .planning-month-title {
    color: #e2e8f0;
}

[data-theme="dark"] .planning-year-badge {
    background: #334155;
    color: #cbd5e1;
}

/* ===== DARK MODE - CONTRASTE CALENDRIER ===== */

/* Cases du calendrier - plus de contraste */
[data-theme="dark"] .calendar-day {
    border-color: #475569;
    background: #0f172a;
}

[data-theme="dark"] .calendar-day.other-month {
    background: #020617;
}

[data-theme="dark"] .calendar-day.is-weekend {
    background: #0c1322;
}

[data-theme="dark"] .calendar-day.is-today {
    box-shadow: inset 0 0 0 2px var(--primary);
}

/* Zone type de journée (header) */
[data-theme="dark"] .day-header-zone {
    background: #1e293b;
    border-bottom: 2px solid #475569;
}

[data-theme="dark"] .day-header-zone:hover {
    background: #334155;
}

[data-theme="dark"] .day-num {
    color: #f1f5f9;
}

[data-theme="dark"] .day-status-badge {
    font-weight: 700;
}

/* Zone spécialités */
[data-theme="dark"] .day-specialty-zone {
    background: #0f172a;
    border-bottom: 2px solid #475569;
}

[data-theme="dark"] .day-specialty-zone:hover {
    background: #1e293b;
}

[data-theme="dark"] .day-specialty-badge {
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

/* Zone notes */
[data-theme="dark"] .day-notes-zone {
    background: #1e293b;
}

[data-theme="dark"] .day-notes-input {
    color: #e2e8f0;
    background: transparent;
}

[data-theme="dark"] .day-notes-input:focus {
    background: #334155;
}

[data-theme="dark"] .day-notes-input::placeholder {
    color: #64748b;
}

/* Statuts avec plus de contraste */
[data-theme="dark"] .calendar-day.status-stage {
    background: linear-gradient(135deg, #431407, #7c2d12) !important;
    border-left: 4px solid #f97316;
}

[data-theme="dark"] .calendar-day.status-revision {
    background: linear-gradient(135deg, #052e16, #14532d) !important;
    border-left: 4px solid #10b981;
}

[data-theme="dark"] .calendar-day.status-garde {
    background: linear-gradient(135deg, #450a0a, #7f1d1d) !important;
    border-left: 4px solid #ef4444;
}

[data-theme="dark"] .calendar-day.status-repos {
    background: linear-gradient(135deg, #2e1065, #4c1d95) !important;
    border-left: 4px solid #8b5cf6;
}

[data-theme="dark"] .calendar-day.status-autre {
    background: linear-gradient(135deg, #500724, #831843) !important;
    border-left: 4px solid #ec4899;
}

/* Zones internes avec statut - garder le contraste */
[data-theme="dark"] .calendar-day.status-stage .day-header-zone,
[data-theme="dark"] .calendar-day.status-revision .day-header-zone,
[data-theme="dark"] .calendar-day.status-garde .day-header-zone,
[data-theme="dark"] .calendar-day.status-repos .day-header-zone,
[data-theme="dark"] .calendar-day.status-autre .day-header-zone {
    background: rgba(0,0,0,0.2);
}

[data-theme="dark"] .calendar-day.status-stage .day-specialty-zone,
[data-theme="dark"] .calendar-day.status-revision .day-specialty-zone,
[data-theme="dark"] .calendar-day.status-garde .day-specialty-zone,
[data-theme="dark"] .calendar-day.status-repos .day-specialty-zone,
[data-theme="dark"] .calendar-day.status-autre .day-specialty-zone {
    background: rgba(0,0,0,0.15);
}

[data-theme="dark"] .calendar-day.status-stage .day-notes-zone,
[data-theme="dark"] .calendar-day.status-revision .day-notes-zone,
[data-theme="dark"] .calendar-day.status-garde .day-notes-zone,
[data-theme="dark"] .calendar-day.status-repos .day-notes-zone,
[data-theme="dark"] .calendar-day.status-autre .day-notes-zone {
    background: rgba(0,0,0,0.1);
}

.mini-popup-status .mini-popup-title {
    margin-bottom: 8px; /* ajuste à 10–16px selon ton ressenti */
}


/* Notification d'erreur pour tâche vide */
.checklist-error-notification {
    position: absolute;
    top: -45px;
    left: 50%;
    transform: translateX(-50%);
    background: #ef4444;
    color: white;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 500;
    white-space: nowrap;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    z-index: 100;
}

.checklist-error-notification::after {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid #ef4444;
}

.checklist-error-notification.show {
    opacity: 1;
    visibility: visible;
}

/* Animation vibration */
@keyframes shake {
    0%, 100% { transform: translateX(-50%); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(calc(-50% - 5px)); }
    20%, 40%, 60%, 80% { transform: translateX(calc(-50% + 5px)); }
}

.checklist-error-notification.shake {
    animation: shake 0.5s ease-in-out;
}

.checklist-input.error {
    border-color: #ef4444 !important;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;
}

/* ===== LAYOUT PRÉSENTATION AVEC SIDEBAR (comme Planning) ===== */
.presentation-layout {
    display: flex;
    gap: 2rem;
    width: 100%;
    align-items: flex-start;
    position: relative;
}

.presentation-sidebar {
    width: 320px;
    flex-shrink: 0;
    position: sticky;
    top: 90px;
    height: fit-content;
    max-height: calc(100vh - 110px);
    z-index: 10;
    align-self: flex-start;
}

.presentation-main {
    flex: 1;
    min-width: 0;
}

/* Carte login dans la sidebar */
.login-sidebar-card {
    background: var(--white);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
    overflow: hidden;
}

.login-sidebar-header {
    background: linear-gradient(135deg, #3b82f6, #60a5fa);
    padding: 1.25rem 1.5rem;
    text-align: center;
}

.login-sidebar-header-title {
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
}

.login-sidebar-body {
    padding: 1.5rem;
    text-align: center;
}

.login-sidebar-icon {
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg, var(--gray-100), var(--gray-200));
    border-radius: var(--border-radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.25rem;
    font-size: 2rem;
    color: var(--primary);
}

.login-sidebar-title {
    font-size: 1.15rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.75rem;
}

.login-sidebar-text {
    color: var(--gray-600);
    font-size: 0.9rem;
    line-height: 1.6;
    margin-bottom: 1.25rem;
}

.login-sidebar-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.9rem 1.5rem;
    background: var(--primary-gradient);
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
    border-radius: var(--border-radius-full);
    box-shadow: var(--shadow-blue);
    transition: all var(--transition-normal);
    margin-bottom: 1rem;
}

.login-sidebar-btn:hover {
    transform: translateY(-2px);
    color: white;
}

.login-sidebar-scroll-hint {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    color: var(--gray-500);
    font-size: 0.8rem;
    transition: color var(--transition-normal);
}

.login-sidebar-scroll-hint:hover {
    color: var(--primary);
}

.login-sidebar-scroll-hint i {
    font-size: 1rem;
    color: var(--primary);
    animation: bounce 2s infinite;
}

/* Dark mode */
[data-theme="dark"] .login-sidebar-card {
    background: #1e293b;
    border-color: #334155;
}

[data-theme="dark"] .login-sidebar-icon {
    background: linear-gradient(135deg, #334155, #475569);
    color: var(--primary-light);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1024px) {
    .presentation-layout {
        flex-direction: column;
    }
    
    .presentation-sidebar {
        width: 100%;
        position: static;
        max-height: none;
        order: -1; /* La sidebar passe AU-DESSUS sur mobile */
    }
    
    .login-sidebar-card {
        max-width: 400px;
        margin: 0 auto;
    }
    
    .presentation-main {
        width: 100%;
    }
}


@media (max-width: 768px) {
    
    /* ===== CORRECTION 1 : Boutons navigation plus compacts ===== */
    .planning-header-row {
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        padding: 0 0.5rem;
    }
    
    .planning-nav-controls {
        justify-content: center;
        width: 100%;
        max-width: 280px;
    }
    
    .planning-nav-btn {
        width: 38px;
        height: 38px;
        font-size: 0.9rem;
    }
    
    .planning-today-btn {
        padding: 0.5rem 0.9rem;
        font-size: 0.8rem;
        white-space: nowrap;
    }
    
    /* Dropdowns mois/année plus compacts */
    .planning-date-selector {
        justify-content: center;
        width: 100%;
        max-width: 280px;
        gap: 0.5rem;
    }
    
    .custom-dropdown {
        flex: 1;
        max-width: 130px;
    }
    
    .custom-dropdown-btn {
        padding: 0.5rem 0.7rem;
        font-size: 0.8rem;
        gap: 0.4rem;
    }
    
    .custom-dropdown-icon {
        font-size: 0.8rem;
    }
    
    .custom-dropdown-btn i.fa-chevron-down {
        font-size: 0.6rem;
    }
    
    /* ===== CORRECTION 2 : Badges spécialités visibles ===== */
    .day-specialty-zone {
        min-height: 28px !important;
        padding: 0.25rem 0.4rem;
        display: flex !important;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.2rem;
        overflow: visible !important;
    }
    
    .day-specialty-badge {
        font-size: 0.5rem !important;
        padding: 0.1rem 0.25rem !important;
        border-radius: 2px;
        line-height: 1.2;
    }
    
    .day-specialty-placeholder {
        font-size: 0.55rem;
    }
    
    /* Cases du calendrier avec assez d'espace */
    .calendar-day {
        min-height: 105px;
        display: flex;
        flex-direction: column;
    }
    
    /* Zone notes ne prend pas tout l'espace */
    .day-notes-zone {
        flex: 1;
        min-height: 30px;
        max-height: 45px;
    }
    
    .day-notes-input {
        font-size: 0.6rem;
        min-height: 28px;
    }
}

@media (max-width: 480px) {
    
    /* Encore plus compact sur très petit écran */
    .planning-nav-controls {
        max-width: 250px;
    }
    
    .planning-nav-btn {
        width: 34px;
        height: 34px;
    }
    
    .planning-today-btn {
        padding: 0.45rem 0.75rem;
        font-size: 0.75rem;
    }
    
    .planning-today-btn i {
        display: none; /* Cache l'icône pour gagner de la place */
    }
    
    .planning-date-selector {
        max-width: 240px;
    }
    
    .custom-dropdown {
        max-width: 115px;
    }
    
    .custom-dropdown-btn {
        padding: 0.45rem 0.6rem;
        font-size: 0.75rem;
    }
    
    .custom-dropdown-icon {
        display: none; /* Cache l'icône calendrier */
    }
    
    /* Badges spécialités encore plus petits */
    .day-specialty-badge {
        font-size: 0.45rem !important;
        padding: 0.08rem 0.2rem !important;
    }
    
    .calendar-day {
        min-height: 95px;
    }
}

/* Hint de scroll pour liste des items */
.items-scroll-hint {
    display: none; /* Caché par défaut sur desktop */
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    margin-bottom: 0.75rem;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
    border-radius: var(--border-radius-md);
    color: var(--primary);
    font-size: 0.8rem;
    font-weight: 500;
}

.items-scroll-hint i {
    animation: scrollHint 1.5s ease-in-out infinite;
}

@media (max-width: 768px) {
    .items-scroll-hint {
        display: flex !important; /* Toujours visible sur mobile */
    }
}


@media (max-width: 768px) {
    
    /* ===== NAVIGATION ONGLETS - MOBILE ===== */
    .app-nav {
        display: flex;
        flex-wrap: nowrap;
        justify-content: space-between;
        gap: 0.75rem;
        padding: 0.6rem 0.75rem;
        width: 100%;
    }
    
    .app-nav-btn {
        flex: 1;
        min-width: 70px;
        padding: 1.1rem 1.5rem;
        border-radius: var(--border-radius-lg);
    }
    
    .app-nav-btn span {
        display: none;
    }
    
    .app-nav-btn i {
        font-size: 1.4rem;
        margin: 0;
    }
}

@media (max-width: 480px) {
    
    .app-nav {
        gap: 0.6rem;
        padding: 0.5rem 0.6rem;
    }
    
    .app-nav-btn {
        min-width: 60px;
        padding: 1rem 1.25rem;
    }
    
    .app-nav-btn i {
        font-size: 1.3rem;
    }
}


/* ===== PAGINATION ITEMS ===== */
.items-pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--white);
    border-top: 1px solid var(--gray-200);
    border-radius: 0 0 var(--border-radius-xl) var(--border-radius-xl);
}

.pagination-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 42px;
    height: 42px;
    border-radius: var(--border-radius-md);
    background: var(--gray-100);
    color: var(--gray-600);
    font-size: 1rem;
    transition: all var(--transition-normal);
    border: 1px solid var(--gray-200);
}

.pagination-btn:hover:not(:disabled) {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    transform: translateY(-2px);
}

.pagination-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.pagination-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.95rem;
    color: var(--gray-700);
    font-weight: 500;
}

.pagination-current {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 80px;
    padding: 0.5rem 1rem;
    background: var(--primary-gradient);
    color: white;
    border-radius: var(--border-radius-full);
    font-weight: 700;
    font-size: 0.95rem;
}

.pagination-total {
    color: var(--gray-500);
    font-size: 0.85rem;
}

.pagination-select {
    padding: 0.5rem 0.75rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--gray-700);
    background: var(--white);
    cursor: pointer;
    transition: all var(--transition-normal);
}

.pagination-select:focus {
    outline: none;
    border-color: var(--primary);
}

/* Pagination en haut aussi */
.items-pagination-top {
    border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0;
    border-top: none;
    border-bottom: 1px solid var(--gray-200);
    margin-bottom: 0;
}

/* Dark mode */
[data-theme="dark"] .items-pagination {
    background: var(--white);
    border-color: var(--gray-700);
}

[data-theme="dark"] .pagination-btn {
    background: var(--gray-800);
    border-color: var(--gray-700);
    color: var(--gray-300);
}

[data-theme="dark"] .pagination-btn:hover:not(:disabled) {
    background: var(--primary);
    color: white;
}

[data-theme="dark"] .pagination-select {
    background: var(--gray-800);
    border-color: var(--gray-700);
    color: var(--gray-300);
}

/* Mobile */
@media (max-width: 768px) {
    .items-pagination {
        flex-wrap: wrap;
        gap: 0.75rem;
        padding: 0.75rem;
    }
    
    .pagination-btn {
        width: 38px;
        height: 38px;
    }
    
    .pagination-info {
        order: -1;
        width: 100%;
        justify-content: center;
    }
    
    .pagination-current {
        min-width: 70px;
        padding: 0.4rem 0.75rem;
        font-size: 0.85rem;
    }
    
    .pagination-total {
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .pagination-select {
        font-size: 0.8rem;
        padding: 0.4rem 0.5rem;
    }
    
    .items-pagination-top {
        display: none; /* Cache la pagination du haut sur très petit écran */
    }
}


/* ===== SECTION HEADER AVEC PAGINATION INTÉGRÉE ===== */
#page-items .section-header {
    position: sticky;
    top: 70px;
    z-index: 60;
    background: var(--gray-50);
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 1rem 1.5rem;
    flex-wrap: nowrap;
}

.section-header-top {
    display: contents; /* Les enfants se placent directement dans le parent */
}

/* Titre */
#page-items .section-title {
    flex-shrink: 0;
}

/* Légende au centre */
#page-items .support-legend {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    flex-wrap: wrap;
    margin: 0;
    justify-content: center;
    flex: 1;
}

/* Pagination */
.header-pagination {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--white);
    padding: 0.4rem 0.75rem;
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--gray-200);
    box-shadow: var(--shadow-sm);
    flex-shrink: 0;
}

.header-pagination .pagination-btn {
    width: 32px;
    height: 32px;
    font-size: 0.8rem;
    background: var(--gray-100);
    border: 1px solid var(--gray-200);
    border-radius: var(--border-radius-md);
    color: var(--gray-600);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-normal);
}

.header-pagination .pagination-btn:hover:not(:disabled) {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.header-pagination .pagination-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.header-pagination .pagination-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
}

.header-pagination .pagination-current {
    min-width: 55px;
    padding: 0.3rem 0.6rem;
    background: var(--primary-gradient);
    color: white;
    border-radius: var(--border-radius-full);
    font-weight: 700;
    font-size: 0.8rem;
    text-align: center;
}

.header-pagination .pagination-total {
    color: var(--gray-500);
    font-size: 0.75rem;
    font-weight: 500;
}

/* Bouton réinitialiser */
#page-items .quick-actions {
    flex-shrink: 0;
}

/* Sticky du thead */
#page-items .items-table th {
    position: sticky;
    top: 145px;
    z-index: 50;
    background: var(--gray-50);
}

/* Dark mode */
[data-theme="dark"] .header-pagination {
    background: var(--gray-800);
    border-color: var(--gray-700);
}

[data-theme="dark"] .header-pagination .pagination-btn {
    background: var(--gray-700);
    border-color: var(--gray-600);
    color: var(--gray-300);
}

/* ===== RESPONSIVE - MOBILE ===== */
@media (max-width: 1100px) {
    #page-items .support-legend {
        display: none;
    }
}

@media (max-width: 900px) {
    #page-items .section-header {
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.75rem;
    }
    
    .section-header-top {
        display: flex;
        width: 100%;
        justify-content: space-between;
        align-items: center;
        gap: 0.75rem;
    }
    
    #page-items .section-title {
        flex: 1;
    }
    
    .header-pagination {
        order: 0;
    }
    
    #page-items .quick-actions {
        order: 1;
    }
}

@media (max-width: 768px) {
    #page-items .section-header {
        position: sticky;
        top: 70px;
        z-index: 60;
        padding: 0.75rem 1rem;
        gap: 0.5rem;
    }
    
    .section-header-top {
        flex-direction: column;
        align-items: center;
        gap: 0.6rem;
    }
    
    #page-items .section-title {
        font-size: 1rem;
        justify-content: center;
        text-align: center;
    }
    
    .header-pagination {
        padding: 0.35rem 0.6rem;
    }
    
    .header-pagination .pagination-btn {
        width: 30px;
        height: 30px;
        font-size: 0.75rem;
    }
    
    .header-pagination .pagination-current {
        min-width: 50px;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
    }
    
    /* Ajuster le sticky du thead */
    #page-items .items-table th {
        position: sticky;
        top: 145px;
        z-index: 50;
    }
}

@media (max-width: 480px) {
    #page-items .section-header {
        padding: 0.6rem 0.75rem;
    }
    
    #page-items .section-title {
        font-size: 0.9rem;
    }
    
    .header-pagination .pagination-total {
        display: none;
    }
    
    .header-pagination .pagination-btn {
        width: 28px;
        height: 28px;
    }
    
    .header-pagination .pagination-current {
        min-width: 45px;
        font-size: 0.7rem;
    }
    
    #page-items .items-table th {
        top: 130px;
    }
}

/* ===== CORRECTION 1 : Désactiver sticky du thead sur mobile ===== */
@media (max-width: 768px) {
    #page-items .items-table th {
        position: static !important;
        top: auto !important;
    }
    
    #page-items .section-header {
        position: sticky;
        top: 70px;
        z-index: 60;
    }
}

@media (max-width: 480px) {
    #page-items .items-table th {
        position: static !important;
        top: auto !important;
    }
}

/* ===== PAGINATION - MODE SOMBRE ===== */
[data-theme="dark"] .pagination-btn {
    background: #334155;
    color: #e2e8f0;
    border-color: #475569;
}

[data-theme="dark"] .pagination-btn:hover:not(:disabled) {
    background: #475569;
    color: #f8fafc;
}

[data-theme="dark"] .pagination-btn:disabled {
    background: #1e293b;
    color: #64748b;
    border-color: #334155;
}

[data-theme="dark"] .header-pagination .pagination-btn {
    background: #334155;
    color: #e2e8f0;
    border-color: #475569;
}

[data-theme="dark"] .header-pagination .pagination-btn:hover:not(:disabled) {
    background: #475569;
    color: #f8fafc;
}

[data-theme="dark"] .header-pagination .pagination-btn:disabled {
    background: #1e293b;
    color: #64748b;
}

[data-theme="dark"] .pagination-select {
    background: #334155;
    color: #e2e8f0;
    border-color: #475569;
}

[data-theme="dark"] .pagination-select:hover {
    border-color: #60a5fa;
}

[data-theme="dark"] .pagination-select:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
}

[data-theme="dark"] .header-pagination {
    background: #1e293b;
    border-color: #334155;
}

/* ===== POPUP CHOIX VALIDATION CHECKLIST ===== */
.checklist-choice-popup {
    position: fixed;
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    border: 1px solid var(--gray-200);
    padding: 0.75rem;
    z-index: 9999;
    display: none;
    flex-direction: column;
    gap: 0.5rem;
    min-width: 200px;
}

.checklist-choice-popup.show {
    display: flex;
}

.checklist-choice-btn {
    padding: 0.6rem 1rem;
    border-radius: var(--border-radius-md);
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: none;
}

.checklist-choice-btn.tour-and-task {
    background: linear-gradient(135deg, #8b5cf6, #a78bfa);
    color: white;
}

.checklist-choice-btn.tour-and-task:hover {
    background: linear-gradient(135deg, #7c3aed, #8b5cf6);
    transform: translateY(-1px);
}

.checklist-choice-btn.task-only {
    background: linear-gradient(135deg, #10b981, #34d399);
    color: white;
}

.checklist-choice-btn.task-only:hover {
    background: linear-gradient(135deg, #059669, #10b981);
    transform: translateY(-1px);
}

.checklist-choice-btn i {
    font-size: 0.9rem;
}

[data-theme="dark"] .checklist-choice-popup {
    background: #1e293b;
    border-color: #334155;
}
[data-theme="dark"] .checklist-choice-btn.task-only {
    background: linear-gradient(135deg, #10b981, #34d399);
    color: white;
}

[data-theme="dark"] .checklist-choice-btn.task-only:hover {
    background: linear-gradient(135deg, #059669, #10b981);
}


/* ===== DROPDOWN PAGINATION PERSONNALISÉ ===== */
.pagination-dropdown {
    min-width: 130px;
}

.pagination-dropdown .custom-dropdown-btn {
    padding: 0.5rem 0.75rem;
    font-size: 0.85rem;
}

.pagination-dropdown .custom-dropdown-menu {
    min-width: 150px;
    right: 0;
    left: auto;
}

.pagination-dropdown .custom-dropdown-option {
    font-size: 0.85rem;
}

/* Badge "Ajouté à la checklist" */
.added-to-checklist-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.35rem;
    padding: 0.35rem 0.6rem;
    margin-top: 0.35rem;
    font-size: 0.7rem;
    font-weight: 600;
    background: linear-gradient(135deg, #10b981, #34d399);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: default;
    white-space: nowrap;
}

.added-to-checklist-badge i {
    font-size: 0.6rem;
}


/* ===== SYSTÈME DE TROPHÉES ===== */
.trophies-section {
    margin-top: 1.5rem;
}

.trophies-card {
    background: var(--white);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
    overflow: hidden;
}

.trophies-header {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--gray-50);
}

.trophies-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--gray-900);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.trophies-title i {
    color: #f59e0b;
}

.trophies-progress-text {
    font-size: 0.85rem;
    color: var(--gray-500);
    font-weight: 500;
}

.trophies-progress-text span {
    color: var(--primary);
    font-weight: 700;
}

.trophies-body {
    padding: 1.5rem;
}

.trophies-category {
    margin-bottom: 1.5rem;
}

.trophies-category:last-child {
    margin-bottom: 0;
}

.trophies-category-title {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--gray-600);
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.trophies-category-title i {
    font-size: 0.75rem;
}

.trophies-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 0.75rem;
}

.trophy-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem 0.75rem;
    background: var(--gray-50);
    border-radius: var(--border-radius-lg);
    border: 2px solid var(--gray-200);
    transition: all 0.3s ease;
    cursor: default;
    position: relative;
    overflow: hidden;
}

.trophy-item.locked {
    opacity: 0.5;
    filter: grayscale(100%);
}

.trophy-item.unlocked {
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
    border-color: #fbbf24;
}

.trophy-item.unlocked:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(251, 191, 36, 0.3);
}

.trophy-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    position: relative;
}

.trophy-item.locked .trophy-icon {
    background: var(--gray-200);
    color: var(--gray-400);
}

.trophy-item.unlocked .trophy-icon {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
}

.trophy-item.locked .trophy-icon::after {
    content: "\f023";
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    position: absolute;
    bottom: -2px;
    right: -2px;
    width: 18px;
    height: 18px;
    background: var(--gray-400);
    border-radius: 50%;
    font-size: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.trophy-name {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--gray-700);
    text-align: center;
    line-height: 1.3;
    margin-bottom: 0.25rem;
}

.trophy-item.locked .trophy-name {
    color: var(--gray-400);
}

.trophy-desc {
    font-size: 0.65rem;
    color: var(--gray-500);
    text-align: center;
    line-height: 1.2;
}

.trophy-item.locked .trophy-desc {
    color: var(--gray-400);
}

.trophy-date {
    font-size: 0.6rem;
    color: #f59e0b;
    margin-top: 0.35rem;
    font-weight: 500;
}

/* Animation déblocage */
.trophy-item.just-unlocked {
    animation: trophyUnlock 0.6s ease;
}

@keyframes trophyUnlock {
    0% { transform: scale(1); }
    30% { transform: scale(1.15); }
    60% { transform: scale(0.95); }
    100% { transform: scale(1); }
}

/* Notification trophée */
.trophy-notification {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius-lg);
    box-shadow: 0 10px 40px rgba(251, 191, 36, 0.5);
    display: flex;
    align-items: center;
    gap: 1rem;
    z-index: var(--z-max);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.trophy-notification.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

.trophy-notification-icon {
    width: 45px;
    height: 45px;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
}

.trophy-notification-content {
    display: flex;
    flex-direction: column;
}

.trophy-notification-title {
    font-size: 0.75rem;
    font-weight: 500;
    opacity: 0.9;
}

.trophy-notification-name {
    font-size: 1rem;
    font-weight: 700;
}

/* Dark mode Trophées */
[data-theme="dark"] .trophies-card {
    background: #1e293b;
    border-color: #334155;
}

[data-theme="dark"] .trophies-header {
    background: #0f172a;
    border-color: #334155;
}

[data-theme="dark"] .trophies-title {
    color: #f1f5f9;
}

[data-theme="dark"] .trophies-title i {
    color: #fbbf24;
}

[data-theme="dark"] .trophies-progress-text {
    color: #94a3b8;
}

[data-theme="dark"] .trophies-progress-text span {
    color: #60a5fa;
}

[data-theme="dark"] .trophies-body {
    background: #1e293b;
}

[data-theme="dark"] .trophies-category-title {
    color: #94a3b8;
}

[data-theme="dark"] .trophy-item {
    background: #334155;
    border-color: #475569;
}

[data-theme="dark"] .trophy-item.locked {
    background: #1e293b;
    border-color: #334155;
    opacity: 0.6;
}

[data-theme="dark"] .trophy-item.unlocked {
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.1));
    border-color: #b45309;
}

[data-theme="dark"] .trophy-item.unlocked:hover {
    box-shadow: 0 8px 20px rgba(251, 191, 36, 0.2);
}

[data-theme="dark"] .trophy-item.locked .trophy-icon {
    background: #475569;
    color: #64748b;
}

[data-theme="dark"] .trophy-item.unlocked .trophy-icon {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
}

[data-theme="dark"] .trophy-item.locked .trophy-icon::after {
    background: #64748b;
}

[data-theme="dark"] .trophy-name {
    color: #e2e8f0;
}

[data-theme="dark"] .trophy-item.locked .trophy-name {
    color: #64748b;
}

[data-theme="dark"] .trophy-desc {
    color: #94a3b8;
}

[data-theme="dark"] .trophy-item.locked .trophy-desc {
    color: #475569;
}

[data-theme="dark"] .trophy-date {
    color: #fbbf24;
}

[data-theme="dark"] .trophy-notification {
    background: linear-gradient(135deg, #b45309, #d97706);
    box-shadow: 0 10px 40px rgba(180, 83, 9, 0.4);
}

[data-theme="dark"] .trophy-notification-icon {
    background: rgba(255, 255, 255, 0.2);
}

/* Responsive */
@media (max-width: 768px) {
    .trophies-grid {
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        gap: 0.5rem;
    }
    
    .trophy-item {
        padding: 0.75rem 0.5rem;
    }
    
    .trophy-icon {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
    
    .trophy-name {
        font-size: 0.7rem;
    }
    
    .trophy-notification {
        left: 1rem;
        right: 1rem;
        transform: translateX(0) translateY(100px);
        padding: 0.85rem 1rem;
    }
    
    .trophy-notification.show {
        transform: translateX(0) translateY(0);
    }
}

/* ===== TOAST LOGOUT ===== */
.toast-logout {
    position: fixed;
    top: 100px;
    right: 30px;
    min-width: 320px;
    max-width: 420px;
    background: var(--white);
    border-radius: var(--border-radius-xl);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 8px 25px rgba(0, 0, 0, 0.1);
    padding: 1.25rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    z-index: var(--z-toast);
    transform: translateX(150%);
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border-left: 5px solid var(--primary);
}
.toast-logout.show {
    transform: translateX(0);
    opacity: 1;
}
.toast-logout.hide {
    transform: translateX(150%);
    opacity: 0;
}
.toast-logout .toast-logout-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--border-radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 1.4rem;
    color: white;
    background: var(--primary-gradient);
}
.toast-logout .toast-logout-content {
    flex: 1;
}
.toast-logout .toast-logout-title {
    font-family: var(--font-display);
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
}
.toast-logout .toast-logout-message {
    font-size: 0.9rem;
    color: var(--gray-600);
    line-height: 1.4;
}
[data-theme="dark"] .toast-logout {
    background: var(--gray-100);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), 0 8px 25px rgba(0, 0, 0, 0.3);
}
[data-theme="dark"] .toast-logout .toast-logout-title {
    color: var(--gray-900);
}
[data-theme="dark"] .toast-logout .toast-logout-message {
    color: var(--gray-500);
}
@media (max-width: 480px) {
    .toast-logout {
        top: auto;
        bottom: 20px;
        right: 15px;
        left: 15px;
        min-width: auto;
        max-width: none;
    }
}


</style>
</head>




<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KGHT97MD" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<div class="loader-wrapper" id="loader">
    <div class="loader">
        <div class="loader-logo"></div>
        <div class="loader-text">TypixClin</div>
    </div>
</div>

<!-- Header -->
<header class="header" id="header">
    <div class="container header-container">
        <a href="index.html" class="logo">
            <span class="logo-icon"><i class="fas fa-stethoscope"></i></span>
            TypixClin
        </a>
        
        <nav class="nav">
            <ul class="nav-items">
                               <!-- Indicateur de sauvegarde -->
                <div class="save-indicator-header" id="save-indicator-header" title="Sauvegarde automatique">
                    <i class="fas fa-check"></i>
                </div>

			   <!-- OUTILS -->
                <li class="nav-dropdown">
                    <button class="nav-dropdown-trigger">
                        <i class="fas fa-toolbox"></i> Outils
                        <i class="fas fa-chevron-down dropdown-chevron"></i>
                    </button>
                    <div class="nav-dropdown-content">
                        <a href="examen-adulte.html" class="dropdown-item"><i class="fas fa-user-md"></i> Examen Adulte</a>
                        <a href="examen-pédiatrique.html" class="dropdown-item"><i class="fas fa-baby"></i> Examen Pédiatrique</a>
                        <a href="examen-réanimation.html" class="dropdown-item"><i class="fas fa-procedures"></i> Examen Réanimation</a>
                        <a href="ecg.html" class="dropdown-item"><i class="fas fa-heartbeat"></i> ECG</a>
                        <a href="gds.html" class="dropdown-item"><i class="fas fa-tint"></i> Gaz du Sang</a>
                        <a href="Troubles ioniques.html" class="dropdown-item"><i class="fas fa-flask"></i> Troubles Ioniques</a>
                    </div>
                </li>
                
                <!-- FICHES -->
                <li class="nav-dropdown">
                    <button class="nav-dropdown-trigger">
                        <i class="fas fa-clipboard"></i> Fiches
                        <i class="fas fa-chevron-down dropdown-chevron"></i>
                    </button>
                    <div class="nav-dropdown-content">
                        <a href="Fiche-examen-clinique.html" class="dropdown-item"><i class="fas fa-notes-medical"></i> Fiche Examen Clinique</a>
                        <a href="Fiche-ECG.html" class="dropdown-item"><i class="fas fa-heartbeat"></i> Fiche ECG</a>
                    </div>
                </li>
                
                <!-- RESSOURCES -->
                <li class="nav-dropdown">
                    <button class="nav-dropdown-trigger">
                        <i class="fas fa-folder-open"></i> Ressources
                        <i class="fas fa-chevron-down dropdown-chevron"></i>
                    </button>
                    <div class="nav-dropdown-content">
                        <a href="FichierGsheet.html" class="dropdown-item"><i class="fas fa-table"></i> Tableur Gsheet Externat</a>
                        <a href="TableurEnLigne.html" class="dropdown-item active"><i class="fas fa-calculator"></i> Tableur en ligne Externat</a>
                        <a href="index.html" class="dropdown-item"><i class="fas fa-book"></i> Carnet de stage</a>
                    </div>
                </li>
            </ul>
            
            <div class="header-actions">
                <button class="theme-toggle" id="theme-toggle"><i class="fas fa-sun"></i></button>
                

                
                <div class="user-auth" id="user-auth">
                    <a href="auth.html?redirect=TableurEnLigne.html" class="auth-btn" title="Se connecter"><i class="fas fa-user"></i></a>
                    <div class="user-avatar" id="user-avatar" title="Mon profil"><span id="avatar-initials">JD</span></div>
                    <div class="profile-dropdown" id="profile-dropdown">
                        <div class="profile-header">
                            <div class="profile-name" id="profile-name">Jean Dupont</div>
                            <div class="profile-email" id="profile-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5c39313d35301c392439312c3039723f3331">[email&#160;protected]</a></div>
                        </div>
                        <div class="profile-menu">
       					 <!--  <a href="comptepremium.html" class="profile-menu-item">
								<i class="fas fa-crown"></i>
								Mon abonnement
							</a>-->
							<button class="profile-menu-item logout" id="logout-btn"><i class="fas fa-sign-out-alt"></i><span>Se déconnecter</span></button>
                        </div>
                    </div>
                </div>
                
                <button class="mobile-menu-btn" id="mobile-menu-btn"><i class="fas fa-bars"></i></button>
            </div>
        </nav>
    </div>
</header>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobile-menu">
    <div class="mobile-menu-section">
        <div class="mobile-menu-title"><i class="fas fa-toolbox"></i> Outils</div>
        <a href="examen-adulte.html" class="mobile-menu-link"><i class="fas fa-user-md"></i> Examen Adulte</a>
        <a href="examen-pédiatrique.html" class="mobile-menu-link"><i class="fas fa-baby"></i> Examen Pédiatrique</a>
        <a href="examen-réanimation.html" class="mobile-menu-link"><i class="fas fa-procedures"></i> Examen Réanimation</a>
        <a href="ecg.html" class="mobile-menu-link"><i class="fas fa-heartbeat"></i> ECG</a>
        <a href="gds.html" class="mobile-menu-link"><i class="fas fa-tint"></i> Gaz du Sang</a>
        <a href="Troubles ioniques.html" class="mobile-menu-link"><i class="fas fa-flask"></i> Troubles Ioniques</a>
    </div>
    
    <div class="mobile-menu-section">
        <div class="mobile-menu-title"><i class="fas fa-clipboard"></i> Fiches</div>
        <a href="Fiche-examen-clinique.html" class="mobile-menu-link"><i class="fas fa-notes-medical"></i> Fiche Examen Clinique</a>
        <a href="Fiche-ECG.html" class="mobile-menu-link"><i class="fas fa-heartbeat"></i> Fiche ECG</a>
    </div>
    
    <div class="mobile-menu-section">
        <div class="mobile-menu-title"><i class="fas fa-folder-open"></i> Ressources</div>
        <a href="FichierGsheet.html" class="mobile-menu-link"><i class="fas fa-table"></i> Tableur Gsheet Externat</a>
        <a href="TableurEnLigne.html" class="mobile-menu-link active"><i class="fas fa-calculator"></i> Tableur en ligne Externat</a>
        <a href="carnet-de-stage.html" class="mobile-menu-link"><i class="fas fa-book"></i> Carnet de stage</a>
    </div>
</div>

<section class="page-header">
    <div class="container">
        <h1 class="page-title"><i class="fas fa-calendar-check"></i> Tableur de Révision EDN</h1>
        <p class="welcome-message" id="welcome-message"></p>
        <p class="page-subtitle">Organisez vos révisions</p>
        <a href="index.html" class="back-home-btn"><i class="fas fa-arrow-left"></i> Retour à l'accueil</a>

		
    </div>
</section>


<section class="presentation-section" id="presentation-section">
    <div class="container">
        <div class="presentation-layout">
            
            <!-- Sidebar Login (comme la checklist du planning) -->
            <aside class="presentation-sidebar" id="login-required">
                <div class="login-sidebar-card">
                    <div class="login-sidebar-header">
                        <h3 class="login-sidebar-header-title">
                            <i class="fas fa-sign-in-alt"></i> Connexion
                        </h3>
                    </div>
                    <div class="login-sidebar-body">
                        <div class="login-sidebar-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <h2 class="login-sidebar-title">Bienvenue sur le Tableur EDN !</h2>
                        <p class="login-sidebar-text">Connectez-vous pour accéder à votre espace personnel et suivre votre progression.</p>
                        <a href="auth.html?redirect=TableurEnLigne.html" class="login-sidebar-btn">
                            <i class="fas fa-sign-in-alt"></i> Connection / Inscription
                        </a>
                        <a href="#presentation-content" class="login-sidebar-scroll-hint">
                            <span>Découvrez les fonctionnalités</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                    </div>
                </div>
            </aside>
            
            <!-- Contenu principal (comme le calendrier du planning) -->
            <main class="presentation-main" id="presentation-content">
                <div class="presentation-container">
                    
                    <!-- Intro -->
                    <div class="presentation-intro">
                        <div class="presentation-intro-icon">
                            <i class="fas fa-laptop-medical"></i>
                        </div>
                        <h2 class="presentation-intro-title">Votre tableur de révision en ligne</h2>
                        <p class="presentation-intro-text">
                            Un outil complet pour planifier et suivre vos révisions de tous les items de l'externat. 
                            Visualisez votre progression, gérez vos tours de révision et organiser vos semaines.
                        </p>
                    </div>

                    <hr class="presentation-separator">

                    <!-- Fonctionnalités -->
                    <h3 class="presentation-section-title">
                        <i class="fas fa-star"></i>
                        Fonctionnalités principales
                    </h3>
                    
                    <div class="presentation-feature-grid">
                        <div class="presentation-feature-card">
                            <div class="presentation-feature-icon specialties">
                                <i class="fas fa-hospital"></i>
                            </div>
                            <h4 class="presentation-feature-title">Liste des spécialités</h4>
                            <p class="presentation-feature-description">Toutes les spécialités de l'externat ainsi que les 367 items sont répertoriés. Identifiez vos matières fortes et vos matières faibles en un clin d'oeil.</p>
                        </div>
                                        
                        <div class="presentation-feature-card">
                            <div class="presentation-feature-icon tracking">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <h4 class="presentation-feature-title">Planning</h4>
                            <p class="presentation-feature-description">Organisez vos semaines de stage et de révisions grâce au planning intégré. Gérez vos taches quotidiennes grâce à une checklist.</p>
                        </div>
                        
                        <div class="presentation-feature-card">
                            <div class="presentation-feature-icon items">
                                <i class="fas fa-list-check"></i>
                            </div>
                            <h4 class="presentation-feature-title">Liste complète des items</h4>
                            <p class="presentation-feature-description">Suivez vos tours de révision et votre progression dans l'apprentissage des items de l'externat. Visualisez quels items doivent être revu en priorité.</p>
                        </div>
 
                        <div class="presentation-feature-card">
                            <div class="presentation-feature-icon stats">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <h4 class="presentation-feature-title">Statistiques complètes</h4>
                            <p class="presentation-feature-description">Visualisez vos performances jour par jour avec des graphiques clairs. Suivez votre progression globale : items révisés, tours effectués et temps de travail cumulé.</p>
                        </div>
                        
                        <div class="presentation-feature-card">
                            <div class="presentation-feature-icon save">
                                <i class="fas fa-save"></i>
                            </div>
                            <h4 class="presentation-feature-title">Enregistrement des tours</h4>
                            <p class="presentation-feature-description">Enregistrez chaque tour avec votre niveau de confiance (1-5), le temps de travail, la date et le support utilisé.</p>
                        </div>
                        
                        <div class="presentation-feature-card">
                            <div class="presentation-feature-icon daily">
                                <i class="fa-solid fa-file-lines"></i>
                            </div>
                            <h4 class="presentation-feature-title">Fiches LISA</h4>
                            <p class="presentation-feature-description">Des liens sont disponibles pour chaque item vers la référence pour les EDN : les fiches LISA (Version imprimable)</p>
                        </div>
                    </div>

                    <hr class="presentation-separator">

                    <!-- Info highlight -->
                    <h3 class="presentation-section-title">
                        <i class="fas fa-lightbulb"></i>
                        À garder en tête
                    </h3>
                    
                    <div class="presentation-info-highlight">
                        <p><strong>Il existe autant de méthodes de travail que d'étudiants.</strong> Ce tableur reflète simplement une manière de s'organiser. Ce n'est pas une méthode miracle.</p>
                        <p>Si cela vous convient, tant mieux ! Sinon, servez-vous-en comme base. Ne vous mettez surtout pas la pression : <strong>écoutez-vous et adaptez selon vos besoins !</strong></p>
                    </div>

                    <hr class="presentation-separator">

                    <!-- Avantages -->
                    <h3 class="presentation-section-title">
                        <i class="fas fa-check-circle"></i>
                        Pourquoi utiliser ce tableur ?
                    </h3>
                    
                    <div class="presentation-benefits-grid">
                        <div class="presentation-benefit-item">
                            <div class="presentation-benefit-icon"><i class="fa-solid fa-compass"></i></div>
                            <div class="presentation-benefit-text">Vision d'ensemble sur l'externat</div>
                        </div>
                        <div class="presentation-benefit-item">
                            <div class="presentation-benefit-icon"><i class="fas fa-mobile-alt"></i></div>
                            <div class="presentation-benefit-text">Accessible sur tous vos appareils</div>
                        </div>
                        <div class="presentation-benefit-item">
                            <div class="presentation-benefit-icon"><i class="fa-solid fa-bolt"></i></div>
                            <div class="presentation-benefit-text">Facilité d'utilisation et gain de temps</div>
                        </div>
                        <div class="presentation-benefit-item">
                            <div class="presentation-benefit-icon"><i class="fas fa-euro-sign"></i></div>
                            <div class="presentation-benefit-text">100% gratuit, sans publicité</div>
                        </div>
                        <div class="presentation-benefit-item">
                            <div class="presentation-benefit-icon"><i class="fa-solid fa-binoculars"></i></div>
                            <div class="presentation-benefit-text">Meilleur moyen d'anticiper l'été pré-EDN</div>
                        </div>
                        <div class="presentation-benefit-item">
                            <div class="presentation-benefit-icon"><i class="fas fa-chart-line"></i></div>
                            <div class="presentation-benefit-text">Statistiques détaillées et graphiques</div>
                        </div>
                    </div>

                    <hr class="presentation-separator">

                    <!-- Aperçus -->
                    <h3 class="presentation-section-title">
                        <i class="fas fa-images"></i>
                        Aperçu de l'interface
                    </h3>

                    <!-- Tabs de catégories -->
                    <div class="preview-tabs">
                        <button class="preview-tab active" data-category="stats">
                            <i class="fas fa-chart-pie"></i> Statistiques
                        </button>
                        <button class="preview-tab" data-category="matieres">
                            <i class="fas fa-hospital"></i> Liste des matières
                        </button>
                        <button class="preview-tab" data-category="items">
                            <i class="fas fa-list-check"></i> Liste des items
                        </button>
                        <button class="preview-tab" data-category="planning">
                            <i class="fas fa-calendar-alt"></i> Planning
                        </button>
                    </div>

                    <!-- Carrousels -->
                    <div class="preview-carousel-container">
                        
                        <!-- Carrousel Statistiques -->
                        <div class="preview-carousel active" data-category="stats">
                          <div class="carousel-slides-wrapper">

							<button class="carousel-arrow carousel-prev"><i class="fas fa-chevron-left"></i></button>
                            <div class="carousel-slides">
                         
								<div class="carousel-slide active">
                                    <p class="carousel-caption">Performances quotidiennes et habdomadaires</p>
                                    <img src="StatsInterfaceGlobale.png" alt="Stats">
                                </div>
								<div class="carousel-slide">
                                    <p class="carousel-caption">Nombre tour fait quotidiennement, temps de travail ...</p>
                                    <img src="StatsJour.png" alt="Stats">
                                </div>
                                <!-- Slide 2 -->
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Statistiques hebdomadaires, le tout sur des graphiques.</p>
                                    <img src="StatsHebdo.png" alt="Stats">
                                </div>			
                                <!-- Slide 1 -->
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Voyez où vous en êtes sur le programme.</p>
                                    <img src="StatsGé.png" alt="Stats">
                                </div>
								
								<div class="carousel-slide">
                                    <p class="carousel-caption">Gagnez des trophées au fur et à mesure de vos années d'externat.</p>
                                    <img src="StatsTrophées.png" alt="Stats">
                                </div>
								
								
                            </div>
                            <button class="carousel-arrow carousel-next"><i class="fas fa-chevron-right"></i></button>
                            </div>
							<div class="carousel-dots"></div>
                        </div>
                        
                        <!-- Carrousel Liste des matières -->
                        <div class="preview-carousel" data-category="matieres">
                            <div class="carousel-slides-wrapper">
							<button class="carousel-arrow carousel-prev"><i class="fas fa-chevron-left"></i></button>
                            <div class="carousel-slides">
                             <div class="carousel-slide active">
                                    <p class="carousel-caption">Vision d'ensemble des spécialités de l'externat.</p>
                                    <img src="Spé4.png" alt="Liste des spécialités">
                                </div>
								
								<!-- Slide 1 -->
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Statistiques détaillées pour chaque spécialité.</p>
                                    <img src="Spé1.png" alt="Liste des spécialités">
                                </div>
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Classer les matières par caractéristique.</p>
                                    <img src="Spé2.png" alt="Liste des spécialités">
                                </div>
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Rechercher et trier les spécialités.</p>
                                    <img src="Spé3.png" alt="Liste des spécialités">
                                </div>
                            </div>
                            <button class="carousel-arrow carousel-next"><i class="fas fa-chevron-right"></i></button>
                            </div>
							<div class="carousel-dots"></div>
                        </div>
                        
                        <!-- Carrousel Liste des items -->
                        <div class="preview-carousel" data-category="items">
                            <div class="carousel-slides-wrapper">
							<button class="carousel-arrow carousel-prev"><i class="fas fa-chevron-left"></i></button>
                            <div class="carousel-slides">
                                <!-- Slide 1 -->
                                 <div class="carousel-slide active">
                                    <p class="carousel-caption">Vision d'ensemble des items de l'externat.</p>
                                    <img src="ItemsInterfaceGlobale.png" alt="Items">
                                </div>
								
								<div class="carousel-slide">
                                    <p class="carousel-caption">Accès aux items classés par matière en cliquant sur une spécialité.</p>
                                    <img src="ItemsIntro.png" alt="Items">
                                </div>
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Entrer vos tours de révision : ressenti sur l'apprentissage, temps de travail et support de cours.</p>
                                    <img src="ItemsValiderTour.png" alt="Valider un tour">
                                </div>
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Visualiser votre progression tour après tour.</p>
                                    <img src="ItemsTours.png" alt="Progression des tours">
                                </div>
								
								  <div class="carousel-slide">
                                    <p class="carousel-caption">Indiquez les ressources que vous avez faites. Priorisez les items que vous n'avez pas vu depuis longtemps.</p>
                                    <img src="ItemsTours2.png" alt="Progression des tours">
                                </div>
								  <div class="carousel-slide">
                                    <p class="carousel-caption">Personalisez la colonne avec les ressources que vous utilisez.</p>
                                    <img src="ItemsRessources.png" alt="Progression des tours">
                                </div>
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Liens cliquable vers la fiche LISA de l'item. Visualisez les collèges de référence pour chaque item.</p>
                                    <img src="ItemsLisa.png" alt="Lisa référence">
                                </div>
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Visualisez les items qu'il est bon de lire dans les petits collèges. Envoyez des items à faire sur la To-do List en un clic.</p>
                                    <img src="ItemsBalises.png" alt="Balises">
                                </div>

                            </div>
							<button class="carousel-arrow carousel-next"><i class="fas fa-chevron-right"></i></button>
							</div>
                            <div class="carousel-dots"></div>
                        </div>
						
					 <div class="preview-carousel " data-category="planning">
                          <div class="carousel-slides-wrapper">

							<button class="carousel-arrow carousel-prev"><i class="fas fa-chevron-left"></i></button>
                            <div class="carousel-slides">
                        
								<div class="carousel-slide active">
                                    <p class="carousel-caption">Organisez vos semaines de stage/révision.</p>
                                    <img src="PlanningInterfaceGlobale.png" alt="Planning mensuel">
                                </div>
								
								<div class="carousel-slide">
                                    <p class="carousel-caption">Naviguez de mois en mois.</p>
                                    <img src="PlanningNavigation.png" alt="Planning mensuel">
                                </div>
                                <!-- Slide 2 -->
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Visualisez facilement l'organisation des semaines à venir.</p>
                                    <img src="PlanningIntituléCase.png" alt="Planning mensuel">
                                </div>			
                                <!-- Slide 1 -->
                                <div class="carousel-slide">
                                    <p class="carousel-caption">Indiquez une ou plusieurs matières à travailler jour après jour.</p>
                                    <img src="PlanningCaseSpé.png" alt="Planning mensuel">
                                </div>
								<div class="carousel-slide">
                                    <p class="carousel-caption">Planifiez les évennements à venir.</p>
                                    <img src="PlanningTexte.png" alt="Planning mensuel">
                                </div>
								<div class="carousel-slide">
                                    <p class="carousel-caption">Listez les choses à faire et visualisez les items à travailler.</p>
                                    <img src="PlanningToDoList.png" alt="Planning mensuel">
                                </div>
								<div class="carousel-slide">
                                    <p class="carousel-caption">Validez vos tâches et entrer vos tours directement depuis la To-Do List.</p>
                                    <img src="PlanningToDoListValidation.png" alt="Planning mensuel">
                                </div>
								
                            </div>
                            <button class="carousel-arrow carousel-next"><i class="fas fa-chevron-right"></i></button>
                            </div>
							<div class="carousel-dots"></div>
                        </div>
						
                        
                    </div>

                    <hr class="presentation-separator">

                    <!-- Infos pratiques -->
                    <h3 class="presentation-section-title">
                        <i class="fas fa-info-circle"></i>
                        Informations pratiques
                    </h3>
                    
                    <ul class="presentation-tips-list">
                        <li>Créez un compte gratuit pour sauvegarder automatiquement vos données.</li>
                        <li>Vos données sont synchronisées en temps réel sur tous vos appareils.</li>
                        <li>N'hésitez pas à contacter l'administrateur (Jean ZENNARO) si vous rencontrez un problème.</li>
                        <li>N'hésitez pas à envoyer un feedback si vous avez des suggestions d'amélioration.</li>
                    </ul>

                    <!-- CTA -->
                    <div class="presentation-cta">
                        <a href="auth.html?redirect=TableurEnLigne.html" class="presentation-cta-btn">
                            <i class="fas fa-rocket"></i>
                            Commencer gratuitement
                        </a>
                        <p class="presentation-cta-text">Créez votre compte en quelques secondes</p>
                    </div>

                </div>
            </main>
            
        </div>
    </div>
</section>


<section class="main-content" id="main-content">
    <div class="container">
<nav class="app-nav">
    <button class="app-nav-btn" data-page="stats"><i class="fas fa-chart-pie"></i><span>Statistiques</span></button>
    <button class="app-nav-btn active" data-page="dashboard"><i class="fas fa-hospital"></i><span>Liste des spécialités</span></button>
    <button class="app-nav-btn" data-page="items"><i class="fas fa-list-check"></i><span>Liste des Items</span></button>
	    <button class="app-nav-btn" data-page="planning"><i class="fas fa-calendar-alt"></i><span>Planning</span></button>

</nav>

<div class="app-page" id="page-stats">
    
    <!-- Titre Section Quotidienne -->
    <div class="stats-section-title daily">
        <i class="fas fa-calendar-day"></i> Statistiques du Jour
		<span class="help-icon" onclick="openHelpModal('stats-daily')">?</span>

    </div>
    
    <div class="daily-stats-grid">
        <div class="daily-stat-card items-today">
            <div class="daily-stat-header">
                <div class="daily-stat-icon"><i class="fas fa-redo-alt"></i></div>
                <div class="daily-stat-label">Tours effectués aujourd'hui</div>
            </div>
            <div class="daily-stat-value" id="stat-items-today">0</div>
        </div>
        
        <div class="daily-stat-card delay-caught">
            <div class="daily-stat-header">
                <div class="daily-stat-icon"><i class="fas fa-forward"></i></div>
                <div class="daily-stat-label">Retard rattrapé</div>
            </div>
            <div class="daily-stat-value" id="stat-delay-caught">0<span class="daily-stat-unit">jours</span></div>
        </div>
        
        <div class="daily-stat-card time-today">
            <div class="daily-stat-header">
                <div class="daily-stat-icon"><i class="fas fa-hourglass-half"></i></div>
                <div class="daily-stat-label">Temps de travail ce jour</div>
            </div>
            <div class="daily-stat-value" id="stat-time-today">0h00</div>
        </div>
        
        <div class="daily-stat-card feeling-today">
            <div class="daily-stat-header">
                <div class="daily-stat-icon"><i class="fas fa-smile"></i></div>
                <div class="daily-stat-label">Ressenti moyen du jour</div>
            </div>
            <div class="daily-stat-value" id="stat-feeling-today">--</div>
            <div class="feeling-indicator" id="feeling-indicator">
                <span class="feeling-dot" data-level="1"></span>
                <span class="feeling-dot" data-level="2"></span>
                <span class="feeling-dot" data-level="3"></span>
                <span class="feeling-dot" data-level="4"></span>
                <span class="feeling-dot" data-level="5"></span>
            </div>
        </div>
    </div>
	
	<!-- Titre Section Hebdomadaire -->
<div class="stats-section-title weekly">
    <i class="fas fa-calendar-week"></i> Statistiques des 7 derniers jours
	<span class="help-icon" onclick="openHelpModal('stats-weekly')">?</span>

</div>

<div class="weekly-stats-grid">
    <div class="weekly-chart-card tours-weekly">
        <div class="weekly-chart-header">
            <div class="weekly-chart-icon"><i class="fas fa-redo-alt"></i></div>
            <div class="weekly-chart-title">Tours effectués</div>
        </div>
        <div class="weekly-chart-container">
            <canvas id="chart-tours-weekly"></canvas>
        </div>
        <div class="weekly-chart-summary">
            <span class="summary-label">Total semaine :</span>
            <span class="summary-value" id="weekly-tours-total">0</span>
        </div>
    </div>
    
    <div class="weekly-chart-card time-weekly">
        <div class="weekly-chart-header">
            <div class="weekly-chart-icon"><i class="fas fa-hourglass-half"></i></div>
            <div class="weekly-chart-title">Temps de travail</div>
        </div>
        <div class="weekly-chart-container">
            <canvas id="chart-time-weekly"></canvas>
        </div>
        <div class="weekly-chart-summary">
            <span class="summary-label">Total semaine :</span>
            <span class="summary-value" id="weekly-time-total">0h00</span>
        </div>
    </div>
    
    <div class="weekly-chart-card feeling-weekly">
        <div class="weekly-chart-header">
            <div class="weekly-chart-icon"><i class="fas fa-smile"></i></div>
            <div class="weekly-chart-title">Ressenti moyen</div>
        </div>
        <div class="weekly-chart-container">
            <canvas id="chart-feeling-weekly"></canvas>
        </div>
        <div class="weekly-chart-summary">
            <span class="summary-label">Moyenne semaine :</span>
            <span class="summary-value" id="weekly-feeling-avg">--</span>
        </div>
    </div>
</div>

    <!-- Titre Section Générale -->
    <div class="stats-section-title general">
        <i class="fas fa-chart-pie"></i> Statistiques Générales
		                <span class="help-icon" onclick="openHelpModal('stats-general')">?</span>

    </div>
    
    <div class="stats-grid">
		<div class="stat-card blue" style="position: relative;">
			<div class="stat-percent-badge" id="stat-items-percent">0%</div>
			<div class="stat-icon blue"><i class="fas fa-book-open"></i></div>
            <div class="stat-value" id="stat-items-done">0</div>
            <div class="stat-label">Items des collèges révisés (≥1 tour)</div>
            <div class="stat-progress"><div class="progress-bar"><div class="progress-fill blue" id="progress-items" style="width: 0%"></div></div></div>
        </div>
				<div class="stat-card orange" style="position: relative;">
			<div class="stat-percent-badge orange-badge" id="stat-ref-percent">0%</div>
			<div class="stat-icon orange"><i class="fas fa-star"></i></div>
			<div class="stat-value" id="stat-ref-done">0</div>
			<div class="stat-label">Items de référence révisés (≥1 tour)</div>
			<div class="stat-progress"><div class="progress-bar"><div class="progress-fill orange" id="progress-ref" style="width: 0%"></div></div></div>
		</div>
        <div class="stat-card green">
            <div class="stat-icon green"><i class="fas fa-check-double"></i></div>
            <div class="stat-value" id="stat-tours-done">0</div>
            <div class="stat-label">Tours effectués</div>
			<div class="stat-sublabel">Cumulé sur tous les items</div>

        </div>

        <div class="stat-card purple">
            <div class="stat-icon purple"><i class="fas fa-clock"></i></div>
            <div class="stat-value" id="stat-total-time">0h00</div>
            <div class="stat-label">Temps de travail total</div>
            <div class="stat-sublabel">Cumulé sur tous les tours</div>
        </div>
    </div>
	
	<!-- Section Trophées -->
<div class="trophies-section">
    <div class="trophies-card">
		<div class="trophies-header">
			<div class="trophies-title-group">
				<h3 class="trophies-title">
					<i class="fas fa-trophy"></i> Trophées
					<span class="help-icon" onclick="openHelpModal('stats-trophies')">?</span>
				</h3>
			</div>
			<span class="trophies-progress-text">
				<span id="trophies-unlocked-count">0</span> / <span id="trophies-total-count">12</span> débloqués
			</span>
		</div>
        <div class="trophies-body">
            
            <!-- Catégorie: Avancement -->
            <div class="trophies-category">
                <div class="trophies-category-title"><i class="fas fa-chart-line"></i> Complétion du programme</div>
                <div class="trophies-grid" id="trophies-progress">
                </div>
            </div>
            
            <!-- Catégorie: Stats Quotidiennes -->
            <div class="trophies-category">
                <div class="trophies-category-title"><i class="fas fa-calendar-day"></i> Trophées quotidiens</div>
                <div class="trophies-grid" id="trophies-daily">
                </div>
            </div>
            
            <!-- Catégorie: Stats Hebdomadaires -->
            <div class="trophies-category">
                <div class="trophies-category-title"><i class="fas fa-calendar-week"></i> Trophées hebdomadaires</div>
                <div class="trophies-grid" id="trophies-weekly">
                </div>
            </div>
            
            <!-- Catégorie: Stats Générales -->
            <div class="trophies-category">
                <div class="trophies-category-title"><i class="fas fa-star"></i> Accomplissements</div>
                <div class="trophies-grid" id="trophies-general">
                </div>
            </div>
            
        </div>
    </div>
</div>

<!-- Notification Trophée -->
<div class="trophy-notification" id="trophy-notification">
    <div class="trophy-notification-icon"><i class="fas fa-trophy"></i></div>
    <div class="trophy-notification-content">
        <span class="trophy-notification-title">Trophée débloqué !</span>
        <span class="trophy-notification-name" id="trophy-notification-name"></span>
    </div>
</div>



</div>


<!-- Page Planning -->
<div class="app-page" id="page-planning">
    <div class="planning-container">
        
        <!-- Sidebar Checklist -->
        <aside class="planning-sidebar">
            <div class="checklist-card">
				<div class="checklist-header">
					<h3 class="checklist-title">
						<i class="fas fa-tasks"></i> To-Do List
						<span class="help-icon" onclick="openHelpModal('planning-checklist')">?</span>
					</h3>
					<span class="checklist-count" id="checklist-count">0/0</span>
				</div>
                <div class="checklist-body">
                    <div class="checklist-input-wrapper" style="position: relative;">
						<div class="checklist-error-notification" id="checklist-error">
							<i class="fas fa-exclamation-circle"></i> Vous devez d'abord écrire une tâche
						</div>
                        <input type="text" class="checklist-input" id="checklist-new-item" placeholder="Ajouter une tâche...">
                        <button class="checklist-add-btn" id="checklist-add-btn"><i class="fas fa-plus"></i></button>
                    </div>
                    <div class="checklist-items" id="checklist-items"></div>
                </div>
            </div>
        </aside>
        
        <!-- Zone principale -->
        <main class="planning-main">
            
            <!-- Header -->
            <div class="planning-header-card">
                <div class="planning-header-row">
						<div class="planning-month-display">
							<h2 class="planning-month-title">
								<i class="fas fa-calendar-alt"></i>
								<span id="current-month-name">Janvier</span>
							</h2>
							<span class="planning-year-badge" id="current-year">2025</span>
							<span class="help-icon" onclick="openHelpModal('planning-calendar')">?</span>
						</div>
                    
                    <div class="planning-nav-controls">
                        <button class="planning-nav-btn" id="planning-prev-month" title="Mois précédent">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="planning-today-btn" id="planning-today">
                            <i class="fas fa-calendar-day"></i> Aujourd'hui
                        </button>
                        <button class="planning-nav-btn" id="planning-next-month" title="Mois suivant">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
						  <div class="planning-date-selector">
							<!-- Dropdown Mois -->
							<div class="custom-dropdown month-dropdown" id="month-dropdown">
								<button class="custom-dropdown-btn" id="month-dropdown-btn">
									<span class="custom-dropdown-icon"><i class="fas fa-calendar"></i></span>
									<span class="custom-dropdown-text" id="month-dropdown-text">Janvier</span>
									<i class="fas fa-chevron-down"></i>
								</button>
								<div class="custom-dropdown-menu" id="month-dropdown-menu">
									<div class="custom-dropdown-header">
										<i class="fas fa-calendar-alt"></i> Mois
									</div>
									<div class="custom-dropdown-option" data-value="0">Janvier</div>
									<div class="custom-dropdown-option" data-value="1">Février</div>
									<div class="custom-dropdown-option" data-value="2">Mars</div>
									<div class="custom-dropdown-option" data-value="3">Avril</div>
									<div class="custom-dropdown-option" data-value="4">Mai</div>
									<div class="custom-dropdown-option" data-value="5">Juin</div>
									<div class="custom-dropdown-option" data-value="6">Juillet</div>
									<div class="custom-dropdown-option" data-value="7">Août</div>
									<div class="custom-dropdown-option" data-value="8">Septembre</div>
									<div class="custom-dropdown-option" data-value="9">Octobre</div>
									<div class="custom-dropdown-option" data-value="10">Novembre</div>
									<div class="custom-dropdown-option" data-value="11">Décembre</div>
								</div>
							</div>
							
							<!-- Dropdown Année -->
							<div class="custom-dropdown year-dropdown" id="year-dropdown">
								<button class="custom-dropdown-btn" id="year-dropdown-btn">
									<span class="custom-dropdown-text" id="year-dropdown-text">2025</span>
									<i class="fas fa-chevron-down"></i>
								</button>
								<div class="custom-dropdown-menu" id="year-dropdown-menu">
									<div class="custom-dropdown-header">
										<i class="fas fa-calendar-check"></i> Année
									</div>
									<!-- Options générées par JS -->
								</div>
							</div>
						</div>
                </div>
                			
				
				<!-- Légende spécialités -->
				<div class="planning-legend specialty-legend">
					<div class="legend-items specialty-badges-legend" id="specialty-legend-items">
					</div>
				</div>
				
            </div>
            
					<!-- Hint scroll mobile -->
					<div class="calendar-scroll-hint">
						<i class="fas fa-hand-pointer"></i>
						<span>Glissez horizontalement pour voir tout le calendrier</span>
						<i class="fas fa-arrows-left-right"></i>
					</div>

					<!-- Wrapper scroll pour mobile -->
					<div class="calendar-scroll-wrapper">
						<div class="calendar-container">
							<div class="calendar-weekdays">
								<div class="weekday-header">Lun</div>
								<div class="weekday-header">Mar</div>
								<div class="weekday-header">Mer</div>
								<div class="weekday-header">Jeu</div>
								<div class="weekday-header">Ven</div>
								<div class="weekday-header weekend">Sam</div>
								<div class="weekday-header weekend">Dim</div>
							</div>
							<div class="calendar-grid" id="calendar-grid"></div>
						</div>
					</div>
            
        </main>
    </div>
</div>

<!-- Mini Popup Statut -->
<div class="mini-popup mini-popup-status" id="status-popup">
    <div class="mini-popup-title">Type de journée</div>
    <div class="status-grid">
        <button class="status-mini-btn none" data-status="">
            <div class="status-mini-icon">⚪</div>
            <div class="status-mini-label">Aucun</div>
        </button>
        <button class="status-mini-btn stage" data-status="stage">
            <div class="status-mini-icon">🏥</div>
            <div class="status-mini-label">Stage</div>
        </button>
        <button class="status-mini-btn revision" data-status="revision">
            <div class="status-mini-icon">📚</div>
            <div class="status-mini-label">Révision</div>
        </button>
        <button class="status-mini-btn garde" data-status="garde">
            <div class="status-mini-icon">🚨</div>
            <div class="status-mini-label">Garde</div>
        </button>
        <button class="status-mini-btn repos" data-status="repos">
            <div class="status-mini-icon">😴</div>
            <div class="status-mini-label">Repos</div>
        </button>
        <button class="status-mini-btn autre" data-status="autre">
            <div class="status-mini-icon">📝</div>
            <div class="status-mini-label">Autre</div>
        </button>
    </div>
    <div class="status-week-fill" id="status-week-fill-container" style="display: none;">
        <label class="status-week-checkbox">
            <input type="checkbox" id="status-week-fill-checkbox">
            <span>Remplir toute la semaine</span>
        </label>
    </div>
</div>

<!-- Mini Popup Spécialité - Amélioré -->
<div class="mini-popup mini-popup-specialty" id="specialty-popup">
    <div class="specialty-popup-header">
        <div class="specialty-popup-top">
            <div class="mini-popup-title">Spécialités</div>
            <div class="specialty-popup-actions">
                <button class="specialty-clear-btn" id="specialty-clear">
                    <i class="fas fa-trash-alt"></i> Effacer
                </button>
                <button class="specialty-confirm-btn" id="specialty-confirm">
                    <i class="fas fa-check"></i> OK
                </button>
            </div>
        </div>
    </div>
    <div class="specialty-grid-scroll">
        <div class="specialty-grid" id="specialty-grid"></div>
    </div>
    <div class="specialty-week-fill" id="specialty-week-fill-container" style="display: none;">
        <label class="specialty-week-checkbox">
            <input type="checkbox" id="specialty-week-fill-checkbox">
            <span>Remplir toute la semaine</span>
        </label>
    </div>
</div>




<div class="app-page active" id="page-dashboard">

<div class="filter-bar">
    <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="search-specialty" placeholder="Rechercher une spécialité...">
    </div>

    <div class="custom-select" id="sort-specialty-dropdown">
        <button class="custom-select-btn" type="button">
            <span class="custom-select-icon"><i class="fas fa-sort"></i></span>
            <span class="custom-select-text">Classer par...</span>
            <i class="fas fa-chevron-down custom-select-arrow"></i>
        </button>
        <div class="custom-select-menu">
            <div class="custom-select-option selected" data-value="default">
                <span class="option-icon"><i class="fas fa-list"></i></span>
                <span>Ordre par défaut</span>
            </div>
            <div class="custom-select-option" data-value="feeling-asc">
                <span class="option-icon" style="color: #ec4899;"><i class="fas fa-heart"></i></span>
                <span>Ressenti (↑ croissant)</span>
            </div>
            <div class="custom-select-option" data-value="feeling-desc">
                <span class="option-icon" style="color: #ec4899;"><i class="fas fa-heart"></i></span>
                <span>Ressenti (↓ décroissant)</span>
            </div>
            <div class="custom-select-option" data-value="time-desc">
                <span class="option-icon" style="color: #f59e0b;"><i class="fas fa-clock"></i></span>
                <span>Temps (↓ décroissant)</span>
            </div>
            <div class="custom-select-option" data-value="time-asc">
                <span class="option-icon" style="color: #f59e0b;"><i class="fas fa-clock"></i></span>
                <span>Temps (↑ croissant)</span>
            </div>
            <div class="custom-select-option" data-value="progress-desc">
                <span class="option-icon" style="color: #10b981;"><i class="fas fa-percentage"></i></span>
                <span>Complétion (↓ décroissant)</span>
            </div>
            <div class="custom-select-option" data-value="progress-asc">
                <span class="option-icon" style="color: #10b981;"><i class="fas fa-percentage"></i></span>
                <span>Complétion (↑ croissant)</span>
            </div>
        </div>
        <input type="hidden" id="sort-specialty" value="default">
    </div>

    <div class="custom-select" id="filter-specialty-dropdown">
        <button class="custom-select-btn" type="button">
            <span class="custom-select-icon"><i class="fas fa-filter"></i></span>
            <span class="custom-select-text">Tous les statuts</span>
            <i class="fas fa-chevron-down custom-select-arrow"></i>
        </button>
        <div class="custom-select-menu">
            <div class="custom-select-option selected" data-value="all">
                <span class="option-icon"><i class="fas fa-list"></i></span>
                <span>Tous les statuts</span>
            </div>
            <div class="custom-select-option" data-value="not-started">
                <span class="option-icon" style="color: #6b7280;"><i class="fas fa-circle"></i></span>
                <span>Non commencées</span>
            </div>
            <div class="custom-select-option" data-value="in-progress">
                <span class="option-icon" style="color: #f59e0b;"><i class="fas fa-spinner"></i></span>
                <span>En cours</span>
            </div>
            <div class="custom-select-option" data-value="completed">
                <span class="option-icon" style="color: #10b981;"><i class="fas fa-check-circle"></i></span>
                <span>Terminées</span>
            </div>
        </div>
        <input type="hidden" id="filter-specialty-status" value="all">
    </div>
</div>


	<div class="section-card">
		<div class="section-header">
			<h2 class="section-title">
				<i class="fas fa-chart-line"></i> Liste des spécialités
				<span class="help-icon" onclick="openHelpModal('dashboard-specialties')">?</span>
			</h2>
			<div class="quick-actions">
				<button class="quick-action-btn" id="btn-reset-filters-specialty">
					<i class="fas fa-filter-circle-xmark"></i> Réinitialiser
				</button>
			</div>
		</div>
		<div class="section-body">
			<div class="specialties-grid" id="dashboard-specialties"></div>
		</div>
	</div>
	
	   
	
</div>

        <div class="app-page" id="page-items">
				<div class="filter-bar">
					<div class="search-box"><i class="fas fa-search"></i><input type="text" id="search-item" placeholder="Rechercher un item..."></div>
						<div class="custom-select" id="reference-dropdown">
							<button class="custom-select-btn" type="button">
								<span class="custom-select-icon"><i class="fas fa-list"></i></span>
								<span class="custom-select-text">Tous les items</span>
								<i class="fas fa-chevron-down custom-select-arrow"></i>
							</button>
							<div class="custom-select-menu">
								<div class="custom-select-option selected" data-value="all">
									<span class="option-icon"><i class="fas fa-list"></i></span>
									<span>Tous les items</span>
								</div>
								<div class="custom-select-option" data-value="reference-only">
									<span class="option-icon" style="color: #f59e0b;"><i class="fas fa-star"></i></span>
									<span>Collèges de références</span>
								</div>
								<div class="custom-select-option" data-value="badge-only">
									<span class="option-icon" style="color: #8b5cf6;"><i class="fas fa-tag"></i></span>
									<span>Collèges associés</span>
								</div>
							</div>
							<input type="hidden" id="filter-item-reference" value="all">
						</div>

<div class="specialty-multi-select" id="specialty-dropdown">
    <button class="specialty-multi-btn" type="button" id="specialty-multi-btn">
        <span class="specialty-multi-icon"><i class="fas fa-list"></i></span>
        <div class="specialty-multi-content">
            <span class="specialty-multi-placeholder">Toutes les spécialités</span>
        </div>
        <i class="fas fa-chevron-down specialty-multi-arrow"></i>
    </button>
    <div class="specialty-multi-menu" id="specialty-menu">
				<div class="specialty-multi-header">
					<div class="specialty-multi-counter">
						<span></span>
						<span class="specialty-counter-badge" id="specialty-counter">0</span>
						<span>/ 4</span>
					</div>
					<div class="specialty-multi-header-buttons">
						<button class="specialty-multi-clear" id="specialty-clear-btn">
							<i class="fas fa-times"></i> Effacer
						</button>
						<button class="specialty-multi-close" id="specialty-close-btn">
							<i class="fas fa-check"></i> OK
						</button>
					</div>
				</div>
        <div class="specialty-multi-search">
            <input type="text" placeholder="Rechercher une spécialité..." id="specialty-search-input">
        </div>
        <div class="specialty-multi-list" id="specialty-multi-list"></div>
    </div>
    <input type="hidden" id="filter-item-specialty" value="all">
</div>

					<div class="custom-select" id="status-dropdown">
						<button class="custom-select-btn" type="button">
							<span class="custom-select-icon"><i class="fas fa-tasks"></i></span>
							<span class="custom-select-text">Tous les statuts</span>
							<i class="fas fa-chevron-down custom-select-arrow"></i>
						</button>
						<div class="custom-select-menu">
							<div class="custom-select-option selected" data-value="all">
								<span class="option-icon"><i class="fas fa-tasks"></i></span>
								<span>Tous les statuts</span>
							</div>
							<div class="custom-select-option" data-value="not-started">
								<span class="option-icon"><i class="fas fa-circle"></i></span>
								<span>Non commencés</span>
							</div>
							<div class="custom-select-option" data-value="in-progress">
								<span class="option-icon"><i class="fas fa-spinner"></i></span>
								<span>En cours</span>
							</div>
						</div>
						<input type="hidden" id="filter-item-status" value="all">
					</div>
					
					<button class="config-resources-btn" onclick="openResourcesConfigModal()">
						<i class="fas fa-cog"></i> Configurer ressources
					</button>

				</div>

            <div class="section-card">
						<div class="section-header">
							<h2 class="section-title">
								<i class="fas fa-list-check"></i> Liste des Items
								<span class="help-icon" onclick="openHelpModal('items-list')">?</span>
							</h2>
							
							<div class="header-pagination">
								<button class="pagination-btn" id="pagination-prev-top" title="Page précédente">
									<i class="fas fa-chevron-left"></i>
								</button>
								<div class="pagination-info">
									<span class="pagination-current" id="pagination-current-top">1 / 8</span>
									<span class="pagination-total" id="pagination-total-top">760 items</span>
								</div>
								<button class="pagination-btn" id="pagination-next-top" title="Page suivante">
									<i class="fas fa-chevron-right"></i>
								</button>
							</div>
							
							<div class="quick-actions" style="position: relative;">
								<!-- Bouton Légende -->
								<button class="legend-button" onclick="toggleLegendModal(event)">
									<i class="fas fa-info-circle"></i>
									<span>Légende</span>
								</button>
								
								<!-- Modal Légende -->
								<div class="legend-modal" id="legendModal">
									<div class="legend-modal-header">
										<div class="legend-modal-title">
											<i class="fas fa-info-circle"></i>
											Supports disponibles
										</div>
										<button class="legend-close" onclick="closeLegendModal()">
											<i class="fas fa-times"></i>
										</button>
									</div>
											<div class="legend-items">
												<div class="legend-item">
													<span class="legend-badge" style="background: #3b82f6; color: white;">QCM</span>
													<span class="legend-description">QCM/DP disponibles</span>
												</div>
												<div class="legend-item">
													<span class="legend-badge" style="background: #8b5cf6; color: white;">COL</span>
													<span class="legend-description">Collèges</span>
												</div>
												<div class="legend-item">
													<span class="legend-badge" style="background: #ef4444; color: white;">ANK</span>
													<span class="legend-description">Anki</span>
												</div>
												<div class="legend-item">
													<span class="legend-badge" style="background: #f59e0b; color: white;">PER</span>
													<span class="legend-description">Fiche perso</span>
												</div>
												<div class="legend-item">
													<span class="legend-badge" style="background: #10b981; color: white;">COD</span>
													<span class="legend-description">EDNi/Codex</span>
												</div>
												<div class="legend-item">
													<span class="legend-badge" style="background: #ec4899; color: white;">CNF</span>
													<span class="legend-description">Conférence</span>
												</div>
											</div>
								</div>
								
								<!-- Bouton Chronomètre -->
								<button class="timer-button" id="timerButton" onclick="toggleTimerModal(event)">
									<i class="fas fa-clock" id="timerIcon"></i>
									<span>Chronomètre</span>
								</button>
								
								<!-- Modal Chronomètre -->
								<div class="timer-modal" id="timerModal">
									<button class="timer-close" onclick="closeTimerModal()">
										<i class="fas fa-times"></i>
									</button>
									<div class="timer-display">
										<div class="timer-time" id="timerDisplay">00:00</div>
									</div>
									<div class="timer-controls" id="timerControls">
										<!-- Les boutons seront générés dynamiquement -->
									</div>
								</div>
								
								<!-- Bouton Réinitialiser -->
								<button class="quick-action-btn" id="btn-reset-filters">
									<i class="fas fa-filter-circle-xmark"></i> Réinitialiser
								</button>
							</div>
						</div>

    <div class="section-body">
        <!-- Hint scroll mobile pour items -->
        <div class="items-scroll-hint">
            <i class="fas fa-hand-pointer"></i>
            <span>Glissez horizontalement pour voir tout le tableau</span>
            <i class="fas fa-arrows-left-right"></i>
        </div>
        
        <div class="items-container">
            <table class="items-table">
                <thead>
                    <tr>
                        <th data-sort="num">
                            N° <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th data-sort="name">Nom <i class="fas fa-sort sort-icon"></i></th>
                        <th data-sort="specialty">Spécialité <i class="fas fa-sort sort-icon"></i></th>
                        <th>Tours (T1-T8)

						</th>
                        <th>Ressources faites</th>
                        <th data-sort="days">Dernière révision <i class="fas fa-sort sort-icon"></i></th>
                    </tr>
                </thead>
                <tbody id="items-table-body"></tbody>
            </table>
        </div>
        
        <div class="empty-state" id="items-empty" style="display: none;">
            <i class="fas fa-search"></i>
            <p>Aucun item ne correspond</p>
        </div>
        
        <!-- Pagination Bas -->
        <div class="items-pagination" id="items-pagination-bottom">
            <button class="pagination-btn" id="pagination-first-bottom" title="Première page">
                <i class="fas fa-angles-left"></i>
            </button>
            <button class="pagination-btn" id="pagination-prev-bottom" title="Page précédente">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <div class="pagination-info">
                <span class="pagination-current" id="pagination-current-bottom">1 / 8</span>
                <span class="pagination-total" id="pagination-total-bottom">760 items</span>
            </div>
            
            <button class="pagination-btn" id="pagination-next-bottom" title="Page suivante">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="pagination-btn" id="pagination-last-bottom" title="Dernière page">
                <i class="fas fa-angles-right"></i>
            </button>
            
            <div class="custom-dropdown pagination-dropdown" id="pagination-dropdown">
                <button class="custom-dropdown-btn" id="pagination-dropdown-btn">
                    <span class="custom-dropdown-icon"><i class="fas fa-layer-group"></i></span>
                    <span class="custom-dropdown-text" id="pagination-dropdown-text">50 / page</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="custom-dropdown-menu" id="pagination-dropdown-menu">
                    <div class="custom-dropdown-header">
                        <i class="fas fa-list-ol"></i> Items par page
                    </div>
                    <div class="custom-dropdown-option" data-value="30">30 / page</div>
                    <div class="custom-dropdown-option selected" data-value="50">50 / page</div>
                    <div class="custom-dropdown-option" data-value="100">100 / page</div>
                </div>
            </div>
        </div>

    </div>
</div>


<style>
/* Bouton aide dans les en-têtes de tableau */
.help-icon-table {
    margin-left: 6px;
    width: 18px;
    height: 18px;
    font-size: 11px;
    vertical-align: middle;
}

/* Ajustement du <th> pour aligner correctement */
.items-table th {
    position: relative;
    white-space: nowrap;
}
</style>
			
											<!-- Modal Configuration Ressources -->
								<div class="modal resources-config-modal" id="resources-config-modal">
									<div class="modal-content">
										<button class="modal-close" onclick="closeResourcesConfigModal()"><i class="fas fa-times"></i></button>
										<h3 class="resources-config-title"><i class="fas fa-cog"></i> Configurer les ressources</h3>
										<p class="resources-config-subtitle">Sélectionnez jusqu'à 4 ressources à afficher pour chaque item, vous pourrez ensuite les valider en fonction de votre avancée.</p>
										
										<div class="resources-selected-count">
											<span id="resources-count">0</span> / 4 ressources sélectionnées
										</div>
										
										<div class="resources-available-list" id="resources-available-list">
											<!-- Généré par JavaScript -->
										</div>
										
										<div class="resources-config-actions">
											<button class="resources-cancel-btn" onclick="closeResourcesConfigModal()">Annuler</button>
											<button class="resources-save-btn" onclick="saveResourcesConfig()">Enregistrer</button>
										</div>
									</div>
								</div>


        </div>
    </div>
</section>

<div class="modal" id="confidence-modal">
    <div class="modal-content">
        <button class="modal-close" id="confidence-close"><i class="fas fa-xmark"></i></button>
        <h3 class="modal-title">Enregistrer le tour</h3>
        
<div class="modal-section">
    <label class="modal-label">Confiance</label>
    <div class="confidence-buttons">
        <button class="confidence-btn c1" data-confidence="1">1</button>
        <button class="confidence-btn c2" data-confidence="2">2</button>
        <button class="confidence-btn c3" data-confidence="3">3</button>
        <button class="confidence-btn c4" data-confidence="4">4</button>
        <button class="confidence-btn c5" data-confidence="5">5</button>
    </div>
    <div class="confidence-error" id="confidence-error">Veuillez sélectionner un niveau de confiance</div>
</div>
        
        <div class="modal-section">
            <label class="modal-label">Date</label>
			<input type="date" id="tour-date" class="modal-input" max="">
			<div class="confidence-error" id="date-error">Erreur de date</div>

			
        </div>
        
        <div class="modal-section">
            <label class="modal-label">Durée</label>
            <div class="duration-input-wrapper">
                <input type="number" id="tour-duration-hours" class="duration-input" min="0" max="10" placeholder="0">
                <span class="duration-separator">h</span>
                <input type="number" id="tour-duration-minutes" class="duration-input" min="0" max="59" step="5" placeholder="00">
                <span class="duration-separator">min</span>

            </div>
							<div class="confidence-error" id="duration-error">La durée ne peut pas dépasser 10 heures</div>

        </div>
        
        <div class="modal-section">
            <label class="modal-label">Support</label>
            <div class="support-buttons">
                <button class="support-btn" data-support="qcm"><i class="fas fa-list-check"></i> QCM/DP</button>
                <button class="support-btn" data-support="college"><i class="fas fa-book"></i> Collèges</button>
                <button class="support-btn" data-support="anki"><i class="fas fa-clone"></i> Anki</button>
                <button class="support-btn" data-support="perso"><i class="fas fa-pen"></i> Fiche perso</button>
                <button class="support-btn" data-support="codex"><i class="fas fa-file-lines"></i> EDNi/Codex</button>
                <button class="support-btn" data-support="conf"><i class="fas fa-chalkboard-user"></i> Conf</button>
            </div>
        </div>
        
        <div class="modal-actions">
            <button class="btn-validate" id="btn-save-tour"><i class="fas fa-check"></i> Valider</button>
            <button class="btn-reset" id="btn-reset-tour"><i class="fas fa-trash"></i> Réinitialiser</button>
        </div>
    </div>
</div>

<div class="saving-indicator" id="saving-indicator"><i class="fas fa-spinner"></i><span>Sauvegarde...</span></div>

<!-- Notification personnalisée pour avertir avant fermeture -->
<div class="custom-warning-modal" id="custom-warning-modal">
    <div class="custom-warning-content">
        <div class="custom-warning-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3 class="custom-warning-title">⚠️ Attention !</h3>
        <p class="custom-warning-message">
            Des modifications sont en cours de sauvegarde.<br>
            <strong>Veuillez patienter quelques secondes...</strong>
        </p>
        <div class="custom-warning-progress">
            <div class="custom-warning-progress-bar" id="warning-progress-bar"></div>
        </div>
        <div class="custom-warning-actions">
            <button class="custom-warning-btn btn-wait" id="btn-wait-save">
                <i class="fas fa-clock"></i> Attendre la sauvegarde
            </button>
            <button class="custom-warning-btn btn-force" id="btn-force-quit">
                <i class="fas fa-sign-out-alt"></i> Quitter quand même
            </button>
        </div>
    </div>
</div>

<div class="back-to-top" id="back-to-top"><i class="fas fa-arrow-up"></i></div>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="footer-container">
            <div class="footer-brand">
                <div class="footer-logo">TypixClin</div>
                <p class="footer-description">Plateforme d'aide à la rédaction des examens cliniques pour étudiants en médecine.</p>
                <div class="footer-social">
                    <a href="https://github.com/JEZENN/TypixClin" class="social-link"><i class="fab fa-github"></i></a>
                </div>
            </div>
            
            <div class="footer-nav">
                <h4 class="footer-nav-title">Outils</h4>
                <div class="footer-nav-links">
                    <a href="examen-adulte.html" class="footer-nav-link">Examen Adulte</a>
                    <a href="examen-pédiatrique.html" class="footer-nav-link">Examen Pédiatrique</a>
                    <a href="examen-réanimation.html" class="footer-nav-link">Examen Réanimation</a>
                    <a href="ecg.html" class="footer-nav-link">ECG</a>
                    <a href="gds.html" class="footer-nav-link">Gaz du sang</a>
                    <a href="Troubles ioniques.html" class="footer-nav-link">Troubles ioniques</a>
                </div>
            </div>
            
            <div class="footer-nav">
                <h4 class="footer-nav-title">Fiches et ressources</h4>
                <div class="footer-nav-links">
                    <a href="Fiche-examen-clinique.html" class="footer-nav-link">Fiche Examen Clinique</a>
                    <a href="Fiche-ECG.html" class="footer-nav-link">Fiche ECG</a>
					<a href="FichierGsheet.html" class="footer-nav-link">Tableur Gsheet Externat</a>
					<a href="TableurEnLigne.html" class="footer-nav-link">Tableur en ligne Externat</a>
					<a href="Carnet-de-stage.html" class="footer-nav-link">Carnet de stage</a>

                </div>
            </div>
            
            <div class="footer-nav">
                <h4 class="footer-nav-title">À propos</h4>
                <div class="footer-nav-links">
				    <a href="index.html#tools" class="footer-nav-link">Outils</a>
					<a href="index.html#tableur" class="footer-nav-link">Tableur</a>
					<a href="index.html#fiches" class="footer-nav-link">Fiches</a>
                    <a href="index.html#ai" class="footer-nav-link">Conception</a>
                    <a href="index.html#feedback" class="footer-nav-link">Feedback</a>
					<a href="MentionsLégales.html" class="footer-nav-link">Mentions légales</a>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="footer-copyright">TypixClin © 2025, Jean ZENNARO. Certaines fonctionnalités et leur code source font l’objet d’un dépôt d’antériorité (e-Soleau – INPI).</div>
        </div>
    </div>
</footer>


<!-- Popup choix validation checklist -->
<div class="checklist-choice-popup" id="checklist-choice-popup">
    <button class="checklist-choice-btn tour-and-task" id="checklist-choice-tour">
        <i class="fas fa-graduation-cap"></i> Valider un tour + la tâche
    </button>
    <button class="checklist-choice-btn task-only" id="checklist-choice-task">
        <i class="fas fa-check"></i> Valider la tâche uniquement
    </button>
</div>

<!-- Toast Logout -->
<div class="toast-logout" id="toast-logout">
    <div class="toast-logout-icon">
        <i class="fas fa-sign-out-alt"></i>
    </div>
    <div class="toast-logout-content">
        <div class="toast-logout-title">Déconnexion réussie</div>
        <div class="toast-logout-message">À bientôt sur TypixClin !</div>
    </div>
</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, onSnapshot, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js";

const firebaseConfig = {
    apiKey: "AIzaSyBSJPwPWOAGnWwQN3j2qwu8pxf2iCdO-Gc",
    authDomain: "typixclin-b5fa9.firebaseapp.com",
    projectId: "typixclin-b5fa9",
    storageBucket: "typixclin-b5fa9.firebasestorage.app",
    messagingSenderId: "726560091078",
    appId: "1:726560091078:web:5ce8b31da0bfbbc1f720c7",
    measurementId: "G-9CZ2QB6TNK"
};

let pendingChecklistItemId = null;

const app = initializeApp(firebaseConfig);
const functions = getFunctions(app, 'europe-west1');
const auth = getAuth(app);
const db = getFirestore(app);


// ===== CONFIGURATION DES RESSOURCES PERSONNALISÉES =====
const AVAILABLE_RESOURCES = [
    { id: 'qi-edni', label: 'Qi sur EDNi', shortLabel: 'Qi EDNi', cssClass: 'qi-edni' },
    { id: 'dp-edni', label: 'DP sur EDNi', shortLabel: 'DP EDNi', cssClass: 'dp-edni' },
    { id: 'qi-hypo', label: 'Qi sur Hypocampus', shortLabel: 'Qi Hypo', cssClass: 'qi-hypo' },
    { id: 'dp-hypo', label: 'DP Hypocampus', shortLabel: 'DP Hypo', cssClass: 'dp-hypo' },
    { id: 'qi-annales', label: 'Qi Annales', shortLabel: 'Qi Ann', cssClass: 'qi-annales' },
    { id: 'dp-annales', label: 'DP Annales', shortLabel: 'DP Ann', cssClass: 'dp-annales' },
    { id: 'qi-uness', label: 'Qi sur UNESS', shortLabel: 'Qi UNESS', cssClass: 'qi-uness' },
    { id: 'dp-uness', label: 'DP sur UNESS', shortLabel: 'DP UNESS', cssClass: 'dp-uness' },
    { id: 'fiche-perso', label: 'Fiche Perso', shortLabel: 'Fiche', cssClass: 'fiche-perso' }
];

// Ressources sélectionnées par défaut
let selectedResources = [];

// Charger la configuration depuis userData (Firebase)
function loadResourcesConfig() {
    if (userData && userData.selectedResources) {
        selectedResources = userData.selectedResources;
    } else {
        selectedResources = [];
    }
}



// Variable temporaire pour la sélection dans le modal
let tempSelectedResources = [];

// Ouvrir le modal de configuration
window.openResourcesConfigModal = function() {
    tempSelectedResources = [...selectedResources];
    renderResourcesOptions();
    updateResourcesCount();
    document.getElementById('resources-config-modal').classList.add('active');
};

// Fermer le modal
window.closeResourcesConfigModal = function() {
    document.getElementById('resources-config-modal').classList.remove('active');
};

// Rendre les options de ressources
function renderResourcesOptions() {
    const container = document.getElementById('resources-available-list');
    container.innerHTML = AVAILABLE_RESOURCES.map(res => {
        const isSelected = tempSelectedResources.includes(res.id);
        const isDisabled = !isSelected && tempSelectedResources.length >= 4;
        return `
            <div class="resource-option ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                 data-resource-id="${res.id}" 
                 onclick="toggleResourceOption('${res.id}')">
                <div class="resource-option-checkbox">
                    ${isSelected ? '<i class="fas fa-check"></i>' : ''}
                </div>
                <div class="resource-option-preview resource-box ${res.cssClass}">${res.shortLabel}</div>
                <span class="resource-option-name">${res.label}</span>
            </div>
        `;
    }).join('');
}

// Basculer la sélection d'une ressource
window.toggleResourceOption = function(resourceId) {
    const index = tempSelectedResources.indexOf(resourceId);
    
    if (index > -1) {
        // Déselectionner
        tempSelectedResources.splice(index, 1);
    } else if (tempSelectedResources.length < 4) {
        // Sélectionner (si moins de 4)
        tempSelectedResources.push(resourceId);
    }
    
    renderResourcesOptions();
    updateResourcesCount();
};

// Mettre à jour le compteur
function updateResourcesCount() {
    document.getElementById('resources-count').textContent = tempSelectedResources.length;
}

// Sauvegarder la configuration
window.saveResourcesConfig = function() {
    selectedResources = [...tempSelectedResources];
    // Sauvegarder dans userData pour Firebase
    if (userData) {
        userData.selectedResources = selectedResources;
        debouncedSave();
    }
    closeResourcesConfigModal();
    renderItemsTable();
    window.showToastNotification('Configuration des ressources enregistrée !', 'success');
};

// Basculer l'état validé d'une ressource pour un item
window.toggleResourceValidation = function(specialtyId, fc, resourceId) {
    const d = getItemData(specialtyId, fc);
    if (!d.resources) d.resources = {};
    d.resources[resourceId] = !d.resources[resourceId];
    debouncedSave();
    renderItemsTable();
	    
		// Vérifier les trophées après validation
    if (typeof TrophiesSystem !== 'undefined') {
        setTimeout(() => TrophiesSystem.checkTrophies(), 500);
    }
};



// Configuration des pastilles sous-spécialités
const BADGE_CONFIG = {
    'neurochir': { label: 'Neurochir', class: 'neurochir' },
    'nutrition': { label: 'Nutrition', class: 'nutrition' },
    'chir-dig': { label: 'Chir Dig', class: 'chir-dig' },
    'cmf': { label: 'CMF', class: 'cmf' },
    'anapath': { label: 'Anapath', class: 'anapath' },
    'immuno': { label: 'Immuno', class: 'immuno' },
    'anesthesie': { label: 'Anesth', class: 'anesthesie' },
    'mpr': { label: 'MPR', class: 'mpr' },
	'chir-vasc': { label: 'Chir Vasc', class: 'chir-vasc' },
    'ortho': { label: 'Ortho', class: 'ortho' },
	'genet': { label: 'Genet', class: 'genet' },
	'parasito': { label: 'Parasito', class: 'parasito' }
};

const SPECIALTY_SHORT = {
    'cardiologie': 'CAR',
    'hge': 'HGE',
    'pneumologie': 'PNE',
    'gynecologie': 'GYN',
    'orl': 'ORL',
    'neurologie': 'NEU',
    'psychiatrie': 'PSY',
    'osteo': 'RHU',
    'pediatrie': 'PED',
    'hematologie': 'HEM',
    'endocrinologie': 'END',
    'mir': 'MIR',
    'nephrologie': 'NEPH',
    'infectiologie': 'INF',
    'dermatologie': 'DER',
    'therapeutique': 'TTT',
    'geriatrie': 'GER',
    'douleur': 'DOU',
    'medecine-interne': 'MIN',
    'oncologie': 'ONC',
    'ophtalmologie': 'OPH',
    'urologie': 'URO',
    'medecine-legale': 'MTML',
    'sante-publique': 'SPU'
};


const ITEM_BADGES = {
    // Immuno (medecine-interne)
    'medecine-interne|Déficit immunitaire': 'immuno',
    'medecine-interne|Pathologies auto-immunes': 'immuno',
    'medecine-interne|Greffe organe': 'immuno',
    
    // Anapath (oncologie)
    'oncologie|Pathologie digestive': 'anapath',
    'oncologie|Pathologie gynécologique': 'anapath',
    'oncologie|Pathologie urologique': 'anapath',
    'oncologie|Néphrologie': 'anapath',
    'oncologie|Pathologie thoracique et pneumologique': 'anapath',
    'oncologie|Tête et cou': 'anapath',
    'oncologie|Dermatologie': 'anapath',
    'oncologie|Hématologie': 'anapath',
    'oncologie|Cancérologie': 'anapath',
    
    // CMF (orl)
    'orl|Développement bucco-dentaire et anomalies': 'cmf',
    'orl|Traumatologie maxillo-faciale': 'cmf',
    'orl|Tumeurs des os de la face': 'cmf',
    'orl|Tumeurs cutanées épithéliales et mélaniques de la face': 'cmf',
    'orl|Malformations vasculaires et hémangiomes de la face': 'cmf',
    'orl|Cellulite faciale origine dentaire': 'cmf',
    'orl|Pathologies non tumorales de la muqueuse buccale': 'cmf',
    'orl|Pathologies des glandes salivaires': 'cmf',
    
    // Neurochir (neurologie)
    'neurologie|Compression médullaire non traumatique et syndrome de la queue de cheval': 'neurochir',
    'neurologie|Tumeurs intracrâniennes': 'neurochir',
    'neurologie|Hémorragie méningée': 'neurochir',
    
    // Chir dig (hge)
    'hge|Syndrome occlusif': 'chir-dig',
    'hge|Appendicite aiguë': 'chir-dig',
    'hge|Péritonite aiguë': 'chir-dig',
    'hge|Transplantation hépatique': 'chir-dig',
    'hge|Hernies pariétales': 'chir-dig',
    'hge|Hémorragie digestive': 'chir-dig',
    'hge|Pathologie hémorroïdaire': 'chir-dig',
    'hge|Diverticulose colique': 'chir-dig',
    
    // Chir vasc (cardiologie)
    'cardiologie|Ulcère de jambe': 'chir-vasc',
    'cardiologie|Acrosyndromes': 'chir-vasc',
    'cardiologie|Hémangiomes et malformations vasculaires cutanées': 'chir-vasc',
    'cardiologie|Surveillance des porteurs de valves cardiaques': 'chir-vasc',
    'cardiologie|Artériopathies aorte et membres inférieurs': 'chir-vasc',
    
    // Nutrition (endocrinologie)
    'endocrinologie|Prévention primaire par la nutrition': 'nutrition',
    'endocrinologie|Modifications thérapeutiques du mode de vie (nutrition)': 'nutrition',
    'endocrinologie|Aptitude au sport et nutrition du sportif': 'nutrition',
    'endocrinologie|Besoins nutritionnels et grossesse': 'nutrition',
    'endocrinologie|Allaitement maternel': 'nutrition',
    'endocrinologie|Amaigrissement à tous les âges (nutrition)': 'nutrition',
    'endocrinologie|Dénutrition adulte enfant': 'nutrition',
    'endocrinologie|Troubles nutritionnels du sujet âgé': 'nutrition',
    'endocrinologie|Troubles des conduites alimentaires adolescent et adulte (Nutrition)': 'nutrition',
    
    // MPR (geriatrie)
    'geriatrie|Éthique médicale et protection juridique': 'mpr',
    'geriatrie|Santé des populations': 'mpr',
    'geriatrie|Enfant handicapé : orientation et prise en charge': 'mpr',
    'geriatrie|Compression médullaire non traumatique et syndrome de la queue de cheval': 'mpr',
    'geriatrie|Rachialgie': 'mpr',
    'geriatrie|Sclérose en plaques': 'mpr',
    'geriatrie|Maladie de Parkinson': 'mpr',
    'geriatrie|Troubles marche et équilibre': 'mpr',
    'geriatrie|La personne handicapée': 'mpr',
    'geriatrie|Complications hypomobilité et du décubitus (ITEM 120 LISA UNIQUE)': 'mpr',
    'geriatrie|Principales techniques de rééducation et de réadaptation': 'mpr',
    'geriatrie|Troubles de la miction et incontinence urinaire de l\'adulte et du sujet âgé': 'mpr',
    'geriatrie|Arthrose de hanche et de genou': 'mpr',
    'geriatrie|Polyarthrite rhumatoïde': 'mpr',
    'geriatrie|Spondylarthrite': 'mpr',
    'geriatrie|Syndrome douloureux régional complexe': 'mpr',
    'geriatrie|Modifications thérapeutiques du mode de vie': 'mpr',
    'geriatrie|Aptitude au sport adulte et enfant': 'mpr',
    'geriatrie|Thérapeutiques non médicamenteuses et dispositifs médicaux': 'mpr',
    'geriatrie|Accidents vasculaires cérébraux': 'mpr',
    
    // Anesthésie (mir)
    'mir|Surveillance et complications des abords veineux': 'anesthesie',
    'mir|Anesthésie locale, locorégionale et générale': 'anesthesie',
    
    // Ortho (osteo)
    'osteo|Lésions péri-articulaires et ligamentaires : épaule, genou et cheville (ITEM 361 LISA UNIQUE)': 'ortho',
    'osteo|Brûlures (ITEM 334 LISA UNIQUE)': 'ortho',
    'osteo|Lésions péri-articulaires et ligamentaires épaule (ITEM 361 LISA UNIQUE)': 'ortho',
    'osteo|Lésions péri-articulaires et ligamentaires du genou (ITEM 361 LISA UNIQUE)': 'ortho',
    'osteo|Lésions péri-articulaires et ligamentaires de la cheville (ITEM 361 LISA UNIQUE)': 'ortho',
    'osteo|Prothèses et ostéosynthèses': 'ortho',
    'osteo|Fractures extrémité proximale du fémur (ITEM 363 LISA UNIQUE)': 'ortho',
    'osteo|Fractures extrémité inférieure du radius (ITEM 363 LISA UNIQUE)': 'ortho',
    'osteo|Surveillance malade sous plâtre ou résine': 'ortho',
    'osteo|Prise en charge immédiate préhospitalière et intrahospitalière (ITEM 334 LISA UNIQUE)': 'ortho',
    'osteo|Dépistage des anomalies orthopédiques': 'ortho',
    'osteo|Fractures chez enfant': 'ortho',
	
	// génétique 
	
	'medecine-interne|Maladies rares': 'genet',
	'medecine-interne|Médecine génomique': 'genet',
	'medecine-interne|Spécificités des maladies génétiques': 'genet',
	
	
	// parasito 
	
	'infectiologie|Paludisme': 'parasito',
	'infectiologie|Gale et pédiculose': 'parasito',
	'infectiologie|Gale et pédiculose': 'parasito',
	'infectiologie|Parasitoses digestives': 'parasito',
	'infectiologie|Zoonoses': 'parasito',
	'infectiologie|Voyage en pays tropical': 'parasito'
	
};

const ITEM_REFERENCE = {
    // Format: 'numéro|idCollège': true
    '01|medecine-interne': true,
    '02|medecine-interne': true,
    '03|medecine-interne': true,
    '04|sante-publique': true,
    '05|sante-publique': true,
    '06|sante-publique': true,
    '07|medecine-legale': true,
    '08|sante-publique': true,
    '09|medecine-legale': true,
    '11|medecine-legale': true,
    '12|medecine-legale': true,
    '13|medecine-legale': true,
    '14|medecine-legale': true,
    '15|psychiatrie': true,
    '16|sante-publique': true,
    '17|sante-publique': true,
    '18|sante-publique': true,
    '19|sante-publique': true,
    '20|sante-publique': true,
    '21|sante-publique': true,
    '22|medecine-interne': true,
    '23|gynecologie': true,
    '24|gynecologie': true,
    '25|gynecologie': true,
    '26|gynecologie': true,
    '27|gynecologie': true,
    '28|gynecologie': true,
    '29|gynecologie': true,
    '30|gynecologie': true,
    '31|gynecologie': true,
    '32|pediatrie': true,
    '33|gynecologie': true,
    '34|gynecologie': true,
    '35|gynecologie': true,
    '36|gynecologie': true,
    '37|gynecologie': true,
    '38|gynecologie': true,
    '39|gynecologie': true,
    '40|gynecologie': true,
    '41|gynecologie': true,
    '42|gynecologie': true,
    '43|gynecologie': true,
    '44|gynecologie': true,
    '45|medecine-interne': true,
    '46|medecine-interne': true,
    '47|pediatrie': true,
    '48|pediatrie': true,
    '49|pediatrie': true,
    '50|urologie': true,
    '51|pediatrie': true,
    '52|ophtalmologie': true,
    '53|pediatrie': true,
    '54|pediatrie': true,
    '55|pediatrie': true,
    '56|pediatrie': true,
    '57|pediatrie': true,
    '58|gynecologie': true,
    '59|medecine-interne': true,
    '60|psychiatrie': true,
    '61|psychiatrie': true,
    '62|psychiatrie': true,
    '63|psychiatrie': true,
    '64|psychiatrie': true,
    '65|psychiatrie': true,
    '66|psychiatrie': true,
    '67|psychiatrie': true,
    '68|psychiatrie': true,
    '69|psychiatrie': true,
    '70|psychiatrie': true,
    '71|psychiatrie': true,
    '72|psychiatrie': true,
    '73|psychiatrie': true,
    '74|psychiatrie': true,
    '75|psychiatrie': true,
    '76|psychiatrie': true,
    '77|psychiatrie': true,
    '78|psychiatrie': true,
    '79|psychiatrie': true,
    '80|psychiatrie': true,
    '81|ophtalmologie': true,
    '82|ophtalmologie': true,
    '83|ophtalmologie': true,
    '84|ophtalmologie': true,
    '85|ophtalmologie': true,
    '86|ophtalmologie': true,
    '87|orl': true,
    '88|orl': true,
    '89|orl': true,
    '90|orl': true,
    '91|neurologie': true,
    '92|neurologie': true,
    '93|neurologie': true,
    '94|geriatrie': true,
    '95|osteo': true,
    '96|neurologie': true,
    '97|neurologie': true,
    '98|neurologie': true,
    '99|neurologie': true,
    '100|neurologie': true,
    '101|neurologie': true,
    '102|neurologie': true,
    '103|orl': true,
    '104|neurologie': true,
    '105|neurologie': true,
    '106|neurologie': true,
    '107|neurologie': true,
    '108|neurologie': true,
    '109|neurologie': true,
    '110|neurologie': true,
    '111|dermatologie': true,
    '112|dermatologie': true,
    '113|dermatologie': true,
    '114|dermatologie': true,
    '115|dermatologie': true,
    '116|dermatologie': true,
    '117|dermatologie': true,
    '118|geriatrie': true,
    '120|geriatrie': true,
    '121|psychiatrie': true,
    '122|geriatrie': true,
    '123|geriatrie': true,
    '124|gynecologie': true,
    '125|urologie': true,
    '126|urologie': true,
    '127|urologie': true,
    '128|osteo': true,
    '129|osteo': true,
    '130|geriatrie': true,
    '131|geriatrie': true,
    '132|geriatrie': true,
    '133|geriatrie': true,
    '134|douleur': true,
    '135|douleur': true,
    '136|mir': true,
    '137|douleur': true,
    '138|douleur': true,
    '139|douleur': true,
    '140|douleur': true,
    '141|douleur': true,
    '142|pediatrie': true,
    '143|douleur': true,
    '144|psychiatrie': true,
    '145|infectiologie': true,
    '146|infectiologie': true,
    '147|infectiologie': true,
    '148|infectiologie': true,
    '149|infectiologie': true,
    '150|orl': true,
    '151|infectiologie': true,
    '152|infectiologie': true,
    '153|cardiologie': true,
    '154|pneumologie': true,
    '155|dermatologie': true,
    '156|infectiologie': true,
    '157|infectiologie': true,
    '158|mir': true,
    '159|infectiologie': true,
    '160|infectiologie': true,
    '161|urologie': true,
    '162|dermatologie': true,
    '163|infectiologie': true,
    '164|pediatrie': true,
    '165|infectiologie': true,
    '166|infectiologie': true,
    '167|hge': true,
    '168|infectiologie': true,
    '169|infectiologie': true,
    '170|infectiologie': true,
    '171|infectiologie': true,
    '172|infectiologie': true,
    '173|infectiologie': true,
    '174|infectiologie': true,
    '175|infectiologie': true,
    '176|infectiologie': true,
    '177|infectiologie': true,
    '178|infectiologie': true,
    '179|sante-publique': true,
    '180|medecine-legale': true,
    '181|sante-publique': true,
    '182|medecine-legale': true,
    '183|medecine-legale': true,
    '184|medecine-legale': true,
    '185|medecine-interne': true,
    '186|pneumologie': true,
    '187|dermatologie': true,
    '188|pneumologie': true,
    '189|medecine-interne': true,
    '190|medecine-interne': true,
    '191|medecine-interne': true,
    '192|medecine-interne': true,
    '193|medecine-interne': true,
    '194|medecine-interne': true,
    '195|medecine-interne': true,
    '196|osteo': true,
    '197|osteo': true,
    '198|osteo': true,
    '199|douleur': true,
    '200|osteo': true,
    '201|medecine-interne': true,
    '202|medecine-interne': true,
    '203|pneumologie': true,
    '204|pneumologie': true,
    '205|pneumologie': true,
    '206|pneumologie': true,
    '207|pneumologie': true,
    '208|pneumologie': true,
    '209|pneumologie': true,
    '210|pneumologie': true,
    '211|medecine-interne': true,
    '212|hematologie': true,
    '213|medecine-interne': true,
    '214|medecine-interne': true,
    '215|medecine-interne': true,
    '216|hematologie': true,
    '217|medecine-interne': true,
    '218|medecine-interne': true,
    '219|medecine-interne': true,
    '220|hematologie': true,
    '221|cardiologie': true,
    '222|cardiologie': true,
    '223|endocrinologie': true,
    '224|cardiologie': true,
    '225|cardiologie': true,
    '226|cardiologie': true,
    '227|cardiologie': true,
    '228|cardiologie': true,
    '229|mir': true,
    '230|cardiologie': true,
    '231|cardiologie': true,
    '232|cardiologie': true,
    '233|cardiologie': true,
    '234|cardiologie': true,
    '235|cardiologie': true,
    '236|cardiologie': true,
    '237|cardiologie': true,
    '238|cardiologie': true,
    '239|cardiologie': true,
    '240|endocrinologie': true,
    '241|endocrinologie': true,
    '242|endocrinologie': true,
    '243|endocrinologie': true,
    '244|endocrinologie': true,
    '245|endocrinologie': true,
    '246|endocrinologie': true,
    '247|endocrinologie': true,
    '248|endocrinologie': true,
    '249|endocrinologie': true,
    '250|endocrinologie': true,
    '251|endocrinologie': true,
    '252|geriatrie': true,
    '253|endocrinologie': true,
    '254|endocrinologie': true,
    '255|endocrinologie': true,
    '256|osteo': true,
    '257|nephrologie': true,
    '258|nephrologie': true,
    '259|nephrologie': true,
    '260|urologie': true,
    '261|nephrologie': true,
    '262|nephrologie': true,
    '263|nephrologie': true,
    '264|nephrologie': true,
    '265|urologie': true,
    '266|nephrologie': true,
    '267|nephrologie': true,
    '268|nephrologie': true,
    '269|hge': true,
    '270|osteo': true,
    '271|hge': true,
    '272|hge': true,
    '273|hge': true,
    '274|hge': true,
    '275|medecine-interne': true,
    '276|hge': true,
    '277|hge': true,
    '278|hge': true,
    '279|hge': true,
    '280|hge': true,
    '281|hge': true,
    '282|hge': true,
    '283|hge': true,
    '284|hge': true,
    '285|hge': true,
    '286|hge': true,
    '287|hge': true,
    '288|hge': true,
    '289|hge': true,
    '290|oncologie': true,
    '291|oncologie': true,
    '292|oncologie': true,
    '293|oncologie': true,
    '294|oncologie': true,
    '295|oncologie': true,
    '296|hematologie': true,
    '297|pediatrie': true,
    '298|orl': true,
    '299|neurologie': true,
    '300|gynecologie': true,
    '301|hge': true,
    '302|dermatologie': true,
    '303|hge': true,
    '304|hge': true,
    '305|hge': true,
    '306|gynecologie': true,
    '307|osteo': true,
    '308|hge': true,
    '309|pneumologie': true,
    '310|urologie': true,
    '311|urologie': true,
    '312|gynecologie': true,
    '313|urologie': true,
    '314|urologie': true,
    '315|hematologie': true,
    '316|hematologie': true,
    '317|hematologie': true,
    '318|hematologie': true,
    '319|hematologie': true,
    '320|hematologie': true,
    '321|therapeutique': true,
    '322|therapeutique': true,
    '323|therapeutique': true,
    '324|therapeutique': true,
    '325|therapeutique': true,
    '326|therapeutique': true,
    '327|therapeutique': true,
    '328|geriatrie': true,
    '329|hematologie': true,
    '330|therapeutique': true,
    '331|mir': true,
    '332|mir': true,
    '333|mir': true,
    '334|mir': true,
    '335|orl': true,
    '336|mir': true,
    '337|mir': true,
    '338|mir': true,
    '339|cardiologie': true,
    '340|neurologie': true,
    '341|mir': true,
    '342|neurologie': true,
    '343|neurologie': true,
    '344|gynecologie': true,
    '345|pediatrie': true,
    '346|pediatrie': true,
    '347|urologie': true,
    '348|nephrologie': true,
    '349|osteo': true,
    '350|dermatologie': true,
    '351|psychiatrie': true,
    '352|psychiatrie': true,
    '353|psychiatrie': true,
    '354|hge': true,
    '355|hge': true,
    '356|hge': true,
    '357|hge': true,
    '358|hge': true,
    '359|mir': true,
    '360|mir': true,
    '361|osteo': true,
    '362|osteo': true,
    '363|osteo': true,
    '364|pediatrie': true,
    '365|osteo': true,
    '366|infectiologie': true,
    '367|sante-publique': true,
	'998|dermatologie': true,
	'997|mir': true,
	'999|oncologie': true,
	'996|ophtalmologie': true,
};

const ITEM_URLS = {
    "1": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_relation_m%C3%A9decin-malade_dans_le_cadre_du_colloque_singulier_ou_au_sein_d%27une_%C3%A9quipe,_le_cas_%C3%A9ch%C3%A9ant_pluriprofessionnelle._La_communication_avec_le_patient_et_son_entourage._L%27annonce_d%27une_maladie_grave_ou_l%C3%A9tale_ou_d%27un_dommage_...",
    "2": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Les_valeurs_professionnelles_du_m%C3%A9decin_et_des_autres_professions_de_sant%C3%A9",
    "3": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Le_raisonnement_et_la_d%C3%A9cision_en_m%C3%A9decine._La_m%C3%A9decine_fond%C3%A9e_sur_les_preuves_(Evidence_Based_Medicine,_EBM)._La_d%C3%A9cision_m%C3%A9dicale_partag%C3%A9e._La_controverse",
    "4": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Qualit%C3%A9_et_s%C3%A9curit%C3%A9_des_soins._La_s%C3%A9curit%C3%A9_du_patient._La_gestion_des_risques._Les_%C3%A9v%C3%A9nements_ind%C3%A9sirables_associ%C3%A9s_aux_soins_(EIAS)._D%C3%A9marche_qualit%C3%A9_et_%C3%A9valuation_des_pratiques_professionnelles",
    "5": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Responsabilit%C3%A9s_m%C3%A9dicale_p%C3%A9nale,_civile,_administrative_et_disciplinaire._La_gestion_des_erreurs_et_des_plaintes_;_l%27al%C3%A9a_th%C3%A9rapeutique",
    "6": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:L%27organisation_de_l%27exercice_clinique_et_les_m%C3%A9thodes_qui_permettent_de_s%C3%A9curiser_le_parcours_du_patient",
    "7": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Les_droits_individuels_et_collectifs_du_patient",
    "8": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Les_discriminations",
    "9": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Introduction_%C3%A0_l%27%C3%A9thique_m%C3%A9dicale",
    "10": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Approches_transversales_du_corps",
    "11": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Violences_et_sant%C3%A9",
    "12": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Violences_sexuelles",
    "13": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Certificats_m%C3%A9dicaux._D%C3%A9c%C3%A8s_et_l%C3%A9gislation",
    "14": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_mort",
    "15": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Soins_psychiatriques_sans_consentement",
    "16": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Organisation_du_syst%C3%A8me_de_soins._Sa_r%C3%A9gulation._Les_indicateurs._Parcours_de_soins",
    "17": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:T%C3%A9l%C3%A9m%C3%A9decine,_t%C3%A9l%C3%A9sant%C3%A9_et_t%C3%A9l%C3%A9services_en_sant%C3%A9",
    "18": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Sant%C3%A9_et_num%C3%A9rique",
    "19": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_s%C3%A9curit%C3%A9_sociale._L%27assurance_maladie._Les_assurances_compl%C3%A9mentaires._La_compl%C3%A9mentaire_sant%C3%A9_solidaire_(CSS)._La_consommation_m%C3%A9dicale._Protection_sociale._Consommation_m%C3%A9dicale_et_%C3%A9conomie_de_la_sant%C3%A9",
    "20": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_m%C3%A9thodologie_de_la_recherche_en_sant%C3%A9",
    "21": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Mesure_de_l%27%C3%A9tat_de_sant%C3%A9_de_la_population",
    "22": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Maladies_rares",
    "23": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Grossesse_normale",
    "24": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Principales_complications_de_la_grossesse",
    "25": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Grossesse_extra-ut%C3%A9rine",
    "26": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Douleur_abdominale_aigu%C3%AB_chez_une_femme_enceinte",
    "27": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pr%C3%A9vention_des_risques_f%C5%93taux_:_infection,_m%C3%A9dicaments,_toxiques,_irradiation",
    "28": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_particularit%C3%A9s_de_l%27infection_urinaire_au_cours_de_la_grossesse",
    "29": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_principaux_risques_professionnels_pour_la_maternit%C3%A9,_li%C3%A9s_au_travail_de_la_m%C3%A8re",
    "30": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pr%C3%A9maturit%C3%A9_et_retard_de_croissance_intra-ut%C3%A9rin_:_facteurs_de_risque_et_pr%C3%A9vention",
    "31": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Accouchement,_d%C3%A9livrance_et_suites_de_couches_normales",
    "32": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89valuation_et_soins_du_nouveau-n%C3%A9_%C3%A0_terme",
    "33": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Allaitement_maternel",
    "34": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Suites_de_couches_pathologiques_:_pathologie_maternelle_dans_les_40_jours",
    "35": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Anomalies_du_cycle_menstruel._M%C3%A9trorragies",
    "36": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Contraception._(voir_item_330)",
    "37": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Interruption_volontaire_de_grossesse",
    "38": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infertilit%C3%A9_du_couple_:_conduite_de_la_premi%C3%A8re_consultation",
    "39": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Assistance_m%C3%A9dicale_%C3%A0_la_procr%C3%A9ation_:_principaux_aspects_biologiques,_m%C3%A9dicaux_et_%C3%A9thiques",
    "40": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Algies_pelviennes_chez_la_femme",
    "41": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Endom%C3%A9triose",
    "42": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Am%C3%A9norrh%C3%A9e",
    "43": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9morragie_g%C3%A9nitale_chez_la_femme",
    "44": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tum%C3%A9faction_pelvienne_chez_la_femme",
    "45": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Sp%C3%A9cificit%C3%A9s_des_maladies_g%C3%A9n%C3%A9tiques._(voir_item_9)",
    "46": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:M%C3%A9decine_g%C3%A9nomique",
    "47": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Suivi_d%27un_nourrisson,_d%27un_enfant_et_d%27un_adolescent_normal._D%C3%A9pistage_des_anomalies_orthop%C3%A9diques,_des_troubles_visuels,_auditifs_et_dentaires._Examens_de_sant%C3%A9_obligatoires._M%C3%A9decine_scolaire._Mortalit%C3%A9_et_morbidit%C3%A9_infantiles",
    "48": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Alimentation_et_besoins_nutritionnels_du_nourrisson_et_de_l%27enfant",
    "49": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pubert%C3%A9_normale_et_pathologique",
    "50": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pathologie_g%C3%A9nito-scrotale_chez_le_gar%C3%A7on_et_chez_l%27homme",
    "51": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_de_la_miction_chez_l%27enfant",
    "52": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Strabisme_et_amblyopie_de_l%27enfant",
    "53": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Retard_de_croissance_staturo-pond%C3%A9rale",
    "54": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Boiterie_chez_l%27enfant",
    "55": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:D%C3%A9veloppement_psychomoteur_du_nourrisson_et_de_l%27enfant_:_aspects_normaux_et_pathologiques_(sommeil,_alimentation,_contr%C3%B4les_sphinct%C3%A9riens,_psychomotricit%C3%A9,_langage,_intelligence)._L%27installation_pr%C3%A9coce_de_la_relation_parents-enfant_et_...",
    "56": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:L%27enfant_handicap%C3%A9_:_orientation_et_prise_en_charge_(voir_items_118,_121)",
    "57": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Maltraitance_et_enfants_en_danger._Protection_maternelle_et_infantile",
    "58": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Sexualit%C3%A9_normale_et_ses_troubles",
    "59": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Sujets_en_situation_de_pr%C3%A9carit%C3%A9",
    "60": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_facteurs_de_risque,_pr%C3%A9vention,_d%C3%A9pistage_des_troubles_psychiques_de_l%27enfant_%C3%A0_la_personne_%C3%A2g%C3%A9e",
    "61": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_bases_des_classifications_des_troubles_mentaux_de_l%27enfant_%C3%A0_la_personne_%C3%A2g%C3%A9e",
    "62": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:D%C3%A9crire_l%27organisation_de_l%27offre_de_soins_en_psychiatrie,_de_l%27enfant_%C3%A0_la_personne_%C3%A2g%C3%A9e",
    "63": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_schizophr%C3%A9niques_de_l%27adolescent_et_de_l%27adulte",
    "64": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_bipolaires_de_l%27adolescent_et_de_l%27adulte",
    "65": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Trouble_d%C3%A9lirant_persistant",
    "66": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diagnostiquer_:_un_trouble_d%C3%A9pressif,_un_trouble_anxieux,_un_trouble_obsessionnel_compulsif,_un_trouble_de_stress_post-traumatique,_un_trouble_de_l%27adaptation,_un_trouble_de_la_personnalit%C3%A9",
    "67": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_du_neurod%C3%A9veloppement_(voir_items_55,_118,_121,_122,_138)",
    "68": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_du_comportement_de_l%27enfant_et_de_l%27adolescent",
    "69": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_psychiques_de_la_grossesse_et_du_post-partum",
    "70": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_psychiques_du_sujet_%C3%A2g%C3%A9",
    "71": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_des_conduites_alimentaires_chez_l%27adolescent_et_l%27adulte_(voir_item_253)",
    "72": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_%C3%A0_symptomatologie_somatique_et_apparent%C3%A9s_%C3%A0_tous_les_%C3%A2ges",
    "73": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diff%C3%A9rents_types_de_techniques_psychoth%C3%A9rapeutiques",
    "74": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prescription_et_surveillance_des_psychotropes_(voir_item_330)",
    "75": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Addiction_au_tabac",
    "76": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Addiction_%C3%A0_l%27alcool",
    "77": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Addiction_aux_m%C3%A9dicaments_psychotropes_(benzodiaz%C3%A9pines_et_apparent%C3%A9s)._(voir_item_322)",
    "78": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Addiction_au_cannabis,_%C3%A0_la_coca%C3%AFne,_aux_amph%C3%A9tamines,_aux_opiac%C3%A9s,_aux_drogues_de_synth%C3%A8se._(voir_item_322)",
    "79": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Addictions_comportementales",
    "80": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Dopage_et_conduites_dopantes._(voir_item_256)",
    "81": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Alt%C3%A9ration_chronique_de_la_vision",
    "82": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Alt%C3%A9ration_aigu%C3%AB_de_la_vision",
    "83": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_et_inflammations_oculaires",
    "84": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Glaucomes",
    "85": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_de_la_r%C3%A9fraction",
    "86": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pathologie_des_paupi%C3%A8res",
    "87": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Epistaxis",
    "88": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Trouble_aigu_de_la_parole._Dysphonie",
    "89": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Alt%C3%A9ration_de_la_fonction_auditive",
    "90": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pathologie_des_glandes_salivaires",
    "91": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:D%C3%A9ficit_neurologique_r%C3%A9cent._(voir_item_340)",
    "92": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:D%C3%A9ficit_moteur_et/ou_sensitif_des_membres",
    "93": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Compression_m%C3%A9dullaire_non_traumatique_et_syndrome_de_la_queue_de_cheval",
    "94": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Rachialgie",
    "95": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Radiculalgie_et_syndrome_canalaire",
    "96": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Neuropathies_p%C3%A9riph%C3%A9riques",
    "97": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Polyradiculon%C3%A9vrite_aigu%C3%AB_inflammatoire_(syndrome_de_Guillain-Barr%C3%A9)",
    "98": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Myasth%C3%A9nie",
    "99": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Migraine,_n%C3%A9vralgie_du_trijumeau_et_algies_de_la_face",
    "100": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:C%C3%A9phal%C3%A9e_inhabituelle_aigu%C3%AB_et_chronique_chez_l%27adulte_et_l%27enfant",
    "101": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Paralysie_faciale",
    "102": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diplopie",
    "103": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Vertige",
    "104": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Scl%C3%A9rose_en_plaques",
    "105": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89pilepsie_de_l%27enfant_et_de_l%27adulte",
    "106": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Maladie_de_Parkinson",
    "107": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Mouvements_anormaux",
    "108": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Confusion,_d%C3%A9mences._(voir_item_132)",
    "109": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_de_la_marche_et_de_l%27%C3%A9quilibre",
    "110": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_du_sommeil_de_l%27enfant_et_de_l%27adulte",
    "111": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Dermatoses_faciales_:_acn%C3%A9,_rosac%C3%A9e,_dermatite_s%C3%A9borrh%C3%A9ique",
    "112": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Dermatose_bulleuse_touchant_la_peau_et/ou_les_muqueuses_externes",
    "113": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9mangiomes_et_malformations_vasculaires_cutan%C3%A9es",
    "114": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Exanth%C3%A8me_et_%C3%A9rythrodermie_de_l%27adulte_et_de_l%27enfant._(voir_item_164)",
    "115": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Toxidermies",
    "116": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prurit",
    "117": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Psoriasis",
    "118": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_personne_handicap%C3%A9e_:_bases_de_l%27%C3%A9valuation_fonctionnelle_et_th%C3%A9rapeutique._(voir_item_56)",
    "119": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Soins_et_accompagnement_dans_la_maladie_chronique_et_le_handicap",
    "120": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Complications_de_l%27immobilit%C3%A9_et_du_d%C3%A9cubitus._Pr%C3%A9vention_et_prise_en_charge",
    "121": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Le_handicap_psychique._(voir_item_56_et_118)",
    "122": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Principales_techniques_de_r%C3%A9%C3%A9ducation_et_de_r%C3%A9adaptation._(voir_item_55)",
    "123": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Vieillissement_normal_:_aspects_biologiques,_fonctionnels_et_relationnels._Donn%C3%A9es_%C3%A9pid%C3%A9miologiques_et_sociologiques._Pr%C3%A9vention_du_vieillissement_pathologique",
    "124": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:M%C3%A9nopause,_insuffisance_ovarienne_pr%C3%A9matur%C3%A9e,_andropause,_d%C3%A9ficit_androg%C3%A9nique_li%C3%A9_%C3%A0_l%27%C3%A2ge._(Voir_item_330)",
    "125": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_de_la_miction_et_incontinence_urinaire_de_l%27adulte_et_du_sujet_%C3%A2g%C3%A9",
    "126": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Trouble_de_l%27%C3%A9rection",
    "127": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypertrophie_b%C3%A9nigne_de_la_prostate",
    "128": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ost%C3%A9opathies_fragilisantes",
    "129": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Arthrose",
    "130": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_personne_%C3%A2g%C3%A9e_malade_:_particularit%C3%A9s_s%C3%A9miologiques,_psychologiques_et_th%C3%A9rapeutiques._(voir_item_322)",
    "131": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_de_la_marche_et_de_l%27%C3%A9quilibre._(voir_item_109)",
    "132": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_cognitifs_du_sujet_%C3%A2g%C3%A9._(voir_item_108)",
    "133": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Autonomie_et_d%C3%A9pendance_chez_le_sujet_%C3%A2g%C3%A9",
    "134": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Bases_neurophysiologiques,_m%C3%A9canismes_physiopathologiques_d%27une_douleur_aigu%C3%AB_et_d%27une_douleur_chronique",
    "135": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Th%C3%A9rapeutiques_antalgiques,_m%C3%A9dicamenteuses_et_non_m%C3%A9dicamenteuses._(voir_item_330)",
    "136": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Anesth%C3%A9sie_locale,_locor%C3%A9gionale_et_g%C3%A9n%C3%A9rale",
    "137": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Douleur_chez_l%27enfant_:_%C3%A9valuation_et_traitements_antalgique",
    "138": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Douleur_chez_la_personne_vuln%C3%A9rable",
    "139": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Soins_palliatifs_pluridisciplinaires_chez_un_malade_en_phase_palliative_ou_terminale_d%27une_maladie_grave,_chronique_ou_l%C3%A9tale_(1)._Principaux_rep%C3%A8res_cliniques._Modalit%C3%A9s_d%27organisation_des_%C3%A9quipes,_en_%C3%A9tablissement_de_sant%C3%A9_et_en_et_en_...",
    "140": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Soins_palliatifs_pluridisciplinaires_chez_un_malade_en_phase_palliative_ou_terminale_d%27une_maladie_grave,_chronique_ou_l%C3%A9tale_(2)._Accompagnement_de_la_personne_malade_et_de_son_entourage._Principaux_rep%C3%A8res_%C3%A9thiques",
    "141": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Soins_palliatifs_pluridisciplinaires_chez_un_malade_en_phase_palliative_ou_terminale_d%27une_maladie_grave,_chronique_ou_l%C3%A9tale_(3)._La_s%C3%A9dation_pour_d%C3%A9tresse_en_phase_terminale_et_dans_des_situations_sp%C3%A9cifiques_et_complexes_en_fin_de_vie_...",
    "142": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_aspects_sp%C3%A9cifiques_des_soins_palliatifs_en_p%C3%A9diatrie",
    "143": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_aspects_sp%C3%A9cifiques_des_soins_palliatifs_en_r%C3%A9animation",
    "144": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Deuil_normal_et_pathologique",
    "145": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Surveillance_des_maladies_infectieuses_transmissibles",
    "146": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Vaccinations",
    "147": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Fi%C3%A8vre_aigu%C3%AB_chez_l%27enfant_et_l%27adulte",
    "148": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_naso-sinusiennes_de_l%27adulte_et_de_l%27enfant",
    "149": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Angines_de_l%27adulte_et_de_l%27enfant",
    "150": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Otites_infectieuses_de_l%27adulte_et_de_l%27enfant",
    "151": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:M%C3%A9ningites,_m%C3%A9ningoenc%C3%A9phalites,_abc%C3%A8s_c%C3%A9r%C3%A9bral_chez_l%27adulte_et_l%27enfant",
    "152": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Endocardite_infectieuse",
    "153": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Surveillance_des_porteurs_de_proth%C3%A8ses_valvulaires",
    "154": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_broncho_pulmonaires_communautaires_de_l%27adulte_et_de_l%27enfant",
    "155": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_cutan%C3%A9o-muqueuses_et_des_phan%C3%A8res,_bact%C3%A9riennes_et_mycosiques_de_l%27adulte_et_de_l%27enfant",
    "156": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_ost%C3%A9o_articulaires_(IOA)_de_l%27enfant_et_de_l%27adulte",
    "157": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Bact%C3%A9ri%C3%A9mie/Fong%C3%A9mie_de_l%27adulte_et_de_l%27enfant",
    "158": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Sepsis_et_choc_septique_de_l%27enfant_et_de_l%27adulte",
    "159": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tuberculose_de_l%27adulte_et_de_l%27enfant",
    "160": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:T%C3%A9tanos",
    "161": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_urinaires_de_l%27enfant_et_de_l%27adulte",
    "162": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_sexuellement_transmissibles_(IST)_:_gonococcies,_chlamydioses,_syphilis,_papillomavirus_humain_(HPV),_trichomonose",
    "163": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Coqueluche",
    "164": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Exanth%C3%A8mes_f%C3%A9briles_de_l%27enfant",
    "165": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Oreillons",
    "166": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Grippe",
    "167": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9patites_virales",
    "168": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_%C3%A0_herp%C3%A8s_virus_du_sujet_immunocomp%C3%A9tent",
    "169": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infections_%C3%A0_VIH",
    "170": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Paludisme",
    "171": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Gale_et_p%C3%A9diculose",
    "172": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Parasitoses_digestives_:_giardiose,_amoebose,_t%C3%A9niasis,_ascaridiose,_oxyurose,_anguillulose,_cryptosporidiose",
    "173": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Zoonoses",
    "174": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pathologie_infectieuse_chez_les_migrants_adultes_et_enfants",
    "175": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Voyage_en_pays_tropical_de_l%27adulte_et_de_l%27enfant_:_conseils_avant_le_d%C3%A9part,_pathologies_du_retour_:_fi%C3%A8vre,_diarrh%C3%A9e,_manifestations_cutan%C3%A9es",
    "176": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diarrh%C3%A9es_infectieuses_de_l%27adulte_et_de_l%27enfant",
    "177": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prescription_et_surveillance_des_anti-infectieux_chez_l%27adulte_et_l%27enfant_(voir_item_330)",
    "178": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Risques_%C3%A9mergents,_bioterrorisme,_maladies_hautement_transmissibles",
    "179": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Risques_sanitaires_li%C3%A9s_%C3%A0_l%27eau_et_%C3%A0_l%27alimentation._Toxi-infections_alimentaires",
    "180": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Risques_sanitaires_li%C3%A9s_aux_irradiations._Radioprotection",
    "181": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_s%C3%A9curit%C3%A9_sanitaire_des_produits_destin%C3%A9s_%C3%A0_l%27homme._La_veille_sanitaire_(voir_item_325)",
    "182": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Environnement_professionnel_et_sant%C3%A9_au_travail",
    "183": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Organisation_de_la_m%C3%A9decine_du_travail._Pr%C3%A9vention_des_risques_professionnels",
    "184": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Accidents_du_travail_et_maladies_professionnelles_:_d%C3%A9finition_et_enjeux",
    "185": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:R%C3%A9action_inflammatoire_:_aspects_biologiques_et_cliniques._Conduite_%C3%A0_tenir",
    "186": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypersensibilit%C3%A9s_et_allergies_chez_l%27enfant_et_l%27adulte_:_aspects_physiopathologiques,_%C3%A9pid%C3%A9miologiques,_diagnostiques_et_principes_de_traitement",
    "187": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypersensibilit%C3%A9s_et_allergies_cutan%C3%A9omuqueuses_chez_l%27enfant_et_l%27adulte._Urticaire,_dermatites_atopique_et_de_contact",
    "188": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypersensibilit%C3%A9_et_allergies_respiratoires_chez_l%27enfant_et_chez_l%27adulte._Asthme,_rhinite",
    "189": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:D%C3%A9ficit_immunitaire",
    "190": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Fi%C3%A8vre_prolong%C3%A9e",
    "191": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Fi%C3%A8vre_chez_un_patient_immunod%C3%A9prim%C3%A9",
    "192": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pathologies_auto-immunes_:_aspects_%C3%A9pid%C3%A9miologiques,_diagnostiques_et_principes_de_traitement",
    "193": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_principaux_types_de_vascularite_syst%C3%A9mique,_les_organes_cibles,_les_outils_diagnostiques_et_les_moyens_th%C3%A9rapeutiques",
    "194": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Lupus_syst%C3%A9mique_(LS)._Syndrome_des_anti-phospholipides_(SAPL)",
    "195": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Art%C3%A9rite_%C3%A0_cellules_g%C3%A9antes",
    "196": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Polyarthrite_rhumato%C3%AFde",
    "197": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Spondyloarthrite",
    "198": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Arthropathies_microcristallines",
    "199": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Syndrome_douloureux_r%C3%A9gional_complexe_(ex_algodystrophie)",
    "200": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Douleur_et_%C3%A9panchement_articulaire._Arthrite_d%27%C3%A9volution_r%C3%A9cente",
    "201": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Transplantation_d%27organes_:_aspects_%C3%A9pid%C3%A9miologiques_et_immunologiques_;_principes_de_traitement_et_surveillance_;_complications_et_pronostic_;_aspects_%C3%A9thiques_et_l%C3%A9gaux._Pr%C3%A9l%C3%A8vements_d%27organes_et_l%C3%A9gislation",
    "202": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Bioth%C3%A9rapies_et_th%C3%A9rapies_cibl%C3%A9es",
    "203": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Dyspn%C3%A9e_aigu%C3%AB_et_chronique",
    "204": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Toux_chez_l%27enfant_et_chez_l%27adulte_(avec_le_traitement)",
    "205": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9moptysie",
    "206": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89panchement_pleural_liquidien",
    "207": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Opacit%C3%A9s_et_masses_intra-thoraciques_chez_l%27enfant_et_chez_l%27adulte",
    "208": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Insuffisance_respiratoire_chronique",
    "209": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Bronchopneumopathie_chronique_obstructive_chez_l%27adulte",
    "210": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pneumopathie_interstitielle_diffuse",
    "211": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Sarco%C3%AFdose",
    "212": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9mogramme_chez_l%27adulte_et_l%27enfant_:_indications_et_interpr%C3%A9tation",
    "213": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:An%C3%A9mie_chez_l%27adulte_et_l%27enfant",
    "214": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Thrombop%C3%A9nie_chez_l%27adulte_et_l%27enfant",
    "215": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Purpuras_chez_l%27adulte_et_l%27enfant",
    "216": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Syndrome_h%C3%A9morragique_d%27origine_h%C3%A9matologique",
    "217": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Syndrome_mononucl%C3%A9osique",
    "218": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89osinophilie",
    "219": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pathologie_du_fer_chez_l%27adulte_et_l%27enfant",
    "220": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ad%C3%A9nopathie_superficielle_de_l%27adulte_et_de_l%27enfant",
    "221": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ath%C3%A9rome_:_%C3%A9pid%C3%A9miologie_et_physiopathologie._Le_malade_poly-ath%C3%A9romateux",
    "222": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Facteurs_de_risque_cardio-vasculaire_et_pr%C3%A9vention",
    "223": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Dyslipid%C3%A9mies",
    "224": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypertension_art%C3%A9rielle_de_l%27adulte_et_de_l%27enfant",
    "225": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Art%C3%A9riopathie_de_l%27aorte,_des_art%C3%A8res_visc%C3%A9rales_et_des_membres_inf%C3%A9rieurs_;_an%C3%A9vrysmes",
    "226": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Thrombose_veineuse_profonde_et_embolie_pulmonaire_(voir_item_330)",
    "227": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Insuffisance_veineuse_chronique._Varices",
    "228": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ulc%C3%A8re_de_jambe",
    "229": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Surveillance_et_complications_des_abords_veineux",
    "230": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Douleur_thoracique_aigu%C3%AB",
    "231": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89lectrocardiogramme_:_indications_et_interpr%C3%A9tations",
    "232": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Fibrillation_atriale",
    "233": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Valvulopathies",
    "234": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Insuffisance_cardiaque_de_l%27adulte",
    "235": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:P%C3%A9ricardite_aigu%C3%AB",
    "236": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_de_la_conduction_intracardiaque",
    "237": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Palpitations",
    "238": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Souffle_cardiaque_chez_l%27enfant",
    "239": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Acrosyndromes_(ph%C3%A9nom%C3%A8ne_de_Raynaud,_%C3%A9rythermalgie,_acrocyanose,_engelures,_isch%C3%A9mie_digitale)",
    "240": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypoglyc%C3%A9mie_chez_l%27adulte_et_l%27enfant",
    "241": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Goitre,_nodules_thyro%C3%AFdiens_et_cancers_thyro%C3%AFdiens",
    "242": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hyperthyro%C3%AFdie",
    "243": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypothyro%C3%AFdie",
    "244": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ad%C3%A9nome_hypophysaire",
    "245": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Insuffisance_surr%C3%A9nale_chez_l%27adulte_et_l%27enfant",
    "246": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Gyn%C3%A9comastie",
    "247": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diab%C3%A8te_sucr%C3%A9_de_type_1_et_2_de_l%27enfant_et_de_l%27adulte._Complications",
    "248": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pr%C3%A9vention_primaire_par_la_nutrition_chez_l%27adulte_et_l%27enfant",
    "249": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Modifications_th%C3%A9rapeutiques_du_mode_de_vie_(alimentation_et_activit%C3%A9_physique)_chez_l%27adulte_et_l%27enfant",
    "250": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:D%C3%A9nutrition_chez_l%27adulte_et_l%27enfant",
    "251": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Amaigrissement_%C3%A0_tous_les_%C3%A2ges",
    "252": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_nutritionnels_chez_le_sujet_%C3%A2g%C3%A9",
    "253": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ob%C3%A9sit%C3%A9_de_l%27enfant_et_de_l%27adulte_(voir_item_71)",
    "254": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Besoins_nutritionnels_de_la_femme_enceinte",
    "255": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diab%C3%A8te_gestationnel",
    "256": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Aptitude_au_sport_chez_l%27adulte_et_l%27enfant_;_besoins_nutritionnels_chez_le_sportif_(voir_item_80)",
    "257": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C5%92d%C3%A8mes_des_membres_inf%C3%A9rieurs_localis%C3%A9s_ou_g%C3%A9n%C3%A9ralis%C3%A9s",
    "258": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89l%C3%A9vation_de_la_cr%C3%A9atinin%C3%A9mie",
    "259": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prot%C3%A9inurie_et_syndrome_n%C3%A9phrotique_chez_l%27adulte_et_de_l%27enfant",
    "260": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9maturie",
    "261": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:N%C3%A9phropathie_glom%C3%A9rulaire",
    "262": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:N%C3%A9phropathies_interstitielles",
    "263": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:N%C3%A9phropathies_vasculaires",
    "264": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Insuffisance_r%C3%A9nale_chronique_chez_l%27adulte_et_l%27enfant",
    "265": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Lithiase_urinaire",
    "266": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Polykystose_r%C3%A9nale",
    "267": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Troubles_de_l%27%C3%A9quilibre_acido-basique_et_d%C3%A9sordres_hydro-%C3%A9lectrolytiques",
    "268": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hypercalc%C3%A9mie",
    "269": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Douleurs_abdominales_aigu%C3%ABs_chez_l%27enfant_et_chez_l%27adulte",
    "270": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Douleurs_lombaires_aigu%C3%ABs",
    "271": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Reflux_gastro-%C5%93sophagien_chez_le_nourrisson,_chez_l%27enfant_et_chez_l%27adulte._Hernie_hiatale",
    "272": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ulc%C3%A8re_gastrique_et_duod%C3%A9nal._Gastrite",
    "273": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Dysphagie",
    "274": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Vomissements_du_nourrisson,_de_l%27enfant_et_de_l%27adulte",
    "275": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Spl%C3%A9nom%C3%A9galie",
    "276": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9patom%C3%A9galie_et_masse_abdominale",
    "277": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Lithiase_biliaire_et_complications",
    "278": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ict%C3%A8re_de_l%27adulte_et_de_l%27enfant",
    "279": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Cirrhose_et_complications",
    "280": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Ascite",
    "281": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pancr%C3%A9atite_chronique",
    "282": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Maladies_inflammatoires_chroniques_de_l%27intestin_(MICI)_chez_l%27adulte",
    "283": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Constipation_chez_l%27enfant_et_l%27adulte",
    "284": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Colopathie_fonctionnelle",
    "285": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diarrh%C3%A9e_chronique_chez_l%27adulte_et_l%27enfant",
    "286": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diarrh%C3%A9e_aigu%C3%AB_et_d%C3%A9shydratation_chez_le_nourrisson,_l%27enfant_et_l%27adulte",
    "287": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diverticulose_colique_et_diverticulite_aigu%C3%AB_du_sigmo%C3%AFde",
    "288": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pathologie_h%C3%A9morro%C3%AFdaire",
    "289": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Hernie_pari%C3%A9tale_chez_l%27enfant_et_l%27adulte",
    "290": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89pid%C3%A9miologie,_facteurs_de_risque,_pr%C3%A9vention_et_d%C3%A9pistage_des_cancers",
    "291": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Cancer_:_canc%C3%A9rog%C3%A9n%C3%A8se,_oncog%C3%A9n%C3%A9tique",
    "292": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Diagnostic_des_cancers_:_signes_d%27appel_et_investigations_para-cliniques_;_caract%C3%A9risation_du_stade_;_pronostic",
    "293": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Le_m%C3%A9decin_pr%C3%A9leveur_de_cellules_et/ou_de_tissus_pour_des_examens_d%27Anatomie_et_Cytologie_Pathologiques_:_conna%C3%AEtre_les_principes_de_r%C3%A9alisation,_transmission_et_utilisation_des_pr%C3%A9l%C3%A8vements_%C3%A0_vis%C3%A9e_sanitaire_et_de_recherche",
    "294": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Traitement_des_cancers_:_principales_modalit%C3%A9s,_classes_th%C3%A9rapeutiques_et_leurs_complications_majeures._La_d%C3%A9cision_th%C3%A9rapeutique_pluridisciplinaire_et_l%27information_du_malade",
    "295": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prise_en_charge_et_accompagnement_d%27un_malade_atteint_de_cancer_%C3%A0_tous_les_stades_de_la_maladie_dont_le_stade_de_soins_palliatifs_en_abordant_les_probl%C3%A9matiques_techniques,_relationnelles,_sociales_et_%C3%A9thiques",
    "296": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Agranulocytose_m%C3%A9dicamenteuse_:_conduite_%C3%A0_tenir",
    "297": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Cancer_de_l%27enfant_:_particularit%C3%A9s_%C3%A9pid%C3%A9miologiques,_diagnostiques_et_th%C3%A9rapeutiques",
    "298": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_de_la_cavit%C3%A9_buccale,_naso-sinusiennes_et_du_cavum,_et_des_voies_a%C3%A9rodigestives_sup%C3%A9rieures",
    "299": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_intracr%C3%A2niennes",
    "300": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_col_ut%C3%A9rin,_tumeur_du_corps_ut%C3%A9rin",
    "301": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_colon_et_du_rectum",
    "302": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_cutan%C3%A9es,_%C3%A9pith%C3%A9liales_et_m%C3%A9laniques",
    "303": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_de_l%27estomac",
    "304": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_foie,_primitives_et_secondaires",
    "305": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_de_l%27%C5%93sophage",
    "306": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_de_l%27ovaire",
    "307": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_des_os_primitives_et_secondaires",
    "308": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_pancr%C3%A9as",
    "309": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_poumon,_primitives_et_secondaires",
    "310": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_de_la_prostate",
    "311": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_rein_de_l%27adulte",
    "312": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_sein",
    "313": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_du_testicule",
    "314": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Tumeurs_v%C3%A9sicales",
    "315": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Leuc%C3%A9mies_aigu%C3%ABs",
    "316": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Syndromes_my%C3%A9lodysplasiques",
    "317": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Syndromes_my%C3%A9loprolif%C3%A9ratifs",
    "318": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Leuc%C3%A9mies_lympho%C3%AFdes_chroniques",
    "319": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Lymphomes_malins",
    "320": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:My%C3%A9lome_multiple_des_os",
    "321": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Principe_du_bon_usage_du_m%C3%A9dicament_et_des_th%C3%A9rapeutiques_non_m%C3%A9dicamenteuses",
    "322": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:La_d%C3%A9cision_th%C3%A9rapeutique_personnalis%C3%A9e_:_bon_usage_dans_des_situations_%C3%A0_risque",
    "323": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Analyser_et_utiliser_les_r%C3%A9sultats_des_%C3%A9tudes_cliniques_dans_la_perspective_du_bon_usage_-_analyse_critique,_recherche_clinique_et_niveaux_de_preuve_(voir_item_3)",
    "324": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89ducation_th%C3%A9rapeutique,_observance_et_autom%C3%A9dication",
    "325": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Identification_et_gestion_des_risques_li%C3%A9s_aux_m%C3%A9dicaments_et_aux_biomat%C3%A9riaux,_risque_iatrog%C3%A8ne,_erreur_m%C3%A9dicamenteuse_(voir_items_4_et_5)",
    "326": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Cadre_r%C3%A9glementaire_de_la_prescription_th%C3%A9rapeutique_et_recommandations_pour_le_bon_usage",
    "327": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Principes_de_la_m%C3%A9decine_int%C3%A9grative,_utilit%C3%A9_et_risques_des_interventions_non_m%C3%A9dicamenteuses_et_des_th%C3%A9rapies_compl%C3%A9mentaires",
    "328": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Th%C3%A9rapeutiques_non_m%C3%A9dicamenteuses_et_dispositifs_m%C3%A9dicaux",
    "329": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Conna%C3%AEtre_les_caract%C3%A9ristiques_des_produits_sanguins_labiles_(PSL)_et_leur_sp%C3%A9cificit%C3%A9",
    "330": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prescription_et_surveillance_des_classes_de_m%C3%A9dicaments_les_plus_courantes_chez_l%27adulte_et_chez_l%27enfant,_hors_anti-infectieux_(voir_item_177)._Conna%C3%AEtre_le_bon_usage_des_principales_classes_th%C3%A9rapeutiques",
    "331": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Arr%C3%AAt_cardio-circulatoire",
    "332": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89tat_de_choc._Principales_%C3%A9tiologies_:_hypovol%C3%A9mique,_septique_(voir_item_158),_cardio-g%C3%A9nique,_anaphylactique",
    "333": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Situations_exceptionnelles",
    "334": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prise_en_charge_imm%C3%A9diate_pr%C3%A9-hospitali%C3%A8re_et_%C3%A0_l%27arriv%C3%A9e_%C3%A0_l%27h%C3%B4pital,_%C3%A9valuation_des_complications_chez_:_un_br%C3%BBl%C3%A9,_un_polytraumatis%C3%A9,_un_traumatis%C3%A9_thoracique,_un_traumatis%C3%A9_abdominal,_un_traumatis%C3%A9_des_membres_et/ou_du_...",
    "335": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Orientation_diagnostique_et_conduite_%C3%A0_tenir_devant_un_traumatisme_cr%C3%A2nio-facial_et_oculaire",
    "336": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Coma_non_traumatique_chez_l%27adulte_et_chez_l%27enfant",
    "337": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Principales_intoxications_aigu%C3%ABs",
    "338": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C5%92d%C3%A8me_de_Quincke_et_anaphylaxie",
    "339": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Syndromes_coronariens_aigus",
    "340": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Accidents_vasculaires_c%C3%A9r%C3%A9braux",
    "341": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9morragie_m%C3%A9ning%C3%A9e",
    "342": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Malaise,_perte_de_connaissance,_crise_comitiale_chez_l%27adulte_(voir_item_105)",
    "343": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:%C3%89tat_confusionnel_et_trouble_de_conscience_chez_l%27adulte_et_chez_l%27enfant",
    "344": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Prise_en_charge_d%27une_patiente_atteinte_de_pr%C3%A9-%C3%A9clampsie",
    "345": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Malaise_grave_du_nourrisson_et_mort_inattendue_du_nourrisson",
    "346": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Convulsions_chez_le_nourrisson_et_chez_l%27enfant",
    "347": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:R%C3%A9tention_aigu%C3%AB_d%27urine",
    "348": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Insuffisance_r%C3%A9nale_aigu%C3%AB_-_Anurie",
    "349": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Infection_aigu%C3%AB_des_parties_molles_(abc%C3%A8s,_panaris,_phlegmon_des_gaines)",
    "350": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Grosse_jambe_rouge_aigu%C3%AB",
    "351": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Agitation_et_d%C3%A9lire_aigu",
    "352": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Crise_d%27angoisse_aigu%C3%AB_et_attaque_de_panique",
    "353": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Risque_et_conduite_suicidaires_chez_l%27enfant,_l%27adolescent_et_l%27adulte_:_identification_et_prise_en_charge",
    "354": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Syndrome_occlusif_de_l%27enfant_et_de_l%27adulte",
    "355": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:H%C3%A9morragie_digestive",
    "356": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Appendicite_de_l%27enfant_et_de_l%27adulte",
    "357": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:P%C3%A9ritonite_aigu%C3%AB_chez_l%27enfant_et_chez_l%27adulte",
    "358": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pancr%C3%A9atite_aigu%C3%AB",
    "359": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:D%C3%A9tresse_et_insuffisance_respiratoire_aig%C3%BCe_du_nourrisson,_de_l%27enfant_et_de_l%27adulte",
    "360": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Pneumothorax",
    "361": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:L%C3%A9sions_p%C3%A9ri-articulaires_et_ligamentaires_du_genou,_de_la_cheville_et_de_l%27%C3%A9paule",
    "362": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Proth%C3%A8ses_et_ost%C3%A9osynth%C3%A8ses",
    "363": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Fractures_fr%C3%A9quentes_de_l%27adulte_et_du_sujet_%C3%A2g%C3%A9",
    "364": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Fractures_chez_l%27enfant_:_particularit%C3%A9s_%C3%A9pid%C3%A9miologiques,_diagnostiques_et_th%C3%A9rapeutiques",
    "365": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Surveillance_d%27un_malade_sous_pl%C3%A2tre/r%C3%A9sine",
    "366": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Exposition_accidentelle_aux_liquides_biologiques_:_conduite_%C3%A0_tenir",
    "367": "https://livret.uness.fr/lisa/2026/Fiche_LiSA:Impact_de_l%27environnement_sur_la_sant%C3%A9"
};



const SPECIALTY_CONFIG = {
    'cardiologie': { color: '#ef4444', icon: 'fa-heart-pulse' },
    'hge': { color: '#f97316', icon: 'fa-poop' },
    'pneumologie': { color: '#3b82f6', icon: 'fa-lungs' },
    'gynecologie': { color: '#ec4899', icon: 'fa-venus' },
    'orl': { color: '#8b5cf6', icon: 'fa-ear-listen' },
    'neurologie': { color: '#6366f1', icon: 'fa-brain' },
    'psychiatrie': { color: '#a855f7', icon: 'fa-masks-theater' },
    'osteo': { color: '#14b8a6', icon: 'fa-bone' },
    'pediatrie': { color: '#f472b6', icon: 'fa-baby' },
    'hematologie': { color: '#dc2626', icon: 'fa-droplet' },
    'endocrinologie': { color: '#eab308', icon: 'fa-dna' },
    'mir': { color: '#ef4444', icon: 'fa-truck-medical' },
    'nephrologie': { color: '#0ea5e9', icon: 'fa-filter' },
    'infectiologie': { color: '#22c55e', icon: 'fa-virus' },
    'dermatologie': { color: '#f59e0b', icon: 'fa-hand-dots' },
    'therapeutique': { color: '#6366f1', icon: 'fa-pills' },
    'geriatrie': { color: '#78716c', icon: 'fa-wheelchair' },
    'douleur': { color: '#a855f7', icon: 'fa-hand-holding-medical' },
    'medecine-interne': { color: '#0d9488', icon: 'fa-stethoscope' },
    'oncologie': { color: '#be123c', icon: 'fa-disease' },
    'ophtalmologie': { color: '#0284c7', icon: 'fa-eye' },
    'urologie': { color: '#ca8a04', icon: 'fa-mars' },
    'medecine-legale': { color: '#475569', icon: 'fa-scale-balanced' },
    'sante-publique': { color: '#059669', icon: 'fa-chart-pie' }
};

const SPECIALTIES_DATA=[
{"id":"cardiologie","name":"Cardiologie - Chir Vasc.","items":[
{"fc":"FC01","num":"113","name":"Hémangiomes et malformations vasculaires cutanées"},
{"fc":"FC02","num":"153","name":"Surveillance des porteurs de valves cardiaques"},
{"fc":"FC03","num":"221","name":"Athérome et patient polyathéromateux"},
{"fc":"FC04","num":"222","name":"Facteurs de risque cardiovasculaires et prévention"},
{"fc":"FC05","num":"224","name":"Hypertension artérielle"},
{"fc":"FC06","num":"230","name":"Douleur thoracique"},
{"fc":"FC07","num":"231","name":"Électrocardiogramme"},
{"fc":"FC08","num":"232","name":"Fibrillation atriale"},
{"fc":"FC09","num":"233","name":"Valvulopathies"},
{"fc":"FC10","num":"227","name":"Insuffisance veineuse chronique"},
{"fc":"FC11","num":"235","name":"Péricardite aiguë"},
{"fc":"FC12","num":"236","name":"Troubles de la conduction"},
{"fc":"FC13","num":"237","name":"Palpitations et troubles du rythme"},
{"fc":"FC14","num":"342","name":"Malaise et perte de connaissance"},
{"fc":"FC15","num":"339","name":"Angor chronique stable et syndrome coronarien aigu"},
{"fc":"FC16","num":"225","name":"Artériopathies aorte et membres inférieurs"},
{"fc":"FC17","num":"223","name":"Dyslipidémies"},
{"fc":"FC18","num":"234","name":"Insuffisance cardiaque"},
{"fc":"FC19","num":"238","name":"Souffle cardiaque de l’enfant"},
{"fc":"FC20","num":"331","name":"Arrêt cardiocirculatoire"},
{"fc":"FC21","num":"226","name":"Thrombose veineuse profonde et embolie pulmonaire"},
{"fc":"FC22","num":"330","name":"Antiagrégants plaquettaires et anticoagulants (ITEM 330 LISA UNIQUE)"},
{"fc":"FC23","num":"152","name":"Endocardite infectieuse"},
{"fc":"FC24","num":"228","name":"Ulcère de jambe"},
{"fc":"FC25","num":"239","name":"Acrosyndromes"}
]},

{"id":"hge","name":"HGE - Chir Dig.","items":[
{"fc":"FC01","num":"167","name":"Hépatites virales"},
{"fc":"FC02","num":"219","name":"Pathologies du fer"},
{"fc":"FC03","num":"269","name":"Douleurs abdominales aiguës"},
{"fc":"FC04","num":"271","name":"Reflux gastro-œsophagien et hernie hiatale"},
{"fc":"FC05","num":"272","name":"Ulcère gastrique et duodénal"},
{"fc":"FC06","num":"273","name":"Dysphagie oro-pharyngée"},
{"fc":"FC07","num":"274","name":"Vomissements de l’adulte"},
{"fc":"FC08","num":"276","name":"Hépatomégalie"},
{"fc":"FC09","num":"277","name":"Lithiase biliaire"},
{"fc":"FC10","num":"278","name":"Ictère de l’adulte"},
{"fc":"FC11","num":"279","name":"Cirrhose"},
{"fc":"FC12","num":"280","name":"Ascite"},
{"fc":"FC13","num":"281","name":"Pancréatite chronique"},
{"fc":"FC14","num":"282","name":"Maladies inflammatoires chroniques de l’intestin"},
{"fc":"FC15","num":"283","name":"Constipation"},
{"fc":"FC16","num":"284","name":"Colopathie fonctionnelle"},
{"fc":"FC17","num":"285","name":"Diarrhée chronique"},
{"fc":"FC18","num":"286","name":"Diarrhée aiguë"},
{"fc":"FC19","num":"287","name":"Diverticulose colique"},
{"fc":"FC20","num":"288","name":"Pathologie hémorroïdaire"},
{"fc":"FC21","num":"301","name":"Tumeurs colorectales"},
{"fc":"FC22","num":"303","name":"Tumeurs de l’estomac"},
{"fc":"FC23","num":"304","name":"Tumeurs du foie"},
{"fc":"FC24","num":"305","name":"Tumeurs de l’œsophage"},
{"fc":"FC25","num":"308","name":"Tumeurs du pancréas"},
{"fc":"FC26","num":"355","name":"Hémorragie digestive"},
{"fc":"FC27","num":"358","name":"Pancréatite aiguë"},
{"fc":"FC28","num":"354","name":"Syndrome occlusif"},
{"fc":"FC29","num":"356","name":"Appendicite aiguë"},
{"fc":"FC30","num":"357","name":"Péritonite aiguë"},
{"fc":"FC31","num":"201","name":"Transplantation hépatique"},
{"fc":"FC32","num":"289","name":"Hernies pariétales"}
]},

{"id":"pneumologie","name":"Pneumologie","items":[
{"fc":"FC01","num":"186","name":"Hypersensibilités et allergies respiratoires"},
{"fc":"FC02","num":"188","name":"Asthme et rhinite"},
{"fc":"FC03","num":"209","name":"Bronchopneumopathie chronique obstructive"},
{"fc":"FC04","num":"204","name":"Toux chez l’adulte"},
{"fc":"FC05","num":"226","name":"Thrombose veineuse profonde et embolie pulmonaire"},
{"fc":"FC06","num":"203","name":"Dyspnée aiguë et chronique"},
{"fc":"FC07","num":"360","name":"Pneumothorax"},
{"fc":"FC08","num":"159","name":"Tuberculose de l’adulte"},
{"fc":"FC09","num":"206","name":"Épanchement pleural liquidien"},
{"fc":"FC10","num":"211","name":"Sarcoïdose"},
{"fc":"FC11","num":"210","name":"Pneumopathies interstitielles diffuses"},
{"fc":"FC12","num":"208","name":"Insuffisance respiratoire chronique"},
{"fc":"FC13","num":"75","name":"Addiction au tabac"},
{"fc":"FC14","num":"110","name":"Troubles du sommeil de l’enfant et de l’adulte"},
{"fc":"FC15","num":"207","name":"Opacités et masses intrathoraciques"},
{"fc":"FC16","num":"309","name":"Tumeurs du poumon primitives et secondaires"},
{"fc":"FC17","num":"338","name":"Œdème de Quincke et anaphylaxie"},
{"fc":"FC18","num":"154","name":"Infections broncho-pulmonaires communautaires de l’adulte"},
{"fc":"FC19","num":"359","name":"Détresse respiratoire et corps étrangers des voies aériennes (ITEM 359 LISA UNIQUE)"},
{"fc":"FC20","num":"155","name":"Infections broncho-pulmonaires"},
{"fc":"FC21","num":"205","name":"Hémoptysie"},
{"fc":"FC22","num":"359","name":"Détresse respiratoire (ITEM 359 LISA UNIQUE)"}
]},


{"id":"gynecologie","name":"Gynéco - Obs","items":[
{"fc":"FC01","num":"12","name":"Violences sexuelles"},
{"fc":"FC02","num":"23","name":"Grossesse normale"},
{"fc":"FC03","num":"25","name":"Grossesse extra-utérine"},
{"fc":"FC04","num":"26","name":"Douleur abdominale aiguë chez la femme enceinte"},
{"fc":"FC05","num":"28","name":"Infection urinaire pendant la grossesse"},
{"fc":"FC06","num":"29","name":"Risques professionnels et maternité"},
{"fc":"FC07","num":"30","name":"Prématurité et retard de croissance intra-utérin"},
{"fc":"FC08","num":"31","name":"Accouchement, délivrance et suites de couches"},
{"fc":"FC09","num":"33","name":"Allaitement"},
{"fc":"FC10","num":"34","name":"Suites de couches pathologiques"},
{"fc":"FC11","num":"36","name":"Contraception"},
{"fc":"FC12","num":"37","name":"Interruption volontaire de grossesse"},
{"fc":"FC13","num":"39","name":"Assistance médicale à la procréation"},
{"fc":"FC14","num":"40","name":"Algies pelviennes chez la femme"},
{"fc":"FC15","num":"41","name":"Endométriose"},
{"fc":"FC16","num":"44","name":"Tuméfaction pelvienne chez la femme"},
{"fc":"FC17","num":"58","name":"Troubles de la sexualité chez la femme"},
{"fc":"FC18","num":"69","name":"Troubles psychiques pendant la grossesse et le post-partum"},
{"fc":"FC19","num":"124","name":"Ménopause"},
{"fc":"FC20","num":"162","name":"Infections génitales de la femme"},
{"fc":"FC21","num":"254","name":"Besoins nutritionnels pendant la grossesse"},
{"fc":"FC22","num":"255","name":"Diabète gestationnel"},
{"fc":"FC23","num":"344","name":"Prééclampsie"},
{"fc":"FC24","num":"43","name":"Hémorragies génitales et anomalies du cycle menstruel - (+ITEM 35 LISA)"},
{"fc":"FC25","num":"42","name":"Aménorrhée et anomalies du cycle menstruel - (+ITEM 35 LISA)"},
{"fc":"FC26","num":"49","name":"Puberté normale et pathologique"},
{"fc":"FC27","num":"38","name":"Infertilité du couple"},
{"fc":"FC28","num":"24","name":"Principales complications de la grossesse"},
{"fc":"FC29","num":"27","name":"Prévention des risques fœtaux : infections et médicaments"},
{"fc":"FC30","num":"27","name":"Prévention des risques fœtaux : toxiques et irradiations"},
{"fc":"FC31","num":"290","name":"Épidémiologie, facteurs de risque et prévention des cancers"},
{"fc":"FC32","num":"300","name":"Tumeurs du col et du corps utérin"},
{"fc":"FC33","num":"312","name":"Tumeurs du sein"},
{"fc":"FC34","num":"306","name":"Tumeurs de l’ovaire"}
]},

{"id":"orl","name":"ORL - CMF","items":[
{"fc":"FC01","num":"87","name":"Épistaxis"},
{"fc":"FC02","num":"88","name":"Trouble aigu de la parole et dysphonie"},
{"fc":"FC03","num":"90","name":"Pathologies des glandes salivaires"},
{"fc":"FC04","num":"99","name":"Migraine, névralgie V et algies de la face"},
{"fc":"FC05","num":"101","name":"Paralysie faciale périphérique"},
{"fc":"FC06","num":"103","name":"Vertiges et troubles de l’équilibre"},
{"fc":"FC07","num":"110","name":"Troubles du sommeil"},
{"fc":"FC08","num":"148","name":"Infections nasosinusiennes"},
{"fc":"FC09","num":"149","name":"Angines et rhinopharyngites"},
{"fc":"FC10","num":"150","name":"Otites infectieuses"},
{"fc":"FC11","num":"203","name":"Dyspnée laryngée aiguë et chronique"},
{"fc":"FC12","num":"220","name":"Adénopathie cervicale superficielle"},
{"fc":"FC13","num":"241","name":"Goitre, nodules et cancers thyroïdiens"},
{"fc":"FC14","num":"273","name":"Dysphagie"},
{"fc":"FC15","num":"298","name":"Tumeurs de la cavité buccale et ORL"},
{"fc":"FC16","num":"89","name":"Altération de la fonction auditive"},
{"fc":"FC17","num":"47","name":"Développement bucco-dentaire et anomalies"},
{"fc":"FC18","num":"335","name":"Traumatologie maxillo-faciale"},
{"fc":"FC19","num":"307","name":"Tumeurs des os de la face"},
{"fc":"FC20","num":"302","name":"Tumeurs cutanées épithéliales et mélaniques de la face"},
{"fc":"FC21","num":"113","name":"Malformations vasculaires et hémangiomes de la face"},
{"fc":"FC22","num":"155","name":"Cellulite faciale origine dentaire"},
{"fc":"FC23","num":"168","name":"Pathologies non tumorales de la muqueuse buccale"},
{"fc":"FC24","num":"148","name":"Corps étrangers ORL"}
]},

{"id":"neurologie","name":"Neurologie - Neurochir","items":[
{"fc":"FC01","num":"76","name":"Addiction à l’alcool et complications"},
{"fc":"FC02","num":"82","name":"Altération aiguë de la vision"},
{"fc":"FC03","num":"88","name":"Trouble aigu de la parole et dysphonie"},
{"fc":"FC04","num":"91","name":"Déficit neurologique récent"},
{"fc":"FC05","num":"92","name":"Déficit moteur et sensitif des membres"},
{"fc":"FC06","num":"93","name":"Compression médullaire non traumatique et syndrome de la queue de cheval"},
{"fc":"FC07","num":"98","name":"Myasthénie"},
{"fc":"FC08","num":"99","name":"Migraine, névralgie du trijumeau et algies de la face"},
{"fc":"FC09","num":"100","name":"Céphalée aiguë et chronique"},
{"fc":"FC10","num":"101","name":"Paralysie faciale"},
{"fc":"FC11","num":"102","name":"Diplopie"},
{"fc":"FC12","num":"103","name":"Vertige"},
{"fc":"FC13","num":"104","name":"Sclérose en plaques"},
{"fc":"FC14","num":"105","name":"Épilepsies"},
{"fc":"FC15","num":"106","name":"Maladie de Parkinson"},
{"fc":"FC16","num":"107","name":"Mouvements anormaux"},
{"fc":"FC17","num":"108","name":"Confusion, troubles cognitifs et démence"},
{"fc":"FC18","num":"109","name":"Troubles marche et équilibre"},
{"fc":"FC19","num":"110","name":"Troubles du sommeil"},
{"fc":"FC20","num":"118","name":"Évaluation clinique et fonctionnelle d’un handicap cognitif"},
{"fc":"FC21","num":"134","name":"Bases neurophysiologiques de la douleur aiguë et chronique et traitements"},
{"fc":"FC22","num":"151","name":"Méningites et méningo-encéphalites"},
{"fc":"FC23","num":"168","name":"Infections à herpès virus et infections par le VIH"},
{"fc":"FC24","num":"299","name":"Tumeurs intracrâniennes"},
{"fc":"FC25","num":"336","name":"Comas non traumatiques"},
{"fc":"FC26","num":"340","name":"Accident vasculaire cérébral"},
{"fc":"FC27","num":"341","name":"Hémorragie méningée"},
{"fc":"FC28","num":"342","name":"Malaise, perte de connaissance et crise comitiale"},
{"fc":"FC29","num":"95","name":"Radiculalgies et syndromes canalaires, neuropathies périphériques aiguës et PRNV - (+ITEM 96 et 97 LISA)"}
]},

{"id":"psychiatrie","name":"Psychiatrie","items":[
{"fc":"FC01","num":"61","name":"Classification des troubles mentaux"},
{"fc":"FC02","num":"60","name":"Facteurs de risque, prévention et dépistage des troubles psychiques"},
{"fc":"FC03","num":"01","name":"Relation médecin-malade"},
{"fc":"FC04","num":"62","name":"Organisation de l’offre de soins en psychiatrie"},
{"fc":"FC05","num":"351","name":"Agitation et délire aigu"},
{"fc":"FC06","num":"352","name":"Crise d’angoisse aiguë et attaque de panique"},
{"fc":"FC07","num":"353","name":"Risque et conduites suicidaires"},
{"fc":"FC08","num":"59","name":"Sujets en situation de précarité"},
{"fc":"FC09","num":"69","name":"Troubles psychiques de la grossesse et du post-partum"},
{"fc":"FC10","num":"70","name":"Troubles psychiques du sujet âgé"},
{"fc":"FC11","num":"138","name":"Douleur chez la personne vulnérable"},
{"fc":"FC12","num":"144","name":"Deuil normal et pathologique"},
{"fc":"FC13","num":"63","name":"Troubles schizophréniques de l’adolescent et de l’adulte"},
{"fc":"FC14","num":"65","name":"Trouble délirant persistant"},
{"fc":"FC15","num":"64","name":"Troubles bipolaires de l’adolescent et de l’adulte"},
{"fc":"FC16","num":"72","name":"Troubles à symptomatologie somatique et apparentés"},
{"fc":"FC17","num":"58","name":"Sexualité normale et ses troubles"},
{"fc":"FC18","num":"110","name":"Troubles du sommeil de l’enfant et de l’adulte"},
{"fc":"FC19","num":"55","name":"Développement psychomoteur du nourrisson et de l’enfant"},
{"fc":"FC20","num":"67","name":"Principaux troubles du neurodéveloppement"},
{"fc":"FC21","num":"68","name":"Troubles du comportement de l’enfant et de l’adolescent"},
{"fc":"FC22","num":"71","name":"Troubles des conduites alimentaires chez l’adolescent et l’adulte"},
{"fc":"FC23","num":"75","name":"Addiction au tabac"},
{"fc":"FC24","num":"76","name":"Addiction à l’alcool"},
{"fc":"FC25","num":"77","name":"Addiction aux médicaments psychotropes"},
{"fc":"FC26","num":"78","name":"Addiction au cannabis, cocaïne, amphétamines, opiacés et drogues de synthèse"},
{"fc":"FC27","num":"79","name":"Addictions comportementales"},
{"fc":"FC28","num":"80","name":"Dopage et conduites dopantes"},
{"fc":"FC29","num":"15","name":"Soins psychiatriques sans consentement"},
{"fc":"FC30","num":"73","name":"Techniques psychothérapeutiques"},
{"fc":"FC31","num":"74","name":"Prescription et surveillance des psychotropes"},
{"fc":"FC32","num":"121","name":"Handicap psychique"},
{"fc":"FC33","num":"66","name":"Épisode dépressif caractérisé et trouble dépressif récurrent (ITEM 66 LISA UNIQUE)"},
{"fc":"FC34","num":"66","name":"Troubles anxieux et troubles de la personnalité (ITEM 66 LISA UNIQUE)"}
]},

{"id":"osteo","name":"Rhumato - Ortho","items":[
{"fc":"FC01","num":"47","name":"Dépistage des anomalies orthopédiques"},
{"fc":"FC02","num":"364","name":"Fractures chez enfant"},
{"fc":"FC03","num":"93","name":"Compression médullaire non traumatique et sd queue de cheval"},
{"fc":"FC04","num":"94","name":"Rachialgie"},
{"fc":"FC05","num":"95","name":"Radiculalgie et syndrome canalaire"},
{"fc":"FC06","num":"156","name":"Infections ostéo-articulaires adulte"},
{"fc":"FC07","num":"307","name":"Tumeurs des os primitives et secondaires"},
{"fc":"FC08","num":"334","name":"Prise en charge immédiate préhospitalière et intrahospitalière (ITEM 334 LISA UNIQUE)"},
{"fc":"FC09","num":"349","name":"Infection aiguë des parties molles"},
{"fc":"FC10","num":"361","name":"Lésions péri-articulaires et ligamentaires épaule (ITEM 361 LISA UNIQUE)"},
{"fc":"FC11","num":"361","name":"Lésions péri-articulaires et ligamentaires du genou (ITEM 361 LISA UNIQUE)"},
{"fc":"FC12","num":"361","name":"Lésions péri-articulaires et ligamentaires de la cheville (ITEM 361 LISA UNIQUE)"},
{"fc":"FC13","num":"362","name":"Prothèses et ostéosynthèses"},
{"fc":"FC14","num":"363","name":"Fractures extrémité proximale du fémur (ITEM 363 LISA UNIQUE)"},
{"fc":"FC15","num":"363","name":"Fractures extrémité inférieure du radius (ITEM 363 LISA UNIQUE)"},
{"fc":"FC16","num":"365","name":"Surveillance malade sous plâtre ou résine"},
{"fc":"FC17","num":"109","name":"Troubles marche et équilibre"},
{"fc":"FC18","num":"117","name":"Psoriasis"},
{"fc":"FC19","num":"128","name":"Ostéopathies fragilisantes"},
{"fc":"FC20","num":"129","name":"Arthrose"},
{"fc":"FC21","num":"134","name":"Douleur aiguë et douleur chronique"},
{"fc":"FC22","num":"135","name":"Thérapeutiques antalgiques"},
{"fc":"FC23","num":"185","name":"Réaction inflammatoire : aspects biologiques et cliniques"},
{"fc":"FC24","num":"192","name":"Pathologies auto-immunes"},
{"fc":"FC25","num":"193","name":"Vascularites systémiques"},
{"fc":"FC26","num":"194","name":"Lupus érythémateux systémique"},
{"fc":"FC27","num":"195","name":"Artérite à cellules géantes"},
{"fc":"FC28","num":"196","name":"Polyarthrite rhumatoïde"},
{"fc":"FC29","num":"197","name":"Spondyloarthrite"},
{"fc":"FC30","num":"198","name":"Arthropathies microcristallines"},
{"fc":"FC31","num":"199","name":"Syndrome douloureux régional complexe"},
{"fc":"FC32","num":"200","name":"Douleur et épanchement articulaire, arthrite récente"},
{"fc":"FC33","num":"202","name":"Biothérapies et thérapies ciblées"},
{"fc":"FC34","num":"211","name":"Sarcoïdose"},
{"fc":"FC35","num":"219","name":"Pathologie du fer"},
{"fc":"FC36","num":"256","name":"Aptitude au sport"},
{"fc":"FC37","num":"268","name":"Hypercalcémie"},
{"fc":"FC38","num":"320","name":"Myélome multiple"},
{"fc":"FC39","num":"330","name":"Corticoïdes et AINS"},
{"fc":"FC40","num":"361","name":"Lésions péri-articulaires et ligamentaires : épaule, genou et cheville (ITEM 361 LISA UNIQUE)"},
{"fc":"FC41","num":"334","name":"Brûlures (ITEM 334 LISA UNIQUE)"}
]},

{"id":"pediatrie","name":"Pédiatrie","items":[
{"fc":"FC01","num":"53","name":"Retard de croissance staturo-pondérale et hypothyroïdie"},
{"fc":"FC02","num":"49","name":"Puberté normale et pathologique"},
{"fc":"FC03","num":"55","name":"Développement psychomoteur du nourrisson et de l’enfant"},
{"fc":"FC04","num":"47","name":"Dépistages chez l’enfant - (+ITEM 52 et 89)"},
{"fc":"FC05","num":"47","name":"Suivi médical pédiatrique - (+ITEM 59 et 256)"},
{"fc":"FC06","num":"45","name":"Trisomie 21"},
{"fc":"FC07","num":"45","name":"Syndrome de l’X fragile"},
{"fc":"FC08","num":"48","name":"Alimentation et besoins nutritionnels du nourrisson et de l’enfant"},
{"fc":"FC09","num":"250","name":"Dénutrition chez l’adulte et l’enfant"},
{"fc":"FC10","num":"253","name":"Obésité de l’enfant et de l’adulte"},
{"fc":"FC11","num":"245","name":"Insuffisance surrénale"},
{"fc":"FC12","num":"247","name":"Diabète de type 1 et de type 2"},
{"fc":"FC13","num":"240","name":"Hypoglycémie chez l’adulte et l’enfant"},
{"fc":"FC14","num":"345","name":"Malaise grave et mort inattendue du nourrisson (ITEM 345 LISA UNIQUE)"},
{"fc":"FC15","num":"57","name":"Maltraitance et enfants en danger"},
{"fc":"FC16","num":"137","name":"Douleur chez l’enfant : évaluation et traitements"},
{"fc":"FC17","num":"269","name":"Douleurs abdominales et pelviennes"},
{"fc":"FC18","num":"274","name":"Vomissements et hémorragie digestive"},
{"fc":"FC19","num":"271","name":"Reflux gastro-œsophagien"},
{"fc":"FC20","num":"285","name":"Diarrhée chronique"},
{"fc":"FC21","num":"283","name":"Constipation"},
{"fc":"FC22","num":"50","name":"Pathologies inguino-scrotales et du pénis"},
{"fc":"FC23","num":"213","name":"Anémie et pathologies du fer"},
{"fc":"FC24","num":"189","name":"Déficits immunitaires héréditaires"},
{"fc":"FC25","num":"215","name":"Purpuras de l’adulte et de l’enfant"},
{"fc":"FC26","num":"220","name":"Adénopathie superficielle"},
{"fc":"FC27","num":"297","name":"Cancers de l’enfant et leucémies aiguës"},
{"fc":"FC28","num":"177","name":"Spécificités infectiologiques pédiatriques"},
{"fc":"FC29","num":"147","name":"Fièvre aiguë"},
{"fc":"FC30","num":"148","name":"Rhinopharyngite aiguë"},
{"fc":"FC31","num":"149","name":"Angines"},
{"fc":"FC32","num":"150","name":"Otites"},
{"fc":"FC33","num":"148","name":"Sinusites"},
{"fc":"FC34","num":"163","name":"Coqueluche"},
{"fc":"FC35","num":"286","name":"Diarrhée aiguë"},
{"fc":"FC36","num":"161","name":"Infections urinaires"},
{"fc":"FC37","num":"151","name":"Méningites et méningo-encéphalites"},
{"fc":"FC38","num":"164","name":"Éruptions fébriles"},
{"fc":"FC39","num":"155","name":"Infections cutanées bactériennes"},
{"fc":"FC40","num":"174","name":"Pathologies infectieuses du migrant et de l’enfant voyageur"},
{"fc":"FC41","num":"146","name":"Vaccinations"},
{"fc":"FC42","num":"71","name":"Troubles des conduites alimentaires de l’adolescent"},
{"fc":"FC43","num":"353","name":"Risque et conduites suicidaires chez l’enfant et l’adolescent"},
{"fc":"FC44","num":"32","name":"Prise en charge du nouveau-né"},
{"fc":"FC45","num":"278","name":"Ictère néonatal"},
{"fc":"FC46","num":"142","name":"Soins palliatifs en néonatalogie et deuil périnatal"},
{"fc":"FC47","num":"259","name":"Protéinurie, syndrome néphrotique et hématurie"},
{"fc":"FC48","num":"258","name":"Insuffisance rénale aiguë et maladie rénale chronique"},
{"fc":"FC49","num":"51","name":"Troubles mictionnels"},
{"fc":"FC50","num":"224","name":"Hypertension artérielle de l’enfant"},
{"fc":"FC51","num":"100","name":"Céphalée aiguë et chronique chez l’enfant"},
{"fc":"FC52","num":"346","name":"Convulsions et crises épileptiques"},
{"fc":"FC53","num":"56","name":"Handicap"},
{"fc":"FC54","num":"203","name":"Dyspnée et détresse respiratoire aiguë"},
{"fc":"FC55","num":"204","name":"Toux"},
{"fc":"FC56","num":"154","name":"Bronchiolite aiguë du nourrisson"},
{"fc":"FC57","num":"188","name":"Asthme"},
{"fc":"FC58","num":"186","name":"Hypersensibilités et allergies"},
{"fc":"FC59","num":"154","name":"Pneumonies aiguës communautaires"},
{"fc":"FC60","num":"207","name":"Opacités et masses intrathoraciques"},
{"fc":"FC61","num":"159","name":"Tuberculose"},
{"fc":"FC62","num":"110","name":"Troubles du sommeil et SAOS"},
{"fc":"FC63","num":"45","name":"Mucoviscidose chez l’enfant"},
{"fc":"FC64","num":"238","name":"Souffle cardiaque"},
{"fc":"FC65","num":"331","name":"Arrêt cardiorespiratoire"},
{"fc":"FC66","num":"345","name":"Malaise grave du nourrisson (ITEM 345 LISA UNIQUE)"},
{"fc":"FC67","num":"157","name":"Septicémie, bactériémie, fongémie et choc septique"},
{"fc":"FC68","num":"343","name":"État confusionnel et troubles de la conscience"},
{"fc":"FC69","num":"337","name":"Intoxications aiguës"},
{"fc":"FC70","num":"54","name":"Boiteries et infections ostéo-articulaires"},
{"fc":"FC71","num":"364","name":"Traumatismes"}
]},


{"id":"hematologie","name":"Hématologie","items":[
{"fc":"FC01","num":"212","name":"Hémogramme chez l’adulte et l’enfant : indications"},
{"fc":"FC02","num":"213","name":"Anémie chez l’adulte et l’enfant"},
{"fc":"FC03","num":"315","name":"Leucémies aiguës"},
{"fc":"FC04","num":"316","name":"Syndromes myélodysplasiques"},
{"fc":"FC05","num":"296","name":"Agranulocytose médicamenteuse"},
{"fc":"FC06","num":"318","name":"Leucémie lymphoïde chronique"},
{"fc":"FC07","num":"320","name":"Myélome multiple"},
{"fc":"FC08","num":"220","name":"Adénopathie superficielle de l’adulte et de l’enfant"},
{"fc":"FC09","num":"318","name":"Lymphomes malins"},
{"fc":"FC10","num":"217","name":"Syndrome mononucléosique"},
{"fc":"FC11","num":"275","name":"Splénomégalie"},
{"fc":"FC12","num":"218","name":"Éosinophilie"},
{"fc":"FC13","num":"214","name":"Thrombopénie chez l’adulte et l’enfant"},
{"fc":"FC14","num":"215","name":"Purpuras chez l’adulte et l’enfant"},
{"fc":"FC15","num":"202","name":"Biothérapies et thérapies ciblées"},
{"fc":"FC16","num":"216","name":"Hémostase : physiologie et exploration en pratique courante (ITEM 216 LISA UNIQUE)"},
{"fc":"FC17","num":"216","name":"Syndrome hémorragique d’origine hématologique (ITEM 216 LISA UNIQUE)"},
{"fc":"FC18","num":"226","name":"Thrombose veineuse profonde et embolie pulmonaire"},
{"fc":"FC19","num":"330","name":"Prescription et surveillance du traitement antithrombotique et accidents des anticoagulants"},
{"fc":"FC20","num":"329","name":"Produits sanguins labiles : caractéristiques et spécificités"},
{"fc":"FC21","num":"317","name":"Syndromes myéloprolifératifs"}
]},

{"id":"endocrinologie","name":"Endoc - Nutrition","items":[
{"fc":"FC01","num":"36","name":"Contraception"},
{"fc":"FC02","num":"38","name":"Infertilité du couple : première consultation"},
{"fc":"FC03","num":"42","name":"Aménorrhée"},
{"fc":"FC04","num":"50","name":"Pathologie génito-scrotale : cryptorchidie"},
{"fc":"FC05","num":"124","name":"Ménopause et andropause"},
{"fc":"FC06","num":"126","name":"Trouble de l’érection"},
{"fc":"FC07","num":"128","name":"Ostéopathies fragilisantes"},
{"fc":"FC08","num":"219","name":"Pathologie du fer (hémochromatose)"},
{"fc":"FC09","num":"223","name":"Dyslipidémies"},
{"fc":"FC10","num":"224","name":"HTA de l’adulte (causes endocriniennes)"},
{"fc":"FC11","num":"240","name":"Hypoglycémie chez l’adulte et l’enfant"},
{"fc":"FC12","num":"241","name":"Goitre, nodules et cancers thyroïdiens"},
{"fc":"FC13","num":"242","name":"Hyperthyroïdie"},
{"fc":"FC14","num":"243","name":"Hypothyroïdie"},
{"fc":"FC15","num":"244","name":"Adénome hypophysaire"},
{"fc":"FC16","num":"245","name":"Insuffisance surrénale chez l’adulte et l’enfant"},
{"fc":"FC17","num":"246","name":"Gynécomastie"},
{"fc":"FC18","num":"247","name":"Diabète de type 1, type 2 et complications"},
{"fc":"FC19","num":"253","name":"Obésité enfant et adulte"},
{"fc":"FC20","num":"255","name":"Diabète gestationnel"},
{"fc":"FC21","num":"267","name":"Désordres hydroélectrolytiques"},
{"fc":"FC22","num":"268","name":"Hypercalcémie"},
{"fc":"FC23","num":"308","name":"Tumeurs neuroendocrines du pancréas"},
{"fc":"FC24","num":"248","name":"Prévention primaire par la nutrition"},
{"fc":"FC25","num":"249","name":"Modifications thérapeutiques du mode de vie"},
{"fc":"FC26","num":"256","name":"Aptitude au sport et nutrition du sportif"},
{"fc":"FC27","num":"254","name":"Besoins nutritionnels et grossesse"},
{"fc":"FC28","num":"33","name":"Allaitement maternel"},
{"fc":"FC29","num":"251","name":"Amaigrissement à tous les âges"},
{"fc":"FC30","num":"250","name":"Dénutrition adulte et enfant"},
{"fc":"FC31","num":"252","name":"Troubles nutritionnels du sujet âgé"},
{"fc":"FC32","num":"71","name":"Troubles des conduites alimentaires adolescent et adulte"}
]},

{"id":"mir","name":"MIR - Anesthésie","items":[
{"fc":"FC01","num":"143","name":"Aspects spécifiques des soins palliatifs en réanimation"},
{"fc":"FC02","num":"05","name":"Aléa thérapeutique"},
{"fc":"FC03","num":"359","name":"Oxygénothérapie"},
{"fc":"FC04","num":"229","name":"Surveillance et complications des abords veineux"},
{"fc":"FC99","num":"136","name":"Anesthésie locale, locorégionale et générale"},
{"fc":"FC05","num":"135","name":"Thérapeutiques antalgiques médicamenteuses et non médicamenteuses"},
{"fc":"FC06","num":"329","name":"Transfusion sanguine"},
{"fc":"FC07","num":"201","name":"Transplantation d’organes"},
{"fc":"FC08","num":"332","name":"État de choc : principales étiologies"},
{"fc":"FC09","num":"158","name":"Sepsis et choc septique de l’enfant et de l’adulte"},
{"fc":"FC10","num":"234","name":"Choc cardiogénique"},
{"fc":"FC11","num":"331","name":"Arrêt cardiocirculatoire de l’adulte et de l’enfant"},
{"fc":"FC12","num":"226","name":"Thrombose veineuse profonde et embolie pulmonaire"},
{"fc":"FC13","num":"234","name":"Insuffisance cardiaque de l’adulte"},
{"fc":"FC14","num":"224","name":"Urgences hypertensives et HTA maligne"},
{"fc":"FC15","num":"339","name":"Syndromes coronariens aigus"},
{"fc":"FC16","num":"332","name":"Choc hémorragique"},
{"fc":"FC17","num":"338","name":"Anaphylaxie et œdème de Quincke"},
{"fc":"FC18","num":"359","name":"PaO2, PaCO2 et insuffisance respiratoire aiguë de l’adulte"},
{"fc":"FC19","num":"209","name":"Insuffisance respiratoire aiguë du patient BPCO"},
{"fc":"FC20","num":"188","name":"Exacerbation sévère d’asthme"},
{"fc":"FC21","num":"154","name":"Pneumonie aiguë communautaire grave"},
{"fc":"FC22","num":"205","name":"Hémoptysie"},
{"fc":"FC23","num":"206","name":"Épanchements pleuraux liquidiens et pneumothorax"},
{"fc":"FC24","num":"336","name":"Coma non traumatique de l’adulte"},
{"fc":"FC25","num":"105","name":"Convulsions et état de mal épileptique"},
{"fc":"FC26","num":"340","name":"Accidents vasculaires cérébraux"},
{"fc":"FC27","num":"341","name":"Hémorragie sous-arachnoïdienne"},
{"fc":"FC28","num":"97","name":"Paralysies extensives"},
{"fc":"FC29","num":"348","name":"Insuffisance rénale aiguë de l’adulte"},
{"fc":"FC30","num":"267","name":"Gaz du sang et troubles de l’équilibre acidobasique (ITEM 267 LISA UNIQUE)"},
{"fc":"FC31","num":"267","name":"Étiologie des anomalies gazométriques métaboliques (ITEM 267 LISA UNIQUE)"},
{"fc":"FC32","num":"267","name":"Désordres hydroélectrolytiques : dysnatrémies (ITEM 267 LISA UNIQUE)"},
{"fc":"FC33","num":"267","name":"Désordres hydroélectrolytiques : dyskaliémies (ITEM 267 LISA UNIQUE)"},
{"fc":"FC34","num":"268","name":"Hypercalcémie aiguë sévère"},
{"fc":"FC35","num":"247","name":"Acidocétose diabétique et état hyperosmolaire"},
{"fc":"FC36","num":"245","name":"Insuffisance surrénalienne aiguë"},
{"fc":"FC37","num":"177","name":"Antibiothérapie d’urgence"},
{"fc":"FC38","num":"04","name":"Hygiène et infections nosocomiales"},
{"fc":"FC39","num":"191","name":"Fièvre chez l’immunodéprimé"},
{"fc":"FC40","num":"155","name":"Infections cutanéomuqueuses sévères"},
{"fc":"FC41","num":"151","name":"Infections neuroméningées"},
{"fc":"FC42","num":"151","name":"Purpura fulminans"},
{"fc":"FC43","num":"161","name":"Sepsis urinaire grave"},
{"fc":"FC44","num":"152","name":"Endocardite infectieuse"},
{"fc":"FC45","num":"170","name":"Paludisme grave"},
{"fc":"FC46","num":"355","name":"Hémorragie digestive"},
{"fc":"FC47","num":"358","name":"Pancréatite aiguë"},
{"fc":"FC48","num":"167","name":"Insuffisance hépatique aiguë"},
{"fc":"FC49","num":"279","name":"Décompensation de cirrhose"},
{"fc":"FC50","num":"333","name":"Situations sanitaires exceptionnelles et afflux de victimes"},
{"fc":"FC51","num":"337","name":"Intoxications aiguës"},
{"fc":"FC52","num":"334","name":"Traumatismes sévères (ITEM 334 LISA UNIQUE)"},
{"fc":"FC53","num":"334","name":"Brûlures (ITEM 334 LISA UNIQUE)"},
{"fc":"FC54","num":"997","name":"Hypothermie et hyperthermie"},
{"fc":"FC55","num":"344","name":"Complications graves de la grossesse : pré-éclampsie"},
{"fc":"FC56","num":"330","name":"Accidents hémorragiques des anticoagulants"},
{"fc":"FC57","num":"214","name":"Thrombopénie en soins critiques"},
{"fc":"FC58","num":"997","name":"Solutés d’hydratation et de remplissage vasculaire"}
]},

{"id":"nephrologie","name":"Néphrologie","items":[
{"fc":"FC01","num":"267","name":"Hyponatrémie et hypernatrémie"},
{"fc":"FC02","num":"267","name":"Anomalies du bilan potassium"},
{"fc":"FC03","num":"330","name":"Diurétiques"},
{"fc":"FC04","num":"267","name":"Désordres de l’équilibre acido-basique"},
{"fc":"FC05","num":"268","name":"Hypocalcémie et hypercalcémie"},
{"fc":"FC06","num":"260","name":"Hématurie"},
{"fc":"FC07","num":"259","name":"Protéinurie et syndrome néphrotique"},
{"fc":"FC08","num":"257","name":"Syndromes œdémateux"},
{"fc":"FC09","num":"261","name":"Néphropathies glomérulaires"},
{"fc":"FC10","num":"247","name":"Néphropathies diabétiques"},
{"fc":"FC11","num":"193","name":"Rein et maladies systémiques"},
{"fc":"FC12","num":"258","name":"Élévation de la créatininémie"},
{"fc":"FC13","num":"348","name":"Insuffisance rénale aiguë et anurie"},
{"fc":"FC14","num":"264","name":"Insuffisance rénale chronique de l’adulte et de l’enfant"},
{"fc":"FC15","num":"320","name":"Atteintes rénales du myélome"},
{"fc":"FC16","num":"266","name":"Polykystose rénale"},
{"fc":"FC17","num":"263","name":"Néphropathies vasculaires"},
{"fc":"FC18","num":"224","name":"Hypertension artérielle de l’adulte et de l’enfant"},
{"fc":"FC19","num":"23","name":"Grossesse normale et complications vasculo-rénales"},
{"fc":"FC20","num":"161","name":"Infections urinaires de l’adulte et de l’enfant"},
{"fc":"FC21","num":"265","name":"Lithiases urinaires"},
{"fc":"FC22","num":"262","name":"Néphropathies interstitielles chroniques"},
{"fc":"FC23","num":"201","name":"Transplantation d’organes"}
]},

{"id":"infectiologie","name":"Infectiologie","items":[
{"fc":"FC01","num":"04","name":"Sécurité du patient et gestion des risques"},
{"fc":"FC02","num":"27","name":"Prévention des risques fœtaux"},
{"fc":"FC03","num":"145","name":"Surveillance des maladies infectieuses transmissibles"},
{"fc":"FC04","num":"146","name":"Vaccinations"},
{"fc":"FC05","num":"147","name":"Fièvre aiguë chez l’enfant et l’adulte"},
{"fc":"FC06","num":"148","name":"Infections naso-sinusiennes de l’adulte et de l’enfant"},
{"fc":"FC07","num":"149","name":"Angines de l’adulte et de l’enfant et rhinopharyngites de l’enfant"},
{"fc":"FC08","num":"150","name":"Otites infectieuses de l’adulte et de l’enfant"},
{"fc":"FC09","num":"151","name":"Méningites, méningo-encéphalites et abcès cérébral de l’adulte et de l’enfant"},
{"fc":"FC10","num":"152","name":"Endocardite infectieuse"},
{"fc":"FC11","num":"153","name":"Surveillance des porteurs de valve et de prothèses vasculaires"},
{"fc":"FC12","num":"154","name":"Infections broncho-pulmonaires communautaires de l’adulte et de l’enfant"},
{"fc":"FC13","num":"155","name":"Infections cutanéo-muqueuses et des phanères bactériennes et mycosiques"},
{"fc":"FC14","num":"156","name":"Infections ostéo-articulaires de l’adulte et de l’enfant"},
{"fc":"FC15","num":"157","name":"Septicémie, bactériémie et fongémie de l’adulte et de l’enfant"},
{"fc":"FC16","num":"159","name":"Tuberculose de l’adulte et de l’enfant"},
{"fc":"FC17","num":"160","name":"Tétanos"},
{"fc":"FC18","num":"161","name":"Infections urinaires de l’adulte et au cours de la grossesse"},
{"fc":"FC19","num":"162","name":"Infections sexuellement transmissibles"},
{"fc":"FC20","num":"163","name":"Coqueluche"},
{"fc":"FC21","num":"165","name":"Oreillons"},
{"fc":"FC22","num":"166","name":"Grippe"},
{"fc":"FC23","num":"167","name":"Hépatites virales"},
{"fc":"FC24","num":"168","name":"Infections à herpès virus du sujet immunocompétent"},
{"fc":"FC25","num":"169","name":"Infections à VIH"},
{"fc":"FC26","num":"170","name":"Paludisme"},
{"fc":"FC27","num":"171","name":"Gale et pédiculose"},
{"fc":"FC28","num":"172","name":"Parasitoses digestives"},
{"fc":"FC29","num":"173","name":"Zoonoses"},
{"fc":"FC30","num":"174","name":"Pathologie infectieuse chez les migrants adultes et enfants"},
{"fc":"FC31","num":"175","name":"Voyage en pays tropical"},
{"fc":"FC32","num":"176","name":"Diarrhées infectieuses de l’adulte et de l’enfant"},
{"fc":"FC33","num":"177","name":"Prescription et surveillance des anti-infectieux chez l’adulte et l’enfant"},
{"fc":"FC34","num":"178","name":"Risques émergents et maladies hautement transmissibles"},
{"fc":"FC35","num":"190","name":"Fièvre prolongée"},
{"fc":"FC36","num":"191","name":"Fièvre chez un patient immunodéprimé"},
{"fc":"FC37","num":"215","name":"Purpuras chez l’adulte et l’enfant"},
{"fc":"FC38","num":"217","name":"Syndrome mononucléosique"},
{"fc":"FC39","num":"218","name":"Éosinophilie"},
{"fc":"FC40","num":"220","name":"Adénopathie superficielle de l’adulte et de l’enfant"},
{"fc":"FC41","num":"357","name":"Péritonite aiguë chez l’enfant et l’adulte"},
{"fc":"FC42","num":"366","name":"Exposition accidentelle aux liquides biologiques"},
{"fc":"FC43","num":"362","name":"Prothèses et ostéosynthèse"}
]},

{"id":"dermatologie","name":"Dermatologie","items":[
{"fc":"FC01","num":"111","name":"Dermatoses faciales : acné, rosacée, dermatite séborrhéique"},
{"fc":"FC02","num":"112","name":"Dermatoses bulleuses auto-immunes"},
{"fc":"FC03","num":"113","name":"Hémangiomes et malformations vasculaires cutanées"},
{"fc":"FC04","num":"114","name":"Exanthème et érythrodermie de l’enfant et de l’adulte"},
{"fc":"FC05","num":"115","name":"Toxidermies"},
{"fc":"FC06","num":"116","name":"Prurit"},
{"fc":"FC07","num":"117","name":"Psoriasis"},
{"fc":"FC08","num":"155","name":"Infections cutanéo-muqueuses bactériennes et mycosiques"},
{"fc":"FC09","num":"162","name":"Infections sexuellement transmissibles"},
{"fc":"FC10","num":"168","name":"Infections à herpès virus du sujet immunocompétent"},
{"fc":"FC11","num":"169","name":"Infection à VIH : manifestations cutanéo-muqueuses de la primo-infection"},
{"fc":"FC12","num":"171","name":"Ectoparasitoses cutanées : gale et pédiculose"},
{"fc":"FC13","num":"187","name":"Hypersensibilités et allergies cutanéo-muqueuses chez l’enfant"},
{"fc":"FC14","num":"194","name":"Lupus érythémateux disséminé"},
{"fc":"FC15","num":"201","name":"Transplantation d’organes : complications cutanées"},
{"fc":"FC16","num":"211","name":"Sarcoïdose : aspects dermatologiques"},
{"fc":"FC17","num":"215","name":"Purpura chez l’adulte et l’enfant"},
{"fc":"FC18","num":"228","name":"Ulcère de jambe"},
{"fc":"FC19","num":"239","name":"Acrosyndromes"},
{"fc":"FC20","num":"302","name":"Tumeurs cutanées épithéliales et mélaniques"},
{"fc":"FC21","num":"319","name":"Lymphomes malins cutanés"},
{"fc":"FC22","num":"330","name":"Anti-inflammatoires : aspects dermatologiques"},
{"fc":"FC23","num":"350","name":"Grosse jambe rouge aiguë"},
{"fc":"FC24","num":"998","name":"Troubles des phanères"},
{"fc":"FC25","num":"998","name":"Lésions élémentaires et secondaires sur peaux noires"}
]},

{"id":"therapeutique","name":"Thérapeutique","items":[
{"fc":"FC01","num":"321","name":"Choix et décision thérapeutique"},
{"fc":"FC02","num":"322","name":"Décision thérapeutique personnalisée"},
{"fc":"FC03","num":"324","name":"Éducation thérapeutique, observance et automédication"},
{"fc":"FC04","num":"325","name":"Identification et gestion des risques liés aux médicaments et biomatériaux"},
{"fc":"FC05","num":"326","name":"Cadre réglementaire de la prescription thérapeutique et bon usage"},
{"fc":"FC06","num":"327","name":"Thérapeutiques non médicamenteuses et dispositifs médicaux"},
{"fc":"FC07","num":"329","name":"Transfusion sanguine et produits dérivés du sang"},
{"fc":"FC08","num":"330","name":"Antibiotiques, antiviraux, antifongiques et antiparasitaires (ITEM 330 LISA UNIQUE)"},
{"fc":"FC09","num":"330","name":"Anti-inflammatoires (ITEM 330 LISA UNIQUE)"},
{"fc":"FC10","num":"330","name":"Antihypertenseurs (ITEM 330 LISA UNIQUE)"},
{"fc":"FC11","num":"330","name":"Antithrombotiques (ITEM 330 LISA UNIQUE)"},
{"fc":"FC12","num":"330","name":"Diurétiques (ITEM 330 LISA UNIQUE)"},
{"fc":"FC13","num":"330","name":"Psychotropes (ITEM 330 LISA UNIQUE)"},
{"fc":"FC14","num":"330","name":"Hypolipémiants (ITEM 330 LISA UNIQUE)"},
{"fc":"FC15","num":"330","name":"Médicaments du diabète (ITEM 330 LISA UNIQUE)"},
{"fc":"FC16","num":"330","name":"Antalgiques (ITEM 330 LISA UNIQUE)"},
{"fc":"FC17","num":"330","name":"Contraceptifs (ITEM 330 LISA UNIQUE)"},
{"fc":"FC18","num":"330","name":"Traitement hormonal de la ménopause (ITEM 330 LISA UNIQUE)"},
{"fc":"FC19","num":"330","name":"Traitement des troubles sexuels chez l’homme (ITEM 330 LISA UNIQUE)"},
{"fc":"FC20","num":"330","name":"Anticancéreux (ITEM 330 LISA UNIQUE)"},
{"fc":"FC21","num":"323","name":"Analyser et utiliser les résultats des études cliniques"}
]},

{"id":"geriatrie","name":"Gériatrie - MPR","items":[
{"fc":"FC01","num":"123","name":"Vieillissement normal"},
{"fc":"FC02","num":"130","name":"La personne âgée malade : particularités sémiologiques, psychologiques et thérapeutiques"},
{"fc":"FC03","num":"133","name":"Autonomie et dépendance chez la personne âgée"},
{"fc":"FC04","num":"09","name":"Introduction à l’éthique médicale"},
{"fc":"FC05","num":"81","name":"Altération chronique de la vision et de la fonction auditive"},
{"fc":"FC06","num":"128","name":"Ostéopathies fragilisantes"},
{"fc":"FC07","num":"129","name":"Arthrose"},
{"fc":"FC08","num":"134","name":"Bases neurophysiologiques et mécanismes de la douleur aiguë et chronique"},
{"fc":"FC09","num":"132","name":"Raisonner devant une plainte mnésique et un trouble neurocognitif"},
{"fc":"FC10","num":"70","name":"Raisonner devant une plainte thymique et une dépression"},
{"fc":"FC11","num":"108","name":"Diagnostiquer et raisonner devant un syndrome confusionnel"},
{"fc":"FC12","num":"109","name":"Raisonner devant une chute et démarche diagnostique et thérapeutique"},
{"fc":"FC13","num":"120","name":"Prévenir et prendre en charge un syndrome d’immobilisation (ITEM 120 LISA UNIQUE)"},
{"fc":"FC14","num":"252","name":"Troubles nutritionnels chez le sujet âgé"},
{"fc":"FC15","num":"125","name":"Raisonner sur les troubles vésico-sphinctériens"},
{"fc":"FC16","num":"322","name":"Apprendre à prescrire chez le patient âgé"},
{"fc":"FC17","num":"139","name":"Prendre une décision de soins palliatifs et accompagner le patient"},
{"fc":"FC18","num":"09","name":"Éthique médicale et protection juridique"},
{"fc":"FC19","num":"21","name":"Santé des populations"},
{"fc":"FC20","num":"56","name":"Enfant handicapé : orientation et prise en charge"},
{"fc":"FC21","num":"93","name":"Compression médullaire non traumatique et syndrome de la queue de cheval"},
{"fc":"FC22","num":"94","name":"Rachialgie"},
{"fc":"FC23","num":"104","name":"Sclérose en plaques"},
{"fc":"FC24","num":"106","name":"Maladie de Parkinson"},
{"fc":"FC25","num":"109","name":"Troubles de la marche et de l’équilibre"},
{"fc":"FC26","num":"118","name":"(+ITEM 119 LISA) - La personne handicapée"},
{"fc":"FC27","num":"120","name":"Complications hypomobilité et du décubitus (ITEM 120 LISA UNIQUE)"},
{"fc":"FC28","num":"122","name":"Principales techniques de rééducation et de réadaptation"},
{"fc":"FC29","num":"125","name":"Troubles de la miction et incontinence urinaire de l’adulte et du sujet âgé"},
{"fc":"FC30","num":"129","name":"Arthrose de hanche et de genou"},
{"fc":"FC31","num":"196","name":"Polyarthrite rhumatoïde"},
{"fc":"FC32","num":"197","name":"Spondylarthrite"},
{"fc":"FC33","num":"199","name":"Syndrome douloureux régional complexe"},
{"fc":"FC34","num":"249","name":"Modifications thérapeutiques du mode de vie"},
{"fc":"FC35","num":"256","name":"Aptitude au sport adulte et enfant"},
{"fc":"FC36","num":"328","name":"Thérapeutiques non médicamenteuses et dispositifs médicaux"},
{"fc":"FC37","num":"340","name":"Accidents vasculaires cérébraux"}
]},


{"id":"douleur","name":"Douleur - Soins pal","items":[
{"fc":"FC01","num":"134","name":"Définition et bases neurophysiologiques de la douleur (ITEM 134 LISA UNIQUE)"},
{"fc":"FC02","num":"134","name":"Reconnaître et évaluer une douleur aiguë et chronique (ITEM 134 LISA UNIQUE)"},
{"fc":"FC03","num":"134","name":"Douleurs par excès de nociception (ITEM 134 LISA UNIQUE)"},
{"fc":"FC04","num":"134","name":"Douleurs neuropathiques (ITEM 134 LISA UNIQUE)"},
{"fc":"FC05","num":"134","name":"Douleurs du cancer (ITEM 134 LISA UNIQUE)"},
{"fc":"FC06","num":"134","name":"Douleur de la personne âgée (ITEM 134 LISA UNIQUE)"},
{"fc":"FC07","num":"137","name":"Douleur chez l’enfant"},
{"fc":"FC08","num":"138","name":"Douleur chez la personne vulnérable"},
{"fc":"FC09","num":"135","name":"Traitements de la douleur par paliers (ITEM 135 LISA UNIQUE)"},
{"fc":"FC10","num":"135","name":"Autres traitements de la douleur (ITEM 135 LISA UNIQUE)"},
{"fc":"FC11","num":"99","name":"Céphalées, migraines, algies vasculaires et névralgies faciales"},
{"fc":"FC12","num":"199","name":"Syndrome douloureux régional complexe"},
{"fc":"FC13","num":"94","name":"Lombalgies et radiculalgies chroniques"},
{"fc":"FC14","num":"72","name":"Fibromyalgie"},
{"fc":"FC15","num":"139","name":"Soins palliatifs : repères cliniques et organisation"},
{"fc":"FC16","num":"140","name":"Soins palliatifs : accompagnement de la personne malade et de l’entourage"},
{"fc":"FC17","num":"141","name":"Soins palliatifs : sédation pour détresse en phase terminale"},
{"fc":"FC18","num":"143","name":"Soins palliatifs en réanimation"}
]},


{"id":"medecine-interne","name":"Méd Interne - Immuno","items":[
{"fc":"FC01","num":"01","name":"La relation médecin-malade"},
{"fc":"FC02","num":"02","name":"Valeurs professionnelles du médecin et des autres professions de santé"},
{"fc":"FC03","num":"03","name":"Raisonnement et décision en médecine"},
{"fc":"FC04","num":"22","name":"Maladies rares"},
{"fc":"FC05","num":"59","name":"Sujets en situation de précarité"},
{"fc":"FC06","num":"72","name":"Troubles à symptomatologie somatique"},
{"fc":"FC07","num":"152","name":"Endocardite infectieuse"},
{"fc":"FC08","num":"185","name":"Réaction inflammatoire"},
{"fc":"FC09","num":"189","name":"Déficit immunitaire"},
{"fc":"FC10","num":"190","name":"Fièvre prolongée"},
{"fc":"FC11","num":"191","name":"Fièvre chez un patient immunodéprimé"},
{"fc":"FC12","num":"192","name":"Pathologies auto-immunes"},
{"fc":"FC13","num":"193","name":"Vascularites systémiques"},
{"fc":"FC14","num":"194","name":"Lupus systémique et syndrome des anticorps antiphospholipides"},
{"fc":"FC15","num":"195","name":"Artérite à cellules géantes et maladies apparentées"},
{"fc":"FC26","num":"201","name":"Greffe d’organe"},
{"fc":"FC16","num":"202","name":"Biothérapies et thérapies ciblées"},
{"fc":"FC17","num":"210","name":"Pneumopathies interstitielles diffuses"},
{"fc":"FC18","num":"211","name":"Sarcoïdose"},
{"fc":"FC19","num":"213","name":"Anémie chez l’adulte et l’enfant"},
{"fc":"FC20","num":"214","name":"Thrombopénie chez l’adulte et l’enfant"},
{"fc":"FC21","num":"215","name":"Purpura chez l’adulte et l’enfant"},
{"fc":"FC22","num":"217","name":"Syndrome mononucléosique"},
{"fc":"FC23","num":"218","name":"Éosinophilie"},
{"fc":"FC24","num":"219","name":"Pathologies du fer"},
{"fc":"FC25","num":"220","name":"Adénopathie superficielle de l’enfant et de l’adulte"},
{"fc":"FC37","num":"224","name":"Hypertension artérielle de l'adulte"},
{"fc":"FC27","num":"226","name":"Thrombose veineuse et embolie pulmonaire"},
{"fc":"FC28","num":"239","name":"Acrosyndromes"},
{"fc":"FC29","num":"251","name":"Amaigrissement à tous les âges"},
{"fc":"FC30","num":"257","name":"Œdèmes des membres inférieurs"},
{"fc":"FC31","num":"268","name":"Hypercalcémie"},
{"fc":"FC32","num":"275","name":"Splénomégalie"},
{"fc":"FC33","num":"324","name":"Éducation thérapeutique et observance"},
{"fc":"FC35","num":"45","name":"Spécificités des maladies génétiques"},
{"fc":"FC36","num":"46","name":"Médecine génomique"},
{"fc":"FC34","num":"330","name":"Anti-inflammatoires et corticoïdes"}
]},

{"id":"oncologie","name":"Onco - Anapath","items":[
{"fc":"FC01","num":"290","name":"Épidémiologie, facteurs de risque, prévention et dépistage des cancers"},
{"fc":"FC02","num":"291","name":"Cancérogenèse et oncogénétique"},
{"fc":"FC03","num":"292","name":"Diagnostic des cancers, signes d’appel et investigations paracliniques"},
{"fc":"FC04","num":"293","name":"Médecin préleveur de cellules et de tissus pour examens anatomopathologiques"},
{"fc":"FC05","num":"294","name":"Traitement des cancers"},
{"fc":"FC06","num":"295","name":"Prise en charge et accompagnement d’un patient atteint de cancer"},
{"fc":"FC07","num":"297","name":"Cancers de l’enfant"},
{"fc":"FC08","num":"298","name":"Tumeurs de la cavité buccale, naso-sinusiennes et des voies aérodigestives supérieures"},
{"fc":"FC09","num":"299","name":"Tumeurs intracrâniennes"},
{"fc":"FC10","num":"300","name":"Tumeurs du col utérin et du corps utérin"},
{"fc":"FC11","num":"301","name":"Tumeurs du côlon et du rectum"},
{"fc":"FC12","num":"302","name":"Tumeurs cutanées épithéliales et mélaniques"},
{"fc":"FC13","num":"303","name":"Tumeurs de l’estomac"},
{"fc":"FC14","num":"304","name":"Tumeurs du foie primitives et secondaires"},
{"fc":"FC15","num":"305","name":"Tumeurs de l’œsophage"},
{"fc":"FC16","num":"306","name":"Tumeurs de l’ovaire"},
{"fc":"FC17","num":"307","name":"Tumeurs osseuses primitives et secondaires"},
{"fc":"FC18","num":"308","name":"Tumeurs du pancréas"},
{"fc":"FC19","num":"309","name":"Tumeurs du poumon primitives et secondaires"},
{"fc":"FC20","num":"310","name":"Tumeurs de la prostate"},
{"fc":"FC21","num":"311","name":"Tumeurs du rein"},
{"fc":"FC22","num":"312","name":"Tumeurs du sein"},
{"fc":"FC23","num":"313","name":"Tumeurs du testicule"},
{"fc":"FC24","num":"314","name":"Tumeurs vésicales"},
{"fc":"FC27","num":"999","name":"Pathologie digestive"},
{"fc":"FC28","num":"999","name":"Pathologie gynécologique"},
{"fc":"FC29","num":"999","name":"Pathologie urologique"},
{"fc":"FC30","num":"999","name":"Néphrologie"},
{"fc":"FC31","num":"999","name":"Pathologie thoracique et pneumologique"},
{"fc":"FC32","num":"999","name":"Tête et cou"},
{"fc":"FC33","num":"999","name":"Dermatologie"},
{"fc":"FC34","num":"999","name":"Hématologie"},
{"fc":"FC35","num":"999","name":"Cancérologie"}
]},

{"id":"ophtalmologie","name":"Ophtalmologie","items":[{"fc":"FC01","num":"85","name":"Troubles de la réfraction"},
{"fc":"FC02","num":"47","name":"Suivi d’un nourrisson"},
{"fc":"FC03","num":"52","name":"Strabisme et amblyopie de l’enfant"},
{"fc":"FC04","num":"102","name":"Diplopie"},
{"fc":"FC05","num":"83","name":"Infections et inflammations oculaires"},
{"fc":"FC06","num":"81","name":"Altération chronique de la vision (ITEM 81 LISA UNIQUE)"},
{"fc":"FC07","num":"82","name":"Altération aiguë de la vision (ITEM 82 LISA UNIQUE)"},
{"fc":"FC08","num":"201","name":"Prélèvement de cornée à but thérapeutique et greffe de cornée"},
{"fc":"FC09","num":"355","name":"Traumatismes et brûlures oculaires"},
{"fc":"FC10","num":"81","name":"Cataracte (ITEM 81 LISA UNIQUE)"},
{"fc":"FC11","num":"84","name":"Glaucomes"},
{"fc":"FC12","num":"81","name":"Dégénérescence maculaire liée à l’âge (ITEM 81 LISA UNIQUE)"},
{"fc":"FC13","num":"82","name":"Occlusions artérielles rétiniennes (ITEM 82 LISA UNIQUE)"},
{"fc":"FC14","num":"82","name":"Occlusions veineuses rétiniennes (ITEM 82 LISA UNIQUE)"},
{"fc":"FC15","num":"86","name":"Pathologie des paupières"},
{"fc":"FC16","num":"104","name":"Œil et sclérose en plaques"},
{"fc":"FC17","num":"82","name":"Neuropathie optique ischémique antérieure (ITEM 82 LISA UNIQUE)"},
{"fc":"FC18","num":"247","name":"Rétinopathie diabétique"},
{"fc":"FC19","num":"242","name":"Orbitopathie dysthyroïdienne"},
{"fc":"FC20","num":"224","name":"Rétinopathie hypertensive"},
{"fc":"FC21","num":"996","name":"Sémiologie en ophtalmologie"}]},

{"id":"urologie","name":"Urologie","items":[{"fc":"FC01","num":"125","name":"Troubles de la miction et incontinence urinaire"},
{"fc":"FC02","num":"126","name":"Troubles de l’érection"},
{"fc":"FC03","num":"127","name":"Hypertrophie bénigne de la prostate"},
{"fc":"FC04","num":"260","name":"Hématurie"},
{"fc":"FC05","num":"265","name":"Lithiase urinaire"},
{"fc":"FC06","num":"310","name":"Tumeurs de la prostate"},
{"fc":"FC07","num":"311","name":"Tumeurs du rein de l’adulte"},
{"fc":"FC08","num":"313","name":"Tumeurs du testicule"},
{"fc":"FC09","num":"314","name":"Tumeurs vésicales"},
{"fc":"FC10","num":"347","name":"Rétention aiguë d’urine"},
{"fc":"FC11","num":"36","name":"Contraception masculine"},
{"fc":"FC12","num":"38","name":"Stérilité du couple : première consultation"},
{"fc":"FC13","num":"161","name":"Infections urinaires de l’adulte et de l’enfant"},
{"fc":"FC14","num":"124","name":"Andropause"},
{"fc":"FC15","num":"44","name":"Tuméfaction pelvienne chez la femme"},
{"fc":"FC16","num":"58","name":"Sexualité normale et troubles sexuels"},
{"fc":"FC17","num":"50","name":"Pathologie génitoscrotale chez le garçon et l’homme"},
{"fc":"FC18","num":"201","name":"Transplantation d’organes"},
{"fc":"FC19","num":"348","name":"Insuffisance rénale aiguë – anurie"},
{"fc":"FC20","num":"40","name":"Algies pelviennes chez la femme : syndrome de la douleur vésicale"}]},

{"id":"medecine-legale","name":"MT - Médecine légale","items":[{"fc":"FC01","num":"05","name":"Responsabilités médicales pénale, civile, administrative et disciplinaire"},
{"fc":"FC02","num":"07","name":"Droits individuels et collectifs du patient"},
{"fc":"FC03","num":"09","name":"Introduction à l’éthique médicale"},
{"fc":"FC04","num":"11","name":"Violence et santé"},
{"fc":"FC05","num":"12","name":"Violences sexuelles"},
{"fc":"FC06","num":"13","name":"Certificats médicaux, décès et législation"},
{"fc":"FC07","num":"14","name":"La mort"},
{"fc":"FC08","num":"57","name":"Maltraitance et enfants en danger, protection maternelle et infantile"},
{"fc":"FC09","num":"29","name":"Grossesse et travail"},
{"fc":"FC10","num":"180","name":"Risques sanitaires liés aux irradiations, radioprotection"},
{"fc":"FC11","num":"182","name":"Environnement professionnel et santé au travail"},
{"fc":"FC12","num":"183","name":"Missions et fonctionnement des services de santé au travail"},
{"fc":"FC13","num":"184","name":"Accidents du travail et maladies professionnelles"},
{"fc":"FC14","num":"290","name":"Cancers"},
{"fc":"FC15","num":"367","name":"Impact de l’environnement sur la santé"}]},

{"id":"sante-publique","name":"Santé publique","items":[{"fc":"FC01","num":"03","name":"Le raisonnement et la décision en médecine"},
{"fc":"FC02","num":"04","name":"Infections associées aux soins"},
{"fc":"FC03","num":"04","name":"Qualité et sécurité des soins"},
{"fc":"FC04","num":"05","name":"Responsabilité médicale pénale, civile, administrative et disciplinaire"},
{"fc":"FC05","num":"06","name":"Organisation de l’exercice clinique et sécurisation du parcours du patient"},
{"fc":"FC06","num":"08","name":"Discriminations et santé"},
{"fc":"FC07","num":"16","name":"Organisation du système de soins et sa régulation"},
{"fc":"FC08","num":"17","name":"Télémédecine, télésanté et téléservices en santé"},
{"fc":"FC09","num":"18","name":"Santé numérique"},
{"fc":"FC10","num":"19","name":"Protection sociale, consommation médicale et économie de la santé"},
{"fc":"FC11","num":"20","name":"Méthode de la recherche en santé"},
{"fc":"FC12","num":"21","name":"Mesure de l’état de santé de la population"},
{"fc":"FC13","num":"59","name":"Sujets en situation de précarité"},
{"fc":"FC14","num":"75","name":"Addiction au tabac"},
{"fc":"FC15","num":"76","name":"Addiction à l’alcool"},
{"fc":"FC16","num":"77","name":"Addiction aux médicaments psychotropes"},
{"fc":"FC17","num":"78","name":"Addiction au cannabis, cocaïne, amphétamines, opiacés et drogues de synthèse"},
{"fc":"FC18","num":"79","name":"Addictions comportementales"},
{"fc":"FC19","num":"145","name":"Surveillance des maladies infectieuses transmissibles"},
{"fc":"FC20","num":"146","name":"Vaccinations"},
{"fc":"FC21","num":"179","name":"Risques sanitaires liés à l’eau et à l’alimentation"},
{"fc":"FC22","num":"181","name":"Sécurité sanitaire des produits destinés à l’homme"},
{"fc":"FC23","num":"221","name":"Athérome : épidémiologie et physiopathologie"},
{"fc":"FC24","num":"222","name":"Facteurs de risque cardiovasculaire et prévention"},
{"fc":"FC25","num":"290","name":"Épidémiologie, facteurs de risque, prévention et dépistage des cancers"},
{"fc":"FC26","num":"297","name":"Cancer de l’enfant : particularités épidémiologiques"},
{"fc":"FC27","num":"323","name":"Analyse et utilisation des résultats des études cliniques"},
{"fc":"FC28","num":"325","name":"Gestion des risques liés aux médicaments et biomatériaux"},
{"fc":"FC29","num":"367","name":"Impact de l’environnement sur la santé"},
{"fc":"FC30","num":"07","name":"Droits des patients"}]}

];

const TOTAL_ITEMS = SPECIALTIES_DATA.reduce((sum, s) => sum + s.items.length, 0);
const MAX_TOURS = 8;

const loader = document.getElementById('loader');
const header = document.getElementById('header');
const mobileMenuBtn = document.getElementById('mobile-menu-btn');
const mobileMenu = document.getElementById('mobile-menu');
const themeToggle = document.getElementById('theme-toggle');
const themeIcon = themeToggle.querySelector('i');
const backToTop = document.getElementById('back-to-top');
const userAuth = document.getElementById('user-auth');
const userAvatar = document.getElementById('user-avatar');
const avatarInitials = document.getElementById('avatar-initials');
const profileDropdown = document.getElementById('profile-dropdown');
const profileName = document.getElementById('profile-name');
const profileEmail = document.getElementById('profile-email');
const logoutBtn = document.getElementById('logout-btn');
const loginRequired = document.getElementById('login-required');
const presentationSection = document.getElementById('presentation-section');  // ← AJOUTER CETTE LIGNE
const filterReference = document.getElementById('filter-item-reference')?.value || 'all';


const mainContent = document.getElementById('main-content');
const savingIndicator = document.getElementById('saving-indicator'); // Ancien (caché)
const saveIndicatorHeader = document.getElementById('save-indicator-header'); // Nouveau dans header
const confidenceModal = document.getElementById('confidence-modal');
const statItemsDone = document.getElementById('stat-items-done');
const statToursDone = document.getElementById('stat-tours-done');
const statSpecialtiesDone = document.getElementById('stat-specialties-done');
const progressItems = document.getElementById('progress-items');
const progressTours = document.getElementById('progress-tours');


const BACKUP_KEY_PREFIX = 'planning_backup_';
const MAX_BACKUPS = 3;


let currentUser = null;
let userData = null;
let cachedStats = null;
let cachedStatsTime = null;
const STATS_CACHE_DURATION = 30000;
let unsubscribe = null;
let saveTimeout = null;
let currentSort = { field: 'num', direction: 'asc' };
let pendingTour = null;



currentUser = null

//window.addEventListener('load', () => { setTimeout(() => { loader.style.opacity = '0'; setTimeout(() => loader.style.display = 'none', 500); }, 800); });

// Fonction pour masquer le loader une fois les données chargées
function hideLoader() {
    if (loader) {
        loader.style.opacity = '0';
        setTimeout(() => {
            loader.style.display = 'none';
        }, 500);
    }
}


mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu.classList.toggle('active');
    mobileMenuBtn.innerHTML = mobileMenu.classList.contains('active') ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
});

function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    themeIcon.classList.remove('fa-sun', 'fa-moon');
    themeIcon.classList.add(theme === 'dark' ? 'fa-moon' : 'fa-sun');
}
setTheme(localStorage.getItem('theme') || 'light');
themeToggle?.addEventListener('click', () => setTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));

window.addEventListener('scroll', () => {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    header?.classList.toggle('scrolled', scrollTop > 0);
    backToTop?.classList.toggle('visible', scrollTop > 600);
});
backToTop?.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

document.querySelectorAll('.app-nav-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.app-nav-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.app-page').forEach(p => p.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('page-' + this.dataset.page).classList.add('active');
        
        // Scroll jusqu'aux boutons de navigation
        const appNav = document.querySelector('.app-nav');
        if (appNav) {
            const headerHeight = 70;
            const navPosition = appNav.getBoundingClientRect().top + window.pageYOffset - headerHeight - 10;
            window.scrollTo({ top: navPosition, behavior: 'smooth' });
        }
    });
});

function getInitials(name) {
    if (!name) return 'U';
    const names = name.trim().split(' ');
    return names.length >= 2 ? (names[0][0] + names[names.length-1][0]).toUpperCase() : name.substring(0,2).toUpperCase();
}

// Cache pour la vérification premium (évite les appels répétés)
let premiumStatusCache = null;
let premiumStatusCacheTime = null;
const PREMIUM_CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

async function updateUserUI(user) {
    const presentationSection = document.getElementById('presentation-section');
    
if (user) {
        // ========== VÉRIFICATION PREMIUM AVEC CACHE ==========
        const now = Date.now();
        let isPremium = false;
        
        // Vérifier si le cache est valide (moins de 5 minutes)
        if (premiumStatusCache !== null && premiumStatusCacheTime && (now - premiumStatusCacheTime) < PREMIUM_CACHE_DURATION) {
            // Utiliser le cache
            isPremium = premiumStatusCache;
            console.log('✅ Statut premium depuis cache');
        } else {
            // Faire un nouvel appel
            try {
                const checkPremiumStatus = httpsCallable(functions, 'checkPremiumStatus');
                const result = await checkPremiumStatus();
                isPremium = result.data.isPremium;
                
                // Mettre à jour le cache
                premiumStatusCache = isPremium;
                premiumStatusCacheTime = now;
                console.log('✅ Statut premium vérifié et mis en cache');
            } catch (error) {
                console.error('Erreur vérification premium:', error);
                
                // Si on a un cache même expiré, l'utiliser plutôt que de bloquer
                if (premiumStatusCache !== null) {
                    console.warn('⚠️ Utilisation du cache expiré suite à une erreur');
                    isPremium = premiumStatusCache;
                } else {
                    // Seulement si aucun cache et erreur, alors rediriger
                    alert('Erreur lors de la vérification de votre abonnement.');
                    window.location.href = 'comptepremium.html';
                    return;
                }
            }
        }
        
        // Vérifier le statut premium
        if (!isPremium) {
            alert('⚠️ Accès premium requis. Vous allez être redirigé vers la page d\'abonnement.');
            window.location.href = 'comptepremium.html';
            return;
        }
        // ========== FIN VÉRIFICATION ==========
        
        currentUser = user;
        userAuth.classList.add('logged-in');
        loginRequired.style.display = 'none';
        if (presentationSection) presentationSection.style.display = 'none';
        mainContent.classList.add('active');
        
        try {
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            const userInfo = userDoc.exists() ? userDoc.data() : {};
            const displayName = userInfo.displayName || user.displayName || 'Utilisateur';
            avatarInitials.textContent = getInitials(displayName);
            profileName.textContent = displayName;
            profileEmail.textContent = user.email || '';
            updateWelcomeMessage(displayName);
        } catch (e) {
            avatarInitials.textContent = getInitials(user.displayName || user.email);
            profileName.textContent = user.displayName || 'Utilisateur';
            profileEmail.textContent = user.email || '';
            updateWelcomeMessage(user.displayName || 'Utilisateur');
        }
        
        loadUserData(user.uid);
		setTimeout(hideLoader, 500);
    } else {
        currentUser = null;
        userAuth.classList.remove('logged-in');
        loginRequired.style.display = 'block';
        if (presentationSection) presentationSection.style.display = 'block';
        mainContent.classList.remove('active');
        if (unsubscribe) { unsubscribe(); unsubscribe = null; }
		hideLoader();
    }
}

onAuthStateChanged(auth, updateUserUI);


userAvatar?.addEventListener('click', e => { e.stopPropagation(); profileDropdown.classList.toggle('active'); });
document.addEventListener('click', e => { if (profileDropdown && !profileDropdown.contains(e.target) && !userAvatar?.contains(e.target)) profileDropdown.classList.remove('active'); });
logoutBtn?.addEventListener('click', async () => {
    try {
		if (currentUser) {
            const cacheKey = `planning_cache_${currentUser.uid}`;
            const cacheTimeKey = `planning_cache_time_${currentUser.uid}`;
            localStorage.removeItem(cacheKey);
            localStorage.removeItem(cacheTimeKey);
            console.log('🧹 Cache nettoyé');
        }
		
		// 1️⃣ Annuler le debounce en cours
        if (saveTimeout) {
            clearTimeout(saveTimeout);
            saveTimeout = null;
        }
        
        // 2️⃣ Afficher l'indicateur de sauvegarde
        if (saveIndicatorHeader) {
            saveIndicatorHeader.classList.add('visible', 'saving');
            saveIndicatorHeader.classList.remove('pending', 'saved');
            saveIndicatorHeader.innerHTML = '<i class="fas fa-sync-alt"></i>';
            saveIndicatorHeader.title = 'Sauvegarde avant déconnexion...';
        }
        
        // 3️⃣ Forcer la sauvegarde immédiate si des modifications existent
        if (hasUnsavedChanges && currentUser) {
            console.log('💾 Sauvegarde forcée avant déconnexion...');
            await forceSaveAsync();
        }
        
        // ✅ Afficher le check vert (que la sauvegarde ait eu lieu ou non)
        if (saveIndicatorHeader) {
            saveIndicatorHeader.classList.remove('pending', 'saving');
            saveIndicatorHeader.classList.add('visible', 'saved');
            saveIndicatorHeader.innerHTML = '<i class="fas fa-check"></i>';
            saveIndicatorHeader.title = 'Sauvegardé';
            saveIndicatorHeader.style.color = '';
            
            const icon = saveIndicatorHeader.querySelector('i');
            if (icon) icon.style.animation = 'none';
        }
        
        // ⏱️ Attendre 1 seconde pour voir le check
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 🧹 Nettoyer l'indicateur AVANT la déconnexion
        if (saveIndicatorHeader) {
            saveIndicatorHeader.classList.remove('visible', 'saved', 'saving', 'pending');
            saveIndicatorHeader.innerHTML = '';
        }
        
        // 4️⃣ Déconnexion
        await signOut(auth);
        profileDropdown.classList.remove('active');
        
        // 5️⃣ Réinitialiser le flag
        hasUnsavedChanges = false;
        
        // 6️⃣ Afficher le toast de déconnexion
        const toast = document.getElementById('toast-logout');
        if (toast) {
            toast.classList.add('show');
            toast.classList.remove('hide');
            
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.add('hide');
            }, 3000);
        }
        
        console.log('✅ Déconnexion réussie avec sauvegarde');
        
    } catch (error) {
        console.error('❌ Erreur lors de la déconnexion:', error);
        
        // Afficher l'erreur dans l'indicateur
        if (saveIndicatorHeader) {
            saveIndicatorHeader.classList.remove('saving', 'saved', 'pending');
            saveIndicatorHeader.classList.add('visible');
            saveIndicatorHeader.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
            saveIndicatorHeader.title = 'Erreur de sauvegarde';
            saveIndicatorHeader.style.color = 'var(--danger)';
            setTimeout(() => saveIndicatorHeader.classList.remove('visible'), 3000);
        }
    }
});

// ========================================
// SAUVEGARDE AVEC MESSAGE DE CONFIRMATION
// ========================================

// ========================================
// NOTIFICATION PERSONNALISÉE
// ========================================

// Variables pour la notification
let warningModal = null;
let warningProgressBar = null;
let btnWaitSave = null;
let btnForceQuit = null;
let canQuit = false; // Flag pour autoriser la fermeture

// Initialiser les éléments de la notification
document.addEventListener('DOMContentLoaded', () => {
    warningModal = document.getElementById('custom-warning-modal');
    warningProgressBar = document.getElementById('warning-progress-bar');
    btnWaitSave = document.getElementById('btn-wait-save');
    btnForceQuit = document.getElementById('btn-force-quit');
    
    // Bouton "Attendre"
    if (btnWaitSave) {
        btnWaitSave.addEventListener('click', async () => {
            // Fermer la modal
            hideWarningModal();
            
            // Afficher indicateur dans le header
            if (saveIndicatorHeader) {
                saveIndicatorHeader.classList.add('visible', 'saving');
                saveIndicatorHeader.classList.remove('pending', 'saved');
                saveIndicatorHeader.innerHTML = '<i class="fas fa-sync-alt"></i>';
                saveIndicatorHeader.title = 'Sauvegarde en cours...';
            }
            
            // Forcer la sauvegarde immédiate
            await forceSaveAsync();
			
        });
    }
    
    // Bouton "Quitter quand même"
    if (btnForceQuit) {
        btnForceQuit.addEventListener('click', () => {
            // Sauvegarder localStorage en dernier recours
            forceSave();
            
            // Autoriser la fermeture
            canQuit = true;
            hasUnsavedChanges = false;
            
            // Fermer la modal
            hideWarningModal();
            
            // Fermer la page
            window.close();
            // Si window.close() ne fonctionne pas, rediriger
            setTimeout(() => {
                if (!window.closed) {
                    alert('Veuillez fermer manuellement cet onglet');
                }
            }, 100);
        });
    }
});

// Fonction pour afficher la notification
function showWarningModal() {
    if (!warningModal) return;
    
    warningModal.classList.add('show');
    
    // Animation de la barre de progression
    if (warningProgressBar) {
        warningProgressBar.style.width = '0%';
        setTimeout(() => {
            warningProgressBar.style.width = '100%';
        }, 100);
    }
}

// Fonction pour cacher la notification
function hideWarningModal() {
    if (!warningModal) return;
    warningModal.classList.remove('show');
}

function forceSave() {
    if (saveTimeout) clearTimeout(saveTimeout);
    if (hasUnsavedChanges && currentUser) {
        userData.lastUpdated = new Date().toISOString();
        
        // Sauvegarder Firebase uniquement
        saveUserData();
        hasUnsavedChanges = false;
    }
}

async function forceSaveAsync() {
    if (saveTimeout) clearTimeout(saveTimeout);
    if (hasUnsavedChanges && currentUser) {
        userData.lastUpdated = new Date().toISOString();
        
        // Sauvegarder Firebase et ATTENDRE
        await saveUserData();
        hasUnsavedChanges = false;
    }
}

// Détecter changement d'onglet/fenêtre
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'hidden') {
        // Si modifications en attente, afficher la notification SEULEMENT si changement d'onglet
        if (hasUnsavedChanges && currentUser) {
            // Afficher la modal personnalisée
            showWarningModal();
            
            // Lancer la sauvegarde en arrière-plan
            forceSave();
        }
    } else if (document.visibilityState === 'visible') {
        // Revenu sur l'onglet, cacher la modal si elle est visible
        hideWarningModal();
    }
});

// MESSAGE DE CONFIRMATION si modifications non sauvegardées
window.addEventListener('beforeunload', (e) => {
    if (hasUnsavedChanges && currentUser && !canQuit) {
        // Forcer la sauvegarde immédiatement
        forceSave();
        
        // Afficher le message Windows SEULEMENT si activé dans la config
        if (ENABLE_WINDOWS_WARNING) {
            e.preventDefault();
            e.returnValue = 'Des modifications sont en cours de sauvegarde. Veuillez patienter...';
            return 'Des modifications sont en cours de sauvegarde. Veuillez patienter...';
        }
        
        // Sinon : sauvegarde silencieuse sans bloquer
        // La notification personnalisée s'affiche seulement au changement d'onglet (visibilitychange)
    }
});


function saveBackupToLocalStorage(userId, data) {
    if (!userId || !data) return;
    
    try {
        const backupKey = `${BACKUP_KEY_PREFIX}${userId}`;
        const existingBackups = JSON.parse(localStorage.getItem(backupKey) || '[]');
        
        // Compter TOUT le contenu
        const content = countDataContent(data);
        
        // Ne sauvegarder que si les données ont du contenu
        if (content.total === 0) {
            console.log('⚠️ Backup ignoré : données vides');
            return;
        }
        
        // Créer le nouveau backup avec toutes les infos
        const newBackup = {
            timestamp: new Date().toISOString(),
            itemsCount: content.items,
            totalCount: content.total,
            details: content,
            data: JSON.parse(JSON.stringify(data)) // Deep copy
        };
        
        // Éviter les doublons (comparer tout le contenu, pas juste items)
        if (existingBackups.length > 0) {
            const lastBackup = existingBackups[existingBackups.length - 1];
            const lastContent = JSON.stringify({
                items: lastBackup.data.items,
                planningData: lastBackup.data.planningData,
                checklistData: lastBackup.data.checklistData,
                trophies: lastBackup.data.trophies,
                selectedResources: lastBackup.data.selectedResources
            });
            const newContent = JSON.stringify({
                items: data.items,
                planningData: data.planningData,
                checklistData: data.checklistData,
                trophies: data.trophies,
                selectedResources: data.selectedResources
            });
            if (lastContent === newContent) {
                console.log('📦 Backup ignoré : identique au précédent');
                return;
            }
        }
        
        // Ajouter le nouveau backup
        existingBackups.push(newBackup);
        
        // Garder seulement les X derniers backups
        while (existingBackups.length > MAX_BACKUPS) {
            existingBackups.shift();
        }
        
        localStorage.setItem(backupKey, JSON.stringify(existingBackups));
        console.log(`💾 Backup créé (${content.items} items, ${content.planningDays} planning, ${content.checklistItems} checklist, ${content.trophies} trophées) - ${existingBackups.length}/${MAX_BACKUPS} backups`);
        
    } catch (e) {
        console.error('❌ Erreur création backup:', e);
    }
}

function getBackupsFromLocalStorage(userId) {
    if (!userId) return [];
    
    try {
        const backupKey = `${BACKUP_KEY_PREFIX}${userId}`;
        return JSON.parse(localStorage.getItem(backupKey) || '[]');
    } catch (e) {
        console.error('❌ Erreur lecture backups:', e);
        return [];
    }
}

function restoreFromBackup(userId, backupIndex = 0) {
    const backups = getBackupsFromLocalStorage(userId);
    
    if (backups.length === 0) {
        console.error('❌ Aucun backup disponible');
        return null;
    }
    
    // backupIndex: 0 = le plus récent, 1 = avant-dernier, etc.
    const index = backups.length - 1 - backupIndex;
    
    if (index < 0 || index >= backups.length) {
        console.error('❌ Index de backup invalide');
        return null;
    }
    
    const backup = backups[index];
    console.log(`🔄 Restauration du backup du ${backup.timestamp} (${backup.itemsCount} items)`);
    
    return backup.data;
}

// 🛡️ PROTECTION ANTI-ÉCRASEMENT - SÉCURITÉ MAXIMALE
function countDataContent(data) {
    if (!data) return { total: 0 };
    
    const counts = {
        items: Object.keys(data.items || {}).length,
        trophies: Object.keys(data.trophies || {}).length,
        planningDays: Object.keys(data.planningData || {}).length,
        checklistItems: (data.checklistData || []).length,
        resources: (data.selectedResources || []).length
    };
    
    counts.total = counts.items + counts.trophies + counts.planningDays + counts.checklistItems + counts.resources;
    
    return counts;
}

function isDataSafeToSave(newData, userId) {
    // Compter TOUT le contenu des nouvelles données
    const newContent = countDataContent(newData);
    
    // Si les nouvelles données ont du contenu significatif, c'est OK
    if (newContent.total > 0) {
        return { safe: true, reason: 'Données valides', content: newContent };
    }
    
    // Les nouvelles données sont COMPLÈTEMENT vides - DANGER !
    const cacheKey = `planning_cache_${userId}`;
    const cachedData = localStorage.getItem(cacheKey);
    
    // 1. Vérifier le cache principal
    if (cachedData) {
        try {
            const parsed = JSON.parse(cachedData);
            const cachedContent = countDataContent(parsed);
            
            if (cachedContent.total > 0) {
                return { 
                    safe: false, 
                    reason: `BLOQUÉ : Tentative d'écraser ${cachedContent.items} items, ${cachedContent.planningDays} jours planning, ${cachedContent.checklistItems} checklist, ${cachedContent.trophies} trophées, ${cachedContent.resources} ressources`,
                    previousContent: cachedContent
                };
            }
        } catch (e) {}
    }
    
    // 2. Vérifier les backups
    const backups = getBackupsFromLocalStorage(userId);
    if (backups.length > 0) {
        const lastBackup = backups[backups.length - 1];
        if ((lastBackup.totalCount || lastBackup.itemsCount || 0) > 0) {
            return { 
                safe: false, 
                reason: `BLOQUÉ : Backup existant avec ${lastBackup.totalCount || lastBackup.itemsCount} éléments`,
                previousCount: lastBackup.totalCount || lastBackup.itemsCount
            };
        }
    }
    
    // Aucune donnée précédente trouvée, OK pour sauvegarder (nouveau compte)
    return { safe: true, reason: 'Nouveau compte ou données déjà vides' };
}

function initializeUserData() { 
    return { 
        items: {}, 
        trophies: {}, 
        planningData: {},      // Planning calendrier
        checklistData: [],     // Checklist
        selectedResources: [], // Ressources
        lastUpdated: new Date().toISOString() 
    }; 
}

function loadUserData(userId) {
    if (userId) {
        // 🔥 Cache pour affichage rapide
        const cacheKey = `planning_cache_${userId}`;
        const cacheTimeKey = `planning_cache_time_${userId}`;
        const cachedData = localStorage.getItem(cacheKey);
        const cacheTime = localStorage.getItem(cacheTimeKey);
        
        const CACHE_DURATION = 4 * 60 * 60 * 1000; // 4 heures
        
        // ✅ Si cache valide : affichage immédiat (pas de lecture Firebase initiale !)
        if (cachedData && cacheTime && (Date.now() - parseInt(cacheTime)) < CACHE_DURATION) {
            userData = JSON.parse(cachedData);
            console.log('📦 Affichage instantané depuis cache (économie lecture Firebase)');
            
            // Afficher immédiatement
            loadResourcesConfig();
            if (typeof PlanningModule !== 'undefined' && PlanningModule.loadData) {
                PlanningModule.loadData();
                if (PlanningModule.renderCalendar) PlanningModule.renderCalendar();
                if (PlanningModule.renderChecklist) PlanningModule.renderChecklist();
            }
            renderAll();
        }
        
        // ✅ TOUJOURS activer onSnapshot (même si cache utilisé ci-dessus)
        // → Garantit sync temps réel multi-appareils
        unsubscribe = onSnapshot(doc(db, 'planningRevision', userId), docSnap => {
            if (docSnap.exists()) {
                const newData = docSnap.data();
                
                // ⚡ OPTIMISATION : Ne re-render que si données différentes
                const dataChanged = JSON.stringify(userData) !== JSON.stringify(newData);
                
                // 💾 BACKUP : Sauvegarder les anciennes données AVANT de les remplacer
                if (userData && Object.keys(userData.items || {}).length > 0 && dataChanged) {
                    saveBackupToLocalStorage(userId, userData);
                }
                
                userData = newData;
                
                // Mettre à jour le cache
                localStorage.setItem(cacheKey, JSON.stringify(userData));
                localStorage.setItem(cacheTimeKey, Date.now().toString());
                
                if (dataChanged) {
                    console.log('📥 Sync Firebase : données mises à jour');
                    
                    loadResourcesConfig();
                    
                    // Charger les données du planning
                    if (typeof PlanningModule !== 'undefined' && PlanningModule.loadData) {
                        PlanningModule.loadData();
                        console.log('📅 Planning synchronisé');
                        console.log('✅ Checklist synchronisée');
                        if (PlanningModule.renderCalendar) PlanningModule.renderCalendar();
                        if (PlanningModule.renderChecklist) PlanningModule.renderChecklist();
                    }
                    
                    // 🏆 Recharger les trophées automatiquement lors de la sync
                    if (typeof TrophiesSystem !== 'undefined') {
                        TrophiesSystem.init(); // Recharge les trophées depuis userData
                        console.log('🏆 Trophées synchronisés');
                    }
                    
                    renderAll();
                } else {
                    console.log('📥 Sync Firebase : aucun changement détecté');
                }
            } else {
                // 🛡️ PROTECTION : Vérifier si on a des données en cache/backup avant d'initialiser
                const existingCache = localStorage.getItem(cacheKey);
                const backups = getBackupsFromLocalStorage(userId);
                
                if (existingCache) {
                    try {
                        const parsed = JSON.parse(existingCache);
                        if (Object.keys(parsed?.items || {}).length > 0) {
                            console.warn('⚠️ Document Firebase absent mais cache avec données - RESTAURATION depuis cache');
                            userData = parsed;
                            // Recréer le document Firebase avec les données du cache
                            saveUserData();
                            renderAll();
                            return;
                        }
                    } catch (e) {}
                }
                
                if (backups.length > 0 && backups[backups.length - 1].itemsCount > 0) {
                    console.warn('⚠️ Document Firebase absent mais backup disponible - RESTAURATION depuis backup');
                    userData = restoreFromBackup(userId, 0);
                    if (userData) {
                        saveUserData();
                        renderAll();
                        return;
                    }
                }
                
                // Vraiment nouveau compte : initialiser avec données vides
                userData = initializeUserData();
                saveUserData();
                console.log('🆕 Nouveau compte initialisé');
                
                loadResourcesConfig();
                if (typeof PlanningModule !== 'undefined' && PlanningModule.loadData) {
                    PlanningModule.loadData();
                    if (PlanningModule.renderCalendar) PlanningModule.renderCalendar();
                    if (PlanningModule.renderChecklist) PlanningModule.renderChecklist();
                }
                renderAll();
            }
        }, e => { 
            console.error('❌ Erreur Firebase:', e);
            
            // 🛡️ PROTECTION : En cas d'erreur, utiliser le cache au lieu d'initialiser des données vides
            const existingCache = localStorage.getItem(cacheKey);
            if (existingCache) {
                try {
                    const parsed = JSON.parse(existingCache);
                    if (Object.keys(parsed?.items || {}).length > 0) {
                        console.warn('⚠️ Erreur Firebase - Utilisation du cache local');
                        userData = parsed;
                        renderAll();
                        return;
                    }
                } catch (parseError) {}
            }
            
            // Fallback sur backup
            const backups = getBackupsFromLocalStorage(userId);
            if (backups.length > 0 && backups[backups.length - 1].itemsCount > 0) {
                console.warn('⚠️ Erreur Firebase - Restauration depuis backup');
                userData = restoreFromBackup(userId, 0);
                if (userData) {
                    renderAll();
                    return;
                }
            }
            
            // Dernier recours : données vides (mais PAS de sauvegarde !)
            console.error('❌ Aucune donnée de secours disponible');
            userData = initializeUserData();
            renderAll(); 
        });
    } else {
        // Pas connecté : rediriger vers login (car app premium uniquement)
        console.warn('⚠️ Utilisateur non connecté - redirection nécessaire');
        userData = initializeUserData();
        renderAll();
    }
}


async function saveUserData() {
    if (!currentUser || !userData) return;
    
    // 🛡️ PROTECTION ANTI-ÉCRASEMENT
    const safetyCheck = isDataSafeToSave(userData, currentUser.uid);
    if (!safetyCheck.safe) {
        console.error('🚫 SAUVEGARDE BLOQUÉE :', safetyCheck.reason);
        
        // Afficher une erreur visuelle
        if (saveIndicatorHeader) {
            saveIndicatorHeader.classList.add('visible');
            saveIndicatorHeader.classList.remove('pending', 'saving', 'saved');
            saveIndicatorHeader.innerHTML = '<i class="fas fa-shield-alt"></i>';
            saveIndicatorHeader.title = 'Protection : écrasement bloqué';
            saveIndicatorHeader.style.color = 'var(--danger)';
            
            setTimeout(() => {
                if (saveIndicatorHeader) {
                    saveIndicatorHeader.classList.remove('visible');
                    saveIndicatorHeader.style.color = '';
                }
            }, 5000);
        }
        
        return; // NE PAS SAUVEGARDER !
    }
    
// 💾 BACKUP avant sauvegarde (si données significatives)
    const contentCheck = countDataContent(userData);
    if (contentCheck.total > 0) {
        saveBackupToLocalStorage(currentUser.uid, userData);
    }
    
    // Variable pour tracker si la sauvegarde est terminée
    let saveCompleted = false;
    let saveTimedOut = false;
    
    // Afficher l'indicateur de sauvegarde dans le header (rotation rapide)
    if (saveIndicatorHeader) {
        saveIndicatorHeader.classList.add('visible', 'saving');
        saveIndicatorHeader.classList.remove('pending', 'saved');
        saveIndicatorHeader.innerHTML = '<i class="fas fa-sync-alt"></i>';
        saveIndicatorHeader.title = 'Sauvegarde en cours...';
    }
    
    // ⚠️ TIMEOUT DE SÉCURITÉ - Force l'arrêt après 10 secondes
    const safetyTimeout = setTimeout(() => {
        if (!saveCompleted) {
            saveTimedOut = true;
            console.warn('⏱️ Timeout de sauvegarde atteint (10s)');
            
            // FORCER l'arrêt de l'animation
            if (saveIndicatorHeader) {
                saveIndicatorHeader.classList.remove('pending', 'saving', 'saved');
                saveIndicatorHeader.classList.add('visible');
                saveIndicatorHeader.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                saveIndicatorHeader.title = 'Timeout - Vérifiez votre connexion';
                saveIndicatorHeader.style.color = 'var(--danger)';
                
                // Supprimer toutes les classes d'animation
                const icon = saveIndicatorHeader.querySelector('i');
                if (icon) {
                    icon.style.animation = 'none';
                }
                
                setTimeout(() => {
                    if (saveIndicatorHeader) {
                        saveIndicatorHeader.classList.remove('visible');
                        saveIndicatorHeader.style.color = '';
                    }
                }, 4000);
            }
        }
    }, 10000); // 10 secondes
    
    // Fonction helper pour afficher le succès
    const showSaveSuccess = () => {
        saveCompleted = true;
        clearTimeout(safetyTimeout);
        
        if (saveIndicatorHeader) {
            saveIndicatorHeader.classList.remove('pending', 'saving');
            saveIndicatorHeader.classList.add('saved');
            saveIndicatorHeader.innerHTML = '<i class="fas fa-check"></i>';
            saveIndicatorHeader.title = 'Tout est sauvegardé';
            
            const icon = saveIndicatorHeader.querySelector('i');
            if (icon) {
                icon.style.animation = 'none';
            }
            
            setTimeout(() => {
                if (saveIndicatorHeader) {
                    saveIndicatorHeader.classList.remove('visible', 'saved');
                }
            }, 3000);
        }
    };
    
    // Fonction helper pour afficher l'erreur
    const showSaveError = () => {
        saveCompleted = true;
        clearTimeout(safetyTimeout);
        
        if (saveIndicatorHeader) {
            saveIndicatorHeader.classList.remove('pending', 'saving', 'saved');
            saveIndicatorHeader.classList.add('visible');
            saveIndicatorHeader.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
            saveIndicatorHeader.title = 'Erreur de sauvegarde';
            saveIndicatorHeader.style.color = 'var(--danger)';
            
            const icon = saveIndicatorHeader.querySelector('i');
            if (icon) {
                icon.style.animation = 'none';
            }
            
            setTimeout(() => {
                if (saveIndicatorHeader) {
                    saveIndicatorHeader.classList.remove('visible');
                    saveIndicatorHeader.style.color = '';
                }
            }, 3000);
        }
    };
    
    try {
        // Si le timeout est déjà passé, ne pas essayer de sauvegarder
        if (saveTimedOut) {
            return;
        }
        
        userData.lastUpdated = new Date().toISOString();
        
        // OPTIMISATION : Utiliser updateDoc au lieu de setDoc
        await updateDoc(doc(db, 'planningRevision', currentUser.uid), {
            items: userData.items,
            trophies: userData.trophies,
            planningData: userData.planningData || {},
            checklistData: userData.checklistData || [],
            selectedResources: userData.selectedResources || [],
            lastUpdated: userData.lastUpdated
        });
        
        // Succès - mais vérifier qu'on n'a pas timeout
        if (!saveTimedOut) {
            lastSaveTime = Date.now();
            hasUnsavedChanges = false;
            showSaveSuccess();
            console.log('✅ Sauvegarde Firestore réussie');
            invalidateStatsCache();
        }
        
    } catch (e) {
        console.error('❌ Erreur sauvegarde Firestore:', e);
        
        // Si timeout déjà passé, ne rien faire
        if (saveTimedOut) {
            return;
        }
        
        // En cas d'erreur, essayer avec setDoc (fallback)
        if (e.code === 'not-found') {
            // 🛡️ Vérification supplémentaire avant setDoc
            if (Object.keys(userData.items || {}).length === 0) {
                console.warn('⚠️ setDoc bloqué : données vides sur document not-found');
                showSaveError();
                return;
            }
            
            try {
                await setDoc(doc(db, 'planningRevision', currentUser.uid), userData);
                
                if (!saveTimedOut) {
                    lastSaveTime = Date.now();
                    hasUnsavedChanges = false;
                    showSaveSuccess();
                    console.log('✅ Document créé avec setDoc (fallback)');
                    invalidateStatsCache();
                }
            } catch (e2) {
                console.error('❌ Erreur setDoc:', e2);
                if (!saveTimedOut) {
                    showSaveError();
                }
            }
        } else {
            if (!saveTimedOut) {
                showSaveError();
            }
        }
    }
}

// ========================================
// OPTIMISATION FIRESTORE - VERSION SIMPLIFIÉE
// ========================================

// ========================================
// CONFIGURATION SAUVEGARDE
// ========================================
// Variables pour le système de sauvegarde optimisé
let lastSaveTime = Date.now();
let hasUnsavedChanges = false; // Track si des modifications ne sont pas sauvegardées
const DEBOUNCE_DELAY = 10 * 1000; // 10 secondes de debounce

// OPTION : Afficher le message d'avertissement à la fermeture
// Note: La modal personnalisée ne peut PAS s'afficher dans beforeunload (restriction navigateur)
// Elle s'affiche seulement au changement d'onglet (visibilitychange)
// Donc on DOIT utiliser le message Windows pour bloquer la fermeture de page
const ENABLE_WINDOWS_WARNING = true; // OBLIGATOIRE pour bloquer la fermeture

// Fonction de sauvegarde avec debounce simple
function debouncedSave() {
    // Marquer qu'il y a des modifications non sauvegardées
    hasUnsavedChanges = true;
    
    // Afficher l'indicateur dans le header (flèches circulaires grises)
    if (saveIndicatorHeader) {
        saveIndicatorHeader.classList.add('visible', 'pending');
        saveIndicatorHeader.classList.remove('saving', 'saved');
        saveIndicatorHeader.innerHTML = '<i class="fas fa-sync-alt"></i>'; // Flèches circulaires
        saveIndicatorHeader.title = 'En attente d\'autres modifications...';
    }
    
    // Annuler le timeout précédent
    if (saveTimeout) clearTimeout(saveTimeout);
    
    // Attendre 10 secondes d'inactivité avant de sauvegarder
    saveTimeout = setTimeout(() => {
        console.log('💾 Sauvegarde après inactivité (10s)');
        saveUserData();
    }, DEBOUNCE_DELAY);
}

function getItemKey(sId, fc) { return sId + '-' + fc; }

function getItemData(sId, fc) {
    const key = getItemKey(sId, fc);
    if (!userData.items[key]) userData.items[key] = { tours: [null,null,null,null,null,null,null,null], tourDates: [null,null,null,null,null,null,null,null], tourDurations: [null,null,null,null,null,null,null,null], tourSupports: [null,null,null,null,null,null,null,null], resources: {}, lastRevision: null };
    const d = userData.items[key];
    if (d.tours && typeof d.tours[0] === 'boolean') d.tours = d.tours.map(t => t ? 3 : null);
    if (!d.tourDates) d.tourDates = [null,null,null,null,null,null,null,null];
    if (!d.tourDurations) d.tourDurations = [null,null,null,null,null,null,null,null];
    if (!d.tourSupports) d.tourSupports = [null,null,null,null,null,null,null,null];
    if (!d.resources) d.resources = {};
    return d;
}

function calculateStats() {
    // 🔥 NOUVEAU : Utiliser le cache si récent (< 30 secondes)
    if (cachedStats && cachedStatsTime && (Date.now() - cachedStatsTime) < STATS_CACHE_DURATION) {
        console.log('📦 Stats depuis cache');
        return cachedStats;
    }
    
    console.log('🔄 Calcul stats...');
    const startTime = performance.now();
    
    let itemsWithOneTour = 0, totalTours = 0, refItemsWithOneTour = 0, totalRefItems = 0;
    let totalMinutes = 0;
    
    SPECIALTIES_DATA.forEach(s => {
        let allSeen = true;
        s.items.forEach(item => {
            const d = getItemData(s.id, item.fc);
            const tc = d.tours.filter(t => t !== null).length;
            if (tc > 0) itemsWithOneTour++;
            const isReference = ITEM_REFERENCE[item.num + '|' + s.id] === true;
            if (isReference) {
                totalRefItems++;
                if (tc > 0) refItemsWithOneTour++;
            }
            totalTours += tc;
            
            if (d.tourDurations) {
                d.tourDurations.forEach(dur => {
                    if (dur) {
                        const parts = dur.split(':');
                        const hours = parseInt(parts[0]) || 0;
                        const minutes = parseInt(parts[1]) || 0;
                        totalMinutes += hours * 60 + minutes;
                    }
                });
            }
        });
    });
    
    // 🔥 NOUVEAU : Mettre en cache
    cachedStats = { 
        itemsWithOneTour, 
        totalTours, 
        refItemsWithOneTour, 
        totalRefItems, 
        maxTours: TOTAL_ITEMS * MAX_TOURS, 
        totalMinutes 
    };
    cachedStatsTime = Date.now();
    
    const endTime = performance.now();
    console.log(`✅ Stats calculées en ${Math.round(endTime - startTime)}ms`);
    
    return cachedStats;
}

function invalidateStatsCache() {
    cachedStats = null;
    cachedStatsTime = null;
}

function calculateDailyStats() {
    const today = new Date();
    const todayStr = today.getFullYear() + '-' + 
                     String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                     String(today.getDate()).padStart(2, '0');
    
    let toursToday = 0;
    let delayCaught = 0;
    let minutesToday = 0;
    let feelingsToday = [];
    
    SPECIALTIES_DATA.forEach(s => {
        s.items.forEach(item => {
            const d = getItemData(s.id, item.fc);
            
            if (d.tourDates) {
                // Chercher si cet item a été révisé aujourd'hui
                let revisedToday = false;
                let lastDateBeforeToday = null;
                
                d.tourDates.forEach((dateStr, i) => {
                    if (dateStr) {
                        const tourDateStr = dateStr.split('T')[0];
                        
                        if (tourDateStr === todayStr) {
                            // Tour fait aujourd'hui
                            revisedToday = true;
                            toursToday++;
                            
                            // Temps aujourd'hui
                            if (d.tourDurations && d.tourDurations[i]) {
                                const parts = d.tourDurations[i].split(':');
                                const hours = parseInt(parts[0]) || 0;
                                const minutes = parseInt(parts[1]) || 0;
                                minutesToday += hours * 60 + minutes;
                            }
                            
                            // Ressenti du jour
                            if (d.tours[i]) {
                                feelingsToday.push(d.tours[i]);
                            }
                        } else {
                            // Tour fait avant aujourd'hui - garder la date la plus récente
                            const tourDate = new Date(dateStr);
                            if (!lastDateBeforeToday || tourDate > lastDateBeforeToday) {
                                lastDateBeforeToday = tourDate;
                            }
                        }
                    }
                });
                
                // Calculer le retard rattrapé pour cet item
                if (revisedToday && lastDateBeforeToday) {
                    const todayDate = new Date(todayStr);
                    const daysSinceLastRevision = Math.floor((todayDate - lastDateBeforeToday) / (1000 * 60 * 60 * 24));
                    if (daysSinceLastRevision > 0) {
                        delayCaught += daysSinceLastRevision;
                    }
                }
            }
        });
    });
    
    const avgFeeling = feelingsToday.length > 0 
        ? Math.round((feelingsToday.reduce((a, b) => a + b, 0) / feelingsToday.length) * 10) / 10
        : null;
    
    return { toursToday, delayCaught, minutesToday, avgFeeling };
}



function formatTime(totalMinutes) {
    const totalHours = Math.floor(totalMinutes / 60);
    const mins = totalMinutes % 60;
    
    if (totalHours >= 24 * 30) {
        // Plus d'un mois (30 jours)
        const months = Math.floor(totalHours / (24 * 30));
        const remainingHours = totalHours % (24 * 30);
        const days = Math.floor(remainingHours / 24);
        const hours = remainingHours % 24;
        return months + 'm ' + days + 'j ' + hours + 'h';
    } else if (totalHours >= 24) {
        // Plus d'un jour
        const days = Math.floor(totalHours / 24);
        const hours = totalHours % 24;
        return days + 'j ' + hours + 'h';
    } else {
        // Moins d'un jour
        return totalHours + 'h' + (mins < 10 ? '0' : '') + mins;
    }
}





function getSpecialtyProgress(s) {
    let itemsSeen = 0, totalTours = 0, totalMinutes = 0;
    let feelings = [];
    
    s.items.forEach(item => {
        const d = getItemData(s.id, item.fc);
        const tc = d.tours.filter(t => t !== null).length;
        if (tc > 0) itemsSeen++;
        totalTours += tc;
        
        // Calcul du temps
        if (d.tourDurations) {
            d.tourDurations.forEach(dur => {
                if (dur) {
                    const parts = dur.split(':');
                    totalMinutes += (parseInt(parts[0]) || 0) * 60 + (parseInt(parts[1]) || 0);
                }
            });
        }
        
        // Calcul du ressenti
        d.tours.forEach(t => {
            if (t !== null) feelings.push(t);
        });
    });
    
    const avgFeeling = feelings.length > 0 ? Math.round((feelings.reduce((a, b) => a + b, 0) / feelings.length) * 10) / 10 : null;
	const timeFormatted = formatTime(totalMinutes);
			
return { 
    itemsSeen, 
    totalItems: s.items.length, 
    totalTours, 
    percentage: s.items.length > 0 ? Math.round((itemsSeen / s.items.length) * 100) : 0,
    totalTime: timeFormatted,
    totalMinutes: totalMinutes,
    avgFeeling: avgFeeling
};
}

function getDaysSince(dateStr) {
    if (!dateStr) return null;
    return Math.floor(Math.abs(new Date() - new Date(dateStr)) / (1000 * 60 * 60 * 24));
}

function formatDate(dateStr) {
    if (!dateStr) return '';
    return new Date(dateStr).toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' });
}

function renderAll() {
    if (!userData) return;
    renderStats();
    renderDashboardSpecialties();
    renderItemsTable();
    populateFilters();
	if (typeof initWeeklyCharts === 'function') initWeeklyCharts();

}

function renderStats() {
    const stats = calculateStats();
    const dailyStats = calculateDailyStats();
    
    // Stats générales
    statItemsDone.textContent = stats.itemsWithOneTour;
	const percent = Math.round((stats.itemsWithOneTour / TOTAL_ITEMS) * 100);
	document.getElementById('stat-items-percent').textContent = percent + '%';
    statToursDone.textContent = stats.totalTours;
    const statRefDone = document.getElementById('stat-ref-done');
	const statRefPercent = document.getElementById('stat-ref-percent');
	const progressRef = document.getElementById('progress-ref');
	if (statRefDone) statRefDone.textContent = stats.refItemsWithOneTour;
	const refPercent = stats.totalRefItems > 0 ? Math.round((stats.refItemsWithOneTour / stats.totalRefItems) * 100) : 0;
	if (statRefPercent) statRefPercent.textContent = refPercent + '%';
	if (progressRef) progressRef.style.width = refPercent + '%';
    progressItems.style.width = Math.round((stats.itemsWithOneTour / TOTAL_ITEMS) * 100) + '%';
	if (progressTours) progressTours.style.width = Math.round((stats.totalTours / stats.maxTours) * 100) + '%';    
    
	// Temps total
    const statTotalTime = document.getElementById('stat-total-time');
    if (statTotalTime) statTotalTime.textContent = formatTime(stats.totalMinutes);
    
    // Stats quotidiennes
    const statItemsToday = document.getElementById('stat-items-today');
    const statDelayCaught = document.getElementById('stat-delay-caught');
    const statTimeToday = document.getElementById('stat-time-today');
    const statFeelingToday = document.getElementById('stat-feeling-today');
    const feelingIndicator = document.getElementById('feeling-indicator');
    
    if (statItemsToday) statItemsToday.textContent = dailyStats.toursToday;
    if (statDelayCaught) statDelayCaught.innerHTML = dailyStats.delayCaught + '<span class="daily-stat-unit">jours</span>';
    if (statTimeToday) statTimeToday.textContent = formatTime(dailyStats.minutesToday);
    
    if (statFeelingToday) {
        statFeelingToday.textContent = dailyStats.avgFeeling !== null ? dailyStats.avgFeeling.toFixed(1) + '/5' : '--';
    }
    
    if (feelingIndicator) {
        const dots = feelingIndicator.querySelectorAll('.feeling-dot');
        dots.forEach(dot => dot.classList.remove('active', 'c1', 'c2', 'c3', 'c4', 'c5'));
        
        if (dailyStats.avgFeeling !== null) {
            const roundedFeeling = Math.round(dailyStats.avgFeeling);
            dots.forEach(dot => {
                const level = parseInt(dot.dataset.level);
                if (level <= roundedFeeling) dot.classList.add('active', 'c' + roundedFeeling);
            });
        }
    }
}

function renderDashboardSpecialties() {
    const container = document.getElementById('dashboard-specialties');
    const sortValue = document.getElementById('sort-specialty')?.value || 'default';
    const filterStatus = document.getElementById('filter-specialty-status')?.value || 'all';
	const searchTerm = (document.getElementById('search-specialty')?.value || '').toLowerCase();
    
    // Calculer les stats pour chaque spécialité
    let specialtiesWithStats = SPECIALTIES_DATA.map(s => {
        const prog = getSpecialtyProgress(s);
        return {
            ...s,
            prog: prog
        };
    });
			// Filtrer par recherche
		if (searchTerm) {
			specialtiesWithStats = specialtiesWithStats.filter(s => 
				s.name.toLowerCase().includes(searchTerm) || 
				s.id.toLowerCase().includes(searchTerm)
			);
}
    
    // Filtrer par statut
    if (filterStatus === 'not-started') {
        specialtiesWithStats = specialtiesWithStats.filter(s => s.prog.percentage === 0);
    } else if (filterStatus === 'in-progress') {
        specialtiesWithStats = specialtiesWithStats.filter(s => s.prog.percentage > 0 && s.prog.percentage < 100);
    } else if (filterStatus === 'completed') {
        specialtiesWithStats = specialtiesWithStats.filter(s => s.prog.percentage === 100);
    }
    
    // Trier
    if (sortValue === 'feeling-asc') {
        specialtiesWithStats.sort((a, b) => (a.prog.avgFeeling || 0) - (b.prog.avgFeeling || 0));
    } else if (sortValue === 'feeling-desc') {
        specialtiesWithStats.sort((a, b) => (b.prog.avgFeeling || 0) - (a.prog.avgFeeling || 0));
    } else if (sortValue === 'time-desc') {
        specialtiesWithStats.sort((a, b) => b.prog.totalMinutes - a.prog.totalMinutes);
    } else if (sortValue === 'time-asc') {
        specialtiesWithStats.sort((a, b) => a.prog.totalMinutes - b.prog.totalMinutes);
    } else if (sortValue === 'progress-desc') {
        specialtiesWithStats.sort((a, b) => b.prog.percentage - a.prog.percentage);
    } else if (sortValue === 'progress-asc') {
        specialtiesWithStats.sort((a, b) => a.prog.percentage - b.prog.percentage);
    }
    
    // Afficher message si aucun résultat
    if (specialtiesWithStats.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p>Aucune spécialité ne correspond à ce filtre</p></div>';
        return;
    }
    
    container.innerHTML = specialtiesWithStats.map(s => {
        const cfg = SPECIALTY_CONFIG[s.id] || { color: '#6b7280', icon: 'fa-book-medical' };
        const prog = s.prog;
        
        // Déterminer la classe de couleur du ressenti
        let feelingClass = 'feeling-none';
        let feelingDisplay = '--';
        if (prog.avgFeeling !== null) {
            feelingDisplay = prog.avgFeeling.toFixed(1) + '/5';
            if (prog.avgFeeling < 1.5) feelingClass = 'feeling-c1';
            else if (prog.avgFeeling < 2.5) feelingClass = 'feeling-c2';
            else if (prog.avgFeeling < 3.5) feelingClass = 'feeling-c3';
            else if (prog.avgFeeling < 4.5) feelingClass = 'feeling-c4';
            else feelingClass = 'feeling-c5';
        }
        
        return '<div class="specialty-card" onclick="navigateToSpecialty(\'' + s.id + '\')" style="border-left: 4px solid ' + cfg.color + ';">' +
            '<div class="specialty-header"><span class="specialty-name"><span class="specialty-icon" style="background:' + cfg.color + ';"><i class="fas ' + cfg.icon + '"></i></span>' + s.name + '</span><span class="specialty-badge" style="background:' + cfg.color + ';">' + s.items.length + '</span></div>' +
            '<div class="specialty-stats"><span class="specialty-stat ' + (prog.percentage === 100 ? 'completed' : '') + '"><i class="fas fa-check-circle"></i> ' + prog.itemsSeen + '/' + prog.totalItems + ' items</span><span class="specialty-stat"><i class="fas fa-redo"></i> ' + prog.totalTours + ' tours</span></div>' +
            '<div class="specialty-extra-stats">' +
                '<span class="specialty-extra-stat time-stat"><i class="fas fa-clock"></i> ' + prog.totalTime + '</span>' +
                '<span class="specialty-extra-stat feeling-stat ' + feelingClass + '"><i class="fas fa-heart"></i> ' + feelingDisplay + '</span>' +
            '</div>' +
            '<div class="specialty-progress"><div class="progress-bar"><div class="progress-fill" style="width:' + prog.percentage + '%;background:linear-gradient(135deg,' + cfg.color + ',' + cfg.color + 'dd);"></div></div></div></div>';
    }).join('');
}

// ===== PAGINATION ITEMS =====
let currentPage = 1;
let itemsPerPage = 50;
let totalFilteredItems = 0;

function getTotalPages() {
    if (itemsPerPage === 'all') return 1;
    return Math.ceil(totalFilteredItems / itemsPerPage);
}


function updatePaginationUI() {
    const totalPages = getTotalPages();
    const currentText = itemsPerPage === 'all' ? '1 / 1' : currentPage + ' / ' + totalPages;
    const totalText = totalFilteredItems + ' items';
    
    // Mettre à jour les deux paginations (haut et bas)
    ['top', 'bottom'].forEach(pos => {
        const currentEl = document.getElementById('pagination-current-' + pos);
        const totalEl = document.getElementById('pagination-total-' + pos);
        const firstBtn = document.getElementById('pagination-first-' + pos);
        const prevBtn = document.getElementById('pagination-prev-' + pos);
        const nextBtn = document.getElementById('pagination-next-' + pos);
        const lastBtn = document.getElementById('pagination-last-' + pos);
        
        if (currentEl) currentEl.textContent = currentText;
        if (totalEl) totalEl.textContent = totalText;
        
        // Désactiver/activer les boutons
        const isFirst = currentPage === 1;
        const isLast = currentPage === totalPages || itemsPerPage === 'all';
        
        if (firstBtn) firstBtn.disabled = isFirst;
        if (prevBtn) prevBtn.disabled = isFirst;
        if (nextBtn) nextBtn.disabled = isLast;
        if (lastBtn) lastBtn.disabled = isLast;
    });
}

function goToPage(page) {
    const totalPages = getTotalPages();
    if (page < 1) page = 1;
    if (page > totalPages) page = totalPages;
    currentPage = page;
    renderItemsTable();
    
    // Scroll vers la barre de filtres avec offset différent selon l'écran
    const filterBar = document.querySelector('#page-items .filter-bar');
    if (filterBar) {
        const rect = filterBar.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // Offset différent pour mobile et desktop
        const isMobile = window.innerWidth <= 768;
        const offset = isMobile ? 182 : 169;
        
        const targetPosition = scrollTop + rect.top - offset;
        
        window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
        });
    }
}

function changePageSize(size) {
    if (size === 'all') {
        itemsPerPage = 'all';
    } else {
        itemsPerPage = parseInt(size);
    }
    currentPage = 1;
    
    // Synchroniser le dropdown personnalisé
    updatePaginationDropdown(size);
    
    renderItemsTable();
    
    // Remonter en haut
    const filterBar = document.querySelector('#page-items .filter-bar');
    if (filterBar) {
        const rect = filterBar.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const isMobile = window.innerWidth <= 768;
        const offset = isMobile ? 182 : 169;
        window.scrollTo({
            top: scrollTop + rect.top - offset,
            behavior: 'smooth'
        });
    }
}

// Initialiser les événements de pagination
function initPagination() {
    // Boutons header (top) - seulement prev/next
    document.getElementById('pagination-prev-top')?.addEventListener('click', () => goToPage(currentPage - 1));
    document.getElementById('pagination-next-top')?.addEventListener('click', () => goToPage(currentPage + 1));
    
    // Boutons bas (bottom) - tous les boutons
    document.getElementById('pagination-first-bottom')?.addEventListener('click', () => goToPage(1));
    document.getElementById('pagination-prev-bottom')?.addEventListener('click', () => goToPage(currentPage - 1));
    document.getElementById('pagination-next-bottom')?.addEventListener('click', () => goToPage(currentPage + 1));
    document.getElementById('pagination-last-bottom')?.addEventListener('click', () => goToPage(getTotalPages()));
    
    // Sélecteur de taille (seulement en bas maintenant)
    document.getElementById('pagination-size-bottom')?.addEventListener('change', function() {
        changePageSize(this.value);
    });
}

// Appeler l'initialisation au chargement
document.addEventListener('DOMContentLoaded', initPagination);

function renderItemsTable() {
    const tbody = document.getElementById('items-table-body');
    const emptyState = document.getElementById('items-empty');
    const searchTerm = (document.getElementById('search-item')?.value || '').toLowerCase();
    const filterSpecialty = document.getElementById('filter-item-specialty')?.value || 'all';
    const filterStatus = document.getElementById('filter-item-status')?.value || 'all';
    const filterReference = document.getElementById('filter-item-reference')?.value || 'all';
    
    let allItems = [];
    SPECIALTIES_DATA.forEach(s => {
        s.items.forEach(item => {
            const d = getItemData(s.id, item.fc);
            const lastDate = d.tourDates.filter(x => x).pop() || d.lastRevision;
            allItems.push({ ...item, specialtyId: s.id, specialtyName: s.name, daysSince: getDaysSince(lastDate), toursCompleted: d.tours.filter(t => t !== null).length });
        });
    });
    
    let filtered = allItems.filter(item => {
        const matchSearch = item.name.toLowerCase().includes(searchTerm) || item.num.includes(searchTerm);
const matchSpec = selectedSpecialties.length === 0 || selectedSpecialties.includes(item.specialtyId);
        let matchStatus = true;
        if (filterStatus === 'not-started') matchStatus = item.toursCompleted === 0;
        else if (filterStatus === 'in-progress') matchStatus = item.toursCompleted > 0 && item.toursCompleted < MAX_TOURS;
        else if (filterStatus === 'completed') matchStatus = item.toursCompleted === MAX_TOURS;
        
        // Filtre référence et pastilles
        const isReference = ITEM_REFERENCE[item.num + '|' + item.specialtyId] === true;
        const hasBadge = ITEM_BADGES[item.specialtyId + '|' + item.name] !== undefined;
        let matchReference = true;
        if (filterReference === 'reference-only') matchReference = isReference;
        else if (filterReference === 'badge-only') matchReference = hasBadge;
        
        return matchSearch && matchSpec && matchStatus && matchReference;
    });
    
    // Tri
    filtered.sort((a, b) => {
        let cmp = 0;
        if (currentSort.field === 'num') cmp = parseInt(a.num) - parseInt(b.num);
        else if (currentSort.field === 'name') cmp = a.name.localeCompare(b.name);
        else if (currentSort.field === 'specialty') cmp = a.specialtyName.localeCompare(b.specialtyName);
        else if (currentSort.field === 'days') cmp = (a.daysSince ?? 9999) - (b.daysSince ?? 9999);
        return currentSort.direction === 'desc' ? -cmp : cmp;
    });
    
    // Mettre à jour le total filtré
    totalFilteredItems = filtered.length;
    
    // Reset page si nécessaire (après un filtre)
    const totalPages = getTotalPages();
    if (currentPage > totalPages && totalPages > 0) {
        currentPage = totalPages;
    }
    if (currentPage < 1) currentPage = 1;
    
    // Appliquer la pagination
    let paginatedItems = filtered;
    if (itemsPerPage !== 'all') {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        paginatedItems = filtered.slice(startIndex, endIndex);
    }
    
    // Mettre à jour l'UI de pagination
    updatePaginationUI();
    
    if (filtered.length === 0) { 
        tbody.innerHTML = ''; 
        emptyState.style.display = 'block'; 
        return; 
    }
    emptyState.style.display = 'none';
    
    // Générer le HTML seulement pour les items paginés
    tbody.innerHTML = paginatedItems.map(item => {
        const d = getItemData(item.specialtyId, item.fc);
        
        const tourBadges = d.tours.map((c, i) => {
            const duration = d.tourDurations ? d.tourDurations[i] : null;
            const support = d.tourSupports ? d.tourSupports[i] : null;
            const supportLabels = { qcm: 'QCM', college: 'COL', anki: 'ANK', perso: 'PER', codex: 'COD', conf: 'CNF' };
            
            const lastDoneIndex = d.tours.reduce((last, t, idx) => t !== null ? idx : last, -1);
            const nextTourIndex = lastDoneIndex + 1;
            const isEditable = (c !== null && i === lastDoneIndex) || (c === null && i === nextTourIndex);
            const isLocked = c === null && i !== nextTourIndex;
            
            let info = '';
            if (c) {
                info = '<div class="tour-info">';
                if (duration) info += '<span class="tour-duration">' + duration + '</span>';
                if (support) info += '<span class="tour-support ' + support + '">' + supportLabels[support] + '</span>';
                info += '</div>';
            }
            
            if (isLocked) {
                return '<div class="tour-badge-wrapper"><span class="tour-badge locked">T' + (i + 1) + '</span></div>';
            }
            
            if (isEditable) {
                return '<div class="tour-badge-wrapper"><span class="tour-badge ' + (c ? 'c' + c : '') + '" data-specialty="' + item.specialtyId + '" data-fc="' + item.fc + '" data-tour="' + i + '" onclick="openConfidenceModal(this)">T' + (i + 1) + '</span>' + info + '</div>';
            }
            
            return '<div class="tour-badge-wrapper"><span class="tour-badge ' + (c ? 'c' + c : '') + '" style="cursor: default;">T' + (i + 1) + '</span>' + info + '</div>';
        }).join('');

        const tourDates = d.tourDates.map(dt => '<span class="tour-date">' + formatDate(dt) + '</span>').join('');
        const days = item.daysSince;
        let daysBadge = '<span class="days-badge never">Jamais</span>';
        if (days !== null) {
            if (days <= 7) daysBadge = '<span class="days-badge recent">' + days + 'j</span>';
            else if (days <= 30) daysBadge = '<span class="days-badge moderate">' + days + 'j</span>';
            else daysBadge = '<span class="days-badge old">' + days + 'j</span>';
        }
        
		const res = d.resources || {};
		let resourcesHtml = '';
		if (selectedResources.length === 0) {
			resourcesHtml = '<div class="resources-empty-btn" onclick="openResourcesConfigModal()"><i class="fas fa-plus"></i><span>Configurer</span></div>';
		} else {
			resourcesHtml = '<div class="resources-grid">' + selectedResources.map(resId => {
				const resourceConfig = AVAILABLE_RESOURCES.find(r => r.id === resId);
				if (!resourceConfig) return '';
				const isValidated = res[resId] === true;
				return '<div class="resource-box ' + resourceConfig.cssClass + (isValidated ? ' validated' : '') + '" onclick="toggleResourceValidation(\'' + item.specialtyId + '\', \'' + item.fc + '\', \'' + resId + '\')">' + resourceConfig.shortLabel + '</div>';
			}).join('') + '</div>';
		}


        const specCfg = SPECIALTY_CONFIG[item.specialtyId] || { color: '#6b7280' };
        const badgeType = ITEM_BADGES[item.specialtyId + '|' + item.name];
        const badgeHtml = badgeType && BADGE_CONFIG[badgeType] ? '<span class="item-badge ' + BADGE_CONFIG[badgeType].class + '">' + BADGE_CONFIG[badgeType].label + '</span>' : '';
        const isReference = ITEM_REFERENCE[item.num + '|' + item.specialtyId] === true;
        const referenceHtml = isReference ? '<span class="reference-badge"><i class="fas fa-star"></i> Référence</span>' : '';
        const itemUrl = ITEM_URLS[String(parseInt(item.num, 10))];
        const nameHtml = (isReference && itemUrl) ? '<a href="' + itemUrl + '" target="_blank" class="item-link">' + item.name + '</a>' : item.name;
const escapedName = item.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
const isInChecklist = window.PlanningModule && window.PlanningModule.isItemInChecklist ? 
    window.PlanningModule.isItemInChecklist(item.specialtyId, item.fc) : false;
const checklistBtn = isInChecklist ? 
    '<span class="added-to-checklist-badge" data-specialty="' + item.specialtyId + '" data-fc="' + item.fc + '"><i class="fas fa-check"></i> Ajouté</span>' :
    '<button class="send-to-checklist-btn" data-specialty="' + item.specialtyId + '" data-fc="' + item.fc + '" onclick="sendToChecklist(this, \'' + item.specialtyId + '\', \'' + item.fc + '\', \'' + item.num + '\', \'' + escapedName + '\')"><i class="fas fa-arrow-right"></i> To-do List</button>';
        
		return '<tr><td class="item-num">' + item.num + '<br>' + checklistBtn + '</td><td class="item-name">' + nameHtml + badgeHtml + '</td><td class="item-specialty" style="background-color:' + specCfg.color + '20; color:' + specCfg.color + '; font-weight: 500;">' + item.specialtyName + referenceHtml + '</td>' +					
            '<td class="tour-cell"><div class="tour-badges">' + tourBadges + '</div><div class="tour-dates">' + tourDates + '</div></td>' +
            '<td class="resources-cell">' + resourcesHtml + '</td><td class="days-cell">' + daysBadge + '</td></tr>';
    }).join('');
}


// Reset pagination quand les filtres changent
document.getElementById('search-item')?.addEventListener('input', function() {
    currentPage = 1;
    renderItemsTable();
});

document.getElementById('filter-item-specialty')?.addEventListener('change', function() {
    currentPage = 1;
    renderItemsTable();
});

document.getElementById('filter-item-status')?.addEventListener('change', function() {
    currentPage = 1;
    renderItemsTable();
});

document.getElementById('filter-item-reference')?.addEventListener('change', function() {
    currentPage = 1;
    renderItemsTable();
});

// ===== MULTI-SELECT SPÉCIALITÉS =====
const MAX_SPECIALTY_SELECTION = 4;
let selectedSpecialties = []; // Tableau des spécialités sélectionnées

function initSpecialtyMultiSelect() {
    const container = document.getElementById('specialty-dropdown');
    const btn = document.getElementById('specialty-multi-btn');
    const menu = document.getElementById('specialty-menu');
    const list = document.getElementById('specialty-multi-list');
    const searchInput = document.getElementById('specialty-search-input');
    const clearBtn = document.getElementById('specialty-clear-btn');
    
    if (!container || !btn || !menu || !list) return;
    
    // Générer la liste des options
    renderSpecialtyOptions();
    
// Toggle du menu
btn.addEventListener('click', function(e) {
    e.stopPropagation();
    // Fermer tous les autres dropdowns
    document.querySelectorAll('.custom-select').forEach(s => s.classList.remove('open'));
    container.classList.toggle('open');
    if (container.classList.contains('open')) {
        searchInput.focus();
    }
});
    
    // Recherche
    searchInput.addEventListener('input', function() {
        renderSpecialtyOptions(this.value.toLowerCase());
    });
    
    // Empêcher la fermeture quand on clique dans le menu
    menu.addEventListener('click', function(e) {
        e.stopPropagation();
    });
    
// Bouton effacer
clearBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    selectedSpecialties = [];
    searchInput.value = '';
    updateSpecialtySelection();
    renderSpecialtyOptions('');
});

// Bouton fermer (mobile)
const closeBtn = document.getElementById('specialty-close-btn');
if (closeBtn) {
    closeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        container.classList.remove('open');
    });
}

    
    // Fermer en cliquant ailleurs
    document.addEventListener('click', function(e) {
        if (!container.contains(e.target)) {
            container.classList.remove('open');
        }
    });
}

function renderSpecialtyOptions(searchTerm = '') {
    const list = document.getElementById('specialty-multi-list');
    if (!list) return;
    
    let html = '';
    
    // Option "Toutes les spécialités"
    const isAllSelected = selectedSpecialties.length === 0;
    html += `
        <div class="specialty-multi-option specialty-multi-all ${isAllSelected ? 'selected' : ''}" data-value="all">
            <div class="specialty-multi-checkbox"><i class="fas fa-check"></i></div>
            <span class="specialty-multi-option-icon"><i class="fas fa-list" style="color: var(--primary)"></i></span>
            <span class="specialty-multi-option-text">Toutes les spécialités</span>
        </div>
    `;
    
    // Options des spécialités
    SPECIALTIES_DATA.forEach(s => {
        const cfg = SPECIALTY_CONFIG[s.id] || { icon: 'fa-folder', color: '#6b7280' };
        const isSelected = selectedSpecialties.includes(s.id);
        const isDisabled = !isSelected && selectedSpecialties.length >= MAX_SPECIALTY_SELECTION;
        const matchesSearch = s.name.toLowerCase().includes(searchTerm);
        
        if (!matchesSearch && searchTerm) return;
        
        html += `
            <div class="specialty-multi-option ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                 data-value="${s.id}" data-name="${s.name}">
                <div class="specialty-multi-checkbox"><i class="fas fa-check"></i></div>
                <span class="specialty-multi-option-icon" style="color: ${cfg.color}">
                    <i class="fas ${cfg.icon}"></i>
                </span>
                <span class="specialty-multi-option-text">${s.name}</span>
            </div>
        `;
    });
    
    list.innerHTML = html;
	
list.querySelectorAll('.specialty-multi-option').forEach(opt => {
    opt.addEventListener('click', function() {
        const value = this.dataset.value;
        
        if (value === 'all') {
            selectedSpecialties = [];
            document.getElementById('specialty-dropdown').classList.remove('open');
        } else if (this.classList.contains('disabled')) {
            return; // Ignorer si désactivé
        } else {
            const index = selectedSpecialties.indexOf(value);
            if (index > -1) {
                selectedSpecialties.splice(index, 1);
            } else if (selectedSpecialties.length < MAX_SPECIALTY_SELECTION) {
                selectedSpecialties.push(value);
            }
        }
        
        updateSpecialtySelection();
        renderSpecialtyOptions(document.getElementById('specialty-search-input')?.value.toLowerCase() || '');
        
        // Fermer si 4 spécialités atteintes
        if (selectedSpecialties.length >= MAX_SPECIALTY_SELECTION) {
            document.getElementById('specialty-dropdown').classList.remove('open');
        }
    });
});
}

function updateSpecialtySelection() {
    const content = document.querySelector('.specialty-multi-content');
    const counter = document.getElementById('specialty-counter');
    const filterInput = document.getElementById('filter-item-specialty');
    
    if (!content) return;
    
    // Mettre à jour le compteur
    if (counter) {
        counter.textContent = selectedSpecialties.length;
        counter.classList.toggle('max-reached', selectedSpecialties.length >= MAX_SPECIALTY_SELECTION);
    }
    
    // Mettre à jour l'input hidden (pour compatibilité)
    if (filterInput) {
        filterInput.value = selectedSpecialties.length === 0 ? 'all' : selectedSpecialties.join(',');
    }
    
    // Mettre à jour l'affichage des chips
    if (selectedSpecialties.length === 0) {
        content.innerHTML = '<span class="specialty-multi-placeholder">Toutes les spécialités</span>';
    } else {
        let chipsHtml = '';
        selectedSpecialties.forEach(sId => {
            const spec = SPECIALTIES_DATA.find(s => s.id === sId);
            if (spec) {
                const cfg = SPECIALTY_CONFIG[sId] || { color: '#6b7280' };
						const abbrev = SPECIALTY_SHORT[sId] || spec.name.substring(0, 3).toUpperCase();
						chipsHtml += `
							<div class="specialty-chip" style="background: ${cfg.color}" data-id="${sId}" title="${spec.name}">
								<span>${abbrev}</span>
								<span class="specialty-chip-remove" onclick="removeSpecialtyChip(event, '${sId}')">
									<i class="fas fa-times"></i>
								</span>
							</div>
						`;
               
            }
        });
        content.innerHTML = chipsHtml;
    }
    
    // Déclencher le re-rendu du tableau
    renderItemsTable();
}

window.removeSpecialtyChip = function(event, sId) {
    event.stopPropagation();
    const index = selectedSpecialties.indexOf(sId);
    if (index > -1) {
        selectedSpecialties.splice(index, 1);
        updateSpecialtySelection();
        renderSpecialtyOptions(document.getElementById('specialty-search-input')?.value.toLowerCase() || '');
    }
};

// Fonction pour le pré-filtre depuis la page spécialités
window.navigateToSpecialty = function(sId) {
    document.querySelectorAll('.app-nav-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.app-page').forEach(p => p.classList.remove('active'));
    document.querySelector('[data-page="items"]').classList.add('active');
    document.getElementById('page-items').classList.add('active');
    
    // Définir cette spécialité comme seule sélectionnée
    selectedSpecialties = [sId];
    updateSpecialtySelection();
    renderSpecialtyOptions();
    
    // Scroll jusqu'aux boutons de navigation
    const appNav = document.querySelector('.app-nav');
    if (appNav) {
        const headerHeight = 70;
        const navPosition = appNav.getBoundingClientRect().top + window.pageYOffset - headerHeight - 10;
        window.scrollTo({ top: navPosition, behavior: 'smooth' });
    }
};

// ===== CUSTOM SELECT DROPDOWNS =====
function initCustomSelects() {
    // Gestion ouverture/fermeture
    document.querySelectorAll('.custom-select-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const parent = this.closest('.custom-select');
            const wasOpen = parent.classList.contains('open');
            
            // Fermer tous les autres
            document.querySelectorAll('.custom-select').forEach(s => s.classList.remove('open'));
			document.getElementById('specialty-dropdown')?.classList.remove('open');
            
            if (!wasOpen) {
                parent.classList.add('open');
            }
        });
    });

    // Gestion sélection d'option
    document.querySelectorAll('.custom-select-menu').forEach(menu => {
        menu.addEventListener('click', function(e) {
            const option = e.target.closest('.custom-select-option');
            if (!option) return;
            
            const parent = this.closest('.custom-select');
            const value = option.dataset.value;
            const text = option.querySelector('span:last-child').textContent;
            const iconHtml = option.querySelector('.option-icon').innerHTML;
            
            // Mettre à jour le bouton
            parent.querySelector('.custom-select-text').textContent = text;
            parent.querySelector('.custom-select-icon').innerHTML = iconHtml;
            
            // Mettre à jour la classe selected
            this.querySelectorAll('.custom-select-option').forEach(o => o.classList.remove('selected'));
            option.classList.add('selected');
            
            // Mettre à jour l'input hidden
            parent.querySelector('input[type="hidden"]').value = value;
            
            // Fermer le menu
            parent.classList.remove('open');
            
            // Déclencher le rendu
            renderItemsTable();
        });
    });

    // Fermer au clic extérieur
    document.addEventListener('click', function() {
        document.querySelectorAll('.custom-select').forEach(s => s.classList.remove('open'));
    });
}

// Appeler après le chargement des données
setTimeout(initCustomSelects, 500);
setTimeout(initSpecialtyMultiSelect, 600);

// Dropdown tri spécialités
const sortSpecialtyDropdown = document.getElementById('sort-specialty-dropdown');
if (sortSpecialtyDropdown) {
    const btn = sortSpecialtyDropdown.querySelector('.custom-select-btn');
    const menu = sortSpecialtyDropdown.querySelector('.custom-select-menu');
    const options = sortSpecialtyDropdown.querySelectorAll('.custom-select-option');
    const hiddenInput = document.getElementById('sort-specialty');
    
    btn.addEventListener('click', () => menu.classList.toggle('show'));
    
    options.forEach(opt => {
        opt.addEventListener('click', () => {
            options.forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            hiddenInput.value = opt.dataset.value;
            btn.querySelector('.custom-select-text').textContent = opt.querySelector('span:last-child').textContent;
            menu.classList.remove('show');
            renderDashboardSpecialties();
        });
    });
}

// Dropdown filtre statut spécialités
const filterSpecialtyDropdown = document.getElementById('filter-specialty-dropdown');
if (filterSpecialtyDropdown) {
    const btn = filterSpecialtyDropdown.querySelector('.custom-select-btn');
    const menu = filterSpecialtyDropdown.querySelector('.custom-select-menu');
    const options = filterSpecialtyDropdown.querySelectorAll('.custom-select-option');
    const hiddenInput = document.getElementById('filter-specialty-status');
    
    btn.addEventListener('click', () => menu.classList.toggle('show'));
    
    options.forEach(opt => {
        opt.addEventListener('click', () => {
            options.forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            hiddenInput.value = opt.dataset.value;
            btn.querySelector('.custom-select-text').textContent = opt.querySelector('span:last-child').textContent;
            menu.classList.remove('show');
            renderDashboardSpecialties();
        });
    });
}

// ===== DROPDOWN PAGINATION PERSONNALISÉ =====
document.addEventListener('DOMContentLoaded', function() {
    const paginationDropdown = document.getElementById('pagination-dropdown');
    const paginationBtn = document.getElementById('pagination-dropdown-btn');
    const paginationMenu = document.getElementById('pagination-dropdown-menu');
    const paginationText = document.getElementById('pagination-dropdown-text');
    
    if (!paginationBtn || !paginationMenu) return;
    
    // Toggle menu
    paginationBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        paginationBtn.classList.toggle('active');
        paginationMenu.classList.toggle('active');
    });
    
    // Sélection d'une option
    paginationMenu.querySelectorAll('.custom-dropdown-option').forEach(option => {
        option.addEventListener('click', function() {
            const value = this.dataset.value;
            const text = this.textContent;
            
            // Mettre à jour le texte affiché
            paginationText.textContent = text;
            
            // Mettre à jour la classe selected
            paginationMenu.querySelectorAll('.custom-dropdown-option').forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            
            // Fermer le menu
            paginationBtn.classList.remove('active');
            paginationMenu.classList.remove('active');
            
            // Appeler la fonction de changement de taille
            changePageSize(value);
        });
    });
    
    // Fermer si clic ailleurs
    document.addEventListener('click', function(e) {
        if (!paginationDropdown.contains(e.target)) {
            paginationBtn.classList.remove('active');
            paginationMenu.classList.remove('active');
        }
    });
});

// Fonction pour mettre à jour le dropdown depuis l'extérieur
function updatePaginationDropdown(value) {
    const paginationText = document.getElementById('pagination-dropdown-text');
    const paginationMenu = document.getElementById('pagination-dropdown-menu');
    
    if (!paginationText || !paginationMenu) return;
    
    const option = paginationMenu.querySelector(`[data-value="${value}"]`);
    if (option) {
        paginationText.textContent = option.textContent;
        paginationMenu.querySelectorAll('.custom-dropdown-option').forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
    }
}

function populateFilters() {
    // Utilise le nouveau système multi-select
    if (typeof renderSpecialtyOptions === 'function') {
        renderSpecialtyOptions();
    }
    if (typeof updateSpecialtySelection === 'function') {
        updateSpecialtySelection();
    }
}

let selectedConfidence = null;
let selectedSupport = null;

window.openConfidenceModal = function(el) {
    pendingTour = { specialtyId: el.dataset.specialty, fc: el.dataset.fc, tour: parseInt(el.dataset.tour) };
    
    const d = getItemData(pendingTour.specialtyId, pendingTour.fc);
    const tourIndex = pendingTour.tour;
    
    selectedConfidence = d.tours[tourIndex];
    selectedSupport = d.tourSupports ? d.tourSupports[tourIndex] : null;
    
    // Reset UI
    document.querySelectorAll('.confidence-btn').forEach(b => b.classList.remove('selected'));
    document.querySelectorAll('.support-btn').forEach(b => b.classList.remove('selected'));
    
    // Reset erreurs
    document.getElementById('confidence-error')?.classList.remove('visible');
    document.getElementById('duration-error')?.classList.remove('visible');
    document.getElementById('date-error')?.classList.remove('visible');
    
    if (selectedConfidence) {
        document.querySelector('.confidence-btn[data-confidence="' + selectedConfidence + '"]')?.classList.add('selected');
    }
    if (selectedSupport) {
        document.querySelector('.support-btn[data-support="' + selectedSupport + '"]')?.classList.add('selected');
    }
    
// Date : existante ou aujourd'hui + définir la date max à aujourd'hui
    const dateInput = document.getElementById('tour-date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.setAttribute('max', today);
    
    // Trouver la date du dernier tour AVANT celui-ci
    let minDate = null;
    if (d.tourDates && tourIndex > 0) {
        // Parcourir les tours précédents pour trouver le plus récent
        for (let i = tourIndex - 1; i >= 0; i--) {
            if (d.tourDates[i]) {
                minDate = d.tourDates[i].split('T')[0];
                break;
            }
        }
    }
    
    // Définir la date min (date du dernier tour précédent)
    if (minDate) {
        dateInput.setAttribute('min', minDate);
    } else {
        dateInput.removeAttribute('min');
    }
    
    if (d.tourDates && d.tourDates[tourIndex]) {
        dateInput.value = d.tourDates[tourIndex].split('T')[0];
    } else {
        dateInput.value = today;
    }
    
    // Durée
    const existingDuration = d.tourDurations ? d.tourDurations[tourIndex] : null;
    if (existingDuration) {
        const parts = existingDuration.split(':');
        document.getElementById('tour-duration-hours').value = parseInt(parts[0]) || '';
        document.getElementById('tour-duration-minutes').value = parts[1] || '';
    } else {
        document.getElementById('tour-duration-hours').value = '';
        document.getElementById('tour-duration-minutes').value = '';
    }
    
    confidenceModal.classList.add('active');
};

document.querySelectorAll('.confidence-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.confidence-btn').forEach(b => b.classList.remove('selected'));
        this.classList.add('selected');
        selectedConfidence = parseInt(this.dataset.confidence);
        document.getElementById('confidence-error')?.classList.remove('visible');
    });
});

document.querySelectorAll('.support-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        selectedSupport = this.dataset.support;
        document.querySelectorAll('.support-btn').forEach(b => b.classList.remove('selected'));
        this.classList.add('selected');
    });
});

document.getElementById('btn-save-tour')?.addEventListener('click', function() {
    const errorEl = document.getElementById('confidence-error');
    const durationErrorEl = document.getElementById('duration-error');
    const dateErrorEl = document.getElementById('date-error');
    
    // Reset toutes les erreurs
    errorEl.classList.remove('visible');
    durationErrorEl.classList.remove('visible');
    dateErrorEl.classList.remove('visible');
    
    let hasError = false;
    
    // Validation confiance
    if (!selectedConfidence) {
        errorEl.classList.add('visible');
        hasError = true;
    }
    
    if (!pendingTour) return;
    
    // VALIDATION : Durée max 10h
    const hours = parseInt(document.getElementById('tour-duration-hours').value) || 0;
    const minutes = parseInt(document.getElementById('tour-duration-minutes').value) || 0;
    
    if (hours > 10) {
        durationErrorEl.classList.add('visible');
        document.getElementById('tour-duration-hours').focus();
        hasError = true;
    }
    
    // VALIDATION : Date pas dans le futur
    const dateInput = document.getElementById('tour-date');
    const selectedDateStr = dateInput.value;
    const today = new Date().toISOString().split('T')[0];
    
    if (selectedDateStr > today) {
        dateErrorEl.textContent = 'Vous ne pouvez pas sélectionner une date future';
        dateErrorEl.classList.add('visible');
        dateInput.focus();
        hasError = true;
    }
    
    // VALIDATION : Date pas avant le dernier tour précédent
    // Récupérer les données pour vérifier les tours précédents
    const tempD = getItemData(pendingTour.specialtyId, pendingTour.fc);
    
    if (pendingTour.tour > 0 && tempD.tourDates) {
        // Trouver la date du dernier tour AVANT celui-ci
        for (let i = pendingTour.tour - 1; i >= 0; i--) {
            if (tempD.tourDates[i]) {
                const previousTourDate = tempD.tourDates[i].split('T')[0];
                if (selectedDateStr < previousTourDate) {
                    dateErrorEl.textContent = 'La date ne peut pas être antérieure au tour précédent (' + previousTourDate + ')';
                    dateErrorEl.classList.add('visible');
                    dateInput.focus();
                    hasError = true;
                }
                break;
            }
        }
    }
    
    // Si erreur, on arrête
    if (hasError) return;
    
    const d = getItemData(pendingTour.specialtyId, pendingTour.fc);
    const tourIndex = pendingTour.tour;
    
    if (!d.tourDurations) d.tourDurations = [null,null,null,null,null,null,null,null];
    if (!d.tourSupports) d.tourSupports = [null,null,null,null,null,null,null,null];
    
    d.tours[tourIndex] = selectedConfidence;
    
    // Date personnalisée
    const selectedDate = selectedDateStr ? new Date(selectedDateStr).toISOString() : new Date().toISOString();
    d.tourDates[tourIndex] = selectedDate;
    
    // Durée
    const hoursStr = hours.toString();
    const minutesStr = minutes.toString().padStart(2, '0');
    d.tourDurations[tourIndex] = hoursStr + ':' + minutesStr;
    
    d.tourSupports[tourIndex] = selectedSupport;
    d.lastRevision = selectedDate;
    
    confidenceModal.classList.remove('active');
    pendingTour = null;
    selectedConfidence = null;
    selectedSupport = null;
    debouncedSave();
    renderAll();
    
    // Si on vient de la checklist, valider la tâche ET afficher une notification
    if (pendingChecklistItemId !== null) {
        // Valider la tâche dans la checklist
        if (typeof PlanningModule !== 'undefined' && PlanningModule.completeChecklistItem) {
            PlanningModule.completeChecklistItem(pendingChecklistItemId);
        }
        window.showToastNotification('Tour enregistré et tâche validée !', 'success');
        pendingChecklistItemId = null;
    }
    
    // Vérifier les trophées après validation
    if (typeof TrophiesSystem !== 'undefined') {
        setTimeout(() => TrophiesSystem.checkTrophies(), 500);
    }
});
document.getElementById('btn-reset-tour')?.addEventListener('click', function() {
    if (!pendingTour) return;
    
    const d = getItemData(pendingTour.specialtyId, pendingTour.fc);
    const tourIndex = pendingTour.tour;
    
    d.tours[tourIndex] = null;
    d.tourDates[tourIndex] = null;
    if (d.tourDurations) d.tourDurations[tourIndex] = null;
    if (d.tourSupports) d.tourSupports[tourIndex] = null;
    
    const remainingDates = d.tourDates.filter(x => x);
    d.lastRevision = remainingDates.length > 0 ? remainingDates[remainingDates.length - 1] : null;
    
    confidenceModal.classList.remove('active');
    pendingTour = null;
    selectedConfidence = null;
    selectedSupport = null;
    debouncedSave();
    renderAll();
	
	    // Vérifier les trophées après validation
    if (typeof TrophiesSystem !== 'undefined') {
        setTimeout(() => TrophiesSystem.checkTrophies(), 500);
    }
	
	
});

document.getElementById('confidence-close')?.addEventListener('click', () => { 
    confidenceModal.classList.remove('active'); 
    pendingTour = null; 
    selectedConfidence = null;
    selectedSupport = null;
	pendingChecklistItemId = null;
});

confidenceModal?.addEventListener('click', e => { 
    if (e.target === confidenceModal) { 
        confidenceModal.classList.remove('active'); 
        pendingTour = null;
        selectedConfidence = null;
        selectedSupport = null;
    } 
});


window.navigateToSpecialty = function(sId) {
    document.querySelectorAll('.app-nav-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.app-page').forEach(p => p.classList.remove('active'));
    document.querySelector('[data-page="items"]').classList.add('active');
    document.getElementById('page-items').classList.add('active');
    
    // Définir cette spécialité comme seule sélectionnée (multi-select)
    selectedSpecialties = [sId];
    updateSpecialtySelection();
    renderSpecialtyOptions();
    
    // Scroll jusqu'aux boutons de navigation
    const appNav = document.querySelector('.app-nav');
    if (appNav) {
        const headerHeight = 70;
        const navPosition = appNav.getBoundingClientRect().top + window.pageYOffset - headerHeight - 10;
        window.scrollTo({ top: navPosition, behavior: 'smooth' });
    }
};


document.querySelectorAll('.items-table th[data-sort]').forEach(th => {
    th.addEventListener('click', function() {
        const field = this.dataset.sort;
        if (currentSort.field === field) currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        else { currentSort.field = field; currentSort.direction = 'asc'; }
        document.querySelectorAll('.items-table th').forEach(h => h.classList.remove('sorted'));
        this.classList.add('sorted');
        renderItemsTable();
    });
});

document.getElementById('search-item')?.addEventListener('input', renderItemsTable);
document.getElementById('filter-item-specialty')?.addEventListener('change', renderItemsTable);
document.getElementById('filter-item-status')?.addEventListener('change', renderItemsTable);
document.getElementById('filter-item-reference')?.addEventListener('change', renderItemsTable);
document.getElementById('search-specialty')?.addEventListener('input', renderDashboardSpecialties);



document.getElementById('btn-reset-filters')?.addEventListener('click', () => {
    const btn = document.getElementById('btn-reset-filters');
    
    // Empêcher les clics multiples
    if (btn.disabled) return;
    
    const originalHTML = btn.innerHTML;
    const originalWidth = btn.offsetWidth + 'px'; // Capturer la largeur actuelle
    btn.disabled = true;
    btn.style.width = originalWidth; // Fixer la largeur
    
    // Reset search
    document.getElementById('search-item').value = '';
    
// Reset specialty multi-select
selectedSpecialties = [];
updateSpecialtySelection();
renderSpecialtyOptions();
    
    // Reset status dropdown
    document.getElementById('filter-item-status').value = 'all';
    const statusDropdown = document.getElementById('status-dropdown');
    if (statusDropdown) {
        statusDropdown.querySelector('.custom-select-text').textContent = 'Tous les statuts';
        statusDropdown.querySelector('.custom-select-icon').innerHTML = '<i class="fas fa-tasks"></i>';
        statusDropdown.querySelectorAll('.custom-select-option').forEach(o => o.classList.remove('selected'));
        statusDropdown.querySelector('[data-value="all"]').classList.add('selected');
    }
    
    // Reset reference dropdown
    document.getElementById('filter-item-reference').value = 'all';
    const referenceDropdown = document.getElementById('reference-dropdown');
    if (referenceDropdown) {
        referenceDropdown.querySelector('.custom-select-text').textContent = 'Tous les items';
        referenceDropdown.querySelector('.custom-select-icon').innerHTML = '<i class="fas fa-list"></i>';
        referenceDropdown.querySelectorAll('.custom-select-option').forEach(o => o.classList.remove('selected'));
        referenceDropdown.querySelector('[data-value="all"]').classList.add('selected');
    }
    
    // Reset tri par numéro croissant
    currentSort = { field: 'num', direction: 'asc' };  
    renderItemsTable();
    
    // Retirer l'indicateur visuel de tri (sélecteur bleu)
    document.querySelectorAll('.items-table th').forEach(h => h.classList.remove('sorted'));
    
    // Scroll jusqu'aux boutons de navigation
    const appNav = document.querySelector('.app-nav');
    if (appNav) {
        const headerHeight = 70;
        const navPosition = appNav.getBoundingClientRect().top + window.pageYOffset - headerHeight - 10;
        window.scrollTo({ top: navPosition, behavior: 'smooth' });
    }
    
    // Feedback visuel
    btn.classList.add('success');
    btn.innerHTML = '<i class="fas fa-check"></i> Réinitialisé !';
    
    setTimeout(() => {
        btn.classList.remove('success');
        btn.innerHTML = originalHTML;
        btn.disabled = false;
        btn.style.width = ''; // Retirer la largeur fixe
    }, 1500);
});

document.getElementById('btn-reset-filters-specialty')?.addEventListener('click', () => {
    const btn = document.getElementById('btn-reset-filters-specialty');
    
    // Empêcher les clics multiples
    if (btn.disabled) return;
    
    const originalHTML = btn.innerHTML;
    const originalWidth = btn.offsetWidth + 'px'; // Capturer la largeur actuelle
    btn.disabled = true;
    btn.style.width = originalWidth; // Fixer la largeur
    
    // Reset search
    document.getElementById('search-specialty').value = '';
    
    // Reset sort dropdown
    document.getElementById('sort-specialty').value = 'default';
    const sortDropdown = document.getElementById('sort-specialty-dropdown');
    if (sortDropdown) {
        sortDropdown.querySelector('.custom-select-text').textContent = 'Trier par...';
        sortDropdown.querySelector('.custom-select-icon').innerHTML = '<i class="fas fa-sort"></i>';
        sortDropdown.querySelectorAll('.custom-select-option').forEach(o => o.classList.remove('selected'));
        sortDropdown.querySelector('[data-value="default"]').classList.add('selected');
    }
    
    // Reset status dropdown
    document.getElementById('filter-specialty-status').value = 'all';
    const filterDropdown = document.getElementById('filter-specialty-dropdown');
    if (filterDropdown) {
        filterDropdown.querySelector('.custom-select-text').textContent = 'Tous les statuts';
        filterDropdown.querySelector('.custom-select-icon').innerHTML = '<i class="fas fa-filter"></i>';
        filterDropdown.querySelectorAll('.custom-select-option').forEach(o => o.classList.remove('selected'));
        filterDropdown.querySelector('[data-value="all"]').classList.add('selected');
    }
    
    renderDashboardSpecialties();
    
    // Scroll jusqu'aux boutons de navigation
    const appNav = document.querySelector('.app-nav');
    if (appNav) {
        const headerHeight = 70;
        const navPosition = appNav.getBoundingClientRect().top + window.pageYOffset - headerHeight - 10;
        window.scrollTo({ top: navPosition, behavior: 'smooth' });
    }
    
    // Feedback visuel
    btn.classList.add('success');
    btn.innerHTML = '<i class="fas fa-check"></i> Réinitialisé !';
    
    setTimeout(() => {
        btn.classList.remove('success');
        btn.innerHTML = originalHTML;
        btn.disabled = false;
        btn.style.width = ''; // Retirer la largeur fixe
    }, 1500);
});


// ===== GRAPHIQUES HEBDOMADAIRES =====
let chartToursWeekly, chartTimeWeekly, chartFeelingWeekly;

function getLast7Days() {
    const days = [];
    const labels = [];
    for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        days.push(date.toISOString().split('T')[0]);
        labels.push(date.toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric' }));
    }
    return { days, labels };
}

function getWeeklyData() {
    const { days, labels } = getLast7Days();
    const toursPerDay = {};
    const timePerDay = {};
    const feelingsPerDay = {};
    
    // Initialiser tous les jours à 0
    days.forEach(day => {
        toursPerDay[day] = 0;
        timePerDay[day] = 0;
        feelingsPerDay[day] = [];
    });
    
    // Parcourir toutes les données
    SPECIALTIES_DATA.forEach(specialty => {
        specialty.items.forEach(item => {
            const fc = item.fc || item.num;
            const d = getItemData(specialty.id, fc);
            
            if (d.tourDates) {
                d.tourDates.forEach((dateStr, idx) => {
                    if (!dateStr) return;
                    const day = dateStr.split('T')[0];
                    
                    if (toursPerDay.hasOwnProperty(day)) {
                        // Compter les tours
                        toursPerDay[day]++;
                        
							if (d.tourDurations && d.tourDurations[idx]) {
								const durationStr = d.tourDurations[idx];
								let minutesWorked = 0;
								if (typeof durationStr === 'string' && durationStr.includes(':')) {
									const parts = durationStr.split(':');
									minutesWorked = (parseInt(parts[0], 10) * 60) + parseInt(parts[1], 10);
								} else {
									minutesWorked = parseFloat(durationStr) || 0;
								}
								if (!isNaN(minutesWorked)) {
									timePerDay[day] += minutesWorked;
								}
							}
                        
                        // Ressenti
                        if (d.tours[idx]) {
                            feelingsPerDay[day].push(d.tours[idx]);
                        }
                    }
                });
            }
        });
    });
    
    // Convertir en tableaux
    const toursData = days.map(d => toursPerDay[d]);
    const timeData = days.map(d => Math.round(timePerDay[d] / 60 * 10) / 10); // en heures
    const feelingData = days.map(d => {
        const arr = feelingsPerDay[d];
        if (arr.length === 0) return null;
        return Math.round((arr.reduce((a, b) => a + b, 0) / arr.length) * 10) / 10;
    });
    
    // Totaux
    const totalTours = toursData.reduce((a, b) => a + b, 0);
    const totalTime = timeData.reduce((a, b) => a + b, 0);
    const allFeelings = days.flatMap(d => feelingsPerDay[d]);
    const avgFeeling = allFeelings.length > 0 
        ? Math.round((allFeelings.reduce((a, b) => a + b, 0) / allFeelings.length) * 10) / 10 
        : null;
    
    return { labels, toursData, timeData, feelingData, totalTours, totalTime, avgFeeling };
}

function createChartConfig(label, data, color, yAxisConfig = {}) {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.06)';
    const textColor = isDark ? '#9ca3af' : '#6b7280';
    
    return {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: label,
                data: data.values,
                borderColor: color,
                backgroundColor: color + '20',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: color,
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7,
                pointHoverBackgroundColor: color,
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: isDark ? '#1e293b' : '#fff',
                    titleColor: isDark ? '#f9fafb' : '#111827',
                    bodyColor: isDark ? '#d1d5db' : '#4b5563',
                    borderColor: isDark ? '#374151' : '#e5e7eb',
                    borderWidth: 1,
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false,
                    titleFont: { weight: '600', size: 13 },
                    bodyFont: { size: 12 },
                    callbacks: {
                        label: function(context) {
                            return label + ' : ' + (context.parsed.y !== null ? context.parsed.y : '--') + (yAxisConfig.unit || '');
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: textColor,
                        font: { size: 11, weight: '500' }
                    }
                },
                y: {
                    beginAtZero: true,
                    ...yAxisConfig,
                    grid: {
                        color: gridColor,
                        drawBorder: false
                    },
                    ticks: {
                        color: textColor,
                        font: { size: 11 },
                        padding: 8,
                        callback: function(value) {
                            return value + (yAxisConfig.unit || '');
                        }
                    }
                }
            }
        }
    };
}

function initWeeklyCharts() {
    const { labels, toursData, timeData, feelingData, totalTours, totalTime, avgFeeling } = getWeeklyData();
    
    // Détruire les anciens graphiques s'ils existent
    if (chartToursWeekly) chartToursWeekly.destroy();
    if (chartTimeWeekly) chartTimeWeekly.destroy();
    if (chartFeelingWeekly) chartFeelingWeekly.destroy();
    
    // Graphique Tours
    const ctxTours = document.getElementById('chart-tours-weekly');
    if (ctxTours) {
        chartToursWeekly = new Chart(ctxTours, createChartConfig(
            'Tours',
            { labels, values: toursData },
            '#3b82f6',
            { unit: '' }
        ));
    }
    
    // Graphique Temps
    const ctxTime = document.getElementById('chart-time-weekly');
    if (ctxTime) {
        chartTimeWeekly = new Chart(ctxTime, createChartConfig(
            'Temps',
            { labels, values: timeData },
            '#f59e0b',
            { unit: 'h' }
        ));
    }
    
    // Graphique Ressenti
    const ctxFeeling = document.getElementById('chart-feeling-weekly');
    if (ctxFeeling) {
        chartFeelingWeekly = new Chart(ctxFeeling, createChartConfig(
            'Ressenti',
            { labels, values: feelingData },
            '#ec4899',
            { min: 0, max: 5, unit: '' }
        ));
    }
    
    // Mettre à jour les totaux
    document.getElementById('weekly-tours-total').textContent = totalTours;
    document.getElementById('weekly-time-total').textContent = formatDuration(totalTime * 60);
    document.getElementById('weekly-feeling-avg').textContent = avgFeeling !== null ? avgFeeling + '/5' : '--';
}


function formatDuration(minutes) {
    const h = Math.floor(minutes / 60);
    const m = Math.round(minutes % 60);
    return h + 'h' + (m < 10 ? '0' : '') + m;
}

// Mettre à jour les graphiques quand le thème change
const originalThemeToggle = document.getElementById('theme-toggle');
if (originalThemeToggle) {
    originalThemeToggle.addEventListener('click', function() {
        setTimeout(initWeeklyCharts, 100);
    });
}


// ===== MESSAGE DE BIENVENUE =====
function updateWelcomeMessage(userName) {
    const welcomeEl = document.getElementById('welcome-message');
    if (welcomeEl && userName) {
        const hour = new Date().getHours();
        let greeting = 'Bienvenue';
        
        if (hour >= 5 && hour < 12) {
            greeting = 'Bonjour';
        } else if (hour >= 12 && hour < 18) {
            greeting = 'Bon après-midi';
        } else {
            greeting = 'Bonsoir';
        }
        
        welcomeEl.innerHTML = greeting + ', <span class="user-name">' + userName + '</span> !';
        welcomeEl.classList.add('visible');
    }
}

// ===== CARROUSEL APERÇUS =====
function initPreviewCarousels() {
    const tabs = document.querySelectorAll('.preview-tab');
    const carousels = document.querySelectorAll('.preview-carousel');
    
    // Gestion des tabs
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const category = tab.dataset.category;
            
            // Activer le tab
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Afficher le carrousel correspondant
            carousels.forEach(c => {
                c.classList.remove('active');
                if (c.dataset.category === category) {
                    c.classList.add('active');
                    
                    // CORRECTION : Réinitialiser à la première slide lors du changement d'onglet
                    const slides = c.querySelectorAll('.carousel-slide');
                    const dots = c.querySelectorAll('.carousel-dot');
                    slides.forEach((s, i) => {
                        s.classList.remove('active');
                        if (i === 0) s.classList.add('active');
                    });
                    dots.forEach((d, i) => {
                        d.classList.remove('active');
                        if (i === 0) d.classList.add('active');
                    });
                    
                    // Réinitialiser l'index du carrousel
                    if (c.carouselState) {
                        c.carouselState.currentIndex = 0;
                    }
                }
            });
        });
    });
    
    // Initialiser chaque carrousel
    carousels.forEach(carousel => {
        const slides = carousel.querySelectorAll('.carousel-slide');
        const prevBtn = carousel.querySelector('.carousel-prev');
        const nextBtn = carousel.querySelector('.carousel-next');
        const dotsContainer = carousel.querySelector('.carousel-dots');
        
        // CORRECTION : Stocker l'état dans l'élément DOM
        carousel.carouselState = { currentIndex: 0 };
        
        // Créer les dots
        slides.forEach((_, index) => {
            const dot = document.createElement('button');
            dot.classList.add('carousel-dot');
            if (index === 0) dot.classList.add('active');
            dot.addEventListener('click', () => goToSlide(index));
            dotsContainer.appendChild(dot);
        });
        
        const dots = dotsContainer.querySelectorAll('.carousel-dot');
        
        function goToSlide(index) {
            // CORRECTION : Utiliser l'état stocké
            const currentIndex = carousel.carouselState.currentIndex;
            
            // Gestion de la navigation inter-pages du carrousel
            if (index < 0) {
                // On est sur la première diapo et on va vers la gauche
                const allCarousels = Array.from(document.querySelectorAll('.preview-carousel'));
                const currentCarouselIndex = allCarousels.indexOf(carousel);
                
                if (currentCarouselIndex > 0) {
                    // Il y a une page précédente
                    const prevCarousel = allCarousels[currentCarouselIndex - 1];
                    const prevSlides = prevCarousel.querySelectorAll('.carousel-slide');
                    const prevDots = prevCarousel.querySelectorAll('.carousel-dot');
                    
                    // Désactiver le carrousel actuel
                    slides[currentIndex].classList.remove('active');
                    dots[currentIndex].classList.remove('active');
                    carousel.classList.remove('active');
                    carousel.carouselState.currentIndex = 0;
                    
                    // Changer de tab visuellement
                    const tabs = document.querySelectorAll('.preview-tab');
                    const prevTab = document.querySelector(`.preview-tab[data-category="${prevCarousel.dataset.category}"]`);
                    tabs.forEach(t => t.classList.remove('active'));
                    prevTab.classList.add('active');
                    
                    // Activer le carrousel précédent
                    prevCarousel.classList.add('active');
                    
                    // Activer la dernière slide du carrousel précédent
                    prevSlides.forEach(s => s.classList.remove('active'));
                    prevDots.forEach(d => d.classList.remove('active'));
                    const lastIndex = prevSlides.length - 1;
                    prevSlides[lastIndex].classList.add('active');
                    prevDots[lastIndex].classList.add('active');
                    prevCarousel.carouselState.currentIndex = lastIndex;
                    
                    return;
                } else {
                    // Pas de page précédente, boucler sur la dernière diapo
                    index = slides.length - 1;
                }
            } else if (index >= slides.length) {
                // On est sur la dernière diapo et on va vers la droite
                const allCarousels = Array.from(document.querySelectorAll('.preview-carousel'));
                const currentCarouselIndex = allCarousels.indexOf(carousel);
                
                if (currentCarouselIndex < allCarousels.length - 1) {
                    // Il y a une page suivante
                    const nextCarousel = allCarousels[currentCarouselIndex + 1];
                    const nextSlides = nextCarousel.querySelectorAll('.carousel-slide');
                    const nextDots = nextCarousel.querySelectorAll('.carousel-dot');
                    
                    // Désactiver le carrousel actuel
                    slides[currentIndex].classList.remove('active');
                    dots[currentIndex].classList.remove('active');
                    carousel.classList.remove('active');
                    carousel.carouselState.currentIndex = 0;
                    
                    // Changer de tab visuellement
                    const tabs = document.querySelectorAll('.preview-tab');
                    const nextTab = document.querySelector(`.preview-tab[data-category="${nextCarousel.dataset.category}"]`);
                    tabs.forEach(t => t.classList.remove('active'));
                    nextTab.classList.add('active');
                    
                    // Activer le carrousel suivant
                    nextCarousel.classList.add('active');
                    
                    // Activer la première slide du carrousel suivant
                    nextSlides.forEach(s => s.classList.remove('active'));
                    nextDots.forEach(d => d.classList.remove('active'));
                    nextSlides[0].classList.add('active');
                    nextDots[0].classList.add('active');
                    nextCarousel.carouselState.currentIndex = 0;
                    
                    return;
                } else {
                    // Pas de page suivante, boucler sur la première diapo
                    index = 0;
                }
            }
            
            // Navigation normale dans la page actuelle
            slides[currentIndex].classList.remove('active');
            dots[currentIndex].classList.remove('active');
            
            carousel.carouselState.currentIndex = index;
            
            slides[index].classList.add('active');
            dots[index].classList.add('active');
        }
        
        prevBtn.addEventListener('click', () => goToSlide(carousel.carouselState.currentIndex - 1));
        nextBtn.addEventListener('click', () => goToSlide(carousel.carouselState.currentIndex + 1));
        
        // Masquer les flèches si une seule image
        if (slides.length <= 1) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            dotsContainer.style.display = 'none';
        }
    });
}

// Appeler l'init au chargement
document.addEventListener('DOMContentLoaded', initPreviewCarousels);


// ===== PLANNING MODULE V4 - MULTI-SPÉCIALITÉS =====
const PlanningModule = (function() {
    
    // État
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let planningData = {};
    let checklistData = [];
    let currentEditingDate = null;
    let tempSelectedSpecialties = []; // Pour la sélection multiple temporaire
    let listenersInitialized = false;
    
    // Constantes
    const monthNames = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 
                        'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
    
    const statusLabels = {
        'stage': 'Stage', 'revision': 'Révision', 'garde': 'Garde', 'repos': 'Repos', 'autre': 'Autre'
    };
    
    // Liste des spécialités
    const specialties = [
		{ id: 'cardio', name: 'CAR', class: 'spe-cardio' },
		{ id: 'hge', name: 'HGE', class: 'spe-hge' },
        { id: 'gyneco', name: 'GYN', class: 'spe-gyneco' },
        { id: 'pneumo', name: 'PNE', class: 'spe-pneumo' },
        { id: 'orl', name: 'ORL', class: 'spe-orl' },
		{ id: 'neuro', name: 'NEU', class: 'spe-neuro' },
        { id: 'psy', name: 'PSY', class: 'spe-psy' },
        { id: 'pediatrie', name: 'PED', class: 'spe-pediatrie' },
        { id: 'hemato', name: 'HEM', class: 'spe-hemato' },
        { id: 'endoc', name: 'END', class: 'spe-endoc' },
        { id: 'osteo', name: 'RHU', class: 'spe-osteo' },
        { id: 'onco', name: 'ONC', class: 'spe-onco' },
        { id: 'nephro', name: 'NEPH', class: 'spe-nephro' },
		{ id: 'infectio', name: 'INF', class: 'spe-infectio' },
        { id: 'mir', name: 'MIR', class: 'spe-mir' },
		{ id: 'dermato', name: 'DER', class: 'spe-dermato' },
		{ id: 'therapeut', name: 'TTT', class: 'spe-therapeut' },
        { id: 'geriatrie', name: 'GER', class: 'spe-geriatrie' },
		{ id: 'douleur', name: 'DOU', class: 'spe-douleur' },
        { id: 'mi', name: 'MIN', class: 'spe-mi' },
        { id: 'uro', name: 'URO', class: 'spe-uro' },
		{ id: 'ophta', name: 'OPH', class: 'spe-ophta' },
		{ id: 'legal', name: 'MTML', class: 'spe-legal' },
        { id: 'sante-pub', name: 'SPU', class: 'spe-sante-pub' }
    ];
    
    // Initialisation
    function init() {
        loadData();
        setupYearSelector();
        setupEventListeners();
        setupSpecialtyPopup();
		setupCustomDropdowns(); 
        renderCalendar();
        renderChecklist();
        updateHeaderDisplay();
		updateSelectors();
		renderSpecialtyLegend();
    }
    
    // Charger les données
    function loadData() {
		// Charger depuis userData UNIQUEMENT
		if (typeof userData !== 'undefined' && userData) {
			if (userData.planningData) {
				planningData = userData.planningData;
			}
			if (userData.checklistData) {
				checklistData = userData.checklistData;
			}
		}

		// Si pas de données : initialiser vide (pas de fallback)
		if (!planningData) {
			planningData = {};
		}
		if (!checklistData) {
			checklistData = [];
		}
    }
    
// Sauvegarder
function saveData() {
    // Sauvegarder dans userData pour Firebase UNIQUEMENT
    if (typeof userData !== 'undefined' && userData) {
        userData.planningData = planningData;
        userData.checklistData = checklistData;
        
        // Déclencher la sauvegarde Firebase
        if (typeof debouncedSave === 'function') {
            debouncedSave();
        }
    }
}
    
// Setup année dropdown
function setupYearSelector() {
    const yearMenu = document.getElementById('year-dropdown-menu');
    if (!yearMenu) return;
    
    const current = new Date().getFullYear();
    const header = yearMenu.querySelector('.custom-dropdown-header');
    
    // Garder le header et ajouter les options
    yearMenu.innerHTML = '';
    if (header) yearMenu.appendChild(header.cloneNode(true));
    else {
        const newHeader = document.createElement('div');
        newHeader.className = 'custom-dropdown-header';
        newHeader.innerHTML = '<i class="fas fa-calendar-check"></i> Sélectionner une année';
        yearMenu.appendChild(newHeader);
    }
    
    for (let y = current; y <= current + 1; y++) {
        const option = document.createElement('div');
        option.className = 'custom-dropdown-option';
        option.dataset.value = y;
        option.textContent = y;
        if (y === currentYear) option.classList.add('selected');
        yearMenu.appendChild(option);
    }
}

// Setup custom dropdowns
function setupCustomDropdowns() {
    // Month dropdown
    const monthBtn = document.getElementById('month-dropdown-btn');
    const monthMenu = document.getElementById('month-dropdown-menu');
    const monthText = document.getElementById('month-dropdown-text');
    
    // Year dropdown
    const yearBtn = document.getElementById('year-dropdown-btn');
    const yearMenu = document.getElementById('year-dropdown-menu');
    const yearText = document.getElementById('year-dropdown-text');
    
    // Toggle month dropdown
    monthBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        monthBtn.classList.toggle('active');
        monthMenu.classList.toggle('active');
        // Fermer l'autre
        yearBtn?.classList.remove('active');
        yearMenu?.classList.remove('active');
    });
    
    // Toggle year dropdown
    yearBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        yearBtn.classList.toggle('active');
        yearMenu.classList.toggle('active');
        // Fermer l'autre
        monthBtn?.classList.remove('active');
        monthMenu?.classList.remove('active');
    });
    
    // Sélection mois
    monthMenu?.addEventListener('click', (e) => {
        const option = e.target.closest('.custom-dropdown-option');
        if (option) {
            const value = parseInt(option.dataset.value);
            currentMonth = value;
            
            // Update UI
            monthMenu.querySelectorAll('.custom-dropdown-option').forEach(opt => {
                opt.classList.toggle('selected', parseInt(opt.dataset.value) === value);
            });
            monthText.textContent = option.textContent;
            
            // Fermer et render
            monthBtn.classList.remove('active');
            monthMenu.classList.remove('active');
            renderCalendar();
            updateHeaderDisplay();
        }
    });
    
    // Sélection année
    yearMenu?.addEventListener('click', (e) => {
        const option = e.target.closest('.custom-dropdown-option');
        if (option) {
            const value = parseInt(option.dataset.value);
            currentYear = value;
            
            // Update UI
            yearMenu.querySelectorAll('.custom-dropdown-option').forEach(opt => {
                opt.classList.toggle('selected', parseInt(opt.dataset.value) === value);
            });
            yearText.textContent = option.textContent;
            
            // Fermer et render
            yearBtn.classList.remove('active');
            yearMenu.classList.remove('active');
            renderCalendar();
            updateHeaderDisplay();
        }
    });
    
    // Fermer au clic extérieur
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.custom-dropdown')) {
            monthBtn?.classList.remove('active');
            monthMenu?.classList.remove('active');
            yearBtn?.classList.remove('active');
            yearMenu?.classList.remove('active');
        }
    });
}
    
    // Setup événements
    function setupEventListeners() {
        if (listenersInitialized) return;
        listenersInitialized = true;
        
        // Navigation
        document.getElementById('planning-prev-month')?.addEventListener('click', () => navigateMonth(-1));
        document.getElementById('planning-next-month')?.addEventListener('click', () => navigateMonth(1));
        document.getElementById('planning-today')?.addEventListener('click', goToToday);
        
        // Sélecteurs
        document.getElementById('planning-month-select')?.addEventListener('change', onDateSelectChange);
        document.getElementById('planning-year-select')?.addEventListener('change', onDateSelectChange);
        
        // Checklist
        document.getElementById('checklist-add-btn')?.addEventListener('click', addChecklistItem);
        document.getElementById('checklist-new-item')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addChecklistItem();
        });
        
        // Fermer popups au clic extérieur
        document.addEventListener('click', (e) => {
            const statusPopup = document.getElementById('status-popup');
            const specPopup = document.getElementById('specialty-popup');
            
            if (statusPopup && !statusPopup.contains(e.target) && !e.target.closest('.day-header-zone')) {
                statusPopup.classList.remove('active');
            }
            if (specPopup && !specPopup.contains(e.target) && !e.target.closest('.day-specialty-zone')) {
                specPopup.classList.remove('active');
            }
        });
        
			// Boutons statut
					document.querySelectorAll('#status-popup .status-mini-btn').forEach(btn => {
						btn.addEventListener('click', () => {
							if (currentEditingDate) {
								const selectedStatus = btn.dataset.status;
								const weekFillCheckbox = document.getElementById('status-week-fill-checkbox');
								
								// Vérifier si la checkbox est cochée
								if (weekFillCheckbox && weekFillCheckbox.checked) {
									// Remplir toute la semaine
									fillWeekWithStatus(currentEditingDate, selectedStatus);
								} else {
									// Remplir seulement le jour actuel
									setDayStatus(currentEditingDate, selectedStatus);
								}
								
								document.getElementById('status-popup').classList.remove('active');
							}
						});
					});
        
// Bouton Effacer - efface ET ferme le popup
			document.getElementById('specialty-clear')?.addEventListener('click', () => {
				if (currentEditingDate) {
					const weekFillCheckbox = document.getElementById('specialty-week-fill-checkbox');
					
					// Vérifier si la checkbox est cochée
					if (weekFillCheckbox && weekFillCheckbox.checked) {
						// Effacer toute la semaine
						fillWeekWithSpecialties(currentEditingDate, []);
					} else {
						// Effacer seulement le jour actuel
						setDaySpecialties(currentEditingDate, []);
					}
					
					document.getElementById('specialty-popup').classList.remove('active');
					document.getElementById('specialty-search').value = ''; // Reset recherche
				}
			});

			// Bouton OK - confirme et ferme
			document.getElementById('specialty-confirm')?.addEventListener('click', () => {
				if (currentEditingDate) {
					const weekFillCheckbox = document.getElementById('specialty-week-fill-checkbox');
					
					// Vérifier si la checkbox est cochée
					if (weekFillCheckbox && weekFillCheckbox.checked) {
						// Remplir toute la semaine
						fillWeekWithSpecialties(currentEditingDate, [...tempSelectedSpecialties]);
					} else {
						// Remplir seulement le jour actuel
						setDaySpecialties(currentEditingDate, [...tempSelectedSpecialties]);
					}
					
					document.getElementById('specialty-popup').classList.remove('active');
					document.getElementById('specialty-search').value = ''; // Reset recherche
				}
			});

			// Recherche spécialité
			document.getElementById('specialty-search')?.addEventListener('input', (e) => {
				filterSpecialties(e.target.value);
			});
    }
    
    // Setup popup spécialité
    function setupSpecialtyPopup() {
        const grid = document.getElementById('specialty-grid');
        if (!grid) return;
        
        grid.innerHTML = specialties.map(spe => `
            <button class="specialty-mini-btn ${spe.class}" data-specialty="${spe.id}">${spe.name}</button>
        `).join('');
        
        grid.querySelectorAll('.specialty-mini-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const speId = btn.dataset.specialty;
                const index = tempSelectedSpecialties.indexOf(speId);
                
                if (index > -1) {
                    tempSelectedSpecialties.splice(index, 1);
                } else {
                    tempSelectedSpecialties.push(speId);
                }
                
                updateSpecialtyPopupSelection();
            });
        });
    }
	
	// Filtrer les spécialités par recherche
function filterSpecialties(query) {
    const grid = document.getElementById('specialty-grid');
    if (!grid) return;
    
    const searchTerm = query.toLowerCase().trim();
    const buttons = grid.querySelectorAll('.specialty-mini-btn');
    let hasResults = false;
    
    buttons.forEach(btn => {
        const name = btn.textContent.toLowerCase();
        const id = btn.dataset.specialty.toLowerCase();
        
        if (name.includes(searchTerm) || id.includes(searchTerm)) {
            btn.classList.remove('hidden');
            hasResults = true;
        } else {
            btn.classList.add('hidden');
        }
    });
    
    // Afficher message si aucun résultat
    let noResultMsg = grid.querySelector('.specialty-no-result');
    if (!hasResults) {
        if (!noResultMsg) {
            noResultMsg = document.createElement('div');
            noResultMsg.className = 'specialty-no-result';
            noResultMsg.textContent = 'Aucune spécialité trouvée';
            grid.appendChild(noResultMsg);
        }
    } else if (noResultMsg) {
        noResultMsg.remove();
    }
}

// Auto-resize textarea
function autoResizeTextarea(textarea) {
    // Reset height pour calculer la vraie hauteur du contenu
    textarea.style.height = 'auto';
    
    // Calculer la nouvelle hauteur (avec min et max)
    const minHeight = 45;
    const maxHeight = 150;
    const newHeight = Math.min(Math.max(textarea.scrollHeight, minHeight), maxHeight);
    
    textarea.style.height = newHeight + 'px';
}
    
    // Mettre à jour la sélection visuelle
    function updateSpecialtyPopupSelection() {
        const grid = document.getElementById('specialty-grid');
        if (!grid) return;
        
        grid.querySelectorAll('.specialty-mini-btn').forEach(btn => {
            const isSelected = tempSelectedSpecialties.includes(btn.dataset.specialty);
            btn.classList.toggle('selected', isSelected);
        });
    }
    
    // Navigation
    function navigateMonth(delta) {
        currentMonth += delta;
        if (currentMonth > 11) { currentMonth = 0; currentYear++; }
        else if (currentMonth < 0) { currentMonth = 11; currentYear--; }
        renderCalendar();
        updateHeaderDisplay();
        updateSelectors();
    }
	
	

    
function goToToday() {
    const today = new Date();
    currentMonth = today.getMonth();
    currentYear = today.getFullYear();
    renderCalendar();
    updateHeaderDisplay();
    updateSelectors();
    
    // Scroll vers la case d'aujourd'hui
    setTimeout(() => {
        const todayCell = document.querySelector('.calendar-day.is-today');
        if (todayCell) {
            const rect = todayCell.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const isMobile = window.innerWidth <= 768;
            const offset = isMobile ? 350 : 300;
            
            window.scrollTo({
                top: scrollTop + rect.top - offset,
                behavior: 'smooth'
            });
        }
    }, 100);
}
    
    function onDateSelectChange() {
        const monthSelect = document.getElementById('planning-month-select');
        const yearSelect = document.getElementById('planning-year-select');
        if (monthSelect) currentMonth = parseInt(monthSelect.value);
        if (yearSelect) currentYear = parseInt(yearSelect.value);
        renderCalendar();
        updateHeaderDisplay();
    }
    
    function updateHeaderDisplay() {
        const monthEl = document.getElementById('current-month-name');
        const yearEl = document.getElementById('current-year');
        if (monthEl) monthEl.textContent = monthNames[currentMonth];
        if (yearEl) yearEl.textContent = currentYear;
    }
    
function updateSelectors() {
    // Custom dropdowns
    const monthText = document.getElementById('month-dropdown-text');
    const yearText = document.getElementById('year-dropdown-text');
    const monthMenu = document.getElementById('month-dropdown-menu');
    const yearMenu = document.getElementById('year-dropdown-menu');
    
    if (monthText) monthText.textContent = monthNames[currentMonth];
    if (yearText) yearText.textContent = currentYear;
    
    // Update selected state
    monthMenu?.querySelectorAll('.custom-dropdown-option').forEach(opt => {
        opt.classList.toggle('selected', parseInt(opt.dataset.value) === currentMonth);
    });
    yearMenu?.querySelectorAll('.custom-dropdown-option').forEach(opt => {
        opt.classList.toggle('selected', parseInt(opt.dataset.value) === currentYear);
    });
}
    
    // Rendu calendrier
    function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        if (!grid) return;
        grid.innerHTML = '';
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        
        let startDayOfWeek = firstDay.getDay() - 1;
        if (startDayOfWeek < 0) startDayOfWeek = 6;
        
        const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
        
        let dayCounter = 1;
        let nextMonthDay = 1;
        const totalCells = Math.ceil((startDayOfWeek + lastDay.getDate()) / 7) * 7;
        
        for (let i = 0; i < totalCells; i++) {
            let date, isOtherMonth = false;
            
            if (i < startDayOfWeek) {
                const day = prevMonthLastDay - startDayOfWeek + i + 1;
                date = new Date(currentYear, currentMonth - 1, day);
                isOtherMonth = true;
            } else if (dayCounter > lastDay.getDate()) {
                date = new Date(currentYear, currentMonth + 1, nextMonthDay);
                nextMonthDay++;
                isOtherMonth = true;
            } else {
                date = new Date(currentYear, currentMonth, dayCounter);
                dayCounter++;
            }
            
            const dayEl = createDayElement(date, today, isOtherMonth);
            grid.appendChild(dayEl);
        }
    }
    
    // Créer élément jour
    function createDayElement(date, today, isOtherMonth) {
        const dateKey = formatDateKey(date);
        const dayData = planningData[dateKey] || {};
        
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        if (isOtherMonth) dayEl.classList.add('other-month');
        if (date.getTime() === today.getTime()) dayEl.classList.add('is-today');
        if (date.getDay() === 0 || date.getDay() === 6) dayEl.classList.add('is-weekend');
        if (dayData.status) dayEl.classList.add('status-' + dayData.status);
        
        // Gérer les spécialités (peut être un array ou une string pour rétrocompatibilité)
        let speList = [];
        if (dayData.specialties && Array.isArray(dayData.specialties)) {
            speList = dayData.specialties;
        } else if (dayData.specialty) {
            speList = [dayData.specialty]; // Rétrocompatibilité
        }
        
        const specialtyBadges = speList.map(speId => {
            const spe = specialties.find(s => s.id === speId);
            return spe ? `<span class="day-specialty-badge ${spe.class}">${spe.name}</span>` : '';
        }).join('');
        
        dayEl.innerHTML = `
            <div class="day-header-zone" data-date="${dateKey}">
                <span class="day-num">${date.getDate()}</span>
                ${dayData.status ? `<span class="day-status-badge ${dayData.status}">${statusLabels[dayData.status]}</span>` : ''}
            </div>
            <div class="day-notes-zone">
                <textarea class="day-notes-input" data-date="${dateKey}" placeholder="Notes...">${dayData.notes || ''}</textarea>
            </div>
            <div class="day-specialty-zone" data-date="${dateKey}">
                ${specialtyBadges || `<span class="day-specialty-placeholder">+ Spécialité</span>`}
            </div>
        `;
        
        // Event: clic header = popup statut
        dayEl.querySelector('.day-header-zone').addEventListener('click', (e) => {
            e.stopPropagation();
            openStatusPopup(dateKey, e.currentTarget);
        });
        
        // Event: clic spécialité = popup spécialité
        dayEl.querySelector('.day-specialty-zone').addEventListener('click', (e) => {
            e.stopPropagation();
            openSpecialtyPopup(dateKey, e.currentTarget);
        });
        
		// Event: modification notes + auto-resize
		const textarea = dayEl.querySelector('.day-notes-input');
		let saveTimeout;

		// Auto-resize au chargement si contenu existant
		if (dayData.notes) {
			setTimeout(() => autoResizeTextarea(textarea), 0);
		}

		textarea.addEventListener('input', (e) => {
			// Auto-resize
			autoResizeTextarea(e.target);
			
			// Sauvegarde avec délai
			clearTimeout(saveTimeout);
			saveTimeout = setTimeout(() => {
				saveDayNotes(dateKey, e.target.value);
			}, 500);
		});

		textarea.addEventListener('blur', (e) => {
			clearTimeout(saveTimeout);
			saveDayNotes(dateKey, e.target.value);
		});

		textarea.addEventListener('focus', (e) => {
			autoResizeTextarea(e.target);
		});
        
        return dayEl;
    }
    
// Ouvrir popup statut
function openStatusPopup(dateKey, targetEl) {
    currentEditingDate = dateKey;
    const popup = document.getElementById('status-popup');
    if (!popup) return;
    
    document.getElementById('specialty-popup')?.classList.remove('active');
    
    // Déterminer si c'est un lundi (jour de la semaine = 1)
    const date = new Date(dateKey);
    const dayOfWeek = date.getDay(); // 0 = Dimanche, 1 = Lundi
    const isMonday = dayOfWeek === 1;
    
    // Afficher/masquer la checkbox selon si c'est un lundi
    const weekFillContainer = document.getElementById('status-week-fill-container');
    const weekFillCheckbox = document.getElementById('status-week-fill-checkbox');
    
    if (weekFillContainer && weekFillCheckbox) {
        if (isMonday) {
            weekFillContainer.style.display = 'block';
            weekFillCheckbox.checked = false; // Toujours décoché par défaut
        } else {
            weekFillContainer.style.display = 'none';
            weekFillCheckbox.checked = false;
        }
    }
    
    const rect = targetEl.getBoundingClientRect();
    const viewportHeight = window.innerHeight;
    const popupHeight = isMonday ? 280 : 200; // Plus haut si lundi (avec checkbox)
    
    // Calculer l'espace disponible
    const spaceBelow = viewportHeight - rect.bottom;
    
    let scrollNeeded = 0;
    
    // Si pas assez d'espace en dessous
    if (spaceBelow < popupHeight + 30) {
        scrollNeeded = (popupHeight + 30) - spaceBelow;
    }
    // Si la case est trop haute (on veut qu'elle soit au moins à 250px du haut)
    else if (rect.top < 250) {
        scrollNeeded = rect.top - 250; // Négatif = scroll vers le haut
    }
    
    // Effectuer le scroll si nécessaire
    if (scrollNeeded !== 0) {
        window.scrollBy({
            top: scrollNeeded,
            behavior: 'smooth'
        });
        
        // Attendre la fin du scroll pour positionner le popup
        setTimeout(() => {
            const newRect = targetEl.getBoundingClientRect();
            popup.style.top = (newRect.bottom + 5) + 'px';
            popup.style.left = Math.max(10, Math.min(newRect.left - 30, window.innerWidth - 240)) + 'px';
            finishOpeningPopup();
        }, 200);
    } else {
        // Pas de scroll nécessaire, affichage direct
        popup.style.top = (rect.bottom + 5) + 'px';
        popup.style.left = Math.max(10, Math.min(rect.left - 30, window.innerWidth - 240)) + 'px';
        finishOpeningPopup();
    }
    
    function finishOpeningPopup() {
        const dayData = planningData[dateKey] || {};
        popup.querySelectorAll('.status-mini-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.status === (dayData.status || ''));
        });
        
        popup.classList.add('active');
    }
}
    
// Ouvrir popup spécialité
function openSpecialtyPopup(dateKey, targetEl) {
    currentEditingDate = dateKey;
    const popup = document.getElementById('specialty-popup');
    if (!popup) return;
    
    document.getElementById('status-popup')?.classList.remove('active');
    
    // Déterminer si c'est un lundi (jour de la semaine = 1)
    const date = new Date(dateKey);
    const dayOfWeek = date.getDay(); // 0 = Dimanche, 1 = Lundi
    const isMonday = dayOfWeek === 1;
    
    // Afficher/masquer la checkbox selon si c'est un lundi
    const weekFillContainer = document.getElementById('specialty-week-fill-container');
    const weekFillCheckbox = document.getElementById('specialty-week-fill-checkbox');
    
    if (weekFillContainer && weekFillCheckbox) {
        if (isMonday) {
            weekFillContainer.style.display = 'block';
            weekFillCheckbox.checked = false; // Toujours décoché par défaut
        } else {
            weekFillContainer.style.display = 'none';
            weekFillCheckbox.checked = false;
        }
    }
    
    const rect = targetEl.getBoundingClientRect();
    const viewportHeight = window.innerHeight;
    const popupHeight = isMonday ? 500 : 440; // Plus haut si lundi (avec checkbox)
    const idealTopPosition = 250; // Position idéale de la case par rapport au haut de l'écran
    
    // Calculer où devrait être la case pour que tout soit visible
    const targetScrollY = window.scrollY + rect.top - idealTopPosition;
    const currentScrollY = window.scrollY;
    
    // Si on doit scroller
    if (Math.abs(targetScrollY - currentScrollY) > 10) {
        window.scrollTo({
            top: targetScrollY,
            behavior: 'smooth'
        });
        
        // Attendre la fin du scroll pour positionner le popup
        setTimeout(() => {
            const newRect = targetEl.getBoundingClientRect();
            popup.style.top = (newRect.bottom + 5) + 'px';
            popup.style.left = Math.max(10, Math.min(newRect.left - 50, window.innerWidth - 340)) + 'px';
            finishOpeningPopup();
        }, 200);
    } else {
        // Pas de scroll nécessaire
        popup.style.top = (rect.bottom + 5) + 'px';
        popup.style.left = Math.max(10, Math.min(rect.left - 50, window.innerWidth - 340)) + 'px';
        finishOpeningPopup();
    }
    
    function finishOpeningPopup() {
        const dayData = planningData[dateKey] || {};
        if (dayData.specialties && Array.isArray(dayData.specialties)) {
            tempSelectedSpecialties = [...dayData.specialties];
        } else if (dayData.specialty) {
            tempSelectedSpecialties = [dayData.specialty];
        } else {
            tempSelectedSpecialties = [];
        }
        
        const searchInput = document.getElementById('specialty-search');
        if (searchInput) {
            searchInput.value = '';
            filterSpecialties('');
        }
        
        updateSpecialtyPopupSelection();
        popup.classList.add('active');
        
        setTimeout(() => searchInput?.focus(), 100);
    }
}
    
    // Sauvegarder statut
    function setDayStatus(dateKey, status) {
        if (!planningData[dateKey]) planningData[dateKey] = {};
        planningData[dateKey].status = status;
        if (!status) delete planningData[dateKey].status;
        cleanupDayData(dateKey);
        saveData();
        renderCalendar();
    }
	
	    // Remplir toute la semaine avec un statut
    function fillWeekWithStatus(mondayDateKey, status) {
        const startDate = new Date(mondayDateKey);
        
        // Déterminer le nombre de jours à remplir selon le statut
        let daysToFill = 7; // Par défaut : lundi à dimanche
        
        if (status === 'stage') {
            daysToFill = 5; // Lundi à vendredi seulement
        } else if (status === 'garde') {
            daysToFill = 1; // Seulement le lundi
        }
        
        // Remplir les jours
        for (let i = 0; i < daysToFill; i++) {
            const currentDate = new Date(startDate);
            currentDate.setDate(startDate.getDate() + i);
            const dateKey = formatDateKey(currentDate);
            
            if (!planningData[dateKey]) planningData[dateKey] = {};
            planningData[dateKey].status = status;
            if (!status) delete planningData[dateKey].status;
            cleanupDayData(dateKey);
        }
        
        saveData();
        renderCalendar();
    }
	
    
	// Remplir toute la semaine avec des spécialités
    function fillWeekWithSpecialties(mondayDateKey, specialtiesArray) {
        const startDate = new Date(mondayDateKey);
        
        // Toujours remplir du lundi au dimanche (7 jours) pour les spécialités
        const daysToFill = 7;
        
        // Remplir les jours
        for (let i = 0; i < daysToFill; i++) {
            const currentDate = new Date(startDate);
            currentDate.setDate(startDate.getDate() + i);
            const dateKey = formatDateKey(currentDate);
            
            if (!planningData[dateKey]) planningData[dateKey] = {};
            
            // Supprimer l'ancien format
            delete planningData[dateKey].specialty;
            
            if (specialtiesArray.length > 0) {
                planningData[dateKey].specialties = [...specialtiesArray];
            } else {
                delete planningData[dateKey].specialties;
            }
            
            cleanupDayData(dateKey);
        }
        
        saveData();
        renderCalendar();
    }
	
	
    // Sauvegarder spécialités (multi)
    function setDaySpecialties(dateKey, specialtiesArray) {
        if (!planningData[dateKey]) planningData[dateKey] = {};
        
        // Supprimer l'ancien format
        delete planningData[dateKey].specialty;
        
        if (specialtiesArray.length > 0) {
            planningData[dateKey].specialties = specialtiesArray;
        } else {
            delete planningData[dateKey].specialties;
        }
        
        cleanupDayData(dateKey);
        saveData();
        renderCalendar();
    }
    
    // Sauvegarder notes
    function saveDayNotes(dateKey, notes) {
        if (!planningData[dateKey]) planningData[dateKey] = {};
        planningData[dateKey].notes = notes.trim();
        if (!notes.trim()) delete planningData[dateKey].notes;
        cleanupDayData(dateKey);
        saveData();
    }
    
    // Nettoyer données vides
    function cleanupDayData(dateKey) {
        if (planningData[dateKey] && Object.keys(planningData[dateKey]).length === 0) {
            delete planningData[dateKey];
        }
    }
    
    // ===== CHECKLIST =====
function addChecklistItem() {
    const input = document.getElementById('checklist-new-item');
    const errorNotif = document.getElementById('checklist-error');
    if (!input) return;
    
    const text = input.value.trim();
    
    if (!text) {
        // Afficher la notification d'erreur avec vibration
        input.classList.add('error');
        errorNotif.classList.add('show', 'shake');
        
        // Retirer l'animation de vibration après qu'elle soit terminée
        setTimeout(() => {
            errorNotif.classList.remove('shake');
        }, 500);
        
        // Masquer la notification après 2.5 secondes
        setTimeout(() => {
            errorNotif.classList.remove('show');
            input.classList.remove('error');
        }, 2500);
        
        // Focus sur l'input
        input.focus();
        return;
    }
    
    // Ajouter la tâche normalement
    checklistData.push({ id: Date.now(), text: text, completed: false });
    input.value = '';
    saveData();
    renderChecklist();
}
    

 
 
function deleteChecklistItem(id) {
    // Récupérer l'itemKey avant de supprimer
    var itemToDelete = checklistData.find(function(i) { return i.id === id; });
    var itemKey = itemToDelete ? itemToDelete.itemKey : null;
    
    checklistData = checklistData.filter(i => i.id !== id);
    saveData();
    renderChecklist();
    
    // Restaurer le bouton "To-do List" dans le tableau si l'item avait un itemKey
    if (itemKey) {
        var parts = itemKey.split('-');
        var specialtyId = parts[0];
        var fc = parts.slice(1).join('-');
        
        // Chercher le badge correspondant et le remplacer par un bouton
        var badges = document.querySelectorAll('.added-to-checklist-badge[data-specialty="' + specialtyId + '"][data-fc="' + fc + '"]');
        badges.forEach(function(badge) {
            // Trouver l'item correspondant pour récupérer le nom et le numéro
            var specialty = SPECIALTIES_DATA.find(function(s) { return s.id === specialtyId; });
            if (specialty) {
                var item = specialty.items.find(function(i) { return i.fc === fc; });
                if (item) {
                    var escapedName = item.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    var btn = document.createElement('button');
                    btn.className = 'send-to-checklist-btn';
                    btn.setAttribute('data-specialty', specialtyId);
                    btn.setAttribute('data-fc', fc);
                    btn.setAttribute('onclick', "sendToChecklist(this, '" + specialtyId + "', '" + fc + "', '" + item.num + "', '" + escapedName + "')");
                    btn.innerHTML = '<i class="fas fa-arrow-right"></i> To-do List';
                    badge.parentNode.replaceChild(btn, badge);
                }
            }
        });
    }
}

function toggleChecklistItem(id, event) {
    const item = checklistData.find(i => i.id === id);
    if (!item) return;
    
    // Si l'item est déjà complété, on le décoche simplement
    if (item.completed) {
        item.completed = false;
        saveData();
        renderChecklist();
        return;
    }
    
    // Si c'est un item du tableau (a un itemKey), afficher le popup de choix
    if (item.itemKey) {
        showChecklistChoicePopup(id, event);
    } else {
        // Item manuel, valider directement
        item.completed = true;
        saveData();
        renderChecklist();
    }
}

function showChecklistChoicePopup(itemId, event) {
    const popup = document.getElementById('checklist-choice-popup');
    if (!popup) return;
    
    // Afficher d'abord pour calculer les dimensions
    popup.classList.add('show');
    
    // Positionner le popup au-dessus de l'élément cliqué
    const rect = event.target.getBoundingClientRect();
    const popupHeight = popup.offsetHeight;
    
    popup.style.left = rect.left + 'px';
    popup.style.top = (rect.top - popupHeight - 10) + 'px';
    
    // Ajuster si le popup sort de l'écran en haut
    if (rect.top - popupHeight - 10 < 10) {
        popup.style.top = (rect.bottom + 10) + 'px';
    }
    
    // Ajuster si le popup sort de l'écran à droite
    if (rect.left + 200 > window.innerWidth) {
        popup.style.left = (window.innerWidth - 220) + 'px';
    }
    
    // Stocker l'ID de l'item pour les boutons
    popup.dataset.itemId = itemId;
    
    // Fermer le popup si on clique ailleurs
    setTimeout(() => {
        document.addEventListener('click', closeChecklistPopupOutside);
    }, 10);
}

function closeChecklistPopupOutside(e) {
    const popup = document.getElementById('checklist-choice-popup');
    if (popup && !popup.contains(e.target)) {
        popup.classList.remove('show');
        document.removeEventListener('click', closeChecklistPopupOutside);
    }
}

function handleChecklistChoice(withTour) {
    const popup = document.getElementById('checklist-choice-popup');
    const itemId = parseInt(popup.dataset.itemId);
    const item = checklistData.find(i => i.id === itemId);
    
    popup.classList.remove('show');
    document.removeEventListener('click', closeChecklistPopupOutside);
    
    if (!item) return;
    
    if (withTour) {
        // Ouvrir le modal de tour, la tâche sera validée après
        window.pendingChecklistItemId = itemId;
        window.openTourModalFromChecklist(itemId, item.itemKey);
    } else {
        // Valider seulement la tâche
        item.completed = true;
        saveData();
        renderChecklist();
    }
}

// Initialiser les événements du popup choix checklist
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('checklist-choice-tour')?.addEventListener('click', function(e) {
        e.stopPropagation();
        if (typeof PlanningModule !== 'undefined' && PlanningModule.handleChecklistChoice) {
            PlanningModule.handleChecklistChoice(true);
        }
    });
    
    document.getElementById('checklist-choice-task')?.addEventListener('click', function(e) {
        e.stopPropagation();
        if (typeof PlanningModule !== 'undefined' && PlanningModule.handleChecklistChoice) {
            PlanningModule.handleChecklistChoice(false);
        }
    });
});
    
function renderChecklist() {
    const container = document.getElementById('checklist-items');
    const countEl = document.getElementById('checklist-count');
    if (!container) return;
    
    const completedCount = checklistData.filter(i => i.completed).length;
    if (countEl) countEl.textContent = `${completedCount}/${checklistData.length}`;
    
    if (checklistData.length === 0) {
        container.innerHTML = `<div class="checklist-empty"><i class="fas fa-clipboard-list"></i><p>Aucune tâche</p></div>`;
        return;
    }
    
    const sorted = [...checklistData].sort((a, b) => a.completed === b.completed ? 0 : a.completed ? 1 : -1);
    container.innerHTML = sorted.map(item => {
        const dotHtml = item.specialtyColor ? 
            '<span class="checklist-specialty-badge" style="background-color: ' + item.specialtyColor + '20; color: ' + item.specialtyColor + ';" title="' + (item.specialtyName || '') + '">' + (item.specialtyShort || '') + '</span>' : '';
        return `
            <div class="checklist-item ${item.completed ? 'completed' : ''}">
                <div class="checklist-checkbox ${item.completed ? 'checked' : ''}" onclick="PlanningModule.toggleChecklistItem(${item.id}, event)">
                    ${item.completed ? '<i class="fas fa-check"></i>' : ''}
                </div>
                <span class="checklist-item-text">${escapeHtml(item.text)}${dotHtml}</span>
                <button class="checklist-delete" onclick="PlanningModule.deleteChecklistItem(${item.id})"><i class="fas fa-trash"></i></button>
            </div>
        `;
    }).join('');
}

function addItemFromTable(specialtyId, fc, itemNum, itemName, specialtyColor, specialtyName) {
    const itemKey = specialtyId + '-' + fc;
    const exists = checklistData.some(item => item.itemKey === itemKey);
    
    if (exists) {
        return { success: false, message: 'Cet item est déjà dans la to-do List !' };
    }
    
    const shortName = itemName.length > 45 ? itemName.substring(0, 42) + '...' : itemName;
    const text = itemNum + ' - ' + shortName;
    
    const specialtyShort = SPECIALTY_SHORT[specialtyId] || '';
    
    checklistData.push({
        id: Date.now(),
        text: text,
        completed: false,
        itemKey: itemKey,
        specialtyColor: specialtyColor,
        specialtyName: specialtyName,
        specialtyShort: specialtyShort
    });
    
    saveData();
    renderChecklist();
    
    return { success: true, message: 'Item ' + itemNum + ' ajouté à la To-do List !' };
}

function completeChecklistItem(id) {
    const item = checklistData.find(i => i.id === id);
    if (item && !item.completed) {
        item.completed = true;
        saveData();
        renderChecklist();
    }
}

function isItemInChecklist(specialtyId, fc) {
    const itemKey = specialtyId + '-' + fc;
    return checklistData.some(item => item.itemKey === itemKey);
}

function getChecklistItemKey(id) {
    const item = checklistData.find(i => i.id === id);
    return item ? item.itemKey : null;
}


// ===== SYSTÈME DE TROPHÉES =====
window.TrophiesSystem = (function() {
    
    // Définition des trophées
    const TROPHIES = {
        progress: [
            { id: 'prog_5', name: 'Débutant - 1', desc: '5% des items', icon: 'fa-seedling', condition: (stats) => stats.progressPercent >= 5 },
            { id: 'prog_10', name: 'Débutant - 2', desc: '10% des items', icon: 'fa-seedling', condition: (stats) => stats.progressPercent >= 10 },
            { id: 'prog_25', name: 'Intermédiaire - 1', desc: '25% des items', icon: 'fa-leaf', condition: (stats) => stats.progressPercent >= 25 },
            { id: 'prog_50', name: 'Intermédiaire - 2', desc: '50% des items', icon: 'fa-leaf', condition: (stats) => stats.progressPercent >= 50 },
            { id: 'prog_75', name: 'Avancé', desc: '75% des items', icon: 'fa-tree', condition: (stats) => stats.progressPercent >= 75 },
            { id: 'prog_90', name: 'Expert', desc: '90% des items', icon: 'fa-crown', condition: (stats) => stats.progressPercent >= 90 }
        ],
        daily: [
            { id: 'daily_10tours', name: 'Productif - 1', desc: '10 tours en 1 jour', icon: 'fa-fire', condition: (stats) => stats.bestToursInDay >= 10 },
            { id: 'daily_20tours', name: 'Productif - 2', desc: '20 tours en 1 jour', icon: 'fa-fire', condition: (stats) => stats.bestToursInDay >= 20 },
            { id: 'daily_8h', name: 'BU lover - 1', desc: '8h de travail en 1 jour', icon: 'fa-clock', condition: (stats) => stats.bestHoursInDay >= 8 },
            { id: 'daily_11h', name: 'BU lover - 2', desc: '11h de travail en 1 jour', icon: 'fa-clock', condition: (stats) => stats.bestHoursInDay >= 11 },
            { id: 'daily_200delay', name: 'Mise à jour - 1', desc: '200j de retard rattrapé', icon: 'fa-bolt', condition: (stats) => stats.bestDelayRecovered >= 200 },
			{ id: 'daily_400delay', name: 'Mise à jour - 2', desc: '400j de retard rattrapé', icon: 'fa-bolt', condition: (stats) => stats.bestDelayRecovered >= 400 }

        ],
        weekly: [
            { id: 'weekly_30tours', name: 'Semaine intense - 1', desc: '30 tours en 1 semaine', icon: 'fa-rocket', condition: (stats) => stats.bestToursInWeek >= 30 },
            { id: 'weekly_70tours', name: 'Semaine intense - 2', desc: '60 tours en 1 semaine', icon: 'fa-rocket', condition: (stats) => stats.bestToursInWeek >= 60 },
            { id: 'weekly_100tours', name: 'Semaine intense - 3', desc: '100 tours en 1 semaine', icon: 'fa-rocket', condition: (stats) => stats.bestToursInWeek >= 100 },
            { id: 'weekly_35h', name: 'Bousillé de QI - 1', desc: '35h en 1 semaine', icon: 'fa-briefcase', condition: (stats) => stats.bestHoursInWeek >= 35 },
            { id: 'weekly_50h', name: 'Bousillé de QI - 2', desc: '45h en 1 semaine', icon: 'fa-briefcase', condition: (stats) => stats.bestHoursInWeek >= 45 },
            { id: 'weekly_70h', name: 'Bousillé de QI - 3', desc: '65h en 1 semaine', icon: 'fa-briefcase', condition: (stats) => stats.bestHoursInWeek >= 65 }
        ],
        general: [
            { id: 'gen_0.5month', name: 'Persévérant - 1', desc: '1 semaine de travail', icon: 'fa-calendar-check', condition: (stats) => stats.totalHours >= 168 },
            { id: 'gen_1month', name: 'Persévérant - 2', desc: '1 mois de travail cumulé', icon: 'fa-calendar-check', condition: (stats) => stats.totalHours >= 720 },
            { id: 'gen_2month', name: 'Persévérant - 3', desc: '2 mois de travail cumulé', icon: 'fa-calendar-check', condition: (stats) => stats.totalHours >= 1440 },
            { id: 'gen_500tours', name: 'Machine - 1', desc: '500 tours cumulés', icon: 'fa-gem', condition: (stats) => stats.totalTours >= 500 },
            { id: 'gen_1000tours', name: 'Machine - 2', desc: '1000 tours cumulés', icon: 'fa-gem', condition: (stats) => stats.totalTours >= 1000 },
            { id: 'gen_2000tours', name: 'Machine - 3', desc: '2000 tours cumulés', icon: 'fa-gem', condition: (stats) => stats.totalTours >= 2000 }
        ]
    };
    
let unlockedTrophies = {};

function loadTrophies() {
    if (typeof userData !== 'undefined' && userData && userData.trophies) {
        unlockedTrophies = userData.trophies;
    } else {
        unlockedTrophies = {};
    }
}

function saveTrophies() {
    if (typeof userData !== 'undefined' && userData) {
        userData.trophies = unlockedTrophies;

    }
}

    
    function getCurrentStats() {
        const today = new Date();
        const todayKey = formatDateKey(today);
        
        let totalItems = 0;
        let completedItems = 0;
        
        if (typeof SPECIALTIES_DATA !== 'undefined') {
            SPECIALTIES_DATA.forEach(s => {
                s.items.forEach(item => {
                    totalItems++;
                    const d = getItemData(s.id, item.fc);
                    if (d.tours && d.tours.filter(t => t !== null).length >= 1) {
                        completedItems++;
                    }
                });
            });
        }
        
        const progressPercent = totalItems > 0 ? (completedItems / totalItems) * 100 : 0;
        
        const dailyStats = {};
        let totalTours = 0;
        let totalHours = 0;
        
        if (typeof SPECIALTIES_DATA !== 'undefined') {
            SPECIALTIES_DATA.forEach(s => {
                s.items.forEach(item => {
                    const d = getItemData(s.id, item.fc);
                    if (d.tourDates) {
                        const datesWithIndex = d.tourDates
                            .map((date, idx) => ({ date, idx }))
                            .filter(x => x.date)
                            .sort((a, b) => new Date(a.date) - new Date(b.date));
                        
                        datesWithIndex.forEach((entry, i) => {
                            const date = entry.date.split('T')[0];
                            const idx = entry.idx;
                            
                            if (!dailyStats[date]) {
                                dailyStats[date] = { tours: 0, hours: 0, confidenceSum: 0, confidenceCount: 0, delayCaught: 0 };
                            }
                            
                            dailyStats[date].tours++;
                            totalTours++;
                            
                            if (d.tours && d.tours[idx] !== null) {
                                dailyStats[date].confidenceSum += d.tours[idx];
                                dailyStats[date].confidenceCount++;
                            }
                            
                            if (d.tourDurations && d.tourDurations[idx]) {
                                const parts = d.tourDurations[idx].split(':');
                                const hours = parseInt(parts[0]) || 0;
                                const minutes = parseInt(parts[1]) || 0;
                                const totalH = hours + (minutes / 60);
                                dailyStats[date].hours += totalH;
                                totalHours += totalH;
                            }
                            
                            if (i > 0) {
                                const prevDate = new Date(datesWithIndex[i - 1].date);
                                const currDate = new Date(entry.date);
                                const daysBetween = Math.floor((currDate - prevDate) / (1000 * 60 * 60 * 24));
                                if (daysBetween > 0) {
                                    dailyStats[date].delayCaught += daysBetween;
                                }
                            }
                        });
                    }
                });
            });
        }
        
        let bestToursInDay = 0;
        let bestHoursInDay = 0;
        let hadPerfectDay = false;
        let bestDelayRecovered = 0;
        
        Object.keys(dailyStats).forEach(date => {
            const day = dailyStats[date];
            
            if (day.tours > bestToursInDay) {
                bestToursInDay = day.tours;
            }
            
            if (day.hours > bestHoursInDay) {
                bestHoursInDay = day.hours;
            }
            
            if (day.confidenceCount >= 5) {
                const avgConfidence = day.confidenceSum / day.confidenceCount;
                if (avgConfidence === 5) {
                    hadPerfectDay = true;
                }
            }
            
            if (day.delayCaught > bestDelayRecovered) {
                bestDelayRecovered = day.delayCaught;
            }
        });
        
        const weeklyStats = {};
        
        Object.keys(dailyStats).forEach(dateStr => {
            const date = new Date(dateStr);
            const weekStart = new Date(date);
            weekStart.setDate(date.getDate() - date.getDay());
            const weekKey = formatDateKey(weekStart);
            
            if (!weeklyStats[weekKey]) {
                weeklyStats[weekKey] = { tours: 0, hours: 0 };
            }
            
            weeklyStats[weekKey].tours += dailyStats[dateStr].tours;
            weeklyStats[weekKey].hours += dailyStats[dateStr].hours;
        });
        
        let bestToursInWeek = 0;
        let bestHoursInWeek = 0;
        
        Object.keys(weeklyStats).forEach(week => {
            if (weeklyStats[week].tours > bestToursInWeek) {
                bestToursInWeek = weeklyStats[week].tours;
            }
            if (weeklyStats[week].hours > bestHoursInWeek) {
                bestHoursInWeek = weeklyStats[week].hours;
            }
        });
        
        const todayStats = dailyStats[todayKey] || { tours: 0, hours: 0, confidenceSum: 0, confidenceCount: 0 };
        const avgConfidenceToday = todayStats.confidenceCount > 0 ? todayStats.confidenceSum / todayStats.confidenceCount : 0;
        
        return {
            progressPercent,
            bestToursInDay,
            bestHoursInDay,
            hadPerfectDay,
            bestDelayRecovered,
            bestToursInWeek,
            bestHoursInWeek,
            totalTours,
            totalHours,
            toursToday: todayStats.tours,
            hoursToday: todayStats.hours,
            avgConfidenceToday: Math.round(avgConfidenceToday * 10) / 10
        };
    }
    
    function checkTrophies() {
        const stats = (typeof TrophiesSystem !== 'undefined' && TrophiesSystem.getCurrentStats) 
            ? TrophiesSystem.getCurrentStats() 
            : getCurrentStats();
        
        Object.keys(TROPHIES).forEach(category => {
            TROPHIES[category].forEach(trophy => {
                const conditionMet = trophy.condition(stats);
                
                if (conditionMet && !unlockedTrophies[trophy.id]) {
                    unlockedTrophies[trophy.id] = {
                        date: new Date().toISOString().split('T')[0],
                        category: category
                    };
                }
            });
        });
        
        saveTrophies();
        renderTrophies();
    }
    
    function renderTrophies() {
        const categories = {
            progress: document.getElementById('trophies-progress'),
            daily: document.getElementById('trophies-daily'),
            weekly: document.getElementById('trophies-weekly'),
            general: document.getElementById('trophies-general')
        };
        
        let totalUnlocked = 0;
        let totalTrophies = 0;
        
        Object.keys(TROPHIES).forEach(category => {
            const container = categories[category];
            if (!container) return;
            
            container.innerHTML = TROPHIES[category].map(trophy => {
                totalTrophies++;
                const isUnlocked = !!unlockedTrophies[trophy.id];
                if (isUnlocked) totalUnlocked++;
                
                const unlockedDate = isUnlocked ? unlockedTrophies[trophy.id].date : null;
                const formattedDate = unlockedDate ? formatTrophyDate(unlockedDate) : '';
                
                return `
                    <div class="trophy-item ${isUnlocked ? 'unlocked' : 'locked'}" data-trophy-id="${trophy.id}" title="${trophy.desc}">
                        <div class="trophy-icon"><i class="fas ${trophy.icon}"></i></div>
                        <div class="trophy-name">${trophy.name}</div>
                        <div class="trophy-desc">${trophy.desc}</div>
                        ${isUnlocked ? `<div class="trophy-date">${formattedDate}</div>` : ''}
                    </div>
                `;
            }).join('');
        });
        
        const unlockedCountEl = document.getElementById('trophies-unlocked-count');
        const totalCountEl = document.getElementById('trophies-total-count');
        if (unlockedCountEl) unlockedCountEl.textContent = totalUnlocked;
        if (totalCountEl) totalCountEl.textContent = totalTrophies;
    }
    
    function formatTrophyDate(dateStr) {
        const date = new Date(dateStr);
        const options = { day: 'numeric', month: 'short' };
        return date.toLocaleDateString('fr-FR', options);
    }
    
    function formatDateKey(date) {
        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    }
    
    function init() {
        loadTrophies();
        renderTrophies();
        setTimeout(checkTrophies, 1000);
    }
    
    return {
        init,
        checkTrophies,
        renderTrophies,
        getCurrentStats
    };
})();

// Variable pour tracker si déjà initialisé
let trophiesInitialized = false;

// Initialiser les trophées quand la page stats est visible
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        if (document.getElementById('trophies-progress') && !trophiesInitialized) {
            TrophiesSystem.init();
            trophiesInitialized = true;
        }
    }, 500);
});

// Réinitialiser au changement de page stats
document.querySelectorAll('.app-nav-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        if (this.dataset.page === 'stats' && document.getElementById('trophies-progress') && !trophiesInitialized) {
            setTimeout(() => {
                TrophiesSystem.init();
                trophiesInitialized = true;
            }, 100);
        }
    });
});



function renderSpecialtyLegend() {
    const container = document.getElementById('specialty-legend-items');
    if (!container) return;
    
    const specialtyNames = {
        'cardiologie': 'Cardio',
        'hge': 'Hépato-Gastro',
        'pneumologie': 'Pneumo',
        'gynecologie': 'Gynéco',
        'orl': 'ORL-CMF',
        'neurologie': 'Neuro-Neurochir',
        'psychiatrie': 'Psychiatrie',
        'osteo': 'Ortho-Rhumato',
        'pediatrie': 'Pédiatrie',
        'hematologie': 'Hématologie',
        'endocrinologie': 'Endoc-Nutrition',
        'mir': 'MIR - Anesth',
        'nephrologie': 'Néphro',
        'infectiologie': 'Infectio',
        'dermatologie': 'Dermato',
        'therapeutique': 'Thérapeutique',
        'geriatrie': 'Géria-MPR',
        'douleur': 'Douleur-Soins Pal',
        'medecine-interne': 'Méd Interne-Immuno',
        'oncologie': 'Onco-Anapath',
        'ophtalmologie': 'Ophtalmo',
        'urologie': 'Urologie',
        'medecine-legale': 'ML-MT',
        'sante-publique': 'Santé Pu'
    };
    
    let html = '';
    for (const [id, short] of Object.entries(SPECIALTY_SHORT)) {
        const config = SPECIALTY_CONFIG[id] || { color: '#6b7280' };
        const fullName = specialtyNames[id] || id;
        html += '<span class="specialty-legend-badge" style="background-color: ' + config.color + '20; color: ' + config.color + ';" data-tooltip="' + fullName + '">' + short + '</span>';
    }
    
    container.innerHTML = html;
}
    
    // Utilitaires
    function formatDateKey(date) {
        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    }
    
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
const api = {
    init,
    loadData,              
    renderCalendar,        
    renderChecklist,       
    toggleChecklistItem,
    deleteChecklistItem,
    addItemFromTable,
    showChecklistChoicePopup,
    handleChecklistChoice,
	completeChecklistItem,
    isItemInChecklist,
    getChecklistItemKey
};

		// Exposer globalement
		window.PlanningModule = api;

		return api;
})();

// Initialisation
let planningInitialized = false;
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        if (document.getElementById('page-planning') && !planningInitialized) {
            PlanningModule.init();
            planningInitialized = true;
        }
    }, 100);
});

document.querySelectorAll('.app-nav-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.app-nav-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.app-page').forEach(p => p.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('page-' + this.dataset.page).classList.add('active');
        
        // Scroll jusqu'aux boutons de navigation
        const appNav = document.querySelector('.app-nav');
        if (appNav) {
            const headerHeight = 70;
            const navPosition = appNav.getBoundingClientRect().top + window.pageYOffset - headerHeight - 10;
            window.scrollTo({ top: navPosition, behavior: 'smooth' });
        }
        
        // Rafraîchir la table des items quand on ouvre la page "Liste des Items"
        if (this.dataset.page === 'items') {
            setTimeout(function() {
                if (typeof renderItemsTable === 'function') {
                    renderItemsTable();
                }
            }, 50);
        }
        
        // Rafraîchir les stats et trophées quand on ouvre la page "Statistiques"
        if (this.dataset.page === 'stats') {
            setTimeout(function() {
                // Mettre à jour les graphiques
                if (typeof initWeeklyCharts === 'function') {
                    initWeeklyCharts();
                }
                // Mettre à jour les trophées
                if (typeof TrophiesSystem !== 'undefined') {
                    TrophiesSystem.checkTrophies();
                }
                // Mettre à jour les stats du jour
                if (typeof updateDailyStatsDisplay === 'function') {
                    updateDailyStatsDisplay();
                }
            }, 100);
        }
    });
});


// ===== FONCTION GLOBALE POUR ENVOYER VERS CHECKLIST =====
window.sendToChecklist = function(btn, specialtyId, fc, itemNum, itemName) {
    // Récupérer la couleur de la spécialité
    var specCfg = SPECIALTY_CONFIG[specialtyId] || { color: '#6b7280' };
    var specialty = SPECIALTIES_DATA.find(function(s) { return s.id === specialtyId; });
    var specialtyName = specialty ? specialty.name : '';
    
    // Appeler la fonction du module
    var result = PlanningModule.addItemFromTable(
        specialtyId, 
        fc, 
        itemNum, 
        itemName, 
        specCfg.color, 
        specialtyName
    );
    
    // Afficher le toast
    window.showToastNotification(result.message, result.success ? 'success' : 'warning');
    
    // Si ajout réussi, transformer le bouton en badge "Ajouté"
    if (result.success && btn) {
        var badge = document.createElement('span');
        badge.className = 'added-to-checklist-badge';
        badge.setAttribute('data-specialty', specialtyId);
        badge.setAttribute('data-fc', fc);
        badge.innerHTML = '<i class="fas fa-check"></i> Ajouté';
        btn.parentNode.replaceChild(badge, btn);
    }
};

window.showToastNotification = function(message, type) {
    // Supprimer les toasts existants
    document.querySelectorAll('.toast-notification').forEach(function(t) { t.remove(); });
    
    var toast = document.createElement('div');
    toast.className = 'toast-notification' + (type === 'warning' ? ' toast-warning' : '');
    toast.innerHTML = '<i class="fas ' + (type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle') + '"></i><span>' + message + '</span>';
    document.body.appendChild(toast);
    
    setTimeout(function() { toast.classList.add('show'); }, 10);
    setTimeout(function() {
        toast.classList.remove('show');
        setTimeout(function() { toast.remove(); }, 300);
    }, 2500);
};

window.openTourModalFromChecklist = function(checklistItemId, itemKey) {
    var parts = itemKey.split('-');
    var specialtyId = parts[0];
    var fc = parts.slice(1).join('-');
    
    // Stocker l'ID pour plus tard
    pendingChecklistItemId = checklistItemId;
    
    // Trouver le prochain tour à faire
    var itemData = getItemData(specialtyId, fc);
    var nextTour = 0;
    for (var i = 0; i < itemData.tours.length; i++) {
        if (itemData.tours[i] === null) {
            nextTour = i;
            break;
        }
    }
    
    // Créer un faux élément pour openConfidenceModal
    var fakeElement = document.createElement('span');
    fakeElement.dataset.specialty = specialtyId;
    fakeElement.dataset.fc = fc;
    fakeElement.dataset.tour = nextTour;
    
    // Ouvrir le modal
    openConfidenceModal(fakeElement);
};


// 🔥 OPTIMISATION : Détacher listener quand onglet inactif
let isTabActive = true;
let temporaryUnsubscribe = null;

document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        // Onglet caché
        isTabActive = false;
        console.log('👁️ Onglet inactif - pause sync Firebase');
        
        // Sauvegarder avant de détacher
        if (hasUnsavedChanges) {
            saveUserData();
        }
        
        // Détacher le listener temporairement
        if (unsubscribe) {
            temporaryUnsubscribe = unsubscribe;
            unsubscribe();
            unsubscribe = null;
        }
    } else {
        // Onglet visible à nouveau
        isTabActive = true;
        console.log('👁️ Onglet actif - reprise sync Firebase');
        
        // Réattacher le listener
        if (currentUser && !unsubscribe) {
            loadUserData(currentUser.uid);
        }
    }
});

// Détection inactivité 3 minutes
let inactivityTimer = null;

function resetInactivityTimer() {
    if (inactivityTimer) clearTimeout(inactivityTimer);
    
    inactivityTimer = setTimeout(() => {
        if (!document.hidden && unsubscribe) {
            console.log('😴 Inactif - détachement');
            if (hasUnsavedChanges) saveUserData();
            if (unsubscribe) {
                unsubscribe();
                unsubscribe = null;
            }
        }
    }, 3 * 60 * 1000);
}

['mousedown', 'keydown', 'click'].forEach(e => {
    document.addEventListener(e, resetInactivityTimer, { passive: true });
});
resetInactivityTimer();



</script>

<style>



/* ===== SYSTÈME DE TOOLTIPS ===== */


/* ✨ MODAL EN DARK MODE */
[data-theme="dark"] .help-modal {
    background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
    box-shadow: 0 25px 60px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(59, 130, 246, 0.3);
}

/* Corps du modal */
[data-theme="dark"] .help-modal-body {
    background: #0a0a0a;
}

/* Scrollbar */
[data-theme="dark"] .help-modal-body::-webkit-scrollbar-track {
    background: #1a1a1a;
}

[data-theme="dark"] .help-modal-body::-webkit-scrollbar-thumb {
    background: #3b82f6;
}

[data-theme="dark"] .help-modal-body::-webkit-scrollbar-thumb:hover {
    background: #60a5fa;
}

/* Description - texte clair */
[data-theme="dark"] .help-description p {
    color: #cbd5e1;
}

[data-theme="dark"] .help-description strong {
    color: #f1f5f9;
}

/* Points clés - version dark */
[data-theme="dark"] .help-key-points {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%);
    border-left-color: #60a5fa;
}

[data-theme="dark"] .help-key-points-title {
    color: #60a5fa;
}

[data-theme="dark"] .help-key-points li {
    color: #cbd5e1;
}

/* Astuce - version dark */
[data-theme="dark"] .help-tip {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.15) 100%);
    border-left-color: #fbbf24;
}

[data-theme="dark"] .help-tip-content strong {
    color: #fbbf24;
}

[data-theme="dark"] .help-tip-content p {
    color: #fde68a;
}

/* Footer du modal */
[data-theme="dark"] .help-modal-footer {
    background: #0f0f0f;
    border-top-color: #2a2a2a;
}

/* Point d'interrogation - VERSION DISCRÈTE */
.help-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #94a3b8;  /* Gris au repos */
    color: white;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    margin-left: 8px;
    opacity: 0.6;
    transform: scale(1);
    box-shadow: 0 0 0 rgba(59, 130, 246, 0);
    
    /* ✨ Transitions SÉPARÉES pour chaque propriété */
    transition: background 0.4s ease, 
                opacity 0.4s ease, 
                transform 0.3s ease, 
                box-shadow 0.4s ease;
}

.help-icon:hover {
    background: #3b82f6;  /* Bleu solide au lieu de gradient */
    opacity: 1;
    transform: scale(1.1);
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.help-icon:active {
    transform: scale(0.95);
}

.help-icon.pulse {
    animation: none;
}


.help-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.help-modal-overlay.active {
    display: flex;
    opacity: 1;
}

.help-modal {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 20px;
    box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
    max-width: 600px;
    width: 90%;
    max-height: 85vh;
    overflow: hidden;
    transform: scale(0.9) translateY(20px);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    flex-direction: column;
}

.help-modal-overlay.active .help-modal {
    transform: scale(1) translateY(0);
}

.help-modal-header {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    padding: 24px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.help-modal-title {
    display: flex;
    align-items: center;
    gap: 12px;
    color: white;
}

.help-modal-icon {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.25);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
}

.help-modal-title h3 {
    font-size: 20px;
    font-weight: 700;
    margin: 0;
}

.help-modal-close {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.help-modal-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

.help-modal-body {
    padding: 28px;
    overflow-y: auto;
}

.help-description p {
    color: #475569;
    line-height: 1.7;
    font-size: 15px;
    margin-bottom: 12px;
}

.help-description strong {
    color: #1e293b;
    font-weight: 600;
}

.help-key-points {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    border-left: 4px solid #3b82f6;
}

.help-key-points-title {
    font-size: 17px;
    font-weight: 700;
    color: #1e40af;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.help-key-points ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.help-key-points li {
    padding: 6px 0 6px 26px;
    position: relative;
    color: #334155;
    font-size: 14px;
    line-height: 1.6;
}
.help-key-points li::before {
    content: "✓";
    position: absolute;
    left: 0;
    top: 6px;
    width: 18px;
    height: 18px;
    background: #3b82f6;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 10px;
}

.help-tip {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border-radius: 12px;
    padding: 16px;
    margin-top: 16px;
    display: flex;
    gap: 12px;
    border-left: 4px solid #f59e0b;
}

.help-tip-icon {
    width: 22px;
    height: 22px;
    min-width: 22px;
    background: #f59e0b;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
}

.help-tip-content strong {
    display: block;
    color: #92400e;
    font-size: 17px;
    font-weight: 700;
    margin-bottom: 4px;
}

.help-tip-content p {
    color: #78350f;
    font-size: 14px;
    line-height: 1.5;
    margin: 0;
}

.help-modal-footer {
    padding: 16px 28px;
    background: #f8fafc;
    border-top: 1px solid #e2e8f0;
    display: flex;
    justify-content: flex-end;
}

.help-modal-btn {
    padding: 10px 24px;
    border-radius: 10px;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.help-modal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

/* ===== CHRONOMÈTRE ===== */
.timer-button {
    padding: 0.625rem 1rem;
    border-radius: var(--border-radius-md);
    font-weight: 500;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--gray-200);
    color: var(--gray-700);
    transition: all var(--transition-normal);
    border: 2px solid transparent;
}

.timer-button:hover {
    background: var(--gray-300);
    box-shadow: var(--shadow-md);
}

/* NOUVEAU - Bouton chronomètre avec états */
.timer-button.active {
    color: white;
    border-color: transparent;
}

.timer-button.active.running {
    background: var(--success);
    animation: pulse 2s infinite;
}

.timer-button.active.running:hover {
    background: var(--success-dark);
}

.timer-button.active.paused {
    background: var(--warning);
    animation: none; /* Important : désactiver le pulse */
}

.timer-button.active.paused:hover {
    background: #d97706;
}

.timer-modal {
    position: absolute;
    top: calc(100% + 0.5rem);
    right: 0;
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    padding: 1.5rem;
    min-width: 280px;
    z-index: var(--z-dropdown);
    display: none;
    border: 2px solid var(--gray-200);
}

.timer-modal.show {
    display: block;
    animation: fadeInUp 0.3s ease-out;
}

.timer-display {
    text-align: center;
    margin-bottom: 1.5rem;
}

.timer-time {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
    font-family: var(--font-display);
    letter-spacing: 0.05em;
}

.timer-controls {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.timer-btn {
    padding: 0.75rem 1.25rem;
    border-radius: var(--border-radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all var(--transition-normal);
    border: 2px solid transparent;
}

.timer-btn-start {
    background: var(--success);
    color: white;
}

.timer-btn-start:hover {
    background: var(--success-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.timer-btn-pause {
    background: var(--warning);
    color: white;
}

.timer-btn-pause:hover {
    background: #d97706;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.timer-btn-stop {
    background: var(--danger);
    color: white;
}

.timer-btn-stop:hover {
    background: #dc2626;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.timer-close {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: var(--gray-200);
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-600);
    transition: all var(--transition-fast);
}

.timer-close:hover {
    background: var(--gray-300);
    color: var(--gray-800);
    transform: rotate(90deg);
}

.legend-close {
    background: var(--gray-200);
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-600);
    transition: all var(--transition-fast);
}

.legend-close:hover {
    background: var(--gray-300);
    color: var(--gray-800);
    transform: rotate(90deg);
}

/* ===== BOUTON LÉGENDE ===== */
.legend-button {
    padding: 0.625rem 1rem;
    border-radius: var(--border-radius-md);
    font-weight: 500;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--gray-200);
    color: var(--gray-700);
    transition: all var(--transition-normal);
    border: 2px solid transparent;
}

.legend-button:hover {
    background: var(--gray-300);
    box-shadow: var(--shadow-md);
}

.legend-modal {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    padding: 1.25rem;
    min-width: 320px;
    max-width: 400px;
    z-index: var(--z-dropdown);
    display: none;
    border: 2px solid var(--gray-200);
}

.legend-modal.show {
    display: block;
    animation: fadeInUp 0.3s ease-out;
}

.legend-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--gray-200);
}

.legend-modal-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--gray-900);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.legend-close {
    background: var(--gray-200);
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-600);
    transition: all var(--transition-fast);
}

.legend-close:hover {
    background: var(--gray-300);
    color: var(--gray-800);
}

/* NOUVEAU - Sélecteurs spécifiques au modal */
.legend-modal .legend-items {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.legend-modal .legend-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem;
    border-radius: var(--border-radius-sm);
    transition: background var(--transition-fast);
}

.legend-modal .legend-item:hover {
    background: var(--gray-100);
}

.legend-modal .legend-badge {
    padding: 0.25rem 0.5rem;
    border-radius: var(--border-radius-sm);
    font-size: 0.75rem;
    font-weight: 600;
    min-width: 60px;
    text-align: center;
}

.legend-modal .legend-description {
    font-size: 0.875rem;
    color: var(--gray-700);
    flex: 1;
}

/* ===== RESPONSIVE MOBILE POUR CHRONO ET LÉGENDE ===== */
@media (max-width: 768px) {
    /* Réduire la taille des boutons sur mobile */
    .timer-button,
    .legend-button {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
        gap: 0.4rem;
    }
    
    .timer-button span,
    .legend-button span {
        display: none; /* Cacher le texte sur mobile */
    }
    
    .timer-button i,
    .legend-button i {
        font-size: 1rem;
        margin: 0;
    }
    
    /* Centrer les modals sur mobile */
    .timer-modal,
    .legend-modal {
        position: absolute;
        top: calc(100% + 0.5rem);
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        max-width: calc(100vw - 2rem);
        width: 90vw;
    }
    
    /* Désactiver l'animation fadeInUp sur mobile */
    .timer-modal.show,
    .legend-modal.show {
        animation: fadeInMobile 0.2s ease-out;
    }
}

/* Animation spécifique pour mobile (sans transform) */
@keyframes fadeInMobile {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Pour très petits écrans */
@media (max-width: 480px) {
    .quick-actions {
        gap: 0.5rem;
    }
    
    .timer-button,
    .legend-button,
    .quick-action-btn {
        padding: 0.5rem;
        font-size: 0.75rem;
    }
    
    .timer-modal,
    .legend-modal {
        width: 95vw;
    }
}

</style>

<!-- Modal -->
<div class="help-modal-overlay" id="helpModalOverlay" onclick="closeHelpModal(event)">
    <div class="help-modal" onclick="event.stopPropagation()">
        <div class="help-modal-header">
            <div class="help-modal-title">
                <div class="help-modal-icon" id="helpModalIcon">
                    <i class="fas fa-question"></i>
                </div>
                <h3 id="helpModalTitle">Titre</h3>
            </div>
            <button class="help-modal-close" onclick="closeHelpModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="help-modal-body" id="helpModalBody"></div>
        <div class="help-modal-footer">
            <button class="help-modal-btn" onclick="closeHelpModal()">
                Compris <i class="fas fa-check"></i>
            </button>
        </div>
    </div>
</div>

<script>
const helpContent = {
    'stats-daily': {
        icon: 'fa-calendar-day',
        title: 'Statistiques Quotidiennes',
        content: `
            <div class="help-description">
                <p>Votre <strong>tableau de bord quotidien</strong> affiche vos statistiques du jour en temps réel.</p>
            </div>
            <div class="help-key-points">
                <div class="help-key-points-title"><i class="fas fa-clock"></i> Statistiques clés</div>
                <ul>
                    <li><strong>Tours effectués</strong> : nombre d'items révisés aujourd'hui.</li>
                    <li><strong>Retard rattrapé</strong> : jours de retard rattrapé (si un item qui n'avait pas été vu depuis 30 jours est vu alors + 30j de retard rattrapé).</li>
                    <li><strong>Temps de travail</strong> : durée totale de vos révisions des items.</li>
                    <li><strong>Ressenti moyen</strong> : votre niveau de confiance (1-5) moyen sur la journée.</li>
                </ul>
            </div>
            <div class="help-tip">
                <div class="help-tip-icon">💡</div>
                <div class="help-tip-content">
                    <strong>Conseil</strong>
                    <p>Pas de stress : il est normal que le temps de travail indiqué soit inférieur au temps de travail réel, car les sessions de QCM ne sont pas prises en compte.</p>
                </div>
            </div>
        `
    },
    'stats-weekly': {
        icon: 'fa-chart-line',
        title: 'Graphiques de la Semaine',
        content: `
            <div class="help-description">
                <p>Visualisez <strong>l'évolution de votre travail sur les 7 derniers jours</strong> sur des graphiques.</p>
            </div>
            <div class="help-key-points">
                <div class="help-key-points-title"><i class="fas fa-chart-bar"></i> Trois graphiques</div>
                <ul>
                    <li><strong>Tours effectués</strong> : évolution quotidienne.</li>
                    <li><strong>Temps de travail</strong> : suivi du temps à réviser les items.</li>
                    <li><strong>Ressenti moyen</strong> : tendance de votre niveau confiance sur les items sur les 7 derniers jours.</li>
                </ul>
            </div>
            <div class="help-tip">
                <div class="help-tip-icon">💡</div>
                <div class="help-tip-content">
                    <strong>Conseil</strong>
                    <p>Voyez ces statistiques comme un moyen de vous motiver ; n’oubliez pas qu’il est normal de moins travailler certains jours de la semaine.</p>
                </div>
            </div>
        `
    },
    'stats-general': {
        icon: 'fa-chart-pie',
        title: 'Statistiques Générales',
        content: `
            <div class="help-description">
                <p>Votre <strong>vue d'ensemble</strong> : toutes vos révisions cumulées.</p>
            </div>
            <div class="help-key-points">
                <div class="help-key-points-title"><i class="fas fa-trophy"></i> Indicateurs globaux</div>
                <ul>
                    <li><strong>Items révisés</strong> : nombre d'item (en comptant les doublons dans les différents collèges) vu au moins une fois (≥1 tour) - Voir Précisions 1</li>
                    <li><strong>Items de référence</strong> : nombre d'items de référence vu au moins une fois (≥1 tour) - Voir Précisions 2</li>
                    <li><strong>Tours totaux</strong> : nombre total de tours fait sur tous les items.</li>
                    <li><strong>Temps total</strong> : temps cumulé passer à réviser les items.</li>
                </ul>
            </div>
			 <div class="help-tip">
                <div class="help-tip-icon">💡</div>
                <div class="help-tip-content">
                    <strong>Précision - 1</strong>
                    <p>Le programme sur le LISA comporte 367 items à réviser pour les EDN. Le tableur comporte en tout 747 items, tous collèges confondus (avec de nombreux doublons entre les collèges). La case bleue correspond au nombre d’items vus sur 747.</p>
                </div>
            </div>
			<div class="help-tip">
                <div class="help-tip-icon">💡</div>
                <div class="help-tip-content">
                    <strong>Précision - 2</strong>
                    <p>Parmi les 747 items du tableur, 411 sont étiquetés « Collège de référence » : pour chaque item, un collège est indiqué comme étant le collège de référence, censé faire foi pour les EDN. Attention, certains gros items sont divisés en plusieurs plus petits, ce qui explique pourquoi on obtient 411. La case orange correspond au nombre d’items vus dans les collèges de référence sur 411.</p>
                </div>
            </div>
			
        `
    },
    'stats-trophies': {
        icon: 'fa-trophy',
        title: 'Système de Trophées',
        content: `
            <div class="help-description">
                <p>Débloquez des <strong>trophées</strong> au fur et à mesure de l'externat.</p>
            </div>
            <div class="help-key-points">
                <div class="help-key-points-title"><i class="fas fa-medal"></i> Types de trophées</div>
                <ul>
                    <li><strong>Complétion du programme</strong> : % des items vu au moins une fois parmi les 747 items du tableur.</li>
                    <li><strong>Trophées quotidiens</strong> : débloqués lors de performances exceptionnelles un jour de votre externat.</li>
                    <li><strong>Trophées hebdomadaires</strong> : débloqués lors de performances exceptionnelles une semaine de votre externat du lundi au dimanche.</li>
                    <li><strong>Accomplissements</strong> : quand les heures de travail deviennent des jours, les jours deviennent des semaines et les semaines deviennent des mois.</li>
                </ul>
            </div>
			<div class="help-tip">
                <div class="help-tip-icon">💡</div>
                <div class="help-tip-content">
                    <strong>Précision</strong>
                    <p>Les trophées sont à prendre avec légèreté, c'est plus une blague qu'un réel indicateur de performance. Beaucoup se débloquent en fin de D3, pendant les révisions.</p>
                </div>
            </div>
        `
    },
	'dashboard-specialties': {
    icon: 'fa-chart-line',
    title: 'Liste des Spécialités',
    content: `
        <div class="help-description">
            <p>Chaque <strong>carte</strong> représente une matière qui sera à aborder au cours de l'externat.</p>
            <p>Certaines spécialités sont regroupées car proches ou à travailler conjointement (par exemple : neurologie et neurochirurgie).</p>
			<p>Utilisez les filtres et le tri pour naviguer efficacement entre les différentes matières.</p>

        </div>
        <div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-info-circle"></i> Informations</div>
            <ul>
                <li>Les <strong>24 matières</strong> de l'externat.</li>
                <li>Nombre total d'items par matière.</li>
                <li><strong>Statistiques par matière :</strong> temps de travail total, nombre de tours, moyenne du ressenti sur les tours.</li>
                <li><strong>Barre de progression visuelle.</strong></li>
            </ul>
        </div>
				<div class="help-tip">
                <div class="help-tip-icon">💡</div>
                <div class="help-tip-content">
                    <strong>Astuce</strong>
                    <p>Accédez directement à la liste des items d’une matière en cliquant sur l’une des cases.</p>
                </div>
        </div>
    `
},
'items-list': {
    icon: 'fa-list-check',
    title: 'Liste des Items',
    content: `
        <div class="help-description">
            <p>Ce tableau centralise tous les <strong>items R2C</strong> du programme des EDNs.</p>
            <p>Utilisez les filtres et le tri pour naviguer efficacement entre les différents items.</p>
        </div>

		
		
		<div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-table"></i> Liste des items</div>
					<ul>
						<li><strong>To-do List</strong> : envoyez directement dans la to-do list les items que vous souhaitez réviser.</li>
						<li><strong>Liens cliquables</strong> : les noms des items de référence apparaissent en bleu. Cliquez sur le lien pour accéder directement aux fiches LISA (après connexion à votre compte UNESS).</li>
						<li><strong>Tri</strong> : Cliquez sur les en-têtes pour trier les items.</li>

					</ul>

        </div>
		<div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-star"></i> Précisions items</div>
            <ul>
            <li><strong>Items de référence</strong> : certains items sont étiquetés « Collège de référence ». Pour chacun d’eux, un collège est désigné comme faisant foi pour les EDN.</li>

			<li><strong>Collèges associés</strong> : certains items sont accompagnés d’une pastille indiquant un collège secondaire. Celle-ci précise : les items pertinents à lire dans un autre collège (ex. : déficit immunitaire en immunologie) ; ou, dans le cas de groupes de spécialités, les items à travailler dans la spécialité secondaire (ex. : MPR dans le groupe gériatrie–MPR).
			</li>
            </ul>
        </div>
		
		
		<div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-pencil"></i> Tours (T1-T8)</div>
            <ul>
				<li><strong>Entrer vos tours :</strong> cliquez sur les cases T1-T8 pour faire apparaitre le formulaire.</li>
				<li><strong>Confiance :</strong> en auto-évaluation, indiquez votre ressenti sur la maitrise de l'item.</li>
				<li><strong>Date :</strong> la date du jour est entrée par défaut, vous pouvez également la modifier.</li>
				<li><strong>Durée :</strong> si vous le souhaitez indiquez le temps passé à travailler l'item pendant le tour.</li>
				<li><strong>Support :</strong> si vous le souhaitez indiquez le support que vous avez utilisé pour travailler l'item.</li>
            </ul>
        </div>
		        <div class="help-tip">
            <div class="help-tip-icon">💡</div>
            <div class="help-tip-content">
                <strong>Conseil</strong>
                <p>La régularité est la clé de la réussite : même si insérer des tours peut paraître un peu laborieux sur le moment, cela vous rendra service pendant les révisions.</p>
            </div>
        </div>
		
		<div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-book-open"></i> Ressources</div>
            <ul>
				<li><strong>Sélection</strong> : sélectionnez les ressources que vous utilisez parmi la liste proposée.</li>
				<li><strong>Valider</strong> : validez les ressources réalisées pour chaque item (fiche de révision, QI EDN, etc.).</li>
				<li><strong>Sauvegarde</strong> : les ressources validées sont sauvegardées, même si vous changez les ressources sélectionnées.</li>

            </ul>
        </div>
		<div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-clock"></i> Dernières révisions</div>
            <ul>
				<li><strong>Nombre de jour depuis le dernier tour sur un item</strong></li>
				<li><strong>Se met à 0j quand un nouveau tour est entré.</strong></li>
            </ul>
        </div>
		<div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-sync fa-spin"></i> Sauvegarde</div>
            <ul>
				<li><strong>Sauvegarde des données</strong> : elle s'effectue 10 secondes après la dernière modification. Évitez de fermer la page ou de vous déconnecter pendant ce délai.</li>
				
            </ul>
        </div>

    `
},



'planning-checklist': {
    icon: 'fa-tasks',
    title: 'To-Do List Quotidienne',
    content: `
        <div class="help-description">
            <p>Votre <strong>checklist personnelle</strong> pour organiser vos révisions du jour.</p>
            <p>Ajoutez des items à travailler depuis la « liste des items » en appuyant sur le bouton « To-do List ».</p>
        </div>
        <div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-tasks"></i> Fonctionalités</div>
            <ul>
			<li><strong>Créer</strong> : tapez le nom d’une tâche à effectuer.</li>
			<li><strong>Valider les tâches</strong> : marquez une tâche comme terminée.</li>
			<li><strong>Entrer des tours</strong> : enregistrez un tour de révision depuis la checklist en appuyant sur la case de validation.</li>
			<li><strong>Supprimer</strong> : retirez l’item ou la tâche de votre liste si vous le souhaitez.</li>
            </ul>
        </div>
        <div class="help-tip">
            <div class="help-tip-icon">💡</div>
            <div class="help-tip-content">
                <strong>Astuce</strong>
                <p>Entrez vos tours directement depuis la To-do List pour gagner du temps.</p>
            </div>
        </div>
    `
},
'planning-calendar': {
    icon: 'fa-calendar-alt',
    title: 'Calendrier & Statuts',
    content: `
        <div class="help-description">
            <p>Votre <strong>planning de l'année</strong> qui vous aidera à organiser vos semaines.</p>
            
        </div>
        <div class="help-key-points">
            <div class="help-key-points-title"><i class="fas fa-tasks"></i> Fonctionnalités</div>
            <ul>
				<li><strong>Statut du jour</strong> : indiquez chaque jour un statut (révision, stage, garde, repos). Vous pouvez également remplir l’ensemble des jours d’une semaine en une seule fois via la case située sous le pop-up « lundi ».</li>
				<li><strong>Spécialité(s) travaillée(s)</strong> : matière(s) étudiée(s) dans la journée, de la même façon vous pouvez remplir l’ensemble des jours d’une semaine en une seule fois.</li>
				<li><strong>Visualisation</strong> : codes couleur pour visualiser l’organisation de vos semaines à venir.</li>
				<li><strong>Zone de texte</strong> : indiquez les événements à venir en appuyant sur les cases «notes».</li>
				<li><strong>Navigation</strong> : naviguez de mois en mois.</li>

            </ul>
        </div>
        <div class="help-tip">
            <div class="help-tip-icon">💡</div>
            <div class="help-tip-content">
                <strong>Astuce</strong>
                <p>Remplissez votre planning à l’avance et consultez-le sur tous vos appareils en cas de besoin.</p>
            </div>
        </div>
    `
},


};

function openHelpModal(contentId) {
    const data = helpContent[contentId];
    if (!data) return;
    
    document.getElementById('helpModalIcon').innerHTML = `<i class="fas ${data.icon}"></i>`;
    document.getElementById('helpModalTitle').textContent = data.title;
    document.getElementById('helpModalBody').innerHTML = data.content;
    
    const overlay = document.getElementById('helpModalOverlay');
    overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeHelpModal(event) {
    if (event && event.target.id !== 'helpModalOverlay') return;
    
    const overlay = document.getElementById('helpModalOverlay');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeHelpModal();
});


// ===== CHRONOMÈTRE =====
let timerInterval = null;
let timerSeconds = 0;
let timerRunning = false;
let timerPaused = false;

function formatTime(seconds) {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    if (hrs > 0) {
        return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }
    return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
}

function updateTimerDisplay() {
    document.getElementById('timerDisplay').textContent = formatTime(timerSeconds);
}

function updateTimerButton() {
    const button = document.getElementById('timerButton');
    const icon = document.getElementById('timerIcon');
    
    // Retirer toutes les classes d'état
    button.classList.remove('active', 'running', 'paused');
    
    if (timerRunning && !timerPaused) {
        // Chrono en cours
        button.classList.add('active', 'running');
        icon.className = 'fas fa-stopwatch';
    } else if (timerRunning && timerPaused) {
        // Chrono en pause
        button.classList.add('active', 'paused');
        icon.className = 'fas fa-pause-circle';
    } else {
        // Chrono arrêté
        icon.className = 'fas fa-clock';
    }
}

function updateTimerControls() {
    const controls = document.getElementById('timerControls');
    
    if (!timerRunning && timerSeconds === 0) {
        // État initial : afficher bouton démarrer
        controls.innerHTML = `
            <button class="timer-btn timer-btn-start" onclick="startTimer()">
                <i class="fas fa-play"></i>
                Démarrer
            </button>
        `;
    } else if (timerRunning && !timerPaused) {
        // En cours : afficher pause et stop
        controls.innerHTML = `
            <button class="timer-btn timer-btn-pause" onclick="event.stopPropagation(); pauseTimer()">
                <i class="fas fa-pause"></i>
                Mettre en pause
            </button>
            <button class="timer-btn timer-btn-stop" onclick="stopTimer()">
                <i class="fas fa-stop"></i>
                Arrêter
            </button>
        `;
    } else if (timerPaused) {
        // En pause : afficher reprendre et stop
        controls.innerHTML = `
            <button class="timer-btn timer-btn-start" onclick="resumeTimer()">
                <i class="fas fa-play"></i>
                Reprendre
            </button>
            <button class="timer-btn timer-btn-stop" onclick="stopTimer()">
                <i class="fas fa-stop"></i>
                Arrêter
            </button>
        `;
    }
}

function startTimer() {
    timerRunning = true;
    timerPaused = false;
    timerInterval = setInterval(() => {
        timerSeconds++;
        if (timerSeconds >= 86400) { // 86400 = 24h
            stopTimer();
        }
        updateTimerDisplay();
    }, 1000);
    updateTimerButton();
    updateTimerControls();
}

function pauseTimer() {
    timerPaused = true;
    clearInterval(timerInterval);
	updateTimerButton();
    updateTimerControls();
}

function resumeTimer() {
    timerPaused = false;
    timerInterval = setInterval(() => {
        timerSeconds++;
        updateTimerDisplay();
    }, 1000);
	updateTimerButton();
    updateTimerControls();
}

function stopTimer() {
    timerRunning = false;
    timerPaused = false;
    clearInterval(timerInterval);
    timerSeconds = 0;
    updateTimerDisplay();
    updateTimerButton();
    updateTimerControls();
	loseTimerModal(); 
}

function toggleTimerModal(event) {
    event.stopPropagation();
    const modal = document.getElementById('timerModal');
    const legendModal = document.getElementById('legendModal');
    
    // Fermer le modal légende s'il est ouvert
    legendModal.classList.remove('show');
    
    if (modal.classList.contains('show')) {
        modal.classList.remove('show');
    } else {
        modal.classList.add('show');
        updateTimerControls();
    }
}

function closeTimerModal() {
    document.getElementById('timerModal').classList.remove('show');
}

// ===== LÉGENDE =====
function toggleLegendModal(event) {
    event.stopPropagation();
    const modal = document.getElementById('legendModal');
    const timerModal = document.getElementById('timerModal');
    
    // Fermer le modal chronomètre s'il est ouvert
    timerModal.classList.remove('show');
    
    if (modal.classList.contains('show')) {
        modal.classList.remove('show');
    } else {
        modal.classList.add('show');
    }
}

function closeLegendModal() {
    document.getElementById('legendModal').classList.remove('show');
}

// ===== FERMETURE DES MODALS EN CLIQUANT AILLEURS =====
document.addEventListener('click', function(event) {
    const timerModal = document.getElementById('timerModal');
    const timerButton = document.getElementById('timerButton');
    const legendModal = document.getElementById('legendModal');
    const legendButton = document.querySelector('.legend-button');
    
    // Fermer le modal chronomètre si on clique ailleurs
    if (timerModal && timerModal.classList.contains('show')) {
        if (!timerModal.contains(event.target) && !timerButton.contains(event.target)) {
            timerModal.classList.remove('show');
        }
    }
    
    // Fermer le modal légende si on clique ailleurs
    if (legendModal && legendModal.classList.contains('show')) {
        if (!legendModal.contains(event.target) && !legendButton.contains(event.target)) {
            legendModal.classList.remove('show');
        }
    }
});

// ===== RÉINITIALISATION DU CHRONOMÈTRE =====
// À la fermeture de la page
window.addEventListener('beforeunload', function() {
    stopTimer();
});

// Exposer les fonctions pour debug (nécessaire car script module)
window.countDataContent = countDataContent;
window.isDataSafeToSave = isDataSafeToSave;
window.saveBackupToLocalStorage = saveBackupToLocalStorage;
window.getBackupsFromLocalStorage = getBackupsFromLocalStorage;
window.restoreFromBackup = restoreFromBackup;

// 🔧 Fonctions utilitaires pour debug/admin (accessibles depuis la console)
window.BackupUtils = {
    // Voir tous les backups
    listBackups: function() {
        if (!currentUser) {
            console.error('Non connecté');
            return;
        }
        const backups = getBackupsFromLocalStorage(currentUser.uid);
        console.log(`📦 ${backups.length} backup(s) disponible(s):`);
        backups.forEach((b, i) => {
            console.log(`  ${i}: ${b.timestamp} - ${b.itemsCount} items`);
        });
        return backups;
    },
    
    // Restaurer un backup spécifique
    restore: function(index = 0) {
        if (!currentUser) {
            console.error('Non connecté');
            return;
        }
        const restored = restoreFromBackup(currentUser.uid, index);
        if (restored) {
            userData = restored;
            renderAll();
            console.log('✅ Données restaurées ! Appelez BackupUtils.saveRestored() pour sauvegarder sur Firebase');
        }
        return restored;
    },
    
    // Sauvegarder après restauration
    saveRestored: function() {
        if (!currentUser || !userData) {
            console.error('Non connecté ou pas de données');
            return;
        }
        // Forcer la sauvegarde même si protection
        const itemsCount = Object.keys(userData.items || {}).length;
        if (itemsCount > 0) {
            console.log(`💾 Sauvegarde de ${itemsCount} items...`);
            saveUserData();
        } else {
            console.error('❌ Impossible de sauvegarder des données vides');
        }
    },
    
    // Forcer un backup manuel
    forceBackup: function() {
        if (!currentUser || !userData) {
            console.error('Non connecté ou pas de données');
            return;
        }
        saveBackupToLocalStorage(currentUser.uid, userData);
    }
};

console.log('🛡️ Protection anti-écrasement activée');
console.log('💾 Système de backup localStorage activé (3 versions)');
console.log('ℹ️ Utilisez BackupUtils.listBackups() pour voir les backups disponibles');

</script>



</body>
</html>